<?php
namespace app\db;

use \PDOStatement;

class sql
{

      //
      private static $dbcon=false;
      private $host;
      private $port;
      private $user;
      private $pass;
      private $db;
      private $charset;
      private $link;
      
      private $pgechostr;
      //
      private function __construct($config=array()){
      global $config;

        $this->host = $config['db']['host'];
        $this->port = $config['db']['port'];
        $this->user = $config['db']['username'];
        $this->pass = $config['db']['password'] ;
        $this->db = $config['db']['dbname'];
        $this->charset=isset($arr['charset']) ? $arr['charset'] : 'utf8';
        //
        $this->db_connect();
        //
        $this->db_usedb();
        //
        $this->db_charset();

               
       }
       //
 
       
       private function db_connect(){
       
        $this->link=mysqli_connect($this->host.':'.$this->port,$this->user,$this->pass);
       
        if(!$this->link){
          echo "失败<br>";
          echo "エラーＮＯ".mysqli_errno($this->link)."<br>";
          echo "エラー".mysqli_error($this->link)."<br>";
          exit;
        }
       }
       //
        private function db_charset(){
         mysqli_query($this->link,"set names {$this->charset}");
        }
        //
       private function db_usedb(){
         mysqli_query($this->link,"use {$this->db}");
       }
       //
       private function __clone(){
         die('clone is not allowed');
       }
       //
       public static function getIntance(){
         if(self::$dbcon==false){
          self::$dbcon=new self;
         }
         return self::$dbcon;
       }
        public function noauto_commit(){
			$this->link->autocommit(FALSE);
        }
        public function auto_commit(){
			$this->link->autocommit(TRUE);
        }        
		public function pg_commit(){
			$this->link->commit();
		}
		public function pg_rollback(){
			$this->link->rollback();
		}
       //sql
        public function query($sql){
         $res=mysqli_query($this->link,$sql);
         if(!$res){
          echo "sql失败<br>";
          echo "エラーＮＯ".mysqli_errno($this->link)."<br>";
          echo "エラー".mysqli_error($this->link)."<br>";

         }
         
         return $res;
       }

       function selectCompanyid__areaidsByCompany_id($companyid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from companyid_areaids as ca left join areas as a on ca.area_id =a.areaid  where ca.company_id  = ?";
       		$tmp="$companyid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$companyid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['acid']			=$row['acid'];
			    $rtn[$i]['company_id']		=$row['company_id'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['showindex']		=$row['showindex'];
			    
			    $rtn[$i]['areaid']		=$row['areaid'];
			    $rtn[$i]['areaname_jp']		=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']		=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']		=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']		=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']		=$row['areaname_kr'];
			    $rtn[$i]['areainvalid']		=$row['areainvalid'];
			    
			        
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }
       
              
       function deleteCompanyid__areaidsByCompany_id($companyid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from companyid_areaids  where company_id  = ?";
       		$tmp="$companyid";
       		
   		
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$companyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }
       
       function addCompanyid__areaids($company_id,$area_id){
			$sql="INSERT companyid_areaids (company_id,area_id) VALUES(?,?)";
			$tmp="$company_id,$area_id";
			

			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("ii", $company_id,$area_id);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }
       
       function addlog($ip,$serialnum,$url){
			$sql="INSERT log (ip,serialnum,url) VALUES(?,?,?)";
			$tmp="$company_id,$area_id";
			

			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("sss",$ip,$serialnum,$url);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }
       //
       function pge($strdebug,$strprama,$typestr){
       		//$tmp="$brand_id";	
       		//$this->echo($sql,$tmp,'i');
              
       		$this->pgechostr=$strdebug;
       		$arrprama = explode(",",$strprama);
 
			$arrtypestr = array();//
			for($i=0;$i<strlen($typestr);$i++){//
				$arrtypestr[] = $typestr[$i];
			}	
       		$loopcnt=substr_count($strdebug,'?');
       		for($i=0;$i<$loopcnt;$i++){
       			if($arrtypestr[$i]=="s"){
       				$this->pgechostr=preg_replace("/\?/","'".$arrprama[$i]."'",$this->pgechostr,1);
       			}else{
       				$this->pgechostr=preg_replace("/\?/",$arrprama[$i],$this->pgechostr,1);
       			}
       		}
       		echo "<div id='pge' style='display:none'>[".$this->pgechostr."]</div>";
     		
       }
       //
        public function p($arr){
          echo "<pre>";
          print_r($arr);
          echo "</pre>";
        }
        public function v($arr){
        echo "<pre>";
          var_dump($arr);
          echo "</pre>";
        }
        
        //id
        public function getInsertid(){
         return mysqli_insert_id($this->link);
        }
        
       /**
        * 
        * @param
        * @return string or int
        */
        public function getAll($sql){
         $query=$this->query($sql);
         $list=array();
         while ($r=$this->getFormSource($query)) {
          $list[]=$r;
         }
         return $list;
        }
		
        public function getFormSource($query,$type="assoc"){
	        if(!in_array($type,array("assoc","array","row")))
	        {
	          die("mysqli_query error");
	        }
	        $funcname="mysqli_fetch_".$type;
	        return $funcname($query);
        }

       public function update($sql){

        	$this->query($sql);
        	return mysqli_affected_rows($this->link);
        
       }
       //
       function searchCoupons($searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select * from coupons where  CONCAT_WS(`couponcd`,`couponadultpoint`,`couponname_jp`,`couponcomment_jp`) LIKE CONCAT('%',?,'%')  and coupondeleter=0  order by couponcreatetime desc limit ?,?";
			$tmp="$searchkey,$start_from, $num_rec_per_page";

			$stmt = $this->link->prepare($sql);


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname']			=$row['couponname'];
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany']	=$row['couponheldcompany'];
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			   
			    $rtn[$i]['couponname_jp']		=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']		=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']		=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']		=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']		=$row['couponname_kr'];

			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }               

       function searchBuyings($urlareaid,$searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from coupons where  CONCAT(`couponcd`,`couponadultpoint`,`couponname_jp`,`couponcomment_jp`) LIKE CONCAT('%',?,'%')  and coupondeleter=0  order by couponcreatetime desc limit ?,?";
			$sql = "
				select * from (
					select b.buyid,null as frmsellerid,null as frmcompanyid ,b.mdacode,b.ismobile,b.affiliatecd,b.seller_id,b.serialnum,b.accessid,b.accesspass,b.coupon_id,b.copnpoint_id,b.urlareaid,b.area_id,b.caldate,b.period,b.usagetypecnt,b.money_id,b.finalmoney,null,'0' as b2bflg,b.finalmoneylog,b.point_id,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,b.cancelday,b.cancelfee,b.deleterid,b.display,createtime from buying  as b 
					where  CONCAT(b.serialnum,b.affiliatecd) LIKE CONCAT('%',?,'%') and  b.deleterid=0 and b.urlareaid= ?   
					union all
					select bb.buyid,bb.frmsellerid,bb.frmcompanyid,bb.mdacode,bb.ismobile,null as affiliatecd,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime from buyingb2b  as bb 
					 where  CONCAT(bb.serialnum) LIKE CONCAT('%',?,'%') and  bb.deleterid=0 and bb.urlareaid= ? 
				) as ut 	ORDER BY `ut`.`createtime` DESC  limit ?,? 
					 
			";
			$tmp="$searchkey,$urlareaid,$searchkey,$urlareaid,$start_from, $num_rec_per_page";



			$stmt = $this->link->prepare($sql);


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sisiii",$searchkey,$urlareaid,$searchkey,$urlareaid,$start_from, $num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['frmsellerid']			=$row['frmsellerid'];
			    $rtn[$i]['frmcompanyid']		=$row['frmcompanyid'];
			    
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['ismobile']			=$row['ismobile'];
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       } 
       //////////////////////////////////-----------------------//////////////////////////////
       	function searchReserveFreeinfosByBuyinginfo($rsvbuyid,$b2bflg){
			$sql = "
				select r.*,rp.usecalval,rp.usecalcost,rp.firstname,rp.lastname,rp.sex,rp.age , rp.usetime,rp.b2bflg from reservefree as r right join 
					
					(
						select rsvfree_id,usecalval,usecalcost,rsvdelegatefirstname as firstname,rsvdelegatelastname as lastname,rsvdelegatesex as sex, rsvdelegateage as age ,createtime as usetime,b2bflg from reservefreedelegate where buy_id= ? and b2bflg=? 
						
						union all
						
						select rsvfree_id,usecalval,usecalcost,rsvfollowerfirstname as firstname,rsvfollowerlastname as lastname,rsvfollowersex as sex, rsvfollowerage as age ,createtime as usetime ,b2bflg from reservefreefollowers where buy_id= ? and b2bflg= ?
						
					) as rp on rp.rsvfree_id = r.rsvid
			
				where 
				
				r.rsvbuyid= ?    and  r.rsvb2bflg = ?";
			
			$tmp="$rsvbuyid,$b2bflg,$rsvbuyid,$b2bflg,$rsvbuyid,$b2bflg";


			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("iiiiii",$rsvbuyid,$b2bflg,$rsvbuyid,$b2bflg,$rsvbuyid,$b2bflg);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']				=$row['rsvid'];
			    $rtn[$i]['rsvcd']				=$row['rsvcd'];
			    $rtn[$i]['rsvlang']				=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate	']		=$row['rsvstartdate	'];
			    $rtn[$i]['rsvperiod']			=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']			=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']		=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']		=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']		=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']		=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplay_id']			=$row['rsvplay_id'];
			    $rtn[$i]['rsvplaycd']			=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']			=$row['rsvplayname'];
			    $rtn[$i]['rsvareaname_en']		=$row['rsvareaname_en'];
			    $rtn[$i]['rsvareaname_cn']		=$row['rsvareaname_cn'];
			    $rtn[$i]['rsvareaname_tw']		=$row['rsvareaname_tw'];
			    $rtn[$i]['rsvareaname_kr']		=$row['rsvareaname_kr'];
			    $rtn[$i]['rsvplayname_en']		=$row['rsvplayname_en'];
			    $rtn[$i]['rsvplayname_cn']		=$row['rsvplayname_cn'];
			    $rtn[$i]['rsvplayname_tw']		=$row['rsvplayname_tw'];
			    $rtn[$i]['rsvplayname_kr']		=$row['rsvplayname_kr'];
			    $rtn[$i]['rsvareafather_id']	=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']	=$row['rsvareafathername'];
			    $rtn[$i]['rsvareafathername_en']=$row['rsvareafathername_en'];
			    $rtn[$i]['rsvareafathername_cn']=$row['rsvareafathername_cn'];
			    $rtn[$i]['rsvareafathername_tw']=$row['rsvareafathername_tw'];
			    $rtn[$i]['rsvareafathername_kr']=$row['rsvareafathername_kr'];
			    $rtn[$i]['rsvarea_id']			=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']			=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']			=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']			=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']		=$row['sectionname1'];
			    $rtn[$i]['sectionname3']		=$row['sectionname3'];
			    $rtn[$i]['sectionname4']		=$row['sectionname4'];
			    $rtn[$i]['sectionname5']		=$row['sectionname5'];
			    $rtn[$i]['sectionname6']		=$row['sectionname6'];
			    $rtn[$i]['rsvb2bflg']			=$row['rsvb2bflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    
			    $rtn[$i]['rsvcreatedatetime']	=$row['rsvcreatedatetime'];

			    $rtn[$i]['rsvplaycd']	=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']	=$row['rsvplayname'];
			    $rtn[$i]['usecalcost']	=$row['usecalcost'];
			    $rtn[$i]['usecalval']	=$row['usecalval'];


			    $rtn[$i]['firstname']	=$row['firstname'];
			    $rtn[$i]['lastname']	=$row['lastname'];
			    $rtn[$i]['sex']			=$row['sex'];
			    $rtn[$i]['age']			=$row['age'];
			    
			     $rtn[$i]['usetime']			=$row['usetime'];
			    
			    $i++;			
			
			}
			return $rtn;
       	}              
		function searchReserveinfosByBuyinginfo($rsvbuyid,$b2bflg){
			$sql = "select r.*,rt.* from reserve as r left join reservepointtype as rt on r.rsvid=rt.rsv_id where r.rsvbuyid= ?    and  r.rsvb2bflg = ?";
			$tmp="$rsvbuyid,$b2bflg";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ii",$rsvbuyid,$b2bflg);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']					=$row['rsvid'];
			    $rtn[$i]['rsvcd']					=$row['rsvcd'];
			    $rtn[$i]['agt_id']					=$row['agt_id'];
			    $rtn[$i]['rsvlang']					=$row['rsvlang'];
			    $rtn[$i]['urlareaid']				=$row['urlareaid'];
			    $rtn[$i]['urllang']					=$row['urllang'];
			    
			    $rtn[$i]['rsvstartdate']			=$row['rsvstartdate'];
			    $rtn[$i]['rsvbuyid']				=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']			=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']				=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']				=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']			=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']			=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']			=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']		=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']	=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']		=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']		=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']	=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']	=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']	=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']			=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']			=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']			=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']			=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']			=$row['rsvdelegatetel'];
			    $rtn[$i]['sectionname1']			=$row['sectionname1'];
			    $rtn[$i]['sectionname2']			=$row['sectionname2'];
			    $rtn[$i]['sectionname3']			=$row['sectionname3'];
			    $rtn[$i]['sectionname4']			=$row['sectionname4'];
			    $rtn[$i]['sectionname5']			=$row['sectionname5'];
			    $rtn[$i]['sectionname6']			=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvusedstock']			=$row['rsvusedstock'];
			    $rtn[$i]['rsvperiod']				=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']			=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']		=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']			=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']		=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvusedpointval']			=$row['rsvusedpointval'];
			    $rtn[$i]['rsvuseprimoney']			=$row['rsvuseprimoney'];
			    $rtn[$i]['rsvcouponheldcompany']	=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']		=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainmod']		=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']		=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']		=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']				=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']				=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']		=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']		=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']		=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']		=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']		=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']						=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']					=$row['rsviscanceled'];
			    $rtn[$i]['rsviscanceledday']				=$row['rsviscanceledday'];
			    $rtn[$i]['rsvfee']							=$row['rsvfee'];
			    $rtn[$i]['rsvpointfee']						=$row['rsvpointfee'];

			    
			    $rtn[$i]['rptypeid']						=$row['rptypeid'];
			    $rtn[$i]['rsv_id']							=$row['rsv_id'];
			    $rtn[$i]['activitypointid']					=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']			=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_us']			=$row['activitypointname_us'];
			    $rtn[$i]['activitypointname_jp']			=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']			=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']			=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']			=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']					=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']					=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']					=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']					=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']					=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']					=$row['planorcourse'];
			    $rtn[$i]['b2bflg']					=$row['b2bflg'];
			    $rtn[$i]['rsvcreatedatetime']				=$row['rsvcreatedatetime'];
			    

			    
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function searchBuyingsTotal($areaid,$datefrom,$dateto,$enddatefrom,$enddateto,$sponsor,$serialnum,$b2bflg,$start_from, $num_rec_per_page){



       		$updatedate=date('Y-m-d');
			$daybetweenb="";
			$daybetweenbb="";
			$nosetted =0;
			
			if(($datefrom<>"")&&($dateto<>"")){
				$nosetted=1;
				$daybetweenb="and '".$datefrom."' <= b.caldate and  caldate <= '".$dateto."'";
				$daybetweenbb="and '".$datefrom."' <= bb.caldate and  caldate <= '".$dateto."'";
			}
			
			if(($enddatefrom<>"")&&($enddateto<>"")){
				$nosetted=1;
				$enddaybetweenb="and '".$enddatefrom."' <= b.endcaldate and  endcaldate <= '".$enddateto."'";
				$enddaybetweenbb="and '".$enddatefrom."' <= bb.endcaldate and  endcaldate <= '".$enddateto."'";
			}
			
			if($nosetted==0){
				return $rtn;
			}

			$sponsorstr="";
			
			if($sponsor<>""){
				$sponsorstr=" and cps.couponheldcompany_jp LIKE CONCAT('%".$sponsor."%') ";
			}
			
			/////////
			$serialnumstr="";
			if($serialnum<>""){
				$serialnumstr=" and b.serialnum LIKE CONCAT('%".$serialnum."%') ";
			}

			$sql="select * from (";
			
			
			$sqlb2c = "
					/*パスb2c*/
						/*要予約*/
							select 
							ap.buyptcnt
							,
							ap.buymncnt
							,				
							ap.appendids
							,										
							pnum.peoplenum
							,
							b.buyid,b.mdacode,b.affiliatecd,b.serialnum,b.urlareaid,b.caldate,b.period,b.endcaldate,b.finalmoney,date_format(b.createtime,'%Y-%m-%d') as finalmoneyday ,'0' as b2bflg,
							b.finalmoneylog,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,
							b.cancelday,b.cancelfee,b.createtime
							,
							cps.couponid,cps.couponname_jp,cps.couponheldcompany_jp
							,
							rv.rsvid,rv.rsvbuyid,rv.rsviscanceled
							,
							rtt.cntprice,rtt.cntmoney 
							,
							fr.usecalval,fr.usecalcost 
							,
							(rtt.cntprice+fr.usecalval) as cntpricefinal,(rtt.cntmoney +fr.usecalcost ) as cntmoneyfinal 
							from buying  as b 
							/*追加ポイント、追加金額*/
							left join (select coupon_id,SUM(finalpointval) as buyptcnt ,SUM(finalmoney) as buymncnt,group_concat(serialnum SEPARATOR'&') as appendids from buyappend group by coupon_id  ) as ap on ap.coupon_id= b.buyid 
							/*人数と原価*/
							left join (select buy_id,count(copnb2cnum) as peoplenum from buyingusageb2c   group by buy_id   ) as pnum on pnum.buy_id= b.buyid 
							/*消費原価、ポイント計算*/
							left join reserve as rv on b.buyid= rv.rsvbuyid and rv.rsvb2bflg=0  
							left join (select rsv_id,SUM(rptypeunitprice*rptypemembernum)as cntprice ,SUM(rptypeunitmoney*rptypemembernum)as cntmoney from  reservepointtype group by rsv_id   ) as rtt on  rv.rsvid= rtt.rsv_id 
							/*クポン情報*/
							left join coupons as cps
							on b.coupon_id=cps.couponid 
							/*遊び放題*/
							left join 
									(
										select r.rsvbuyid,SUM(rp.usecalval) as usecalval ,SUM(rp.usecalcost) as usecalcost from reservefree as r 
										left join 
											
										(
											select buy_id,rsvfree_id,usecalval,usecalcost from reservefreedelegate  where  b2bflg=0 
												
											union all
												
											select buy_id,rsvfree_id,usecalval,usecalcost from reservefreefollowers  where  b2bflg=0 
												
										) as rp on rp.rsvfree_id = r.rsvid 
									   where  r.rsvb2bflg = 0 and rp.buy_id= r.rsvbuyid  group by r.rsvbuyid 
										
									) as fr on fr.rsvbuyid= b.buyid 
									
							where    b.deleterid=0 and b.urlareaid= ?   $enddaybetweenb $daybetweenb $sponsorstr $serialnumstr
							
				";
				
				
				$sqlunion=" union all ";
				
				if($serialnum<>""){
					$serialnumstr=" and bb.serialnum LIKE CONCAT('%".$serialnum."%') ";
				}
			
				$sqlb2b = "			
					/*パスb2b*/
						/*要予約*/
							select 
							app.buyptcnt
							,
							app.buymncnt
							,
							app.appendids
							,
							ppnum.peoplenum
							,
							bb.buyid,bb.mdacode,null as affiliatecd,bb.serialnum,bb.urlareaid,bb.caldate,bb.period,bb.endcaldate,bb.finalmoney,date_format(bb.createtime,'%Y-%m-%d') as finalmoneyday ,'1' as b2bflg,
							bb.finalmoneylog,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,
							bb.cancelday,bb.cancelfee,bb.createtime
							,
							cps.couponid,cps.couponname_jp,cps.couponheldcompany_jp
							,
							rrv.rsvid,rrv.rsvbuyid,rrv.rsviscanceled						
							,
							rrtt.cntprice,rrtt.cntmoney
							,	
							fr.usecalval,fr.usecalcost 
							,
							(rrtt.cntprice+fr.usecalval) as cntpricefinal  ,(rrtt.cntmoney +fr.usecalcost ) as cntmoneyfinal 
							
							from buyingb2b  as bb 
							/*追加ポイント、追加金額*/
							left join (select coupon_id,SUM(finalpointval) as buyptcnt ,SUM(finalmoney) as buymncnt,group_concat(serialnum SEPARATOR'&') as appendids  from buyappend  group by coupon_id  ) as app on app.coupon_id= bb.buyid 
							/*人数と原価*/
							left join (select buy_id,count(copnb2cnum) as peoplenum from buyingusageb2b   group by buy_id  ) as ppnum on ppnum.buy_id= bb.buyid 
							/*消費原価、ポイント計算*/
							left join reserve as rrv on bb.buyid= rrv.rsvbuyid and rrv.rsvb2bflg=1  
							left join (select rsv_id,SUM(rptypeunitprice*rptypemembernum)as cntprice ,SUM(rptypeunitmoney*rptypemembernum)as cntmoney from  reservepointtype group by rsv_id   ) as rrtt on  rrv.rsvid= rrtt.rsv_id 
							/*クポン情報*/
							left join coupons as cps
							on bb.coupon_id=cps.couponid 
							/*遊び放題*/
							left join 
									(
										select r.rsvbuyid,SUM(rp.usecalval) as usecalval ,SUM(rp.usecalcost) as usecalcost from reservefree as r 
										left join 
											
										(
											select buy_id, rsvfree_id,usecalval,usecalcost from reservefreedelegate   where b2bflg=1
												
											union all
												
											select  buy_id,rsvfree_id,usecalval,usecalcost from reservefreefollowers  where b2bflg=1 
												
										) as rp on rp.rsvfree_id = r.rsvid 
										 where  r.rsvb2bflg = 1  and rp.buy_id= r.rsvbuyid  group by r.rsvbuyid 
										
									) as fr on fr.rsvbuyid= bb.buyid 
						 	where    bb.deleterid=0 and bb.urlareaid= ?  $enddaybetweenbb $daybetweenbb $sponsorstr $serialnumstr
					 
			";
			
			if($b2bflg=="b2c"){
			
				$sql=$sql.$sqlb2c;
			}elseif($b2bflg=="b2b"){
			
				$sql=$sql.$sqlb2b;
			}else{
				$sql=$sql.$sqlb2c.$sqlunion.$sqlb2b;
			}
			
			$sql=$sql.") as ut 	ORDER BY `ut`.`createtime` DESC ";
			
			$tmp="$areaid,$areaid";
			

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			
			if($b2bflg==""){


				$stmt->bind_param("ii",$areaid,$areaid);	
			}else{
			
				$stmt->bind_param("i",$areaid);	
			}

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['rsviscanceled']		=$row['rsviscanceled'];
			    
			    
			    
			    $rtn[$i]['buyptcnt']			=$row['buyptcnt'];
			    //
			    $rtn[$i]['buymncnt']			=$row['buymncnt'];
			    $rtn[$i]['appendids']			=$row['appendids'];
			    
			    
			    $rtn[$i]['peoplenum']			=$row['peoplenum'];

			    $rtn[$i]['usecalcost']			=$row['usecalcost'];
			    $rtn[$i]['usecalval']			=$row['usecalval'];
			    			    			    
			    $rtn[$i]['cntprice']			=$row['cntpricefinal'];
			    $rtn[$i]['cntmoney']			=$row['cntmoneyfinal'];

			    			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    
			    $rtn[$i]['period']				=$row['period'];
			    
			    $rtn[$i]['endcaldate']				=$row['endcaldate'];
			    
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


				//クポン
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname_jp']		=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']		=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']		=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']		=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']		=$row['couponname_kr'];
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponclosedupd']		=$row['couponclosedupd'];
			    $rtn[$i]['couponclosedupt']		=$row['couponclosedupt'];
			    $rtn[$i]['couponheldcompany_jp']=$row['couponheldcompany_jp'];
			    $rtn[$i]['couponheldcompany_en']=$row['couponheldcompany_en'];
			    $rtn[$i]['couponheldcompany_cn']=$row['couponheldcompany_cn'];
			    $rtn[$i]['couponheldcompany_tw']=$row['couponheldcompany_tw'];
			    $rtn[$i]['couponheldcompany_kr']=$row['couponheldcompany_kr'];
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponcomment_jp']	=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']	=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']	=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']	=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']	=$row['couponcomment_kr'];
			    $rtn[$i]['coupontype']			=$row['coupontype'];
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

			
       }         
       
       function getFrontCoupons($areaid,$caldate,$ticketarr,$start_from, $num_rec_per_page,$isb2b){
			global $config;
			$ticket=implode(",",$ticketarr);
			
			$calmonth=$caldate." 00:00:00";
       		$updatedate=date('Y-m-d');
			//
			$sql = "select c.*,b.*,ca.*  from coupons as c left join copnb2cmoney b on c.couponid= b.coupon_id left join b2cmoneycal as ca on b.copnb2cmid=ca.f_key  
			where c.coupondeleter=0 and 
			c.area_id= ? and 
			ca.calmonth= ? 	and		
			c.couponinterval in ($ticket)  

			order by c.couponcreatetime desc limit ?,?";
			
			if(($caldate=="")||($caldate==null)){
			
				$num_rec_per_page=$config['num_rec_per_page'];
				
				//$sql = "select c.*,b.*,ca.* from coupons as c left join copnb2cmoney b on c.couponid= b.coupon_id left join  (SELECT * FROM `b2cmoneycal` ORDER BY `calcreatedate`)  as ca on b.copnb2cmid=ca.f_key where coupondeleter=0  order by couponcreatetime desc limit 0,".$num_rec_per_page;
				$sql = "select c.*,b.*,ca.* from coupons as c left join copnb2cmoney b on c.couponid= b.coupon_id left join b2cmoneycal as ca on b.copnb2cmid=ca.f_key where coupondeleter=0  order by couponcreatetime desc limit ?,?";
			
			
			}
			
				$tmp="$areaid,$caldate,$ticket,$start_from, $num_rec_per_page";
			
		

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
		//	$stmt->bind_param("isii",$areaid,$caldate,$start_from,$num_rec_per_page);	
			$stmt->bind_param("is",$areaid,$caldate);	
			if(($caldate=="")||($caldate==null)){
					
				$stmt->bind_param("ii",$start_from,$num_rec_per_page);	
			}
		
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname_jp']		=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']		=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']		=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']		=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']		=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    
			    $rtn[$i]['couponclosedupd']		=$row['couponclosedupd'];
			    $rtn[$i]['couponclosedupt']		=$row['couponclosedupt'];
			    
			    
			    $rtn[$i]['couponheldcompany_jp']=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment_jp']	=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']	=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']	=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']	=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']	=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];

			    $rtn[$i]['copnb2cmid']			=$row['copnb2cmid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']			=$row['copncreate'];
			    $rtn[$i]['copnb2cmname_jp']		=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']		=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']		=$row['copnb2cmname_us'];
			    $rtn[$i]['copnb2cmname_cn']		=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']		=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']		=$row['copnb2cmname_kr'];
			    $rtn[$i]['calmonth']			=$row['calmonth'];
			    $rtn[$i]['calval']				=$row['calval'];
			    $rtn[$i]['calcost']				=$row['calcost'];
			    $rtn[$i]['calsex']				=$row['calsex'];

			    
				$i++;
			}
		  $stmt->free_result();



		  return $rtn;

			
       }           
       function getFrontCouponsNopage($areaid,$caldate,$ticketarr,$sellercompanyid,$isb2b,$langflg){
			global $config;
			$ticket=implode(",",$ticketarr);
			
			$calmonth=$caldate." 00:00:00";
       		$updatedate=date('Y-m-d');
			//

			if($isb2b==1){//B2B
				//b2bの場合にはb2c以外表示する
				$tmpsql=" c.coupontype <> 0 and ";
								
				$moneytablecal="b2bmoneycal";
				$moneytable="copnb2bmoney";
				$copnb2bcmid="copnb2bmid";
				
			}elseif($isb2b==0){//B2c
				//b2cの場合にはb2b以外表示する
				$tmpsql=" c.coupontype <> 1 and";	
				$moneytablecal="b2cmoneycal";
				$moneytable="copnb2cmoney";
				$copnb2bcmid="copnb2cmid";
				
			}else{
				$tmpsql="";
			}
			
			//copnb2cmoney→B2BとB2Cは共有する			
			$sql = "select c.*,b.*,ca.*  from coupons as c left join $moneytable b on c.couponid= b.coupon_id left join $moneytablecal as ca on b.".$copnb2bcmid."=ca.f_key  
			
			where c.coupondeleter=0 and c.".$langflg."langflg =1  and  $tmpsql  
			c.area_id= ? and 
			ca.calmonth= ? 	and		
					
			c.couponinterval in ($ticket)  
			order by c.couponcreatetime desc ";

			
			if(($caldate=="")||($caldate==null)){
			
				echo "日付など選んでください";
				exit;
				//$num_rec_per_page=$config['num_rec_per_page'];
				//$sql = "select c.*,b.*,ca.* from coupons as c left join $moneytable b on c.couponid= b.coupon_id left join $moneytablecal as ca on b.".$copnb2bcmid."=ca.f_key left join agents as ag on c.couponid=ag.coupon_id  where c.coupondeleter=0 and ag.company_id= ?  ".$tmpsql." order by c.couponcreatetime desc ";
			
			}
			
			$tmp="$areaid,$caldate,$sellercompanyid";


			
			$stmt = $this->link->prepare($sql);


			if ( false===$stmt ) {
			  die('prepare() failed: ' . htmlspecialchars($mysqli->error));
			}
						


				if($isb2b==1){//B2B
				
					$rc = $stmt->bind_param("is",$areaid,$caldate);	
					if ( false===$rc ) {
				  
					  die('bind_param() failed: ' . htmlspecialchars($stmt->error));
					}
					
				}else{//B2c

					if(($caldate=="")||($caldate==null)){
							
						//$stmt->bind_param("i",$sellercompanyid);	
					}else{
						$rc =$stmt->bind_param("is",$areaid,$caldate);
						if ( false===$rc ) {
						  
						  die('bind_param() failed: ' . htmlspecialchars($stmt->error));
						}
											
					}				
					
	
						
				}
			
		

		
		
			$rc = $stmt->execute();
			if ( false===$rc ) {
			  die('execute() failed: ' . htmlspecialchars($stmt->error));
			}
			
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname_jp']		=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']		=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']		=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']		=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']		=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    
			    $rtn[$i]['couponclosedupd']		=$row['couponclosedupd'];
			    $rtn[$i]['couponclosedupt']		=$row['couponclosedupt'];
			    
			    
			    $rtn[$i]['couponheldcompany_jp']=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    
			    
			    $rtn[$i]['couponcomment_jp']	=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']	=$row['couponcomment_en'];
			    
			    $rtn[$i]['couponcomment_cn']	=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']	=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']	=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];

			    $rtn[$i]['copnb2cmid']			=$row['copnb2cmid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']			=$row['copncreate'];
			    $rtn[$i]['copnb2cmname_jp']		=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']		=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']		=$row['copnb2cmname_us'];
			    $rtn[$i]['copnb2cmname_cn']		=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']		=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']		=$row['copnb2cmname_kr'];
			    
			    $rtn[$i]['copnb2bmname_jp']		=$row['copnb2bmname_jp'];
			    $rtn[$i]['copnb2bmname_en']		=$row['copnb2bmname_en'];
			    $rtn[$i]['copnb2bmname_us']		=$row['copnb2bmname_us'];
			    $rtn[$i]['copnb2bmname_cn']		=$row['copnb2bmname_cn'];
			    $rtn[$i]['copnb2bmname_tw']		=$row['copnb2bmname_tw'];
			    $rtn[$i]['copnb2bmname_kr']		=$row['copnb2bmname_kr'];
			    			    
			    $rtn[$i]['calmonth']			=$row['calmonth'];
			    $rtn[$i]['calval']				=$row['calval'];
			    $rtn[$i]['calcost']				=$row['calcost'];
			    $rtn[$i]['calsex']				=$row['calsex'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;


			
       }           

       function getBuyingByBuyid($buyid){
       
			$sql = "select * from buying as b left join coupons as cs on b.coupon_id=cs.couponid left join copnpoint as c on b.copnpoint_id=c.copnpointid left join areas as a on a.areaid =b.area_id left join pointcal as p on b.point_id=p.calid  where b.deleterid=0 and  b.buyid = ? ";

			$tmp="$buyid";


			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$buyid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['urllang']		=$row['urllang'];
			    $rtn[$i]['mdacode']			=$row['mdacode'];
			    $rtn[$i]['affiliatecd']		=$row['affiliatecd'];
			    
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];			    
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    
				$rtn[$i]['couponid']		=$row['couponid'];	    
			    $rtn[$i]['areaname_jp']		=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']		=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']		=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']		=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']		=$row['areaname_kr'];

			    $rtn[$i]['money_id']		=$row['money_id'];
			    $rtn[$i]['point_id']		=$row['point_id'];
			    
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['memo']			=$row['memo'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];
			    $rtn[$i]['finalmoneylog']	=$row['finalmoneylog'];
			    
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];		
			    
			    $rtn[$i]['delegatebirthday']		=$row['delegatebirthday'];		
			    	
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			    $rtn[$i]['isused']			=$row['isused'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['cancelday']		=$row['cancelday'];
			    $rtn[$i]['cancelfee']		=$row['cancelfee'];
			    
			    
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];


			    $rtn[$i]['copnpointid']		=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']	=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']	=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']	=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']	=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']	=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']	=$row['copntypename_kr'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];

			    $rtn[$i]['couponname_jp']	=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']	=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']	=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']	=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']	=$row['couponname_kr'];

			    $rtn[$i]['couponheldcompany_jp']		=$row['couponheldcompany_jp'];
			    $rtn[$i]['couponheldcompany_cn']		=$row['couponheldcompany_cn'];
			    $rtn[$i]['couponheldcompany_tw']		=$row['couponheldcompany_tw'];
			    $rtn[$i]['couponheldcompany_kr']		=$row['couponheldcompany_kr'];
			    $rtn[$i]['couponheldcompany_en']		=$row['couponheldcompany_en'];
			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       
       }

       function getBuyingb2bByBuyid($buyid){
       
			$sql = "select * from buyingb2b as b left join coupons as cs on b.coupon_id=cs.couponid left join copnpoint as c on b.copnpoint_id=c.copnpointid left join areas as a on a.areaid =b.area_id left join pointcal as p on b.point_id=p.calid left join company as cp on cp.companyid=b.frmcompanyid  where b.deleterid=0 and  b.buyid = ? ";

			$tmp="$buyid";

			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$buyid);		


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    
			    $rtn[$i]['frmsellerid']		=$row['frmsellerid'];
			    $rtn[$i]['frmcompanyid']	=$row['frmcompanyid'];
			    
			    
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['urllang']			=$row['urllang'];
			    $rtn[$i]['mdacode']			=$row['mdacode'];
			    $rtn[$i]['affiliatecd']		=$row['affiliatecd'];
			    
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];		
			    $rtn[$i]['urlareaid']		=$row['urlareaid'];	    
			    $rtn[$i]['area_id']			=$row['area_id'];
				$rtn[$i]['couponid']		=$row['couponid'];	    
			    $rtn[$i]['areaname_jp']		=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']		=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']		=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']		=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']		=$row['areaname_kr'];

			    $rtn[$i]['money_id']		=$row['money_id'];
			    $rtn[$i]['point_id']		=$row['point_id'];
			    
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['finalmoneyday']	=$row['finalmoneyday'];
			    $rtn[$i]['finalpointvallog']=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];		
			    
			    $rtn[$i]['delegatebirthday']=$row['delegatebirthday'];		
			    	
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			    $rtn[$i]['isused']			=$row['isused'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    
			    $rtn[$i]['cancelday']		=$row['cancelday'];
			    $rtn[$i]['cancelfee']		=$row['cancelfee'];
			    
			    $rtn[$i]['memo']			=$row['memo'];
			    
			    
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];


			    $rtn[$i]['copnpointid']		=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']	=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']	=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']	=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']	=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']	=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']	=$row['copntypename_kr'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];

			    $rtn[$i]['couponname_jp']	=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']	=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']	=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']	=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']	=$row['couponname_kr'];

			    $rtn[$i]['couponheldcompany_jp']		=$row['couponheldcompany_jp'];
			    $rtn[$i]['couponheldcompany_cn']		=$row['couponheldcompany_cn'];
			    $rtn[$i]['couponheldcompany_tw']		=$row['couponheldcompany_tw'];
			    $rtn[$i]['couponheldcompany_kr']		=$row['couponheldcompany_kr'];
			    $rtn[$i]['couponheldcompany_en']		=$row['couponheldcompany_en'];
			    



			    $rtn[$i]['companyid']		=$row['companyid'];
			    $rtn[$i]['companycd']		=$row['companycd'];
			    $rtn[$i]['companyname_jp']	=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']	=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']	=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']	=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']	=$row['companyname_kr'];
			    $rtn[$i]['companymail']		=$row['companymail'];
			    $rtn[$i]['companyloginid']	=$row['companyloginid'];
			    $rtn[$i]['companypass']		=$row['companypass'];
			    $rtn[$i]['companyareaid']	=$row['companyareaid'];
			    $rtn[$i]['companytel_jp']	=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']	=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']	=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']	=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']	=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']	=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']	=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']	=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']	=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']	=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']	=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']	=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']	=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']	=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']	=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']	=$row['companyaddr2_kr'];
			    $rtn[$i]['companyagtflg']	=$row['companyagtflg'];
			    $rtn[$i]['agtcontact_jp']	=$row['agtcontact_jp'];
			    $rtn[$i]['agtcontact_en']	=$row['agtcontact_en'];
			    $rtn[$i]['agtcontact_cn']	=$row['agtcontact_cn'];
			    $rtn[$i]['agtcontact_tw']	=$row['agtcontact_tw'];
			    $rtn[$i]['agtcontact_kr']	=$row['agtcontact_kr'];
			    $rtn[$i]['companymakerid']	=$row['companymakerid'];
			    $rtn[$i]['isadmin']			=$row['isadmin'];
			    $rtn[$i]['companyupdaterid']=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']		=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']		=$row['companycreatetime'];
			    			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       
       }
              
	   function getActivemainInfoByactivitymainid($activitymainid){
       			$sql="select * from activitymain as a left join company as c on a.activitymaincmpcd= c.companyid  where a.activitymainid =?";
       			$tmp="$activitymainid";

				$stmt = $this->link->prepare($sql);
				if(!$stmt){
					echo "sql文が正しくない";
				}
				$stmt->bind_param("i",$activitymainid);		
				$stmt->execute();
				$result = $stmt->get_result();
				$num_of_rows = $result->num_rows;
				$i=0;
				while ($row = $result->fetch_assoc()) {
				    $rtn[$i]['activitymainid']			=$row['activitymainid'];
				    $rtn[$i]['activitymainseq']			=$row['activitymainseq'];
				    $rtn[$i]['activitymaincmpcd']		=$row['activitymaincmpcd'];
				    $rtn[$i]['activitymainplncd']		=$row['activitymainplncd'];
				    $rtn[$i]['activitymainpln_jp']		=$row['activitymainpln_jp'];
				    $rtn[$i]['activitymainpln_en']		=$row['activitymainpln_en'];
				    $rtn[$i]['activitymainpln_cn']		=$row['activitymainpln_cn'];

				    $rtn[$i]['activitymainminpoint']	=$row['activitymainminpoint'];
				    $rtn[$i]['activitymainpln_tw']		=$row['activitymainpln_tw'];
				    $rtn[$i]['activitymainpln_kr']		=$row['activitymainpln_kr'];
				    $rtn[$i]['activitymainkbn']			=$row['activitymainkbn'];
				    $rtn[$i]['activitymainunit_en']		=$row['activitymainunit_en'];
				    $rtn[$i]['activitymainunit_cn']		=$row['activitymainunit_cn'];
				    $rtn[$i]['activitymainunit_tw']		=$row['activitymainunit_tw'];
				    $rtn[$i]['activitymainunit_kr']		=$row['activitymainunit_kr'];
				    $rtn[$i]['activitymainmod']			=$row['activitymainmod'];
				    $rtn[$i]['activitymaincmt_jp']		=$row['activitymaincmt_jp'];
				    $rtn[$i]['activitymaincmt_en']		=$row['activitymaincmt_en'];
				    $rtn[$i]['activitymaincmt_cn']		=$row['activitymaincmt_cn'];
				    $rtn[$i]['activitymaincmt_tw']		=$row['activitymaincmt_tw'];
				    
				    $rtn[$i]['activitymaincmt_kr']		=$row['activitymaincmt_kr'];
				    $rtn[$i]['activitymainimg']			=$row['activitymainimg'];
				    $rtn[$i]['activitymainimgcp_jp']	=$row['activitymainimgcp_jp'];
				    $rtn[$i]['activitymainimgcp_en']	=$row['activitymainimgcp_en'];
				    $rtn[$i]['activitymainimgcp_cn']	=$row['activitymainimgcp_cn'];
				    $rtn[$i]['activitymainimgcp_tw']	=$row['activitymainimgcp_tw'];
				    $rtn[$i]['activitymainimgcp_kr']	=$row['activitymainimgcp_kr'];
				    $rtn[$i]['activitymainreqtime']		=$row['activitymainreqtime'];
				    $rtn[$i]['activitymainify']			=$row['activitymainify'];
				    $rtn[$i]['activitytype_id']			=$row['activitytype_id'];
				    $rtn[$i]['area_fid']				=$row['area_fid'];
				    $rtn[$i]['area_id']					=$row['area_id'];
				    $rtn[$i]['activitymainlangflg_jp']	=$row['activitymainlangflg_jp'];
				    $rtn[$i]['activitymainlangflg_en']	=$row['activitymainlangflg_en'];
				    $rtn[$i]['activitymainlangflg_cn']	=$row['activitymainlangflg_cn'];
				    $rtn[$i]['activitymainlangflg_tw']	=$row['activitymainlangflg_tw'];
				    $rtn[$i]['activitymainlangflg_kr']	=$row['activitymainlangflg_kr'];
				    $rtn[$i]['activitymaincreaterid']	=$row['activitymaincreaterid'];
				    $rtn[$i]['activitymainupdaterid']	=$row['activitymainupdaterid'];
				    $rtn[$i]['activitymaindeleterid']	=$row['activitymaindeleterid'];
				    $rtn[$i]['activitymaincreatetime']	=$row['activitymaincreatetime'];
				    
				    
				    $rtn[$i]['companyid']	=$row['companyid'];
				    $rtn[$i]['companycd']	=$row['companycd'];
				    $rtn[$i]['companyname_jp']	=$row['companyname_jp'];
				    $rtn[$i]['companyname_en']	=$row['companyname_en'];
				    $rtn[$i]['companyname_cn']	=$row['companyname_cn'];
				    $rtn[$i]['companyname_tw']	=$row['companyname_tw'];
				    $rtn[$i]['companyname_kr']	=$row['companyname_kr'];
				    $rtn[$i]['companymail']	=$row['companymail'];
				    $rtn[$i]['companypass']	=$row['companypass'];
				    $rtn[$i]['companytel_jp']	=$row['companytel_jp'];
				    $rtn[$i]['companytel_en']	=$row['companytel_en'];
				    $rtn[$i]['companytel_cn']	=$row['companytel_cn'];
				    $rtn[$i]['companytel_tw']	=$row['companytel_tw'];
				    $rtn[$i]['companytel_kr']	=$row['companytel_kr'];
				    $rtn[$i]['companyzipcd']	=$row['companyzipcd'];
				    $rtn[$i]['companyaddr1_jp']	=$row['companyaddr1_jp'];
				    $rtn[$i]['companyaddr2_jp']	=$row['companyaddr2_jp'];
				    $rtn[$i]['companyaddr1_en']	=$row['companyaddr1_en'];
				    $rtn[$i]['companyaddr2_en']	=$row['companyaddr2_en'];
				    $rtn[$i]['companyaddr1_cn']	=$row['companyaddr1_cn'];
				    $rtn[$i]['companyaddr2_cn']	=$row['companyaddr2_cn'];
				    $rtn[$i]['companyaddr1_tw']	=$row['companyaddr1_tw'];
				    $rtn[$i]['companyaddr2_tw']	=$row['companyaddr2_tw'];
				    $rtn[$i]['companyaddr1_kr']	=$row['companyaddr1_kr'];
				    $rtn[$i]['companyaddr2_kr']	=$row['companyaddr2_kr'];

				    
						
					$i++;
				}
			  $stmt->free_result();

			  return $rtn;
       			
	   }	
       function getActivemain($areaid,$subareaid=0,$activitymainify){
       
       		if($subareaid==0){
       			$sql="select * from activitymain as a left join areas as aa on a.area_id= aa.areaid  where a.activitymaindeleterid=0 and a.activitymainisopen=1 and a.area_fid= ? and a.activitymainify= ?";
       			$tmp="$areaid,$activitymainify";
    			

  			
       		}else{
       			$sql="select * from activitymain as a left join areas as aa on a.area_id= aa.areaid where a.activitymaindeleterid=0 and  a.activitymainisopen=1 and  a.area_fid= ? and a.area_id = ?  and a.activitymainify= ?";
       			$tmp="$areaid,$subareaid,$activitymainify";
       			
 			     			
       		}
			


		
			$stmt = $this->link->prepare($sql);
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			if($subareaid==0){
				$tmp="$areaid";

				$stmt->bind_param("ii",$areaid,$activitymainify);		
			}else{
				$tmp="$areaid,$subareaid";

				$stmt->bind_param("iii",$areaid,$subareaid,$activitymainify);		
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']			=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']			=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']		=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']		=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']		=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']		=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']		=$row['activitymainpln_cn'];

			    $rtn[$i]['activitymainminpoint']		=$row['activitymainminpoint'];




			    $rtn[$i]['activitymainpln_tw']		=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']		=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']			=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_en']		=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']		=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']		=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']		=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']			=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']		=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']		=$row['activitymaincmt_en'];
			    $rtn[$i]['activitymaincmt_cn']		=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']		=$row['activitymaincmt_tw'];
			    
			    $rtn[$i]['activitymaincmt_kr']		=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']			=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']	=$row['activitymainimgcp_jp'];
			    $rtn[$i]['activitymainimgcp_en']	=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']	=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']	=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']	=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']		=$row['activitymainreqtime'];
			    $rtn[$i]['activitymainify']			=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']			=$row['activitytype_id'];
			    $rtn[$i]['area_fid']				=$row['area_fid'];
			    $rtn[$i]['area_id']					=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']	=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']	=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']	=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']	=$row['activitymainlangflg_tw'];
			    $rtn[$i]['activitymainlangflg_kr']	=$row['activitymainlangflg_kr'];
			    $rtn[$i]['activitymaincreaterid']	=$row['activitymaincreaterid'];
			    $rtn[$i]['activitymainupdaterid']	=$row['activitymainupdaterid'];
			    $rtn[$i]['activitymaindeleterid']	=$row['activitymaindeleterid'];
			    $rtn[$i]['activitymaincreatetime']	=$row['activitymaincreatetime'];

			    $rtn[$i]['areaid']	=$row['areaid'];
			    $rtn[$i]['areafatherid']	=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']	=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']	=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']	=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']	=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']	=$row['areaname_kr'];
			    $rtn[$i]['areasort']	=$row['areasort'];
			    $rtn[$i]['areainvalid']	=$row['areainvalid'];



			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
		         		
       }
       function getActivitystockcalByActivitydetail_id($id,$todaydate,$tomorrowdate=""){
			
			if($tomorrowdate==""){
	       	 	$sql="select * from activitystockcal where activitydetail_id = ? and atstockcalmonth = ?";
				$tmp="$id,$todaydate";			
			
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("is",$id,$todaydate);	
			}else{
	       	 	$sql="select * from activitystockcal where activitydetail_id = ? and ( atstockcalmonth = ? or atstockcalmonth = ?)";
				$tmp="$id,$todaydate,$tomorrowdate";			
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("iss",$todaydate,$tomorrowdate);	
			}

			
			

		
			if(!$stmt){
				echo "sql文が正しくない";
			}
				

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
				$rtn[$i]['atstockcalid']				=$row['atstockcalid'];
				$rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
				$rtn[$i]['atstockcalname']				=$row['atstockcalname'];
				$rtn[$i]['atstockcalyear']				=$row['atstockcalyear'];
				$rtn[$i]['atstockcalmonth']				=$row['atstockcalmonth'];
				$rtn[$i]['atstockcalcost']				=$row['atstockcalcost'];
				$rtn[$i]['atstockcalval']				=$row['atstockcalval'];
				$rtn[$i]['calcreatedate']				=$row['calcreatedate'];
				$i++;
			}
			$stmt->free_result();

			return $rtn;

	   }              
	   function getActivitydetailActivitymainAreasByactivitydetailid($id){
	   
       	 	$sql="select * from (select * from activitydetail as d left join activitymain as m on d.activitymain_id=m.activitymainid  where d.activitydetailid = ?) as t left join areas as a on t.area_id =a.areaid ";
       	 	
			$tmp="$id";
			
			$stmt = $this->link->prepare($sql);

		
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$id);		

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']				=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']				=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']				=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']				=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']				=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']				=$row['areaname_kr'];
			    $rtn[$i]['areasort']				=$row['areasort'];
			    $rtn[$i]['areainvalid']				=$row['areainvalid'];
			    $rtn[$i]['countryflg']				=$row['countryflg'];

			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
	   
	   }
	   
       function getActivitydetailByActivitymainid($id){
       
       	 	$sql="select * from activitydetail where activitymain_id = ?";
			$tmp="$id";
			
			$stmt = $this->link->prepare($sql);

		
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$id);		

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']				=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']				=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']					=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']				=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']			=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']			=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']			=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']			=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']			=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']				=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']				=$row['activitydetailto'];
			    
			    $rtn[$i]['activitydetailperiod']			=$row['activitydetailperiod'];
			    
			    
			    
			    $rtn[$i]['activitystock']					=$row['activitystock'];
			    
			    $rtn[$i]['activitydetailschdtal_jp']		=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']		=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']		=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']		=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']		=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']		=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']		=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']		=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']		=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']		=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']		=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']		=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']		=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']		=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']		=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']			=$row['activitydetailmetplc_jp'];
			    
			    $rtn[$i]['activitydetailmetplc_en']			=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']			=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']			=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']			=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']				=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']				=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime_jp']			=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailmettime_en']			=$row['activitydetailmettime_en'];
			    $rtn[$i]['activitydetailmettime_cn']			=$row['activitydetailmettime_cn'];
			    $rtn[$i]['activitydetailmettime_tw']			=$row['activitydetailmettime_tw'];
			    $rtn[$i]['activitydetailmettime_kr']			=$row['activitydetailmettime_kr'];

			    $rtn[$i]['activitydetailminpar']			=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']			=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']			=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']			=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']			=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']			=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']				=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']				=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']				=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']				=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']			=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']			=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']			=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']			=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']			=$row['activitydetailimgcp1_kr'];
			    
			    $rtn[$i]['activitydetailimgcp2_jp']			=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']			=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']			=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']			=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']			=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']			=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']			=$row['activitydetailimgcp3_en'];
			    
			    $rtn[$i]['activitydetailimgcp3_cn']			=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']			=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']			=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']			=$row['activitydetailimgcp4_jp'];
			    
			    $rtn[$i]['activitydetailimgcp4_en']			=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']			=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']			=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']			=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']			=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']			=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']			=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']			=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']			=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']			=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']			=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']			=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']			=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']			=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']			=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']			=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetaildeleter']			=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']			=$row['activitydetailcreattime'];
			    
			    $rtn[$i]['activitydetailstartage']			=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']			=$row['activitydetailendage'];
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }
       function getActivitydetailByActivitydetailid($activitydetailid){
       
       	 	$sql="select * from activitydetail where activitydetailid = ?";
			$tmp="$activitydetailid";
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$activitydetailid);		

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']				=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']				=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']					=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']				=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']			=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']			=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']			=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']			=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']			=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']				=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']				=$row['activitydetailto'];
			    
			    $rtn[$i]['activitydetailperiod']			=$row['activitydetailperiod'];
			    
			    
			    
			    $rtn[$i]['activitystock']					=$row['activitystock'];
			    
			    $rtn[$i]['activitydetailschdtal_jp']		=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']		=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']		=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']		=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']		=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']		=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']		=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']		=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']		=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']		=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']		=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']		=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']		=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']		=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']		=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']			=$row['activitydetailmetplc_jp'];
			    
			    $rtn[$i]['activitydetailmetplc_en']			=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']			=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']			=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']			=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']				=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']				=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']			=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailmettime_en']			=$row['activitydetailmettime_en'];
			    $rtn[$i]['activitydetailmettime_cn']			=$row['activitydetailmettime_cn'];
			    $rtn[$i]['activitydetailmettime_tw']			=$row['activitydetailmettime_tw'];
			    $rtn[$i]['activitydetailmettime_kr']			=$row['activitydetailmettime_kr'];
			    
			    $rtn[$i]['activitydetailminpar']			=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']			=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']			=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']			=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']			=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']			=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']				=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']				=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']				=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']				=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']			=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']			=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']			=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']			=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']			=$row['activitydetailimgcp1_kr'];
			    
			    $rtn[$i]['activitydetailimgcp2_jp']			=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']			=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']			=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']			=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']			=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']			=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']			=$row['activitydetailimgcp3_en'];
			    
			    $rtn[$i]['activitydetailimgcp3_cn']			=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']			=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']			=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']			=$row['activitydetailimgcp4_jp'];
			    
			    $rtn[$i]['activitydetailimgcp4_en']			=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']			=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']			=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']			=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']			=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']			=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']			=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']			=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']			=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']			=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']			=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']			=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']			=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']			=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']			=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']			=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetaildeleter']			=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']			=$row['activitydetailcreattime'];
			    
			    $rtn[$i]['activitydetailstartage']			=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']			=$row['activitydetailendage'];
			    
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companypass']			=$row['companypass'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']			=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']			=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']			=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']			=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']			=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']			=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']			=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']			=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']			=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']			=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']			=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']			=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']			=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']			=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']			=$row['companyaddr2_kr'];
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }
       function getActivitymainActivitydetailByActivitydetailid($activitydetailid){
       		
       		
       		$sql="select * from activitymain as a left join activitydetail as ad  on a.activitymainid= ad.activitymain_id where  ad.activitydetaildeleter=0 and ad.activitydetailid= ?";
       	
			$tmp="$activitydetailid";
			
			$stmt = $this->link->prepare($sql);

		
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$activitydetailid);		

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']			=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']			=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']		=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']		=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']		=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']		=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']		=$row['activitymainpln_cn'];
			    $rtn[$i]['activitymainpln_tw']		=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']		=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']			=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']		=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']		=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']		=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']		=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']		=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']			=$row['activitymainmod'];
			    $rtn[$i]['activitymainnoshowbaby']	=$row['activitymainnoshowbaby'];
			    
			    $rtn[$i]['activitymaincmt_jp']		=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']		=$row['activitymaincmt_en'];
			    $rtn[$i]['activitymaincmt_cn']		=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']		=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']		=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']			=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']	=$row['activitymainimgcp_jp'];
			    $rtn[$i]['activitymainimgcp_en']	=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']	=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']	=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']	=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']		=$row['activitymainreqtime'];
			    $rtn[$i]['activitymainify']			=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']			=$row['activitytype_id'];
			    $rtn[$i]['area_fid']				=$row['area_fid'];
			    $rtn[$i]['area_id']					=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']	=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']	=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']	=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']	=$row['activitymainlangflg_tw'];
			    $rtn[$i]['activitymainlangflg_kr']	=$row['activitymainlangflg_kr'];
			    $rtn[$i]['activitymaincreaterid']	=$row['activitymaincreaterid'];
			    $rtn[$i]['activitymainupdaterid']	=$row['activitymainupdaterid'];
			    $rtn[$i]['activitymaindeleterid']	=$row['activitymaindeleterid'];
			    $rtn[$i]['activitymaincreatetime']	=$row['activitymaincreatetime'];
			    $rtn[$i]['activitydetailmininum']	=$row['activitydetailmininum'];
			    
			    $rtn[$i]['activitydetailid']				=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']				=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']					=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']				=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']			=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']			=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']			=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']			=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']			=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']				=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']				=$row['activitydetailto'];
			    $rtn[$i]['activitydetailperiod']			=$row['activitydetailperiod'];
			    
			    
			    
			    $rtn[$i]['activitystock']					=$row['activitystock'];
			    
			    $rtn[$i]['activitydetailschdtal_jp']		=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']		=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']		=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']		=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']		=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']		=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']		=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']		=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']		=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']		=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']		=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']		=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']		=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']		=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']		=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']			=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']			=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']			=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']			=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']			=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']				=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']				=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']			=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']			=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailtejmaid']			=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']			=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']			=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']			=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']				=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']				=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']				=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']				=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']		=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];
			    
			    $rtn[$i]['activitydetaildeleter']		=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']		=$row['activitydetailcreattime'];

			    
				$i++;
			}
		  $stmt->free_result();


		  return $rtn;
       
       }
       
       function getActivitymainByArea_fid($area_fid,$activitymainify){
       		
       		$sql="select distinct ar.areaid,ar.areafatherid,ar.areaname_jp,ar.areaname_en,ar.areaname_cn,ar.areaname_tw,ar.areaname_kr,ar.areasort  from activitymain as a left join areas ar on a.area_id= ar.areaid where a.area_fid= ? and ar.areainvalid=0 and a.activitymainify=?";
       		
			$tmp="$area_fid,,$activitymainify";

			
			$stmt = $this->link->prepare($sql);

		
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$area_fid,$activitymainify);		

			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']			=$row['areaid'];
			    $rtn[$i]['areafatherid']	=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']		=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']		=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']		=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']		=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']		=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       		
       
       }


       function getMenusActivemainByAreaidCoupon_id($couponid,$areaid,$subareaid=0,$activitymainify,$langflg,$orderbystr){
			
			$orderstr="a.activitymaincreatetime  ";
			
			if($orderbystr=="ordercnt"){
				$orderstr="a.activitymainordercnt ";
			}
			
			
			
       		if($subareaid==0){
       			$sql="select s.*,a.*,aa.*  from menus as s left join  activitymain as a on s.activitymain_id=a.activitymainid left join areas as aa on a.area_id= aa.areaid  where a.activitymaindeleterid=0 and a.activitymainlangflg_$langflg =1 and a.activitymainisopen=1 and s.coupon_id= ?  and a.area_fid= ? and a.activitymainify= ? ORDER BY $orderstr DESC ";
       			$tmp="$couponid,$areaid,$activitymainify";
  			
       		}else{
       			$sql="select  s.*,a.*,aa.* from menus as s left join  activitymain as a on s.activitymain_id=a.activitymainid  left join  areas as aa on a.area_id= aa.areaid where a.activitymaindeleterid=0 and a.activitymainlangflg_$langflg =1 and  a.activitymainisopen=1 and s.coupon_id= ?  and  a.area_fid= ? and a.area_id = ?  and a.activitymainify= ?  ORDER BY $orderstr DESC";
       			$tmp="$couponid,$areaid,$subareaid,$activitymainify";

       		}
			
		
			$stmt = $this->link->prepare($sql);
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			if($subareaid==0){
				$tmp="$couponid,$areaid,$activitymainify";

				$stmt->bind_param("iii",$couponid,$areaid,$activitymainify);		
			}else{
				$tmp="$couponid,$areaid,$subareaid,$activitymainify";

				$stmt->bind_param("iiii",$couponid,$areaid,$subareaid,$activitymainify);		
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']			=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']			=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']		=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']		=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']		=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']		=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']		=$row['activitymainpln_cn'];

			    $rtn[$i]['activitymainminpoint']		=$row['activitymainminpoint'];




			    $rtn[$i]['activitymainpln_tw']		=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']		=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']			=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_en']		=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']		=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']		=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']		=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']			=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']		=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']		=$row['activitymaincmt_en'];
			    $rtn[$i]['activitymaincmt_cn']		=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']		=$row['activitymaincmt_tw'];
			    
			    $rtn[$i]['activitymaincmt_kr']		=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']			=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']	=$row['activitymainimgcp_jp'];
			    $rtn[$i]['activitymainimgcp_en']	=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']	=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']	=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']	=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']		=$row['activitymainreqtime'];
			    $rtn[$i]['activitymainify']			=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']			=$row['activitytype_id'];
			    $rtn[$i]['area_fid']				=$row['area_fid'];
			    $rtn[$i]['area_id']					=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']	=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']	=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']	=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']	=$row['activitymainlangflg_tw'];
			    $rtn[$i]['activitymainlangflg_kr']	=$row['activitymainlangflg_kr'];
			    $rtn[$i]['activitymaincreaterid']	=$row['activitymaincreaterid'];
			    $rtn[$i]['activitymainupdaterid']	=$row['activitymainupdaterid'];
			    $rtn[$i]['activitymaindeleterid']	=$row['activitymaindeleterid'];
			    $rtn[$i]['activitymaincreatetime']	=$row['activitymaincreatetime'];

			    $rtn[$i]['areaid']	=$row['areaid'];
			    $rtn[$i]['areafatherid']	=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']	=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']	=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']	=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']	=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']	=$row['areaname_kr'];
			    $rtn[$i]['areasort']	=$row['areasort'];
			    $rtn[$i]['areainvalid']	=$row['areainvalid'];



			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       
       }

       
       function getPlaymasterAreasByplayid($playid){

      		$sql = "select * from  playmaster as p left join company as c on c.companyid=p.playcompany_id left join areas as a on p.area_id= a.areaid where p.playid= ?";

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$tmp="$playid";
			$stmt->bind_param("i",$playid);		

			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']				=$row['playid'];
			    $rtn[$i]['playcd']				=$row['playcd'];
			    $rtn[$i]['playname_jp']			=$row['playname_jp'];
			    $rtn[$i]['playname_en']			=$row['playname_en'];
			    $rtn[$i]['playname_cn']			=$row['playname_cn'];
			    $rtn[$i]['playname_tw']			=$row['playname_tw'];
			    $rtn[$i]['playname_kr']			=$row['playname_kr'];			
			    $rtn[$i]['playcompany_id']		=$row['playcompany_id'];			
			    $rtn[$i]['playpic1']			=$row['playpic1'];			
			    $rtn[$i]['playpic2']			=$row['playpic2'];			
			    $rtn[$i]['playpic3']			=$row['playpic3'];			
			        
			    $rtn[$i]['playpic4']			=$row['playpic4'];
			    $rtn[$i]['playpic5']			=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']	=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']	=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']	=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']	=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']	=$row['playdescription_kr'];
			    $rtn[$i]['playnotes_jp']		=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']		=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']		=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']		=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']		=$row['playnotes_kr'];
			    $rtn[$i]['playplace_jp']		=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']		=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']		=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']		=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']		=$row['playplace_kr'];
			    $rtn[$i]['playlongitude']		=$row['playlongitude'];
			    $rtn[$i]['playlatitude']		=$row['playlatitude'];
			    $rtn[$i]['playcontact']			=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']		=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']		=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']		=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']		=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']		=$row['playaccess_kr'];
			    $rtn[$i]['playclose_jp']			=$row['playclose'];
			    $rtn[$i]['playclose_en']			=$row['playclose_en'];
			    $rtn[$i]['playclose_cn']			=$row['playclose_cn'];
			    $rtn[$i]['playclose_tw']			=$row['playclose_tw'];
			    $rtn[$i]['playclose_kr']			=$row['playclose_kr'];
			    
			    $rtn[$i]['playopenstart_jp']		=$row['playopenstart'];
			    $rtn[$i]['playopenstart_en']		=$row['playopenstart_en'];
			    $rtn[$i]['playopenstart_cn']		=$row['playopenstart_cn'];
			    $rtn[$i]['playopenstart_tw']		=$row['playopenstart_tw'];
			    $rtn[$i]['playopenstart_kr']		=$row['playopenstart_kr'];
			    
			    $rtn[$i]['playopenend_jp']			=$row['playopenend'];
			    $rtn[$i]['playopenend_en']			=$row['playopenend_en'];
			    $rtn[$i]['playopenend_cn']			=$row['playopenend_cn'];
			    $rtn[$i]['playopenend_tw']			=$row['playopenend_tw'];
			    $rtn[$i]['playopenend_kr']			=$row['playopenend_kr'];
			    
			    $rtn[$i]['playhpurl']			=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']		=$row['playutubeurl'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['areafather_id']		=$row['areafather_id'];
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];
			    $rtn[$i]['playdeteleter']		=$row['playdeteleter'];
			    $rtn[$i]['playupdater']			=$row['playupdater'];
			    $rtn[$i]['playupdatetime']		=$row['playupdatetime'];
			    $rtn[$i]['playcreater']			=$row['playcreater'];
			    $rtn[$i]['playcreatetime']		=$row['playcreatetime'];

			    $rtn[$i]['areaid']				=$row['areaid'];
			    $rtn[$i]['areafatherid']		=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    $rtn[$i]['companyid']						=$row['companyid'];
			    $rtn[$i]['companycd']						=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']						=$row['companymail'];
			    $rtn[$i]['companyagtflg']					=$row['companyagtflg'];
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       

       
       function getFacilityPlaymasterByAreaidCoupon_id($coupon_id,$areaid,$langflg,$orderbystr,$subareaid=0){
			
			$orderstr="playcreatetime  ";
			
			if($orderbystr=="ordercnt"){
				$orderstr="playordercnt ";
			}
			
      		if($subareaid==0){
      			$sql = "select * from facility as f left join playmaster as p on f.play_id=p.playid left join areas as a on p.area_id= a.areaid where p.playisopen=1 and p.".$langflg."langflg=1  and f.coupon_id=? and  p.areafather_id = ?   ORDER BY $orderstr DESC";
      		}else{
      			$sql = "select * from facility as f left join playmaster as p on f.play_id=p.playid  left join areas as a on p.area_id= a.areaid where p.playisopen=1 and  p.".$langflg."langflg=1  and  f.coupon_id=? and  p.areafather_id = ? and p.area_id= ?   ORDER BY $orderstr DESC";
      		}
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			if($subareaid==0){
				$tmp="$coupon_id,$areaid";
				
			
				
				$stmt->bind_param("ii",$coupon_id,$areaid);		
			}else{
				$tmp="$coupon_id,$areaid,$subareaid";
				
				
				$stmt->bind_param("iii",$coupon_id,$areaid,$subareaid);		
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['facilityid']			=$row['facilityid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['play_id']				=$row['play_id'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    
			    $rtn[$i]['playid']				=$row['playid'];
			    $rtn[$i]['playcd']				=$row['playcd'];
			    $rtn[$i]['playname_jp']			=$row['playname_jp'];
			    $rtn[$i]['playname_en']			=$row['playname_en'];
			    $rtn[$i]['playname_cn']			=$row['playname_cn'];
			    $rtn[$i]['playname_tw']			=$row['playname_tw'];
			    $rtn[$i]['playname_kr']			=$row['playname_kr'];			
			    $rtn[$i]['playcompany_id']		=$row['playcompany_id'];			
			    $rtn[$i]['playpic1']			=$row['playpic1'];			
			    $rtn[$i]['playpic2']			=$row['playpic2'];			
			    $rtn[$i]['playpic3']			=$row['playpic3'];			
			        
			    $rtn[$i]['playpic4']			=$row['playpic4'];
			    $rtn[$i]['playpic5']			=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']	=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']	=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']	=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']	=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']	=$row['playdescription_kr'];
			    $rtn[$i]['playnotes_jp']		=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']		=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']		=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']		=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']		=$row['playnotes_kr'];
			    $rtn[$i]['playplace_jp']		=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']		=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']		=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']		=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']		=$row['playplace_kr'];
			    $rtn[$i]['playlongitude']		=$row['playlongitude'];
			    $rtn[$i]['playlatitude']		=$row['playlatitude'];
			    $rtn[$i]['playcontact']			=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']		=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']		=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']		=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']		=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']		=$row['playaccess_kr'];
			    $rtn[$i]['playclose_jp']			=$row['playclose'];
			    $rtn[$i]['playclose_en']			=$row['playclose_en'];
			    $rtn[$i]['playclose_cn']			=$row['playclose_cn'];
			    $rtn[$i]['playclose_tw']			=$row['playclose_tw'];
			    $rtn[$i]['playclose_kr']			=$row['playclose_kr'];
			    
			    $rtn[$i]['playopenstart_jp']		=$row['playopenstart'];
			    $rtn[$i]['playopenstart_en']		=$row['playopenstart_en'];
			    $rtn[$i]['playopenstart_cn']		=$row['playopenstart_cn'];
			    $rtn[$i]['playopenstart_tw']		=$row['playopenstart_tw'];
			    $rtn[$i]['playopenstart_kr']		=$row['playopenstart_kr'];
			    
			    $rtn[$i]['playopenend_jp']			=$row['playopenend'];
			    $rtn[$i]['playopenend_en']			=$row['playopenend_en'];
			    $rtn[$i]['playopenend_cn']			=$row['playopenend_cn'];
			    $rtn[$i]['playopenend_tw']			=$row['playopenend_tw'];
			    $rtn[$i]['playopenend_kr']			=$row['playopenend_kr'];
			    
			    $rtn[$i]['playhpurl']			=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']		=$row['playutubeurl'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['areafather_id']		=$row['areafather_id'];
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];
			    $rtn[$i]['playdeteleter']		=$row['playdeteleter'];
			    $rtn[$i]['playupdater']			=$row['playupdater'];
			    $rtn[$i]['playupdatetime']		=$row['playupdatetime'];
			    $rtn[$i]['playcreater']			=$row['playcreater'];
			    $rtn[$i]['playcreatetime']		=$row['playcreatetime'];

			    $rtn[$i]['areaid']				=$row['areaid'];
			    $rtn[$i]['areafatherid']		=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       

       function getBuyingBySerialnumDelegatetel($serialnum,$delegatetel,$urlareaid){
       
			$sql = "select * from buying where serialnum=? and  delegatetel = ? and urlareaid = ?";

			$tmp="$serialnum,$delegatetel,$urlareaid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ssi",$serialnum,$delegatetel,$urlareaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       
       function getBuyingBySerialnumDelegatetelMullang($serialnum,$delegatebirthday,$urlareaid){
       
			$sql = "select * from buying where serialnum=? and  delegatebirthday = ? and urlareaid = ?";

			$tmp="$serialnum,$delegatetel,$urlareaid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ssi",$serialnum,$delegatebirthday,$urlareaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       


       function getBuyingb2bBySerialnumDelegatetel($serialnum,$delegatetel,$urlareaid){
       
			$sql = "select * from buyingb2b where serialnum=? and  delegatetel = ? and urlareaid = ?";

			$tmp="$serialnum,$delegatetel,$urlareaid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ssi",$serialnum,$delegatetel,$urlareaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['frmcompanyid']	=$row['frmcompanyid'];
			    
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       
       function getBuyingb2bBySerialnumDelegatetelMullang($serialnum,$delegatebirthday,$urlareaid){
       
			$sql = "select * from buyingb2b where serialnum=? and  delegatebirthday = ? and urlareaid = ?";

			$tmp="$serialnum,$delegatebirthday,$urlareaid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ssi",$serialnum,$delegatebirthday,$urlareaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['frmcompanyid']	=$row['frmcompanyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       
       function getBuyingb2bIsCancelByBuyid($buyid){
       
			$sql = "select * from buyingb2b where buyid=? and cancelflg =1 ";

			$tmp="$buyid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$buyid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
  
       function getBuyingIsCancelByBuyid($buyid){
       
			$sql = "select * from buying where buyid=? and cancelflg =1 ";

			$tmp="$buyid";
	
			
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$buyid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']			=$row['buyid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['area_id']			=$row['area_id'];
			    $rtn[$i]['caldate']			=$row['caldate'];
			    
			    $rtn[$i]['period']			=$row['period'];
			    $rtn[$i]['usagetypecnt']	=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['delegatefist']	=$row['delegatefist'];
			    $rtn[$i]['delegatelast']	=$row['delegatelast'];			
			    $rtn[$i]['delegatesex']		=$row['delegatesex'];			
			    $rtn[$i]['delegateage']		=$row['delegateage'];			
			    $rtn[$i]['delegatetel']		=$row['delegatetel'];			
			    $rtn[$i]['delegatemail']	=$row['delegatemail'];			
			        
			    $rtn[$i]['cancelflg']		=$row['cancelflg'];
			    $rtn[$i]['deleterid']		=$row['deleterid'];
			    $rtn[$i]['display']			=$row['display'];
			    $rtn[$i]['createtime']		=$row['createtime'];



			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
  
                
       function getCouponsByCouponid($couponid){
       
			$sql = "select * from coupons where coupondeleter=0 and  couponid = ? ";

			$tmp="$couponid";
			

			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$couponid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']				=$row['couponid'];
			    $rtn[$i]['couponcd']				=$row['couponcd'];
			    $rtn[$i]['couponname_jp']			=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']			=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']			=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']			=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']			=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']		=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']			=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']				=$row['couponstart'];
			    $rtn[$i]['couponend']				=$row['couponend'];
			    $rtn[$i]['couponinterval']			=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']				=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']		=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']		=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']		=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']		=$row['couponchildb2bprice'];
			    $rtn[$i]['coupontype']				=$row['coupontype'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']			=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']			=$row['couponupdater'];
			    $rtn[$i]['couponupdate']			=$row['couponupdate'];
			    $rtn[$i]['couponcreater']			=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']		=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       
       }
       
       function getCoupons($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from coupons where coupondeleter=0 and area_id= ?  order by couponcreatetime desc limit ?,?";

			$tmp="$areaid,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']				=$row['couponid'];
			    $rtn[$i]['couponcd']				=$row['couponcd'];
			    $rtn[$i]['couponname_jp']			=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']			=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']			=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']			=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']			=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']		=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']			=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']				=$row['couponstart'];
			    $rtn[$i]['couponend']				=$row['couponend'];
			    $rtn[$i]['couponinterval']			=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']				=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']		=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']		=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']		=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']		=$row['couponchildb2bprice'];
			    $rtn[$i]['coupontype']				=$row['coupontype'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']			=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']			=$row['couponupdater'];
			    $rtn[$i]['couponupdate']			=$row['couponupdate'];
			    $rtn[$i]['couponcreater']			=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']		=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        

       function getBuyings($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "
					select * from (
						select b.buyid,null as frmsellerid,null as frmcompanyid ,b.mdacode,b.ismobile,b.affiliatecd,b.seller_id,b.serialnum,b.accessid,b.accesspass,b.coupon_id,b.copnpoint_id,b.urlareaid,b.area_id,b.caldate,b.period,b.usagetypecnt,b.money_id,b.finalmoney,null,'0' as b2bflg,b.finalmoneylog,b.point_id,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,b.cancelday,b.cancelfee,b.deleterid,b.display,createtime from buying  as b where b.deleterid=0 and b.urlareaid= ?   
						union all
						select bb.buyid,bb.frmsellerid,bb.frmcompanyid,bb.mdacode,bb.ismobile,null,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime from buyingb2b  as bb where bb.deleterid=0 and bb.urlareaid= ? 
					) as ut ORDER BY `ut`.`createtime` DESC  limit ?,? 
			";

			$tmp="$areaid,$areaid,$start_from, $num_rec_per_page";
			
			
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiii",$areaid,$areaid,$start_from,$num_rec_per_page);		

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    
			    $rtn[$i]['frmsellerid']			=$row['frmsellerid'];
			    $rtn[$i]['frmcompanyid']		=$row['frmcompanyid'];
			    
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    
			    $rtn[$i]['ismobile']			=$row['ismobile'];
			    
			    
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        

       function getAllBuyingb2bs($areaid,$companyid,$sellerid){


       		$updatedate=date('Y-m-d');
			$sql = "

						select bb.buyid,bb.ismobile,bb.mdacode,null,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime 
						from buyingb2b  as bb 
						where bb.deleterid=0 
						and bb.urlareaid= ? 
						and bb.frmcompanyid= ? 
					    and bb.frmsellerid= ? 
			";

			$tmp="$areaid,$companyid,$sellerid,$start_from, $num_rec_per_page";
			
			
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$companyid,$sellerid);		

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['ismobile']				=$row['ismobile'];
			    
			    
			    
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        
                    
       function getBuyingb2bs($start_from, $num_rec_per_page,$areaid,$companyid,$sellerid){


       		$updatedate=date('Y-m-d');
			$sql = "

						select bb.buyid,bb.frmsellerid,bb.frmcompanyid,bb.mdacode,null,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime 
						from buyingb2b  as bb 
						where bb.deleterid=0 
						and bb.urlareaid= ? 
						and bb.frmcompanyid= ? 
						and bb.frmsellerid= ? 
					    ORDER BY `bb`.`createtime` DESC  limit ?,? 
			";

			$tmp="$areaid,$companyid,$start_from, $num_rec_per_page";
			
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiiii",$areaid,$companyid,$sellerid,$start_from,$num_rec_per_page);		

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['frmsellerid']			=$row['frmsellerid'];
			    $rtn[$i]['frmcompanyid']		=$row['frmcompanyid'];
			    
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        

       function searchGetBuyingb2bs($keyword,$areaid,$companyid,$sellerid){


       		$updatedate=date('Y-m-d');
			$sql = "

						select bb.buyid,bb.frmsellerid,bb.frmcompanyid,bb.ismobile,bb.mdacode,null,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime 
						from buyingb2b  as bb 
						where bb.deleterid=0 
						and bb.urlareaid= ? 
						and bb.frmcompanyid= ? 
						and bb.frmsellerid= ? 
						and CONCAT(bb.serialnum) LIKE CONCAT('%',?,'%') 
					    ORDER BY `bb`.`createtime` DESC  
			";

			$tmp="$areaid,$companyid,$sellerid,$keyword";
			
		
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiis",$areaid,$companyid,$sellerid,$keyword);		

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['frmsellerid']			=$row['frmsellerid'];
			    $rtn[$i]['frmcompanyid']		=$row['frmcompanyid'];
			    
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    
			    $rtn[$i]['ismobile']			=$row['ismobile'];
			    
			    
			    $rtn[$i]['affiliatecd']			=$row['affiliatecd'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }               
       function searchAllBuyings($areaid,$keyword){


       		$updatedate=date('Y-m-d');
			$sql = "select b.buyid,b.mdacode,b.ismobile,b.seller_id,b.serialnum,b.accessid,b.accesspass,b.coupon_id,b.copnpoint_id,b.urlareaid,b.area_id,b.caldate,b.period,b.usagetypecnt,b.money_id,b.finalmoney,null,'0' as b2bflg,b.finalmoneylog,b.point_id,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,b.cancelday,b.cancelfee,b.deleterid,b.display,createtime from buying  as b 
					where  CONCAT_WS(b.serialnum,b.caldate,b.period,b.finalmoney,b.delegatetel,b.delegatemail,b.cancelday) LIKE CONCAT('%',?,'%') and  b.deleterid=0 and b.urlareaid= ?   
					union all
					select bb.buyid,bb.mdacode,bb.ismobile,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,'1' as b2bflg,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime from buyingb2b  as bb 
					where  CONCAT_WS(bb.serialnum,bb.caldate,bb.period,bb.finalmoney,bb.delegatetel,bb.delegatemail,bb.cancelday) LIKE CONCAT('%',?,'%') and bb.deleterid=0 and bb.urlareaid= ? 
					 
			";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sisi",$searchkey,$urlareaid,$searchkey,$urlareaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['ismobile']			=$row['ismobile'];
			    
			    $rtn[$i]['couponname']			=$row['couponname'];
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany']	=$row['couponheldcompany'];			    
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment']		=$row['couponcomment'];
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       } 
              
       function searchAllCoupons($searchkey){


       		$updatedate=date('Y-m-d');
			$sql = "select * from coupons  where  CONCAT_WS(`couponcd`,`couponadultpoint`,`couponname_jp`,`couponcomment_jp`)   LIKE CONCAT('%',?,'%') and coupondeleter=0 ";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("s",$searchkey);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname']			=$row['couponname'];
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany']	=$row['couponheldcompany'];			    
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment']		=$row['couponcomment'];
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       } 
       
       function getFrontAllCoupons(){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from coupons where coupondeleter=0 ";
			// 下記のSQLで間違って重複データになるので、コメントアウトする
			$sql = "select c.*,b.* from coupons as c left join copnb2cmoney b on c.couponid= b.coupon_id left join b2cmoneycal as ca on b.copnb2cmid=ca.f_key  where c.coupondeleter=0  order by c.couponcreatetime desc ";
			


			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['couponid']				=$row['couponid'];
			    $rtn[$i]['couponcd']				=$row['couponcd'];
			    $rtn[$i]['couponname']				=$row['couponname'];
			    $rtn[$i]['couponadultpoint']		=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']			=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']				=$row['couponstart'];
			    $rtn[$i]['couponend']				=$row['couponend'];
			    $rtn[$i]['couponinterval']			=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']				=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']		=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']		=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']		=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']		=$row['couponchildb2bprice'];
			    
			    $rtn[$i]['coupontype']				=$row['coupontype'];
			    
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']			=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']			=$row['couponupdater'];
			    $rtn[$i]['couponupdate']			=$row['couponupdate'];
			    $rtn[$i]['couponcreater']			=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']		=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  
		  
		  return $rtn;

			
       }   
       function getAllActivityTypeJS($activitytype){


   
       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype  where activitydeleter=0 and activitytype = $activitytype";
		
		
			$stmt = $this->link->prepare($sql);
			//$stmt->bind_param("i", $activitytype);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']	=$row['activitycreatetime'];
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

       
       }
              
       function getAllCoupons($areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from coupons where coupondeleter=0  and area_id= ?";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i", $areaid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname']			=$row['couponname'];
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  
		  
		  return $rtn;

			
       }     
       
       function getAllBuyings($areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select b.buyid,b.mdacode,b.ismobile,b.seller_id,b.serialnum,b.accessid,b.accesspass,b.coupon_id,b.copnpoint_id,b.urlareaid,b.area_id,b.caldate,b.period,b.usagetypecnt,b.money_id,b.finalmoney,null,b.finalmoneylog,b.point_id,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,b.cancelday,b.cancelfee,b.deleterid,b.display,createtime from buying  as b where b.deleterid=0 and b.urlareaid= ?   
					union all
					select bb.buyid,bb.mdacode,bb.ismobile,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime from buyingb2b  as bb where bb.deleterid=0 and bb.urlareaid= ? 
					
			";

			$tmp="$areaid,$areaid,$start_from, $num_rec_per_page";
			
			
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$areaid,$areaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['ismobile']			=$row['ismobile'];
			    
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }               
       
      function getAllBuyingsByCompanyid($areaid){


       		$updatedate=date('Y-m-d');
			$sql = "
			
					select b.buyid,b.mdacode,b.seller_id,b.serialnum,b.accessid,b.accesspass,b.coupon_id,b.copnpoint_id,b.urlareaid,b.area_id,b.caldate,b.period,b.usagetypecnt,b.money_id,b.finalmoney,null,b.finalmoneylog,b.point_id,b.finalpointval,b.finalpointvallog,b.delegatefist,b.delegatelast,b.delegatesex,b.delegateage,b.delegatetel,b.delegatemail,b.isused,b.cancelflg,b.cancelday,b.cancelfee,b.deleterid,b.display,createtime from buying  as b where b.deleterid=0 and b.urlareaid= ?   
					union all
					select bb.buyid,bb.mdacode,bb.seller_id,bb.serialnum,bb.accessid,bb.accesspass,bb.coupon_id,bb.copnpoint_id,bb.urlareaid,bb.area_id,bb.caldate,bb.period,bb.usagetypecnt,bb.money_id,bb.finalmoney,bb.finalmoneyday,bb.finalmoneylog,bb.point_id,bb.finalpointval,bb.finalpointvallog,bb.delegatefist,bb.delegatelast,bb.delegatesex,bb.delegateage,bb.delegatetel,bb.delegatemail,bb.isused,bb.cancelflg,bb.cancelday,bb.cancelfee,bb.deleterid,bb.display,bb.createtime from buyingb2b  as bb where bb.deleterid=0 and bb.urlareaid= ? 
					
			";

			$tmp="$areaid,$areaid,$start_from, $num_rec_per_page";
			
			
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$areaid,$areaid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buyid']				=$row['buyid'];
			    $rtn[$i]['mdacode']				=$row['mdacode'];
			    $rtn[$i]['seller_id']			=$row['seller_id'];
			    $rtn[$i]['serialnum']			=$row['serialnum'];
			    $rtn[$i]['accessid']			=$row['accessid'];
			    $rtn[$i]['accesspass']			=$row['accesspass'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['area_id']				=$row['area_id'];
			    $rtn[$i]['caldate']				=$row['caldate'];
			    $rtn[$i]['period']				=$row['period'];
			    $rtn[$i]['usagetypecnt']		=$row['usagetypecnt'];			
			    $rtn[$i]['money_id']			=$row['money_id'];			
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];			
			    $rtn[$i]['finalmoneyday']		=$row['finalmoneyday'];			
			    $rtn[$i]['finalmoneylog']		=$row['finalmoneylog'];			
			        
			    $rtn[$i]['point_id']			=$row['point_id'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['finalpointvallog']	=$row['finalpointvallog'];
			    $rtn[$i]['delegatefist']		=$row['delegatefist'];
			    $rtn[$i]['delegatelast']		=$row['delegatelast'];
			    $rtn[$i]['delegatesex']			=$row['delegatesex'];
			    $rtn[$i]['delegateage']			=$row['delegateage'];
			    $rtn[$i]['delegatetel']			=$row['delegatetel'];
			    $rtn[$i]['delegatemail']		=$row['delegatemail'];
			    $rtn[$i]['isused']				=$row['isused'];
			    $rtn[$i]['cancelflg']			=$row['cancelflg'];
			    
			    $rtn[$i]['cancelday']			=$row['cancelday'];
			    $rtn[$i]['cancelfee']			=$row['cancelfee'];
			    $rtn[$i]['deleterid']			=$row['deleterid'];
			    $rtn[$i]['display']				=$row['display'];
			    $rtn[$i]['createtime']			=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }             
       
              
		function getThedayPointByCoupon_idCopnpoint_id($coupon_id,$f_key,$calmonth){

			$sql = "select *  from pointcal  where coupon_id = ? and  f_key = ? and calmonth = ?";
			$stmt = $this->link->prepare($sql);
			$tmp="$coupon_id,$f_key,$calmonth";


		
			$stmt->bind_param("iis", $coupon_id,$f_key,$calmonth);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];



				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

		}
		       
		function getCompanyByAgents($coupon_id){

			$sql = "select a.*,b.* from company as a right join agents as b on a.companyid=b.company_id where b.coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$coupon_id";
		
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']			=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']			=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']			=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']			=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    $rtn[$i]['agentid']				=$row['agentid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['company_id']			=$row['company_id'];

				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

		}
		function getPlaymasterByFacility($coupon_id){

			$sql = "select a.*,b.*,ar.* from playmaster as a right join facility as b on a.playid =b.play_id  left join areas as ar on ar.areaid= a.area_id where b.coupon_id = ? and a.playcd<>'' ";
			$stmt = $this->link->prepare($sql);
			$tmp="$coupon_id";
			

			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
			    $rtn[$i]['areafatherid']					=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    
			    
			    
			    $rtn[$i]['facilityid']				=$row['facilityid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['play_id']			=$row['play_id'];

				$i++;
			}
		  $stmt->free_result();
	 
		  return $rtn;
	   }
	   
		function getMenusByCoupon_id($coupon_id){

			$sql = "select a.*,b.*,c.* from activitymain as a right join menus as b on a.activitymainid =b.activitymain_id left join areas as c on c.areaid= a.area_id where b.coupon_id = ?  ";
			$stmt = $this->link->prepare($sql);
			$tmp="$coupon_id";
			
		
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']					=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']						=$row['activitymainminpoint'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']					=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']						=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']					=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']					=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']						=$row['activitymainmod'];
			    $rtn[$i]['activitymainnoshowbaby']					=$row['activitymainnoshowbaby'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    $rtn[$i]['activitymaincmt_cn']					=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']							=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']					=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']						=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    $rtn[$i]['activitymainimgcp_en']						=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];

			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']					=$row['activitymainreqtime'];
			    $rtn[$i]['activitymainify']					=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']					=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']					=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];

			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];

			    
			    $rtn[$i]['facilityid']				=$row['facilityid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['play_id']			=$row['play_id'];

			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areafatherid']			=$row['areafatherid'];
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;
	   }	   
	   
	   function getCopnb2cmoneyByCopnb2cmid($id){
	   		
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnb2cmoney where copnb2cmid = ? ";
			$tmp="$id";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnb2cmid']			=$row['copnb2cmid'];
			    $rtn[$i]['copnb2cmname_jp']		=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']		=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']		=$row['copnb2cmname_us']; 
			    $rtn[$i]['copnb2cmname_cn']		=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']		=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']		=$row['copnb2cmname_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']			=$row['copncreate'];
			    
				$i++;
			}
		  	$stmt->free_result();
		 
			return $rtn;
	   		
	   
	   }	   
	   
	   function getCopnb2bmoneyByCopnb2cmid($id){
	   		
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnb2bmoney where copnb2bmid = ? ";
			$tmp="$id";



			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnb2bmid']			=$row['copnb2bmid'];
			    $rtn[$i]['copnb2bmname_jp']		=$row['copnb2bmname_jp'];
			    $rtn[$i]['copnb2bmname_en']		=$row['copnb2bmname_en'];
			    $rtn[$i]['copnb2bmname_us']		=$row['copnb2bmname_us'];
			    $rtn[$i]['copnb2bmname_cn']		=$row['copnb2bmname_cn'];
			    $rtn[$i]['copnb2bmname_tw']		=$row['copnb2bmname_tw'];
			    $rtn[$i]['copnb2bmname_kr']		=$row['copnb2bmname_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']			=$row['copncreate'];
			    
				$i++;
			}
		  	$stmt->free_result();
		 
			return $rtn;
	   		
	   
	   }		   
	   
       function getCoupon($id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from coupons as c left join dissign as d on d.dissignid= c.dissign_id  where couponid = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']				=$row['couponid'];
			    $rtn[$i]['area_id']					=$row['area_id'];			    
			    $rtn[$i]['couponcd']				=$row['couponcd'];
			    $rtn[$i]['couponname_jp']			=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']			=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']			=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']			=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']			=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']		=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']			=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']				=$row['couponstart'];
			    $rtn[$i]['couponend']				=$row['couponend'];
			    $rtn[$i]['couponinterval']			=$row['couponinterval'];
			    $rtn[$i]['couponclosedupd']			=$row['couponclosedupd'];
			    $rtn[$i]['couponclosedupt']			=$row['couponclosedupt'];
			    
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];

			    $rtn[$i]['couponpic']				=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']		=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']		=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']		=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']		=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupontype']				=$row['coupontype'];
			    
			    $rtn[$i]['dissign_id']				=$row['dissign_id'];
			    
			    
			    $rtn[$i]['jplangflg']				=$row['jplangflg'];
			    $rtn[$i]['enlangflg']				=$row['enlangflg'];
			    $rtn[$i]['cnlangflg']				=$row['cnlangflg'];
			    $rtn[$i]['twlangflg']				=$row['twlangflg'];
			    $rtn[$i]['krlangflg']				=$row['krlangflg'];
			    
			    
			    $rtn[$i]['coupondeleter']			=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']			=$row['couponupdater'];
			    $rtn[$i]['couponupdate']			=$row['couponupdate'];
			    $rtn[$i]['couponcreater']			=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']		=$row['couponcreatetime'];
			    
			    
			    $rtn[$i]['dissignid']				=$row['dissignid'];
			    $rtn[$i]['dissignname']				=$row['dissignname'];
			    $rtn[$i]['dissignfolder']			=$row['dissignfolder'];
			    $rtn[$i]['dissigncreatetime']		=$row['dissigncreatetime'];
			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

       }  
	   
       function getMdacodes($areaid,$mdacode){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from mdacodes where area_id = ? and mdacode = ?";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("is", $areaid,$mdacode);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['mdacodeid']				=$row['mdacodeid'];
			    $rtn[$i]['mdacode']					=$row['mdacode'];			    
			    $rtn[$i]['mdacodename']				=$row['mdacodename'];
			    $rtn[$i]['mdacodecompany']			=$row['mdacodecompany'];
			    $rtn[$i]['area_id']					=$row['area_id'];

				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

       }  

       function getAgentsbyCompanyid($id){
			$sql = "select 
					a.*,
					c.area_id,
					c.couponcd,
					c.couponname_jp,
					c.couponname_en,
					c.couponname_cn,
					c.couponname_tw,
					c.couponname_kr,
					c.couponadultpoint,
					c.ouponchildpoint,
					c.couponstart,
					c.couponend,
					c.couponinterval,
					c.couponclosedupd,
					c.couponclosedupt,
					c.couponheldcompany_jp,
					c.couponheldcompany_en,
					c.couponheldcompany_cn,
					c.couponheldcompany_tw,
					c.couponheldcompany_kr,
					c.couponadultb2cprice,
					c.couponchildb2cprice,
					c.couponadultb2bprice,
					c.couponchildb2bprice,
					c.couponcomment_jp,
					c.couponcomment_en,
					c.couponcomment_cn,
					c.couponcomment_tw,
					c.couponcomment_kr,
					c.coupontype,
					c.jplangflg,
					c.enlangflg,
					c.cnlangflg,
					c.twlangflg,
					c.krlangflg,
					c.coupondeleter,
					c.couponupdater,
					c.couponupdate,
					c.couponcreater,
					c.couponcreatetime
			
			 from agents as a left join coupons as  c on a.coupon_id=c.couponid where a.company_id = ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
			$stmt->bind_param("i", $id);

			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
		
			    $rtn[$i]['agentid']				=$row['agentid'];			
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];			
			    $rtn[$i]['company_id']			=$row['company_id'];		

			    $rtn[$i]['dissign_id']			=$row['dissign_id'];		
			    $rtn[$i]['area_id']				=$row['area_id'];		
			    $rtn[$i]['couponcd']			=$row['couponcd'];		
			    $rtn[$i]['couponname_jp']		=$row['couponname_jp'];		
			    $rtn[$i]['couponname_en']		=$row['couponname_en'];		
			    $rtn[$i]['couponname_cn']		=$row['couponname_cn'];		
			    $rtn[$i]['couponname_tw']		=$row['couponname_tw'];		
			    $rtn[$i]['couponname_kr']		=$row['couponname_kr'];		
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];		
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];		
			    $rtn[$i]['couponstart']			=$row['couponstart'];		
			    $rtn[$i]['couponend']			=$row['couponend'];		
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];		
			    $rtn[$i]['couponclosedupd']		=$row['couponclosedupd'];		
			    $rtn[$i]['couponclosedupt']		=$row['couponclosedupt'];		
			    $rtn[$i]['couponheldcompany_jp']=$row['couponheldcompany_jp'];		
			    $rtn[$i]['couponheldcompany_en']=$row['couponheldcompany_en'];		
			    $rtn[$i]['couponheldcompany_cn']=$row['couponheldcompany_cn'];		
			    $rtn[$i]['couponheldcompany_tw']=$row['couponheldcompany_tw'];		
			    $rtn[$i]['couponheldcompany_kr']=$row['couponheldcompany_kr'];		
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];		
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];		
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];		
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];		
			    $rtn[$i]['couponcomment_jp']	=$row['couponcomment_jp'];		
			    $rtn[$i]['couponcomment_en']	=$row['couponcomment_en'];		
			    $rtn[$i]['couponcomment_cn']	=$row['couponcomment_cn'];		
			    $rtn[$i]['couponcomment_tw']	=$row['couponcomment_tw'];		
			    $rtn[$i]['couponcomment_kr']	=$row['couponcomment_kr'];		
			    $rtn[$i]['coupontype']			=$row['coupontype'];		
	
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];		
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];		
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];		
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];		
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];		
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];		
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];		
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];		
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];		
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];		
			    
				$i++;
			}
			$stmt->free_result();


	 
			return $rtn;
       
       }
       
       function getFrontAgentsCompanyidsOnly($id){
			$sql = "select * from agents as a left join company as  c on a.company_id=c.companyid where a.coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
			$stmt->bind_param("i", $id);


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
		
			    $rtn[$i]			=$row['company_id'];			

			    
				$i++;
			}
			$stmt->free_result();
		 
			return $rtn;
       
       }

       function getFrontAgents($id){
			$sql = "select * from agents as a left join company as  c on a.company_id=c.companyid where a.coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
			$stmt->bind_param("i", $id);


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['agentid']				=$row['agentid'];			
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];			
			    $rtn[$i]['company_id']			=$row['company_id'];			
			    $rtn[$i]['dissign_id']			=$row['dissign_id'];			

			    
			    $rtn[$i]['companyid']			=$row['companyid'];			
			    $rtn[$i]['companycd']			=$row['companycd'];			
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];			
			    $rtn[$i]['companyname_en']		=$row['companyname_en'];			
			    $rtn[$i]['companyname_cn']		=$row['companyname_cn'];			
			    $rtn[$i]['companyname_tw']		=$row['companyname_tw'];			
			    $rtn[$i]['companyname_kr']		=$row['companyname_kr'];			
			    $rtn[$i]['companymail']			=$row['companymail'];			
			    $rtn[$i]['companytel_jp']		=$row['companytel_jp'];			
			    $rtn[$i]['companytel_en']		=$row['companytel_en'];			
			    $rtn[$i]['companytel_cn']		=$row['companytel_cn'];			
			    $rtn[$i]['companytel_tw']		=$row['companytel_tw'];			
			    $rtn[$i]['companytel_kr']		=$row['companytel_kr'];			
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];			
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];			
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];			
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];			
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];			
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];			
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];			
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];			
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];			
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];			
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];			
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];			
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];			
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];			
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];			
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];			
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];		
			    	
			    
				$i++;
			}
			$stmt->free_result();
		 
			return $rtn;
       
       }
  
  
                
       function getAgentDissignByCompany_idCoupon_id($coupon_id,$company_id){
			$sql = "select * from agents as a left join dissign as  d on a.dissign_id=d.dissignid where a.coupon_id = ? and company_id = ?";
			$stmt = $this->link->prepare($sql);
			$tmp="$coupon_id,$company_id";
			
		
			$stmt->bind_param("ii", $coupon_id,$company_id);

			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['agentid']				=$row['agentid'];			
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];			
			    $rtn[$i]['company_id']			=$row['company_id'];			
			    $rtn[$i]['dissign_id']			=$row['dissign_id'];			

			    
			    $rtn[$i]['dissignid']			=$row['dissignid'];			
			    $rtn[$i]['dissignname']			=$row['dissignname'];			
			    $rtn[$i]['dissignfolder']		=$row['dissignfolder'];			
			    $rtn[$i]['dissigndeleter']		=$row['dissigndeleter'];			
			    $rtn[$i]['dissigncreatetime']	=$row['dissigncreatetime'];	
			    	
			    
				$i++;
			}
			$stmt->free_result();
		 
			return $rtn;
       
       }
       
       function getFrontFacilitys($id){
			$sql = "select * from facility as f left join playmaster as  p on f.play_id=p.playid where p.playisopen=1 and f.coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
			$stmt->bind_param("i", $id);


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['facilityid']			=$row['facilityid'];			
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];			
			    $rtn[$i]['play_id']				=$row['play_id'];			
			    
			    $rtn[$i]['playid']				=$row['playid'];			
			    $rtn[$i]['playcd']				=$row['playcd'];	
			    
			    $rtn[$i]['playminipoint']		=$row['playminipoint'];			
			    $rtn[$i]['playname_jp']			=$row['playname_jp'];			
			    $rtn[$i]['playname_en']			=$row['playname_en'];			
			    $rtn[$i]['playname_en']			=$row['playname_en'];			
			    $rtn[$i]['playname_cn']			=$row['playname_cn'];			
			    $rtn[$i]['playname_tw']			=$row['playname_tw'];			
			    $rtn[$i]['playname_kr']			=$row['playname_kr'];			
			    $rtn[$i]['playcompany_id']		=$row['playcompany_id'];			
			    $rtn[$i]['playpic1']			=$row['playpic1'];			
			    $rtn[$i]['playpic2']			=$row['playpic2'];			
			    $rtn[$i]['playpic3']			=$row['playpic3'];			
			    $rtn[$i]['playpic4']			=$row['playpic4'];			
			    $rtn[$i]['playpic5']			=$row['playpic5'];			
			    $rtn[$i]['playdescription_jp']	=$row['playdescription_jp'];			
			    $rtn[$i]['playdescription_en']	=$row['playdescription_en'];			
			    $rtn[$i]['playdescription_cn']	=$row['playdescription_cn'];			
			    $rtn[$i]['playdescription_tw']	=$row['playdescription_tw'];			
			    $rtn[$i]['playdescription_kr']	=$row['playdescription_kr'];			
			    $rtn[$i]['playnotes_jp']		=$row['playnotes_jp'];			
			    $rtn[$i]['playnotes_en']		=$row['playnotes_en'];			
			    $rtn[$i]['playnotes_cn']		=$row['playnotes_cn'];			
			    $rtn[$i]['playnotes_tw']		=$row['playnotes_tw'];			
			    $rtn[$i]['playnotes_kr']		=$row['playnotes_kr'];			
			    $rtn[$i]['playplace_jp']		=$row['playplace_jp'];			
			    $rtn[$i]['playplace_en']		=$row['playplace_en'];			
			    $rtn[$i]['playplace_cn']		=$row['playplace_cn'];			
			    $rtn[$i]['playplace_tw']		=$row['playplace_tw'];			
			    $rtn[$i]['playplace_kr']		=$row['playplace_kr'];			
			    $rtn[$i]['playlongitude']		=$row['playlongitude'];		
			    $rtn[$i]['playlatitude']		=$row['playlatitude'];		
			    $rtn[$i]['playcontact']			=$row['playcontact'];		
			    $rtn[$i]['playaccess_jp']		=$row['playaccess_jp'];		
			    $rtn[$i]['playaccess_en']		=$row['playaccess_en'];		
			    $rtn[$i]['playaccess_cn']		=$row['playaccess_cn'];		
			    $rtn[$i]['playaccess_tw']		=$row['playaccess_tw'];		
			    $rtn[$i]['playaccess_kr']		=$row['playaccess_kr'];		
			    $rtn[$i]['playclose']			=$row['playclose'];		
			    $rtn[$i]['playopenstart']		=$row['playopenstart'];		
			    $rtn[$i]['playopenend']			=$row['playopenend'];		
			    $rtn[$i]['playhpurl']			=$row['playhpurl'];		
			    $rtn[$i]['playutubeurl']		=$row['playutubeurl'];		
			    $rtn[$i]['area_id']				=$row['area_id'];		
			    $rtn[$i]['areafather_id']		=$row['areafather_id'];		
			    $rtn[$i]['activitytype_id']		=$row['activitytype_id'];		
			    
			    
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];		
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];		
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];		
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];		
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];		
			    $rtn[$i]['playdeteleter']		=$row['playdeteleter'];		
			    $rtn[$i]['playupdater']			=$row['playupdater'];		
			    $rtn[$i]['playupdatetime']		=$row['playupdatetime'];		
			    $rtn[$i]['playcreater']			=$row['playcreater'];		
			    $rtn[$i]['playcreatetime']		=$row['playcreatetime'];		

			    	
			    
				$i++;
			}
			$stmt->free_result();
		 
			return $rtn;
       
       }       
       
       function getFrontFacilitysPlaymasterActivitytype($id,$langflg){
			$sql = "select * from facility as f left join playmaster as  p on f.play_id=p.playid left join activitytype as a on a.activitytypeid= p.activitytype_id where p.".$langflg."langflg =1 and p.playisopen=1 and f.coupon_id = ? order by p.activitytype_id ASC";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
		
			
			$stmt->bind_param("i", $id);


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['facilityid']			=$row['facilityid'];			
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];			
			    $rtn[$i]['play_id']				=$row['play_id'];			
			    
			    $rtn[$i]['playid']				=$row['playid'];			
			    $rtn[$i]['playcd']				=$row['playcd'];	
			    
			    $rtn[$i]['playminipoint']		=$row['playminipoint'];			
			    $rtn[$i]['playname_jp']			=$row['playname_jp'];			
			    $rtn[$i]['playname_en']			=$row['playname_en'];			
			    $rtn[$i]['playname_cn']			=$row['playname_cn'];			
			    $rtn[$i]['playname_tw']			=$row['playname_tw'];			
			    $rtn[$i]['playname_kr']			=$row['playname_kr'];			
			    $rtn[$i]['playcompany_id']		=$row['playcompany_id'];			
			    $rtn[$i]['playpic1']			=$row['playpic1'];			
			    $rtn[$i]['playpic2']			=$row['playpic2'];			
			    $rtn[$i]['playpic3']			=$row['playpic3'];			
			    $rtn[$i]['playpic4']			=$row['playpic4'];			
			    $rtn[$i]['playpic5']			=$row['playpic5'];			
			    $rtn[$i]['playdescription_jp']	=$row['playdescription_jp'];			
			    $rtn[$i]['playdescription_en']	=$row['playdescription_en'];			
			    $rtn[$i]['playdescription_cn']	=$row['playdescription_cn'];			
			    $rtn[$i]['playdescription_tw']	=$row['playdescription_tw'];			
			    $rtn[$i]['playdescription_kr']	=$row['playdescription_kr'];			
			    $rtn[$i]['playnotes_jp']		=$row['playnotes_jp'];			
			    $rtn[$i]['playnotes_en']		=$row['playnotes_en'];			
			    $rtn[$i]['playnotes_cn']		=$row['playnotes_cn'];			
			    $rtn[$i]['playnotes_tw']		=$row['playnotes_tw'];			
			    $rtn[$i]['playnotes_kr']		=$row['playnotes_kr'];			
			    $rtn[$i]['playplace_jp']		=$row['playplace_jp'];			
			    $rtn[$i]['playplace_en']		=$row['playplace_en'];			
			    $rtn[$i]['playplace_cn']		=$row['playplace_cn'];			
			    $rtn[$i]['playplace_tw']		=$row['playplace_tw'];			
			    $rtn[$i]['playplace_kr']		=$row['playplace_kr'];			
			    $rtn[$i]['playlongitude']		=$row['playlongitude'];		
			    $rtn[$i]['playlatitude']		=$row['playlatitude'];		
			    $rtn[$i]['playcontact']			=$row['playcontact'];		
			    $rtn[$i]['playaccess_jp']		=$row['playaccess_jp'];		
			    $rtn[$i]['playaccess_en']		=$row['playaccess_en'];		
			    $rtn[$i]['playaccess_cn']		=$row['playaccess_cn'];		
			    $rtn[$i]['playaccess_tw']		=$row['playaccess_tw'];		
			    $rtn[$i]['playaccess_kr']		=$row['playaccess_kr'];		
			    $rtn[$i]['playclose']			=$row['playclose'];		
			    $rtn[$i]['playopenstart']		=$row['playopenstart'];		
			    $rtn[$i]['playopenend']			=$row['playopenend'];		
			    $rtn[$i]['playhpurl']			=$row['playhpurl'];		
			    $rtn[$i]['playutubeurl']		=$row['playutubeurl'];		
			    $rtn[$i]['area_id']				=$row['area_id'];		
			    $rtn[$i]['areafather_id']		=$row['areafather_id'];		
			    $rtn[$i]['activitytype_id']		=$row['activitytype_id'];		
			    
			    
			    $rtn[$i]['jplangflg']			=$row['jplangflg'];		
			    $rtn[$i]['enlangflg']			=$row['enlangflg'];		
			    $rtn[$i]['cnlangflg']			=$row['cnlangflg'];		
			    $rtn[$i]['twlangflg']			=$row['twlangflg'];		
			    $rtn[$i]['krlangflg']			=$row['krlangflg'];		
			    $rtn[$i]['playdeteleter']		=$row['playdeteleter'];		
			    $rtn[$i]['playupdater']			=$row['playupdater'];		
			    $rtn[$i]['playupdatetime']		=$row['playupdatetime'];		
			    $rtn[$i]['playcreater']			=$row['playcreater'];		
			    $rtn[$i]['playcreatetime']		=$row['playcreatetime'];		

			    	
			    $rtn[$i]['activitytypeid']		=$row['activitytypeid'];		
			    $rtn[$i]['activityname_jp']		=$row['activityname_jp'];		
			    $rtn[$i]['activityname_en']		=$row['activityname_en'];		
			    $rtn[$i]['activityname_cn']		=$row['activityname_cn'];		
			    $rtn[$i]['activityname_tw']		=$row['activityname_tw'];		
			    $rtn[$i]['activityname_kr']		=$row['activityname_kr'];		
			    $rtn[$i]['activitytype']		=$row['activitytype'];		
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];		
			    
				$i++;
			}
			$stmt->free_result();
		 
			return $rtn;
       
       }           
       //ポイントはB2BとB2c共通しているので、下記の関数をそのままでいいです。
       function getFrontCoupon($id,$areaid,$caldate,$period){
    
       		$updatedate=date('Y-m-d');

			
			$sql= "select c.*,b.*,ca.* from coupons as c left join copnb2cmoney b on c.couponid= b.coupon_id left join b2cmoneycal as ca on b.copnb2cmid=ca.f_key where c.coupondeleter=0 and c.couponid= ? and ca.calmonth = ?  order by couponcreatetime desc";
			$stmt = $this->link->prepare($sql);
			$tmp="$id";
			$stmt->bind_param("is", $id,$caldate);


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname_jp']			=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']			=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']			=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']			=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']			=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];

			    $rtn[$i]['copnb2cmid']		=$row['copnb2cmid'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']		=$row['copncreate'];
			    $rtn[$i]['copnb2cmname_jp']	=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']	=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']	=$row['copnb2cmname_us'];
			    $rtn[$i]['copnb2cmname_cn']	=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']	=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']	=$row['copnb2cmname_kr'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];

				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

       }  
       function getB2bFrontCoupon($id,$areaid,$caldate,$period){
    
       		$updatedate=date('Y-m-d');

			
			$sql= "select c.*,b.*,ca.* from coupons as c left join copnb2bmoney b on c.couponid= b.coupon_id left join b2bmoneycal as ca on b.copnb2bmid=ca.f_key where c.coupondeleter=0 and c.couponid= ?  and ca.calmonth = ? order by couponcreatetime desc";
			$stmt = $this->link->prepare($sql);
			$tmp="$id,$caldate";

		
			$stmt->bind_param("is", $id,$caldate);
			


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['couponid']			=$row['couponid'];
			    $rtn[$i]['couponcd']			=$row['couponcd'];
			    $rtn[$i]['couponname_jp']			=$row['couponname_jp'];
			    $rtn[$i]['couponname_en']			=$row['couponname_en'];
			    $rtn[$i]['couponname_cn']			=$row['couponname_cn'];
			    $rtn[$i]['couponname_tw']			=$row['couponname_tw'];
			    $rtn[$i]['couponname_kr']			=$row['couponname_kr'];
			    
			    $rtn[$i]['couponadultpoint']	=$row['couponadultpoint'];
			    $rtn[$i]['ouponchildpoint']		=$row['ouponchildpoint'];
			    $rtn[$i]['couponstart']			=$row['couponstart'];
			    $rtn[$i]['couponend']			=$row['couponend'];
			    $rtn[$i]['couponinterval']		=$row['couponinterval'];
			    $rtn[$i]['couponheldcompany_jp']	=$row['couponheldcompany_jp'];			
			    $rtn[$i]['couponheldcompany_en']	=$row['couponheldcompany_en'];			
			    $rtn[$i]['couponheldcompany_cn']	=$row['couponheldcompany_cn'];			
			    $rtn[$i]['couponheldcompany_tw']	=$row['couponheldcompany_tw'];			
			    $rtn[$i]['couponheldcompany_kr']	=$row['couponheldcompany_kr'];			
			        
			    $rtn[$i]['couponpic']			=$row['couponpic'];
			    $rtn[$i]['couponadultb2cprice']	=$row['couponadultb2cprice'];
			    $rtn[$i]['couponchildb2cprice']	=$row['couponchildb2cprice'];
			    $rtn[$i]['couponadultb2bprice']	=$row['couponadultb2bprice'];
			    $rtn[$i]['couponchildb2bprice']	=$row['couponchildb2bprice'];
			    $rtn[$i]['couponcomment_jp']		=$row['couponcomment_jp'];
			    $rtn[$i]['couponcomment_en']		=$row['couponcomment_en'];
			    $rtn[$i]['couponcomment_cn']		=$row['couponcomment_cn'];
			    $rtn[$i]['couponcomment_tw']		=$row['couponcomment_tw'];
			    $rtn[$i]['couponcomment_kr']		=$row['couponcomment_kr'];
			    
			    $rtn[$i]['coupondeleter']		=$row['coupondeleter'];
			    $rtn[$i]['couponupdater']		=$row['couponupdater'];
			    $rtn[$i]['couponupdate']		=$row['couponupdate'];
			    $rtn[$i]['couponcreater']		=$row['couponcreater'];
			    $rtn[$i]['couponcreatetime']	=$row['couponcreatetime'];

			    $rtn[$i]['copnb2bmid']		=$row['copnb2bmid'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']		=$row['copncreate'];
			    $rtn[$i]['copnb2bmname_jp']	=$row['copnb2bmname_jp'];
			    $rtn[$i]['copnb2bmname_en']	=$row['copnb2bmname_en'];
			    $rtn[$i]['copnb2bmname_cn']	=$row['copnb2bmname_cn'];
			    $rtn[$i]['copnb2bmname_tw']	=$row['copnb2bmname_tw'];
			    $rtn[$i]['copnb2bmname_kr']	=$row['copnb2bmname_kr'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];

				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

       }         
       function getPlaymoneyByPlay_id($play_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from playmoney where play_id = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $play_id);
			$tmp="$play_id";
			$stmt->execute();
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['play_id']			=$row['play_id'];
			    $rtn[$i]['playmoneytype_jp']	=$row['playmoneytype_jp'];
			    $rtn[$i]['playmoneytype_en']	=$row['playmoneytype_en'];
			    $rtn[$i]['playmoneytype_us']	=$row['playmoneytype_us'];
			    $rtn[$i]['playmoneytype_cn']	=$row['playmoneytype_cn'];
			    $rtn[$i]['playmoneytype_tw']	=$row['playmoneytype_tw'];
			    $rtn[$i]['playmoneytype_kr']	=$row['playmoneytype_kr'];
			    
			    $rtn[$i]['playmoneyid']		=$row['playmoneyid'];
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

       }  
       
       function getPlaymoneyPlaymoneycalByPlay_idF_key($play_id,$todayadte,$tomorrowdate=""){
    
       		$updatedate=date('Y-m-d');

			if($tomorrowdate==""){
				$sql = "select * from playmoney as p left join playmoneycal as pc on p.playmoneyid=pc.f_key where p.play_id = ? and pc.calmonth = ? ";
				$tmp="$play_id,$todayadte";
				
					
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("is", $play_id,$todayadte);
							
			}else{
			
				$sql = "select * from playmoney as p left join playmoneycal as pc on p.playmoneyid=pc.f_key where p.play_id = ? and ( pc.calmonth = ? or pc.calmonth = ?)";
				$tmp="$play_id,$todayadte,$tomorrowdate";
					
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("iss",$play_id,$todayadte,$tomorrowdate);
			}

			
			$stmt->execute();
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['play_id']				=$row['play_id'];
			    $rtn[$i]['playmoneytype_jp']	=$row['playmoneytype_jp'];
			    $rtn[$i]['playmoneytype_en']	=$row['playmoneytype_en'];
			    $rtn[$i]['playmoneytype_cn']	=$row['playmoneytype_cn'];
			    $rtn[$i]['playmoneytype_tw']	=$row['playmoneytype_tw'];
			    $rtn[$i]['playmoneytype_kr']	=$row['playmoneytype_kr'];
			    $rtn[$i]['playmoneyid']			=$row['playmoneyid'];
			    
			    $rtn[$i]['calid']				=$row['calid'];
			    $rtn[$i]['f_key']				=$row['f_key'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['calname']				=$row['calname'];
			    $rtn[$i]['calmonth']			=$row['calmonth'];
			    $rtn[$i]['calval']				=$row['calval'];
			    $rtn[$i]['calcost']				=$row['calcost'];
			    $rtn[$i]['calsex']				=$row['calsex'];
			    $rtn[$i]['calcreatedate']		=$row['calcreatedate'];
			    
			    $tmpdays[]=$row['calmonth'];
			    
				$i++;
			}
			$finalrtn['opendays']= $tmpdays;
			$finalrtn['detail']= $rtn;
		  $stmt->free_result();
		 
		  return $finalrtn;

       }        
       
       
       function getPlaymoneyTypesByPlay_idF_key($play_id,$todayadte,$tomorrowdate=""){
    
       		$updatedate=date('Y-m-d');

			if($tomorrowdate==""){
				$sql = "select * from playmoney as p left join playmoneycal as pc on p.playmoneyid=pc.f_key where p.play_id = ? and pc.calmonth = ? ";
				$tmp="$play_id,$todayadte";
					
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("is", $play_id,$todayadte);
							
			}else{
			
				$sql = "select * from playmoney as p left join playmoneycal as pc on p.playmoneyid=pc.f_key where p.play_id = ? and ( pc.calmonth = ? or pc.calmonth = ?)";
				$tmp="$play_id,$todayadte,$tomorrowdate";

					
				$stmt = $this->link->prepare($sql);
				$stmt->bind_param("iss",$play_id,$todayadte,$tomorrowdate);
			}

			
			$stmt->execute();
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]	=$row['playmoneytype_en'];
			    
				$i++;
			}

		 
		  return $rtn;

       }        

       
       function getCopnpointByCoupon_id($coupon_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnpoint where coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }      

       function getCouponTypesByCoupon_id($coupon_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnpoint where coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]	=$row['copntypename_en'];
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }    
              
       function getCopnpointPointcalByCoupon_idCalmonth($coupon_id,$calmonth){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnpoint as c right join pointcal as p on c.copnpointid=p.f_key left join copnb2cmoney as b on b.copnpoint_id =c.copnpointid where c.coupon_id = ? and p.calmonth= ? ";
			$tmp="$coupon_id,$calmonth";


		
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("is", $coupon_id,$calmonth);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];

			    $rtn[$i]['calid_point']			=$row['calid'];
			    $rtn[$i]['f_key_point']			=$row['f_key'];
			    $rtn[$i]['coupon_id_point']			=$row['coupon_id'];
			    $rtn[$i]['calname_point']			=$row['calname'];
			    $rtn[$i]['calmonth_point']			=$row['calmonth'];
			    $rtn[$i]['calval_point']			=$row['calval'];
			    $rtn[$i]['calcost_point']			=$row['calcost'];
			    $rtn[$i]['calsex_point']			=$row['calsex'];

			    $rtn[$i]['copnb2cmid']			=$row['copnb2cmid'];
			    $rtn[$i]['copnb2cmname_jp']			=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']			=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']			=$row['copnb2cmname_us'];
			    $rtn[$i]['copnb2cmname_cn']			=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']			=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']			=$row['copnb2cmname_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']			=$row['copnpoint_id'];
			  
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }      
       
       function getCopnpointPointcalByCoupon_idCalmonthB2b($coupon_id,$calmonth){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnpoint as c right join pointcal as p on c.copnpointid=p.f_key left join copnb2bmoney as b on b.copnpoint_id =c.copnpointid where c.coupon_id = ? and p.calmonth= ? ";
			$tmp="$coupon_id,$calmonth";

		
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("is", $coupon_id,$calmonth);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];

			    $rtn[$i]['calid_point']			=$row['calid'];//pointcalのID
			    $rtn[$i]['f_key_point']			=$row['f_key'];
			    $rtn[$i]['coupon_id_point']		=$row['coupon_id'];
			    $rtn[$i]['calname_point']		=$row['calname'];
			    $rtn[$i]['calmonth_point']		=$row['calmonth'];
			    $rtn[$i]['calval_point']		=$row['calval'];//ポイント
			    $rtn[$i]['calcost_point']		=$row['calcost'];//原価
			    $rtn[$i]['calsex_point']		=$row['calsex'];

			    $rtn[$i]['copnb2bmid']			=$row['copnb2bmid'];
			    $rtn[$i]['copnb2bmname_jp']		=$row['copnb2bmname_jp'];
			    $rtn[$i]['copnb2bmname_en']		=$row['copnb2bmname_en'];
			    $rtn[$i]['copnb2bmname_us']		=$row['copnb2bmname_us']; 
			    $rtn[$i]['copnb2bmname_cn']		=$row['copnb2bmname_cn'];
			    $rtn[$i]['copnb2bmname_tw']		=$row['copnb2bmname_tw'];
			    $rtn[$i]['copnb2bmname_kr']		=$row['copnb2bmname_kr'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			  
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }             
       function getActivitypointByActivitydetail_id($activitydetail_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from activitypoint where activitydetail_id = ? ";
			$tmp="$activitydetail_id";

		
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $activitydetail_id);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_us']		=$row['activitypointname_us'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }   
       function getActivitypointByActivitypointid($activitypointid){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from activitypoint where activitypointid = ? ";
			$tmp="$activitypointid";
			
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $activitypointid);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }    
       function getActivitypointActivitystockcalByActivitypointidAtstockcalmonth($activitypointid,$atstockcalmonth){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from activitypoint as a left join activitystockcal as ac on a.activitypointid= ac.activitypoint_id  where a.activitypointid = ? and ac.atstockcalmonth = ? ";
			$tmp="$activitypointid,$atstockcalmonth";

			
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("is", $activitypointid,$atstockcalmonth);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_us']		=$row['activitypointname_us'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    $rtn[$i]['activitypointcreate']			=$row['activitypointcreate'];			    
			    $rtn[$i]['atstockcalid']			=$row['atstockcalid'];
			    $rtn[$i]['activitypoint_id']			=$row['activitypoint_id'];
			    $rtn[$i]['atstockcalname']			=$row['atstockcalname'];
			    $rtn[$i]['atstockcalyear']			=$row['atstockcalyear'];
			    $rtn[$i]['atstockcalmonth']			=$row['atstockcalmonth'];
			    $rtn[$i]['atstockcalcost']			=$row['atstockcalcost'];
			    $rtn[$i]['atstockcalval']			=$row['atstockcalval'];
			    $rtn[$i]['atstockcalsex']			=$row['atstockcalsex'];


			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();


		 
		  return $rtn;

       }             
       function getPointcal($f_key,$coupon_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from pointcal  where f_key  = ? and coupon_id = ?  ORDER BY `calmonth` ASC";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$f_key,$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function getPointcalByCoupon_idCalmonth($coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from pointcal  where coupon_id  = ? and calmonth = ?";
       		$tmp="$coupon_id,$calmonth";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
				
       function getPointcalByF_keyCalmonth($f_key,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from pointcal  where f_key  = ? and calmonth = ?";
       		$tmp="$f_key,$calmonth";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$f_key,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getPointcalByCalid($calid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from pointcal  where calid  = ?";
       		$tmp="$calid";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getPlaymoneycalByF_keyCalmonth($f_key,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from playmoneycal  where f_key  = ? and calmonth = ?";
       		$tmp="$f_key,$calmonth";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$f_key,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getActivitystockcal($activitypoint_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from activitystockcal  where  activitypoint_id = ? ORDER BY `atstockcalmonth` ASC";
       		$tmp="$activitypoint_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitypoint_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['atstockcalid']			=$row['atstockcalid'];
			    $rtn[$i]['activitypoint_id']		=$row['activitypoint_id'];
			    $rtn[$i]['atstockcalname']			=$row['atstockcalname'];
			    $rtn[$i]['atstockcalyear']			=$row['atstockcalyear'];
			    $rtn[$i]['atstockcalmonth']			=$row['atstockcalmonth'];
			    $rtn[$i]['atstockcalcost']			=$row['atstockcalcost'];
			    $rtn[$i]['atstockcalval']			=$row['atstockcalval'];
			    $rtn[$i]['atstockcalsex']			=$row['atstockcalsex'];
			    $rtn[$i]['calcreatedate']			=$row['calcreatedate'];

				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function getActivitystockcal2prm($activitypoint_id,$atstockcalmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from activitystockcal  where  activitypoint_id = ? and atstockcalmonth = ?";
       		$tmp="$activitypoint_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$activitypoint_id,$atstockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['atstockcalid']			=$row['atstockcalid'];
			    $rtn[$i]['activitypoint_id']		=$row['activitypoint_id'];
			    $rtn[$i]['atstockcalname']			=$row['atstockcalname'];
			    $rtn[$i]['atstockcalyear']			=$row['atstockcalyear'];
			    $rtn[$i]['atstockcalmonth']			=$row['atstockcalmonth'];
			    $rtn[$i]['atstockcalcost']			=$row['atstockcalcost'];
			    $rtn[$i]['atstockcalval']			=$row['atstockcalval'];
			    $rtn[$i]['atstockcalsex']			=$row['atstockcalsex'];
			    $rtn[$i]['calcreatedate']			=$row['calcreatedate'];

				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getBatchPlanstockcalByActivitydetail_idStockcalmonth($activitydetail_id,$stockcalmonth){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from planstockcal  where  activitydetail_id = ? and stockcalmonth = ? ";
       		$tmp="$activitydetail_id,$stockcalmonth";
			$stmt =$this->link->prepare($sql);

			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];
			    $rtn[$i]['stockisstop']			=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];


				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function getPlanstockcalByActivitydetail_idStockcalmonth($activitydetail_id,$stockcalmonth){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from planstockcal  where  activitydetail_id = ? and stockcalmonth = ? and stockisstop=0";
       		$tmp="$activitydetail_id,$stockcalmonth";
			$stmt =$this->link->prepare($sql);

			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];
			    $rtn[$i]['stockisstop']			=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];


				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function getStockcalByActivitydetail_idStockcalmonth($activitydetail_id,$stockcalmonth){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from stockcal  where  activitydetail_id = ? and stockcalmonth = ?  and stockisstop=0";
       		$tmp="$activitydetail_id,$stockcalmonth";
			$stmt =$this->link->prepare($sql);

			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];
			    $rtn[$i]['stockisstop']			=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];


				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function getBatchStockcalByActivitydetail_idStockcalmonth($activitydetail_id,$stockcalmonth){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from stockcal  where  activitydetail_id = ? and stockcalmonth = ?  ";
       		$tmp="$activitydetail_id,$stockcalmonth";
			$stmt =$this->link->prepare($sql);

			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];
			    $rtn[$i]['stockisstop']			=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];


				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}			
       function getActivitystockcalByActivitypoint_idAtstockcalmonth($activitypoint_id,$atstockcalmonth,$tomorrowdate=""){
			$sellerupdatedate=date('Y-m-d');
			if($tomorrowdate==""){
	       		$sql = "select * from activitystockcal as a left join activitypoint as ap on a.activitypoint_id=ap.activitypointid  where  a.activitypoint_id = ? and a.atstockcalmonth = ?";
	       		$tmp="$activitypoint_id,$atstockcalmonth";
    		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('is',$activitypoint_id,$atstockcalmonth);
				}
			       		
			}else{
	       		$sql = "select * from activitystockcal  where  activitypoint_id = ? and ( atstockcalmonth = ? or atstockcalmonth = ?)";
	       		$tmp="$activitypoint_id,$atstockcalmonth,$tomorrowdate";
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('iss',$activitypoint_id,$atstockcalmonth,$tomorrowdate);	
				}
			}

			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['atstockcalid']			=$row['atstockcalid'];
			    $rtn[$i]['activitypoint_id']		=$row['activitypoint_id'];
			    $rtn[$i]['atstockcalname']			=$row['atstockcalname'];
			    $rtn[$i]['atstockcalyear']			=$row['atstockcalyear'];
			    $rtn[$i]['atstockcalmonth']			=$row['atstockcalmonth'];
			    $rtn[$i]['atstockcalcost']			=$row['atstockcalcost'];
			    $rtn[$i]['atstockcalval']			=$row['atstockcalval'];
			    $rtn[$i]['atstockcalsex']			=$row['atstockcalsex'];
			    $rtn[$i]['calcreatedate']			=$row['calcreatedate'];

			    $rtn[$i]['activitypointname_jp']	=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_en']	=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_us']	=$row['activitypointname_us'];
			    $rtn[$i]['activitypointname_cn']	=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']	=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']	=$row['activitypointname_kr'];
			    $rtn[$i]['activitydetail_id']		=$row['activitydetail_id'];

				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function getActivityTypesByActivitypoint_idAtstockcalmonth($activitypoint_id,$atstockcalmonth,$tomorrowdate=""){
			$sellerupdatedate=date('Y-m-d');
			if($tomorrowdate==""){
	       		$sql = "select * from activitystockcal as a left join activitypoint as ap on a.activitypoint_id=ap.activitypointid  where  a.activitypoint_id = ? and a.atstockcalmonth = ?";
	       		$tmp="$activitypoint_id,$atstockcalmonth";
    		
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('is',$activitypoint_id,$atstockcalmonth);
				}
			       		
			}else{
	       		$sql = "select * from activitystockcal  where  activitypoint_id = ? and ( atstockcalmonth = ? or atstockcalmonth = ?)";
	       		$tmp="$activitypoint_id,$atstockcalmonth,$tomorrowdate";
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('iss',$activitypoint_id,$atstockcalmonth,$tomorrowdate);	
				}
			}

			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]	=$row['activitypointname_en'];


				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
				
       function getActivitystockcall($activitydetail_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from activitystockcal  where  activitydetail_id = ?";
       		$tmp="$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['atstockcalid']			=$row['atstockcalid'];
			    $rtn[$i]['activitydetail_id']		=$row['activitydetail_id'];
			    $rtn[$i]['atstockcalname']			=$row['atstockcalname'];
			    $rtn[$i]['atstockcalyear']			=$row['atstockcalyear'];
			    $rtn[$i]['atstockcalmonth']			=$row['atstockcalmonth'];
			    $rtn[$i]['atstockcalcost']			=$row['atstockcalcost'];
			    $rtn[$i]['atstockcalval']			=$row['atstockcalval'];
			    $rtn[$i]['atstockcalsex']			=$row['atstockcalsex'];
			    $rtn[$i]['calcreatedate']			=$row['calcreatedate'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
		
       function getStockcall($activitydetail_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from stockcal  where  activitydetail_id = ?  ORDER BY `stockcalmonth` ASC";
       		$tmp="$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['stockcalid']				=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']		=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']			=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']				=$row['stockcalval'];
			    $rtn[$i]['stockisstop']				=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']		=$row['stockcalcreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}			
		
       function getPlanstockcall($activitydetail_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from planstockcal  where  activitydetail_id = ? ORDER BY `stockcalmonth` ASC";
       		$tmp="$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['stockcalid']				=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']		=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']			=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']				=$row['stockcalval'];
			    $rtn[$i]['stockisstop']				=$row['stockisstop'];
			    
			    $rtn[$i]['stockcalcreatetime']		=$row['stockcalcreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
       function getB2cmoneycal($f_key,$coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2cmoneycal  where f_key  = ? and coupon_id = ? and calmonth = ?";
       		$tmp="$f_key,$coupon_id,$calmonth";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$f_key,$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];//b2cmoneycalのID
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];//金額
			    $rtn[$i]['calcost']			=$row['calcost'];//原価
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getB2cmoneycals($f_key,$coupon_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2cmoneycal  where f_key  = ? and coupon_id = ? ORDER BY `calmonth` ASC";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$f_key,$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];//b2cmoneycalのID
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];//金額
			    $rtn[$i]['calcost']			=$row['calcost'];//原価
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
       function getB2cmoneycalByCalid($calid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2cmoneycal  where calid  = ? ";
       		$tmp="$calid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}	
		
       function getB2bmoneycalByCalid($calid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2bmoneycal  where calid  = ? ";
       		$tmp="$calid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}	
							
       function getB2cmoneycalByCoupon_idCalmonth($coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2cmoneycal  where coupon_id  = ? and calmonth = ?";
       		$tmp="$coupon_id,$calmonth";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}			
       function getPlaymoney($f_key,$coupon_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from playmoneycal  where f_key  = ? and coupon_id = ? ORDER BY `calmonth` ASC";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$f_key,$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function getPlaymoney3prm($f_key,$coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from playmoneycal  where f_key  = ? and coupon_id = ? and calmonth = ?";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$f_key,$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function getPlaymoneyPlaymoneycalByPlay_idCalmonth($play_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from playmoney as p left join playmoneycal as pc on pc.f_key= p.playmoneyid  where p.play_id  = ? and pc.coupon_id= ? and pc.calmonth = ? ";
       		$tmp="$play_id,$play_id,$calmonth";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$play_id,$play_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['playmoneyid']			=$row['playmoneyid'];
			    $rtn[$i]['playmoneytype_jp']			=$row['playmoneytype_jp'];
			    $rtn[$i]['playmoneytype_en']		=$row['playmoneytype_en'];
			    $rtn[$i]['playmoneytype_us']		=$row['playmoneytype_us'];
			    $rtn[$i]['playmoneytype_cn']			=$row['playmoneytype_cn'];
			    $rtn[$i]['playmoneytype_tw']			=$row['playmoneytype_tw'];
			    $rtn[$i]['playmoneytype_kr']		=$row['playmoneytype_kr'];
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['calname']	=$row['calname'];
			    $rtn[$i]['calmonth']	=$row['calmonth'];
			    $rtn[$i]['calval']	=$row['calval'];
			    $rtn[$i]['calcost']	=$row['calcost'];
			    $rtn[$i]['calsex']	=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function getB2bmoneycal($f_key,$coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2bmoneycal  where f_key  = ? and coupon_id = ? and calmonth = ? ";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$f_key,$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
		
       function getB2bmoneycals($f_key,$coupon_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from b2bmoneycal  where f_key  = ? and coupon_id = ?  ORDER BY `calmonth` ASC ";
       		$tmp="$f_key,$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$f_key,$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];
			    $rtn[$i]['calyear']			=$row['calyear'];
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}		
	   function searchReservefreedelegateisusedReservefreedelegate($datefrom,$dateto,$companyid,$searchkey,$start_from, $num_rec_per_page,$areaid){
		
			$daybetween ="";
			$searchstr="";
			
			if(($datefrom<>"")&&($dateto<>"")){
				
				$daybetween=" and ? <= tt.rsvcreatedatetime and  tt.rsvcreatedatetime <= ? ";
			}
			if($searchkey<>''){
				
				$searchstr=	" and CONCAT_WS(tt.rsvcd,tt.rsvstartdate,tt.rsvbuyid,tt.rsvserialnum,tt.rsvcompanycd,tt.rsvplayname,tt.rsvareafathername,tt.rsvareaname,tt.tel,tt.mail,tt.usetime,tt.delegatefist,tt.delegatelast) LIKE CONCAT('%',?,'%')  ";
			
			}
					

			$sellerupdatedate=date('Y-m-d');

       		$sql = "
				
    			select * from (
	       			select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvb2bflg=0
					
					UNION ALL
					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvb2bflg=1
					
				 ) as tt  where tt.rsvcompanyid=? and  tt.rsvareafather_id=?
				 
				   $daybetween
				   $searchstr
				   
				 	ORDER BY tt.`usetime` DESC 

					";


			if($searchkey<>''){

				$tmp="$companyid,$areaid,$datefrom,$dateto,$searchkey";
			}else{
			
				$tmp="$companyid,$areaid,$datefrom,$dateto";	
			
			}

			$stmt =$this->link->prepare($sql);
			if($stmt){

				
				if($searchkey<>''){
				
					$stmt->bind_param('iisss',$companyid,$areaid,$datefrom,$dateto,$searchkey);
				}else{
							
					$stmt->bind_param('iiss',$companyid,$areaid,$datefrom,$dateto);
				}
							

				
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {


			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']						=$row['usetime'];
			    $rtn[$i]['usertype']					=$row['usertype'];




			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];

			     
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }		
	   		
	   function searchReservefreedelegateisusedReservefreedelegateAll($datefrom,$dateto,$searchkey,$start_from, $num_rec_per_page,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
			$daybetween ="";
			$searchstr="";
			$paramtypes="i";
			$params=$areaid;

			if(($datefrom<>"")&&($dateto<>"")){

				
				$daybetween=" and ? <= tt.rsvcreatedatetime and  tt.rsvcreatedatetime <= ? ";
				$paramtypes=$paramtypes."ss";
				$params=$params.","."$datefrom,$dateto";
			}
			if($searchkey<>''){
				
				$searchstr=	" and CONCAT_WS(tt.rsvcd,tt.rsvstartdate,tt.rsvbuyid,tt.rsvserialnum,tt.rsvcompanycd,tt.rsvplayname,tt.rsvareafathername,tt.rsvareaname,tt.tel,tt.mail,tt.usetime,tt.delegatefist,tt.delegatefist,delegatelast) LIKE CONCAT('%',?,'%') ";
				$paramtypes=$paramtypes."s";
				$params=$params.","."$searchkey";
			}
			
       		
       		$sql = "	
    			select * from (       		
					select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select rf.*,un.* from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age ,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd    ,rsvlivearea_name     as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex ,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'follower' as usertype  FROM reservefreefollowers
						)as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid  where  refr.rsvb2bflg=0
				
					UNION ALL
				
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select  rf.*,un.* from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers
						)as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where  refr.rsvb2bflg=1
				 ) as tt  where  tt.rsvareafather_id=?
				 $daybetween
				 $searchstr
				 
				 ORDER BY tt.`usetime` DESC 
			";
			
			
			if($searchkey<>''){

				$tmp="$areaid,$datefrom,$dateto,$searchkey";
	
			}else{
			
				$tmp="$areaid,$datefrom,$dateto";	
			
			}



			$stmt =$this->link->prepare($sql);
			if($stmt){
				
				if($searchkey<>''){
				   // $paramtypes="isss";
					$stmt->bind_param('ii',$paramtypes,$areaid,$datefrom,$dateto,$searchkey);
				}else{
					// $paramtypes="iss";
					 		
					$stmt->bind_param('ii',$paramtypes,$areaid,$datefrom,$dateto);
				}
				
				
			}

			
			$stmt->execute();
			$result = $stmt->get_result();
			

			$num_of_rows = $result->num_rows;
			
			
			
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']					=$row['usetime'];


			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['usertype']					=$row['usertype'];
			    
			    
			    
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }	
	   function searchReserveDataCnt($companyid,$searchkey,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
       		$sql = "
      			
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt
       				
       				where  tt.rsvcompanyid = ? and  CONCAT_WS(
       								tt.`rsvcd`,
       								tt.`rsvcreatedatetime`,
       								tt.`rsvstartdate`,
       								tt.`rsvactivitydetailcrs`,
       								tt.`rsvactivitymainpln`,
       								tt.`delegatefist`,
       								tt.`delegatelast`,
       								tt.`companyname_jp`,
       								tt.`activityname_jp`,
       								tt.`rsvdelegatetel`,tt.`areaname_jp`
       							) 
      						LIKE CONCAT('%',?,'%') 
       				 ORDER BY tt.rsvcreatedatetime DESC  
       				
       		";
       		
       		$tmp="$searchkey,$companyid,$areaid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiis',$areaid,$areaid,$companyid,$searchkey);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}  
	   
	   function searchReserveData($companyid,$searchkey,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reserve as r  left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id left join company as c  on r.rsvcompanyid=c.companyid left join activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join activitymain as am on am.activitymainid= r.rsvactivitymainid left join activitytype as att on att.activitytypeid=am.activitytype_id   where CONCAT_WS(`rsvcd`,`rsvcreatedatetime`,`rsvstartdate`,`rsvactivitydetailcrs`,`rsvactivitymainpln`,`delegatefist`,`delegatelast`,`companyname_jp`,`activityname_jp`,`rsvdelegatetel`) LIKE CONCAT('%',?,'%')  and r.rsvcompanyid= ?  limit ?,?";

      		$sql = "
      			
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt
       				
       				where tt.rsvcompanyid = ? and CONCAT_WS(
       								tt.`rsvcd`,
       								tt.`rsvcreatedatetime`,
       								tt.`rsvstartdate`,
       								tt.`rsvactivitydetailcrs`,
       								tt.`rsvactivitymainpln`,
       								tt.`delegatefist`,
       								tt.`rsvserialnum`,
       								tt.`delegatelast`,
       								tt.`companyname_jp`,
       								tt.`activityname_jp`,
       								tt.`rsvdelegatetel`,tt.`areaname_jp`
       							) 
      						LIKE CONCAT('%',?,'%') 
       				 ORDER BY tt.rsvcreatedatetime DESC
       				

      			
      			";
       		

       		$tmp="$areaid,$areaid,$companyid,$searchkey,$start_from, $num_rec_per_page";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiis',$areaid,$areaid,$companyid,$searchkey);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];			    
			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   
	   function searchReserveDataAllcnt($searchkey,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
       		$sql = "
       		
      			
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt
       				
       				where  CONCAT_WS(
       								tt.`rsvcd`,
       								tt.`rsvcreatedatetime`,
       								tt.`rsvstartdate`,
       								tt.`rsvactivitydetailcrs`,
       								tt.`rsvactivitymainpln`,
       								tt.`delegatefist`,
       								tt.`delegatelast`,
       								tt.`companyname_jp`,
       								tt.`activityname_jp`,
       								tt.`rsvdelegatetel`,tt.`areaname_jp`
       							) 
      						LIKE CONCAT('%',?,'%') 
       				 ORDER BY tt.rsvcreatedatetime DESC  
       				

       		
       		";
       		$tmp="$areaid,$searchkey";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$areaid,$areaid,$searchkey);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   }
	   	   
	   function searchReserveDataAll($searchkey,$areaid){

   		
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reserve as r  left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id left join company as c  on r.rsvcompanyid=c.companyid left join activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join activitymain as am on am.activitymainid= r.rsvactivitymainid left join activitytype as att on att.activitytypeid=am.activitytype_id   where CONCAT_WS(`rsvcd`,`rsvcreatedatetime`,`rsvstartdate`,`rsvactivitydetailcrs`,`rsvactivitymainpln`,`delegatefist`,`delegatelast`,`companyname_jp`,`activityname_jp`,`rsvdelegatetel`,`rsvareaname`) LIKE CONCAT('%',?,'%')  limit ?,?  order by r.rsvcreatedatetime desc";
      		$sql = "
      			
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt
       				
       				where  CONCAT_WS(
       								tt.`rsvcd`,
       								tt.`rsvcreatedatetime`,
       								tt.`rsvstartdate`,
       								tt.`rsvactivitydetailcrs`,
       								tt.`rsvactivitymainpln`,
       								tt.`delegatefist`,
       								tt.`rsvserialnum`,
       								tt.`delegatelast`,
       								tt.`companyname_jp`,
       								tt.`activityname_jp`,
       								tt.`rsvdelegatetel`,tt.`areaname_jp`
       							) 
      						LIKE CONCAT('%',?,'%') 
       				 ORDER BY tt.rsvcreatedatetime DESC
       				

      			
      			";
       		
       		$tmp="$areaid,$areaid,$searchkey,$start_from, $num_rec_per_page";



			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$areaid,$areaid,$searchkey);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


			    $rtn[$i]['replyquestion']						=$row['replyquestion'];
			    
				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    $rtn[$i]['rsvb2bflg']					=$row['rsvb2bflg'];
			    
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   function getReserveDataAll($start_from, $num_rec_per_page,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
       		$sql = "
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt ORDER BY tt.rsvcreatedatetime DESC limit ?,? 
       				
       				";
  
       		$tmp="$areaid,$areaid,$start_from, $num_rec_per_page";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiii',$areaid,$areaid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['urlareaid']						=$row['urlareaid'];
			    
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    
			    
			    			    			    
				$i++;
			}
		
		  $stmt->free_result();
  
		  
		  return $rtn;
	   		
	   }

	   function getReserveDataCntAll($areaid){
			$sellerupdatedate=date('Y-m-d');
       	//	$sql = "select * from reserve as r  left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id left join company as c  on r.rsvcompanyid=c.companyid left join activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join activitymain as am on am.activitymainid= r.rsvactivitymainid left join activitytype as att on att.activitytypeid=am.activitytype_id  ";
       		$sql = "
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt ORDER BY tt.rsvcreatedatetime DESC 
       				
       				";
       	
       		$tmp="$areaid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$areaid,$areaid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']=$row['rsvid'];			
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;			    	   
	   }
	   	   	   
	   function getReserveDataCnt($companyid,$areaid){
	 
			$sellerupdatedate=date('Y-m-d');
       		 $sql = "
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt where  tt.rsvcompanyid= ? ORDER BY tt.rsvcreatedatetime DESC 
       		 		
       		 ";
       		$tmp="$areaid,$areaid,$companyid";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iii',$areaid,$areaid,$companyid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];			
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;			    	   
	   }
	   function getReserveData($companyid,$start_from, $num_rec_per_page,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
      		 $sql = "
       				select * from (
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.affiliatecd,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buying as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=0
       				
       					union all
       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join 
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1
	       				       				
       				
       				) as tt where   tt.rsvcompanyid= ? ORDER BY tt.rsvcreatedatetime DESC limit ?,? 
      		 		
      		 		";
       		
       		$tmp="$areaid,$areaid,$companyid,$start_from, $num_rec_per_page";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiiii',$areaid,$areaid,$companyid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {


			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['urlareaid']					=$row['urlareaid'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];
			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   	   
	   function b2bgetReserveData($sellerid,$companyid,$start_from, $num_rec_per_page,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
      		 $sql = "
       				select * from (

       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.frmsellerid,
	       					b.frmcompanyid,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse,
	       					at.company_id
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join  
	       					agents at  on b.coupon_id= at.coupon_id  left join  
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1 and b.frmcompanyid =? and b.frmsellerid = ?
	       				       				
       				
       				) as tt where   tt.company_id= ? ORDER BY tt.rsvcreatedatetime DESC limit ?,? 
      		 		
      		 		";
       		
       		$tmp="$areaid,$companyid,$start_from, $num_rec_per_page";



			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiiiii',$areaid,$companyid,$sellerid,$companyid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {


			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['urlareaid']					=$row['urlareaid'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];
			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }


	   	   
	   function b2bSearchGetReserveData($keyword,$companyid,$sellerid,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
      		 $sql = "
       				select * from (

       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.frmcompanyid,
	       					b.frmsellerid,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse,
	       					at.company_id
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join  
	       					agents at  on b.coupon_id= at.coupon_id  left join  
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1 and b.frmcompanyid = ? and b.frmsellerid = ? 
	       				       				
       				
       				) as tt where   tt.company_id= ? and
       				
       				  CONCAT_WS(
       								tt.`rsvcd`,
       								tt.`rsvcreatedatetime`,
       								tt.`rsvstartdate`,
       								tt.`rsvactivitydetailcrs`,
       								tt.`rsvactivitymainpln`,
       								tt.`delegatefist`,
       								tt.`rsvserialnum`,
       								tt.`delegatelast`,
       								tt.`companyname_jp`,
       								tt.`activityname_jp`,
       								tt.`rsvdelegatetel`,tt.`areaname_jp`
       							) 
      						LIKE CONCAT('%',?,'%') 
       				
       				ORDER BY tt.rsvcreatedatetime DESC 
      		 		
      		 		";
       		
       		$tmp="$areaid,$companyid,$keyword";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiiis',$areaid,$companyid,$sellerid,$companyid,$keyword);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {


			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['urlareaid']					=$row['urlareaid'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];
			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   	   
	   function b2bgetReserveDataAll($companyid,$sellerid,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
      		 $sql = "
       				select * from (

       				
	       				select  
	       					r.rsvid,
	       					r.rsvcd,
	       					r.agt_id,
	       					r.rsvlang,
	       					r.urlareaid,
	       					r.urllang,
	       					r.rsvstartdate,
	       					r.rsvbuyid,
	       					r.rsvserialnum,
	       					r.rsvcouponid,
	       					r.rsvcouponcd,
	       					r.rsvcouponname,
	       					r.rsvcompanyid,
	       					r.rsvcompanycd,
	       					r.rsvactivitymainid,
	       					r.rsvactivitymainplncd,
	       					r.rsvactivitymainpln,
	       					r.rsvactivitydetailid,
	       					r.rsvactivitydetailseqcd,
	       					r.rsvactivitydetailcrscd,
	       					r.rsvactivitydetailcrs,
	       					r.rsvdelegatefist,
	       					r.rsvdelegatelast,
	       					r.rsvdelegatesex,
	       					r.rsvdelegateage,
	       					r.rsvdelegatetel,
	       					r.sectionname1,
	       					r.sectionname2,
	       					r.sectionname3,
	       					r.sectionname4,
	       					r.sectionname5,
	       					r.sectionname6,
	       					r.rsvbabynum,
	       					r.rsvusedstock,
	       					r.rsvperiod,
	       					r.rsvlivearea_id,
	       					r.rsvactivitytypecnt,
	       					r.rsvfinalmoney,
	       					r.rsvfinalpointval,
	       					r.rsvusedpointval,
	       					r.rsvuseprimoney,
	       					r.rsvcouponheldcompany,
	       					r.rsvactivitymainkbn,
	       					r.rsvactivitymainmod,
	       					r.rsvactivitymainify,
	       					r.rsvactivitytype_id,
	       					r.rsvarea_fid,
	       					r.rsvarea_id,
	       					r.rsvactivitymainlangflg_jp,
	       					r.rsvactivitymainlangflg_en,
	       					r.rsvactivitymainlangflg_cn,
	       					r.rsvactivitymainlangflg_tw,
	       					r.rsvactivitymainlangflg_kr,
	       					r.replyquestion,
	       					r.rsvisused,
	       					r.rsviscanceled,
	       					r.rsvstatusatcancel,
	       					r.rsviscanceledday,
	       					r.rsvfee,
	       					r.rsvpointfee,
	       					r.rsvb2bflg,
	       					r.rsvcreatedatetime,
	       					b.buyid,
	       					b.mdacode,
	       					b.frmcompanyid,
	       					b.frmsellerid,
	       					null ,
	       					b.seller_id,
	       					b.serialnum,
	       					b.accessid,
	       					b.accesspass,
	       					b.coupon_id,
	       					b.copnpoint_id,
	       					b.urlareaid as b_urlareaid,
	       					b.area_id,
	       					b.caldate,
	       					b.period,
	       					b.usagetypecnt,
	       					b.money_id,
	       					b.finalmoney,
	       					b.finalmoneylog,
	       					b.point_id,
	       					b.finalpointval,
	       					b.finalpointvallog,
	       					b.delegatefist,
	       					b.delegatelast,
	       					b.delegatesex,
	       					b.delegateage,
	       					b.delegatetel,
	       					b.delegatemail,
	       					b.isused,
	       					b.cancelflg,
	       					b.cancelday,
	       					b.cancelfee,
	       					b.deleterid,
	       					b.display,
	       					b.createtime,
	       					ar.areaid,
	       					ar.areafatherid,
	       					ar.areaname_jp,
	       					ar.areaname_en,
	       					ar.areaname_cn,
	       					ar.areaname_tw,
	       					ar.areaname_kr,
	       					ar.areasort,
	       					ar.areainvalid,
	       					c.companyid,
	       					c.companycd,
	       					c.companyname_jp,
	       					c.companyname_en,
	       					c.companyname_cn,
	       					c.companyname_tw,
	       					c.companyname_kr,
	       					c.companymail,
	       					c.companyloginid,
	       					c.companypass,
	       					c.companyareaid,
	       					c.companytel_jp,
	       					c.companytel_en,
	       					c.companytel_cn,
	       					c.companytel_tw,
	       					c.companytel_kr,
	       					c.companyzipcd,
	       					c.companyaddr1_jp,
	       					c.companyaddr2_jp,
	       					c.companyaddr1_en,
	       					c.companyaddr2_en,
	       					c.companyaddr1_cn,
	       					c.companyaddr2_cn,
	       					c.companyaddr1_tw,
	       					c.companyaddr2_tw,
	       					c.companyaddr1_kr,
	       					c.companyaddr2_kr,
	       					c.companyagtflg,
	       					c.companymakerid,
	       					c.isadmin,
	       					c.companyupdaterid,
	       					c.companydeleterid,
	       					c.companyupdatetime,
	       					c.companycreatetime,
	       					ad.activitydetailid,
	       					ad.activitydetailseqcd,
	       					ad.activitymain_id,
	       					ad.activitydetailcrscd,
	       					ad.activitydetailcrs_jp,
	       					ad.activitydetailcrs_en,
	       					ad.activitydetailcrs_cn,
	       					ad.activitydetailcrs_tw,
	       					ad.activitydetailcrs_kr,
	       					ad.activitydetailfrom,
	       					ad.activitydetailto,
	       					ad.activitydetailperiod,
	       					ad.activitydetailschdtal_jp,
	       					ad.activitydetailschdtal_en,
	       					ad.activitydetailschdtal_cn,
	       					ad.activitydetailschdtal_tw,
	       					ad.activitydetailschdtal_kr,
	       					ad.activitydetailinstrct_jp,
	       					ad.activitydetailinstrct_en,
	       					ad.activitydetailinstrct_cn,
	       					ad.activitydetailinstrct_tw,
	       					ad.activitydetailinstrct_kr,
	       					ad.activitydetailfarcont_jp,
	       					ad.activitydetailfarcont_en,
	       					ad.activitydetailfarcont_cn,
	       					ad.activitydetailfarcont_tw,
	       					ad.activitydetailfarcont_kr,
	       					ad.activitydetailmetplc_jp,
	       					ad.activitydetailmetplc_en,
	       					ad.activitydetailmetplc_cn,
	       					ad.activitydetailmetplc_tw,
	       					ad.activitydetailmetplc_kr,
	       					ad.activitydetaillat,
	       					ad.activitydetaillon,
	       					ad.activitydetailmettime,
	       					ad.activitydetailmininum,
	       					ad.activitydetailminpar,
	       					ad.activitydetailmaxpar,
	       					ad.activitydetailtejmaid,
	       					ad.activitydetailtejmait,
	       					ad.activitydetailsttjmid,
	       					ad.activitydetailsttjmit,
	       					ad.activitydetailimg1,
	       					ad.activitydetailimg2,
	       					ad.activitydetailimg3,
	       					ad.activitydetailimg4,
	       					ad.activitydetailimgcp1_jp,
	       					ad.activitydetailimgcp1_en,
	       					ad.activitydetailimgcp1_cn,
	       					ad.activitydetailimgcp1_tw,
	       					ad.activitydetailimgcp1_kr,
	       					ad.activitydetailimgcp2_jp,
	       					ad.activitydetailimgcp2_en,
	       					ad.activitydetailimgcp2_cn,
	       					ad.activitydetailimgcp2_tw,
	       					ad.activitydetailimgcp2_kr,
	       					ad.activitydetailimgcp3_jp,
	       					ad.activitydetailimgcp3_en,
	       					ad.activitydetailimgcp3_cn,
	       					ad.activitydetailimgcp3_tw,
	       					ad.activitydetailimgcp3_kr,
	       					ad.activitydetailimgcp4_jp,
	       					ad.activitydetailimgcp4_en,
	       					ad.activitydetailimgcp4_cn,
	       					ad.activitydetailimgcp4_tw,
	       					ad.activitydetailimgcp4_kr,
	       					ad.activitydetailmov_jp,
	       					ad.activitydetailmov_en,
	       					ad.activitydetailmov_cn,
	       					ad.activitydetailmov_tw,
	       					ad.activitydetailmov_kr,
	       					ad.activitydetailmovcmt_jp,
	       					ad.activitydetailmovcmt_en,
	       					ad.activitydetailmovcmt_cn,
	       					ad.activitydetailmovcmt_tw,
	       					ad.activitydetailmovcmt_kr,
	       					ad.question_jp,
	       					ad.question_en,
	       					ad.question_cn,
	       					ad.question_tw,
	       					ad.question_kr,
	       					ad.activitydetailmovurl,
	       					ad.activitydetailreqtime,
	       					ad.activitydetailstartage,
	       					ad.activitydetailendage,
	       					ad.activitydetaildeleter,
	       					ad.activitydetailcreattime,
	       					am.activitymainid,
	       					am.activitymainseq,
	       					am.activitymaincmpcd,
	       					am.activitymainplncd,
	       					am.activitymainminpoint,
	       					am.activitymainpln_jp,
	       					am.activitymainpln_en,
	       					am.activitymainpln_cn,
	       					am.activitymainpln_tw,
	       					am.activitymainpln_kr,
	       					am.activitymainkbn,
	       					am.activitymainunit_jp,
	       					am.activitymainunit_en,
	       					am.activitymainunit_cn,
	       					am.activitymainunit_tw,
	       					am.activitymainunit_kr,
	       					am.activitymainmod,
	       					am.activitymainnoshowbaby,
	       					am.activitymaincmt_jp,
	       					am.activitymaincmt_en,
	       					am.activitymaincmt_cn,
	       					am.activitymaincmt_tw,
	       					am.activitymaincmt_kr,
	       					am.activitymainimg,
	       					am.activitymainimgcp_jp,
	       					am.activitymainimgcp_en,
	       					am.activitymainimgcp_cn,
	       					am.activitymainimgcp_tw,
	       					am.activitymainimgcp_kr,
	       					am.activitymainreqtime,
	       					am.activitymainify,
	       					am.activitytype_id,
	       					am.area_fid as am_area_fid,
	       					am.area_id as am_area_id,
	       					am.activitymainlangflg_jp,
	       					am.activitymainlangflg_en,
	       					am.activitymainlangflg_cn,
	       					am.activitymainlangflg_tw	,
	       					am.activitymainlangflg_kr,
	       					am.activitymaincreaterid,
	       					am.activitymainupdaterid,
	       					am.activitymaindeleterid,
	       					am.activitymainisopen,
	       					am.activitymaincreatetime,
	       					att.activitytypeid,
	       					att.activityname_jp,
	       					att.activityname_en,
	       					att.activityname_cn,
	       					att.activityname_tw,
	       					att.activityname_kr,
	       					att.activitytype,
	       					att.activitydeleter,
	       					att.activitytypeindex,
	       					att.activitycreatetime,
	       					rpt.rptypeid,
	       					rpt.rsv_id,
	       					rpt.activitypointid,
	       					rpt.activitypointname_en,
	       					rpt.activitypointname_jp,
	       					rpt.activitypointname_cn,
	       					rpt.activitypointname_tw,
	       					rpt.activitypointname_kr,
	       					rpt.rptypemembernum,
	       					rpt.rptypeunitprice,
	       					rpt.rptypeunitmoney,
	       					rpt.rptypepeoplenum,
	       					rpt.atstockcal_id,
	       					rpt.planorcourse,
	       					at.company_id
	       					
	       				from reserve as r  left join 
	       					buyingb2b as b on b.buyid =r.rsvbuyid left join  
	       					agents at  on b.coupon_id= at.coupon_id  left join  
	       					areas as ar on ar.areaid=b.area_id left join 
	       					company as c  on r.rsvcompanyid=c.companyid left join 
	       					activitydetail as ad on ad.activitydetailid = r.rsvactivitydetailid left join 
	       					activitymain as am on am.activitymainid= r.rsvactivitymainid left join 
	       					activitytype as att on att.activitytypeid=am.activitytype_id left join 
	       					reservepointtype as rpt on r.rsvid=rpt.rsv_id 
	       				where rpt.activitypointid >0 and r.rsvarea_fid= ? and r.rsvb2bflg=1 and b.frmcompanyid =? and frmsellerid = ?
	       				       				
       				
       				) as tt where   tt.company_id= ? ORDER BY tt.rsvcreatedatetime DESC 
      		 		
      		 		";
       		
       		$tmp="$areaid,$companyid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiii',$areaid,$companyid,$sellerid,$companyid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {


			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['urlareaid']					=$row['urlareaid'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];//利用日
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];//パス予約ID
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];//パス予約番号
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];		
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];		
			    $rtn[$i]['rsvuseprimoney']				=$row['rsvuseprimoney'];		
			    	    
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']				=$row['rsvbabynum'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    $rtn[$i]['rsviscanceledday']			=$row['rsviscanceledday'];			    
			    $rtn[$i]['rsvfee']						=$row['rsvfee'];
			    
			    $rtn[$i]['buyid']						=$row['buyid'];
			    $rtn[$i]['serialnum']					=$row['serialnum'];
			    $rtn[$i]['accessid']					=$row['accessid'];
			    $rtn[$i]['accesspass']					=$row['accesspass'];
			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    $rtn[$i]['deleterid']					=$row['deleterid'];
			    $rtn[$i]['createtime']					=$row['createtime'];

			    $rtn[$i]['areaid']						=$row['areaid'];
			    $rtn[$i]['areafatherid']				=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];
			    $rtn[$i]['createtime']					=$row['createtime'];
			    $rtn[$i]['replyquestion']						=$row['replyquestion'];
			    $rtn[$i]['companyid']					=$row['companyid'];
			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']				=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']				=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']				=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']				=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']				=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']				=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']				=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']				=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']				=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']				=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']				=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']				=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']				=$row['companyaddr2_jp'];
			    $rtn[$i]['companyagtflg']				=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']				=$row['companymakerid'];


				
			    $rtn[$i]['activitydetailid']			=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']			=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']			=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']		=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']		=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']		=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']		=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']		=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']			=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']			=$row['activitydetailto'];
			    $rtn[$i]['activitystock']				=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp	']	=$row['activitydetailschdtal_jp	'];
			    $rtn[$i]['activitydetailschdtal_en']	=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']	=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']	=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']	=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']	=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']	=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']	=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']	=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']	=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']	=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']	=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']	=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']	=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']	=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']		=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']		=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']		=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']		=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']		=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']			=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']			=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']		=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']		=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']		=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']		=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']		=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']		=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']		=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']			=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']			=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']			=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']			=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']		=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']		=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']		=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']		=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']		=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['companymakerid']				=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_jp']		=$row['companymakerid'];
			    $rtn[$i]['activitydetailimgcp2_en']		=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']		=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']		=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']		=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']		=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']		=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']		=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']		=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']		=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']		=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']		=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']		=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']		=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']		=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']		=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']		=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']		=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']		=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']		=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']		=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']		=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']	=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']		=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']		=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']		=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']		=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']		=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']		=$row['activitydetailendage'];

				
			    $rtn[$i]['activitymainid']				=$row['activitymainid'];
			    $rtn[$i]['activitymaincmpcd']			=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainseq']				=$row['activitymainseq'];
			    $rtn[$i]['activitymainplncd']			=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']			=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainkbn']				=$row['activitymainkbn'];
			    $rtn[$i]['activitymainmod']				=$row['activitymainmod'];
			    $rtn[$i]['activitymainify']				=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']				=$row['activitytype_id'];
			    $rtn[$i]['area_fid']					=$row['area_fid'];
			    $rtn[$i]['area_id']						=$row['area_id'];

			    $rtn[$i]['activitytypeid']						=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']						=$row['activityname_jp'];
			    $rtn[$i]['activitytype']						=$row['activitytype'];


				
				$getfarea=$this->getAreasByAreaid($row['area_fid']);
			    $rtn[$i]['area_fname']					=$getfarea[0]['areaname_jp'];
			    $getarea=$this->getAreasByAreaid($row['area_id']);
			    $rtn[$i]['area_name']					=$getarea[0]['areaname_jp'];
			    
			    
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypeunitmoney']				=$row['rptypeunitmoney'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];
			    $rtn[$i]['atstockcal_id']				=$row['atstockcal_id'];
			    $rtn[$i]['planorcourse']				=$row['planorcourse'];
			    
			    $rtn[$i]['rsvb2bflg']				=$row['rsvb2bflg'];
			    
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   	   	   	   	   	
	   function reservefreedelegateisusedReservefreedelegateAll($start_from, $num_rec_per_page,$areaid){
	   		
			$sellerupdatedate=date('Y-m-d');
      		$sql = "
    			select * from (
	       			select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=0
					
					UNION ALL
					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1
					
				 ) as tt 	ORDER BY tt.`usetime` DESC limit ?,?
				 
					";
       		
       		$tmp="$areaid,$areaid,$start_from, $num_rec_per_page";



			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiii',$areaid,$areaid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['delegatefist']					=$row['delegatefist'];
			    $rtn[$i]['delegatelast']					=$row['delegatelast'];

				$rtn[$i]['area_id']						=$row['area_id'];
				$rtn[$i]['delegatetel']					=$row['delegatetel'];
				$rtn[$i]['delegatemail']				=$row['delegatemail'];
			 
				$rtn[$i]['areaname_jp']				=$row['areaname_jp'];
			 
			 
			 
			    			
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']						=$row['usetime'];

			    $rtn[$i]['usertype']					=$row['usertype'];




			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   function reservefreedelegateisusedReservefreedelegateCnt($rsvcompanyid,$areaid){
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reservefree as r left join reservefreedelegate as rd on r.rsvid=rd.rsvfree_id  where r.rsvcompanyid  = ? ";
       		$sql = "
					
    			select * from (
	       			select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=0
					
					UNION ALL
					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1
					
				 ) as tt  where tt.rsvcompanyid  = ? 	ORDER BY tt.`usetime` DESC 
				 
					";
       		
       		$tmp="$areaid,$areaid,$rsvcompanyid";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iii',$areaid,$areaid,$rsvcompanyid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['createtime']					=$row['createtime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   }
	   function reservefreedelegateisusedReservefreedelegateCntAll($areaid){
	   
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reservefree as r left join reservefreedelegate as rd on r.rsvid=rd.rsvfree_id  ";
       		$sql = "
    			select * from (
	       			select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=0
					
					UNION ALL
					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1
					
				 ) as tt 	ORDER BY tt.`usetime` DESC 
				 
					";
       		$tmp="$areaid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ii',$areaid,$areaid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['createtime']					=$row['createtime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   }	   
	   function searchReservefreedelegateisusedReservefreedelegateCnt($rsvcompanyid,$searchkey,$areaid){
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reservefree as r  left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id   where CONCAT_WS(`rsvcd`,`rsvstartdate`,`rsvbuyid`,`rsvserialnum`,`rsvcompanycd`,`rsvplayname`,`rsvareafathername`,`rsvareaname`,`delegatetel`) LIKE CONCAT('%',?,'%') and r.rsvcompanyid  = ? ";
       		$sql = "
	       		select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
					select * from reservefree as rf right join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost,'delegate' as usertype  FROM reservefreedelegate 
						UNION All
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost,'follower' as usertype  FROM reservefreefollowers
						
					) 
					as un on rf.rsvid= un.rsvfree_id where CONCAT_WS(rf.rsvcd,rf.rsvstartdate,rf.rsvbuyid,rf.rsvserialnum,rf.rsvcompanycd,rf.rsvplayname,rf.rsvareafathername,rf.rsvareaname,un.tel,un.mail,un.usetime) LIKE CONCAT('%',?,'%') and rf.rsvcompanyid  = ?  ORDER BY `un`.`usetime` DESC 
				) as refr on bi.buyid=refr.rsvbuyid	where refr.rsvareafather_id = ?
				
					";
       		$tmp=",$searchkey,$rsvcompanyid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sii',$searchkey,$rsvcompanyid,$areaid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['createtime']					=$row['createtime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   }	   
	   
	   
	   function searchReservefreedelegateisusedReservefreedelegateCntAll($searchkey,$areaid){
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reservefree as r  left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id   where CONCAT_WS(`rsvcd`,`rsvstartdate`,`rsvbuyid`,`rsvserialnum`,`rsvcompanycd`,`rsvplayname`,`rsvareafathername`,`rsvareaname`,`delegatetel`) LIKE CONCAT('%',?,'%')  ";
       		
       		$sql = "
	       		select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
					select * from reservefree as rf right join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost,'delegate' as usertype  FROM reservefreedelegate 
						UNION All
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost,'follower' as usertype  FROM reservefreefollowers
						
					) 
					as un on rf.rsvid= un.rsvfree_id where CONCAT_WS(rf.rsvcd,rf.rsvstartdate,rf.rsvbuyid,rf.rsvserialnum,rf.rsvcompanycd,rf.rsvplayname,rf.rsvareafathername,rf.rsvareaname,un.tel,un.mail,un.usetime) LIKE CONCAT('%',?,'%')  ORDER BY `un`.`usetime` DESC 
				) as refr on bi.buyid=refr.rsvbuyid	 	where refr.rsvareafather_id = ?
				
					";
       		
       		$tmp="$searchkey,$areaid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('si',$searchkey,$areaid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['createtime']					=$row['createtime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   }	   
	   	   
	   function reservefreedelegateisusedReservefreedelegate($rsvcompanyid,$start_from, $num_rec_per_page,$areaid){
	   		
	   		
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from reservefree as r left join reservefreedelegate as rd on r.rsvid=rd.rsvfree_id left join buying as b on b.buyid =r.rsvbuyid left join areas as ar on ar.areaid=b.area_id left join playmaster as pm on pm.playid=r.rsvplay_id left join activitytype as at on at.activitytypeid = pm.activitytype_id  where r.rsvcompanyid  = ? limit ?,?";
       		$sql = "
					
    			select * from (
	       			select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buying as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=0 and refr.rsvcompanyid  = ?
					
					UNION ALL
					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1  and refr.rsvcompanyid  = ?
					
				 ) as tt 	ORDER BY tt.`usetime` DESC limit ?,?					

					";
       		
       		$tmp="$rsvcompanyid,$start_from, $num_rec_per_page,$areaid";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('isisii',$areaid,$rsvcompanyid,$areaid,$rsvcompanyid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']					=$row['usetime'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];

			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    
			    $rtn[$i]['usertype']					=$row['usertype'];

			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }

	   function b2breservefreedelegateisusedReservefreedelegate($sellerid,$frmcompanyid,$start_from, $num_rec_per_page,$areaid){

			$sellerupdatedate=date('Y-m-d');
      		$sql = "
					
    			select * from (

					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,coupon_id,frmcompanyid,frmsellerid,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1  
					
				 ) as tt left join agents ag on tt.coupon_id=ag.coupon_id where ag.company_id=? and tt.frmcompanyid= ? and tt.frmsellerid=?	ORDER BY tt.`usetime` DESC limit ?,?					

					";
       		
       		$tmp="$areaid,$frmcompanyid,$frmcompanyid,$sellerid,$start_from, $num_rec_per_page";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiiiii',$areaid,$frmcompanyid,$frmcompanyid,$sellerid,$start_from, $num_rec_per_page);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']					=$row['usetime'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];

			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    
			    $rtn[$i]['usertype']					=$row['usertype'];
			    
			    
			    
			    
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   function searchb2breservefreedelegateisusedReservefreedelegate($datefrom,$dateto,$sellerid,$frmcompanyid,$keyword,$areaid){


			$daybetween ="";
			$searchstr="";
			$paramtypes="iiii";
			
			if(($datefrom<>"")&&($dateto<>"")){

				$daybetween="and ? <= tt.rsvcreatedatetime and  tt.rsvcreatedatetime <= ?";
				$paramtypes=$paramtypes."ss";
			}
			if($keyword<>''){
				$searchstr=	"
					  and 
					 CONCAT_WS(tt.rsvcd,tt.rsvstartdate,tt.rsvbuyid,tt.rsvserialnum,tt.rsvcompanycd,
					 			tt.rsvplayname,tt.rsvareafathername,tt.rsvareaname,tt.tel,tt.mail,tt.usetime,tt.delegatefist,tt.delegatelast
					 		) 
					 LIKE CONCAT('%',?,'%') 
				";
				$paramtypes=$paramtypes."s";
			}
			$sellerupdatedate=date('Y-m-d');
      		$sql = "
				
	    			select * from (
						
						 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,coupon_id,frmcompanyid,frmsellerid,refr.* from buyingb2b as bi right join (
							select * from reservefree as rf left join (
							SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
							UNION 
							SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
							as un on rf.rsvid= un.rsvfree_id 
						) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and bi.frmcompanyid=? and bi.frmsellerid=?  and refr.rsvb2bflg=1  
						
					 ) as tt left join agents ag on tt.coupon_id=ag.coupon_id 
				
				 where ag.company_id=?	
				 $daybetween 
				 $searchstr
 
				 ORDER BY tt.`usetime` DESC 					

					";
			$tmp="$areaid,$frmcompanyid,$sellerid,$frmcompanyid,$sellerid,$keyword";
			if($keyword<>''){

				$tmp="$areaid,$frmcompanyid,$sellerid,$frmcompanyid,$datefrom,$dateto,$keyword";
	
			}else{
			
				$tmp="$areaid,$frmcompanyid,$sellerid,$frmcompanyid,$datefrom,$dateto";	
				
			}


			$stmt =$this->link->prepare($sql);
			if($stmt){
				if($keyword<>''){
					$stmt->bind_param($paramtypes,$areaid,$frmcompanyid,$sellerid,$frmcompanyid,$datefrom,$dateto,$keyword);
				}else{
					$stmt->bind_param($paramtypes,$areaid,$frmcompanyid,$sellerid,$frmcompanyid,$datefrom,$dateto);
				}
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']					=$row['usetime'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];

			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    
			    $rtn[$i]['usertype']					=$row['usertype'];
			    
			    
			    
			    
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   	   
	   function b2breservefreedelegateisusedReservefreedelegateAll($sellerid,$frmcompanyid,$areaid){

			$sellerupdatedate=date('Y-m-d');
      		$sql = "
					
    			select * from (

					
					 select delegatefist,delegatelast,area_idd as barea_id, delegatetel ,delegatemail,coupon_id,frmcompanyid,frmsellerid,refr.* from buyingb2b as bi right join (
						select * from reservefree as rf left join (
						SELECT rsvfree_id,buy_id,rsvdelegatefirstname as fname,rsvdelegatelastname as lname,rsvdelegatesex as sex ,rsvdelegateage as age,rsvdelegatetel as tel,rsvdelegatemail as mail,rsvlivearea_id as area_idd,rsvlivearea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime ,usecalval,usecalcost ,'delegate' as usertype  FROM reservefreedelegate 
						UNION 
						SELECT rsvfree_id,buy_id,rsvfollowerfirstname as fname,rsvfollowerlastname as lname,rsvfollowersex as sex,rsvfollowerage as age ,rsvfollowertel as tel,rsvfollowermail as mail,rsvfollowerarea_id as area_idd,rsvfollowerarea_name as area_name,usecalval as point,usecalcost as money,createtime as usetime,usecalval,usecalcost,'follower' as usertype   FROM reservefreefollowers) 
						as un on rf.rsvid= un.rsvfree_id 
					) as refr on bi.buyid=refr.rsvbuyid where refr.rsvareafather_id=? and refr.rsvb2bflg=1  
					
				 ) as tt left join agents ag on tt.coupon_id=ag.coupon_id where ag.company_id=?  and tt.frmcompanyid= ? and tt.frmsellerid= ?	ORDER BY tt.`usetime` DESC					

					";
       		
       		$tmp="$areaid,$frmcompanyid,$frmcompanyid";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiii',$areaid,$frmcompanyid,$frmcompanyid,$frmsellerid);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {

			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']				=$row['rsvcompanyname'];
			    $rtn[$i]['rsvplaycd']					=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']					=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']			=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']			=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']					=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']					=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']					=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    $rtn[$i]['resvfdelegateid']				=$row['resvfdelegateid'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['ticketid']					=$row['ticketid'];
			    $rtn[$i]['fname']						=$row['fname'];
			    $rtn[$i]['lname']						=$row['lname'];
			    $rtn[$i]['sex']							=$row['sex'];
			    $rtn[$i]['age']							=$row['age'];
			    $rtn[$i]['tel']							=$row['tel'];
			    $rtn[$i]['mail']						=$row['mail'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['area_name']					=$row['area_name'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['usetime']					=$row['usetime'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];

			    $rtn[$i]['coupon_id']					=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['caldate']						=$row['caldate'];
			    $rtn[$i]['period']						=$row['period'];
			    $rtn[$i]['usagetypecnt']				=$row['usagetypecnt'];
			    $rtn[$i]['finalmoney']					=$row['finalmoney'];
			    $rtn[$i]['finalpointval']				=$row['finalpointval'];
			    $rtn[$i]['delegatefist']				=$row['delegatefist'];
			    $rtn[$i]['delegatelast']				=$row['delegatelast'];
			    $rtn[$i]['delegatesex']					=$row['delegatesex'];
			    $rtn[$i]['delegateage']					=$row['delegateage'];
			    $rtn[$i]['delegatetel']					=$row['delegatetel'];
			    $rtn[$i]['delegatemail']				=$row['delegatemail'];
			    $rtn[$i]['isused']						=$row['isused'];
			    $rtn[$i]['cancelflg']					=$row['cancelflg'];
			    
			    $rtn[$i]['usertype']					=$row['usertype'];
			    
			    
			    
			    
			    
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']					=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']					=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']					=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']					=$row['areaname_kr'];

			    $rtn[$i]['activityname_jp']					=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']					=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']					=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']					=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']					=$row['activityname_kr'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
	   		
	   }
	   function getusedreservefree($rsvbuyid,$urlareaid,$b2bflg){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from reservefree  where rsvbuyid  = ? and rsvareafather_id = ?  and rsvb2bflg = ? ";
       		$tmp="$rsvbuyid,$urlareaid,$b2bflg";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iii',$rsvbuyid,$urlareaid,$b2bflg);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']				=$row['rsvid'];
			    $rtn[$i]['rsvcd']				=$row['rsvcd'];
			    $rtn[$i]['rsvlang']				=$row['rsvlang'];
			    $rtn[$i]['rsvstartdate']		=$row['rsvstartdate'];
			    $rtn[$i]['rsvperiod']			=$row['rsvperiod'];
			    $rtn[$i]['rsvbuyid']			=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']		=$row['rsvserialnum'];
			    $rtn[$i]['rsvcompanyid']		=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']		=$row['rsvcompanycd'];
			    $rtn[$i]['rsvcompanyname']		=$row['rsvcompanyname'];

			    $rtn[$i]['rsvplay_id']			=$row['rsvplay_id'];
			    $rtn[$i]['rsvplaycd']			=$row['rsvplaycd'];
			    $rtn[$i]['rsvplayname']			=$row['rsvplayname'];
			    $rtn[$i]['rsvareafather_id']	=$row['rsvareafather_id'];
			    $rtn[$i]['rsvareafathername']	=$row['rsvareafathername'];
			    $rtn[$i]['rsvarea_id']			=$row['rsvarea_id'];
			    $rtn[$i]['rsvareaname']			=$row['rsvareaname'];
			    $rtn[$i]['rsvagt_id']			=$row['rsvagt_id'];
			    $rtn[$i]['rsvagt_name']			=$row['rsvagt_name'];
			    $rtn[$i]['sectionname1']		=$row['sectionname1'];
			    $rtn[$i]['sectionname2']		=$row['sectionname2'];
			    $rtn[$i]['sectionname3']		=$row['sectionname3'];
			    $rtn[$i]['sectionname4']		=$row['sectionname4'];
			    $rtn[$i]['sectionname5']		=$row['sectionname5'];
			    $rtn[$i]['sectionname6']		=$row['sectionname6'];
			    $rtn[$i]['rsvcreatedatetime']	=$row['rsvcreatedatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

	   }
       function reservefreedelegateisused($buy_id,$ticketid,$rsvb2bflg){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select rd.*,r.* from reservefreedelegate as rd right join reservefree as r on rd.rsvfree_id=r.rsvid  where rd.buy_id  = ? and rd.ticketid = ? and r.rsvbuyid=? and r.rsvplay_id= ? and r.rsvb2bflg=? ";
       		$tmp="$buy_id,$ticketid,$buy_id,$ticketid,$rsvb2bflg";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iiiii',$buy_id,$ticketid,$buy_id,$ticketid,$rsvb2bflg);
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['resvfdelegateid']			=$row['resvfdelegateid'];
			    $rtn[$i]['rsvfree_id']				=$row['rsvfree_id'];
			    $rtn[$i]['buyserserialnum']			=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']					=$row['buy_id'];
			    $rtn[$i]['rsvdelegatefirstname']	=$row['rsvdelegatefirstname'];
			    $rtn[$i]['rsvdelegatelastname']		=$row['rsvdelegatelastname'];
			    $rtn[$i]['rsvdelegatesex']			=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']			=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']			=$row['rsvdelegatetel'];
			    $rtn[$i]['rsvdelegatemail']			=$row['rsvdelegatemail'];

			    $rtn[$i]['rsvlivearea_id']			=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvlivearea_name']		=$row['rsvlivearea_name'];
			    $rtn[$i]['buykpcalid']				=$row['buykpcalid'];
			    $rtn[$i]['buykpf_key']				=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']			=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']			=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']			=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']			=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']				=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']			=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']				=$row['buykpcalsex'];
			    $rtn[$i]['playid']					=$row['playid'];
			    $rtn[$i]['playtype_jp']				=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']				=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']				=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']				=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']				=$row['playtype_kr'];
			    $rtn[$i]['usecalid']				=$row['usecalid'];
			    $rtn[$i]['usef_key']				=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']			=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']				=$row['usecalname'];
			    $rtn[$i]['usecalmonth']				=$row['usecalmonth'];
			    $rtn[$i]['usecalval']				=$row['usecalval'];
			    $rtn[$i]['usecalcost']				=$row['usecalcost'];
			    $rtn[$i]['usecalsex']				=$row['usecalsex'];
			    $rtn[$i]['createtime']				=$row['createtime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
		
       function deleteFavoriteplanByBuying_idB2bflgPlay_id($buyingserialnum,$b2bflg,$activitydetail_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from favoriteplan  where buyingserialnum  = ? and b2bflg = ? and activitydetail_id = ? ";
       		$tmp="$buyingserialnum,$b2bflg,$activitydetail_id";



			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sii',$buyingserialnum,$b2bflg,$activitydetail_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }              
       function deleteFavoriteplayByBuying_idB2bflgPlay_id($buyingserialnum,$b2bflg,$play_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from favoriteplay  where buyingserialnum  = ? and b2bflg = ? and play_id = ? ";
       		$tmp="$companyid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sii',$buyingserialnum,$b2bflg,$play_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }

       
		function selectFavoriteplanByBuying_idB2bflg($buyingserialnum,$b2bflg){
       		$sql = "select * from favoriteplan  where buyingserialnum  = ? and b2bflg = ?   ";
       		$tmp="$buyingserialnum,$b2bflg,$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('si',$buyingserialnum,$b2bflg);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['favoriteplanid']				=$row['favoriteplanid'];
			    $rtn[$i]['buying_id']					=$row['buying_id'];
			    $rtn[$i]['buyingserialnum']				=$row['buyingserialnum'];
			    $rtn[$i]['b2bflg']						=$row['b2bflg'];
			    
			    
			    $rtn[$i]['activitymain_id']				=$row['activitymain_id'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    $rtn[$i]['planname']					=$row['planname'];
			    $rtn[$i]['plancoursename']				=$row['plancoursename'];
			    $rtn[$i]['planimg']						=$row['planimg'];
			    $rtn[$i]['planendtime']					=$row['planendtime'];
			    $rtn[$i]['planmeettime']				=$row['planmeettime'];

			    $rtn[$i]['planmeetplace']				=$row['planmeetplace'];
			    $rtn[$i]['planinclude']					=$row['planinclude'];
			    $rtn[$i]['planschedule']				=$row['planschedule'];
			    $rtn[$i]['plannotes']					=$row['plannotes'];
			    $rtn[$i]['planstartdate']				=$row['planstartdate'];
			    $rtn[$i]['plancancelpolicy']			=$row['plancancelpolicy'];
			    $rtn[$i]['planpageurl']					=$row['planpageurl'];
			    $rtn[$i]['favoriteCreateTime']			=$row['favoriteCreateTime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
				
				       
		function selectFavoriteplanByBuying_idB2bflgPlay_id($buyingserialnum,$b2bflg,$activitydetail_id){
       		$sql = "select * from favoriteplan  where buyingserialnum  = ? and b2bflg = ?  and activitydetail_id = ? ";
       		$tmp="$buyingserialnum,$b2bflg,$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sii',$buyingserialnum,$b2bflg,$activitydetail_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['favoriteplanid']				=$row['favoriteplanid'];
			    $rtn[$i]['buying_id']					=$row['buying_id'];
			    $rtn[$i]['buyingserialnum']				=$row['buyingserialnum'];
			    $rtn[$i]['b2bflg']						=$row['b2bflg'];
			    $rtn[$i]['activitydetail_id']						=$row['activitydetail_id'];
			    $rtn[$i]['planname']					=$row['planname'];
			    $rtn[$i]['plancoursename']				=$row['plancoursename'];
			    $rtn[$i]['planimg']						=$row['planimg'];
			    $rtn[$i]['planendtime']					=$row['planendtime'];
			    $rtn[$i]['planmeettime']				=$row['planmeettime'];

			    $rtn[$i]['planmeetplace']				=$row['planmeetplace'];
			    $rtn[$i]['planinclude']					=$row['planinclude'];
			    $rtn[$i]['planschedule']				=$row['planschedule'];
			    $rtn[$i]['plannotes']					=$row['plannotes'];
			    $rtn[$i]['plancancelpolicy']			=$row['plancancelpolicy'];
			    $rtn[$i]['planstartdate']				=$row['planstartdate'];
			    $rtn[$i]['planpageurl']					=$row['planpageurl'];
			    $rtn[$i]['favoriteCreateTime']			=$row['favoriteCreateTime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}
				
		function selectFavoriteplayByBuying_idB2bflgPlay_id($buyingserialnum,$b2bflg,$play_id){
       		$sql = "select * from favoriteplay  where buyingserialnum  = ? and b2bflg = ?  and play_id = ? ";
       		$tmp="$buyingserialnum,$b2bflg,$play_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sii',$buyingserialnum,$b2bflg,$play_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['favoriteplayid']				=$row['favoriteplayid'];
			    $rtn[$i]['buying_id']					=$row['buying_id'];
			    $rtn[$i]['buyingserialnum']				=$row['buyingserialnum'];
			    $rtn[$i]['b2bflg']						=$row['b2bflg'];
			    $rtn[$i]['play_id']						=$row['play_id'];
			    $rtn[$i]['playtitle']					=$row['playtitle'];
			    $rtn[$i]['playimgurl']					=$row['playimgurl'];
			    $rtn[$i]['playstart']					=$row['playstart'];
			    $rtn[$i]['playend']						=$row['playend'];
			    $rtn[$i]['playoverview']				=$row['playoverview'];

			    $rtn[$i]['playcontact']					=$row['playcontact'];
			    $rtn[$i]['playnotes']					=$row['playnotes'];
			    $rtn[$i]['playstartdate']				=$row['playstartdate'];
			    $rtn[$i]['playsiteurl']					=$row['playsiteurl'];
			    $rtn[$i]['playpageurl']					=$row['playpageurl'];
			    $rtn[$i]['favoriteCreateTime']			=$row['favoriteCreateTime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}

		function selectFavoriteplayByBuying_idB2bflg($buyingserialnum,$b2bflg){
       		$sql = "select * from favoriteplay  where buyingserialnum  = ? and b2bflg = ? ";
       		$tmp="$buying_id,$b2bflg";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('si',$buyingserialnum,$b2bflg);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['favoriteplayid']				=$row['favoriteplayid'];
			    $rtn[$i]['buying_id']					=$row['buying_id'];
			    $rtn[$i]['buyingserialnum']				=$row['buyingserialnum'];
			    $rtn[$i]['b2bflg']						=$row['b2bflg'];
			    $rtn[$i]['playareaid']					=$row['playareaid'];
			    $rtn[$i]['playsubareaid']				=$row['playsubareaid'];
			    
			    $rtn[$i]['play_id']						=$row['play_id'];
			    $rtn[$i]['playtitle']					=$row['playtitle'];
			    $rtn[$i]['playimgurl']					=$row['playimgurl'];
			    $rtn[$i]['playstart']					=$row['playstart'];
			    $rtn[$i]['playend']						=$row['playend'];
			    $rtn[$i]['playoverview']				=$row['playoverview'];

			    $rtn[$i]['playcontact']					=$row['playcontact'];
			    $rtn[$i]['playnotes']					=$row['playnotes'];
			    $rtn[$i]['playstartdate']				=$row['playstartdate'];
			    $rtn[$i]['playsiteurl']					=$row['playsiteurl'];
			    $rtn[$i]['playpageurl']					=$row['playpageurl'];
			    $rtn[$i]['favoriteCreateTime']			=$row['favoriteCreateTime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		}



       function  favoriteplay($buying_id,$buyingserialnum,$b2bflg,$areaid,$subareaid,$play_id,$playtitle,$playimgurl,$playstart,$playend,$playoverview,$playcontact,$playnotes,$playstartdate,$playsiteurl,$playpageurl){

			$sql="INSERT  favoriteplay (buying_id,buyingserialnum,b2bflg,playareaid,playsubareaid,play_id,playtitle,playimgurl,playstart,playend,playoverview,playcontact,playnotes,playstartdate,playsiteurl,playpageurl) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);

			$tmp="$buying_id,$buyingserialnum,$b2bflg,$areaid,$subareaid,$play_id,$playtitle,$playimgurl,$playstart,$playend,$playoverview,$playcontact,$playnotes,$playstartdate,$playsiteurl,$playpageurl";


			$stmt->bind_param("isiiiissssssssss",$buying_id,$buyingserialnum,$b2bflg,$areaid,$subareaid,$play_id,$playtitle,$playimgurl,$playstart,$playend,$playoverview,$playcontact,$playnotes,$playstartdate,$playsiteurl,$playpageurl);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 	

       function  favoriteplan($buying_id,$buyingserialnum,$b2bflg,$activitymain_id,$activitydetail_id,$planname,$plancoursename,$planimg,$planendtime,$planmeettime,$planmeetplace,$planinclude,$planschedule,$plannotes,$plancancelpolicy,$planstartdate,$planpageurl,$planareaid){


			$sql="INSERT  favoriteplan (buying_id,buyingserialnum,b2bflg,activitymain_id,activitydetail_id,planname,plancoursename,planimg,planendtime,planmeettime,planmeetplace,planinclude,planschedule,plannotes,plancancelpolicy,planstartdate,planpageurl,planareaid) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);

			$tmp="$buying_id,$buyingserialnum,$b2bflg,$activitymain_id,$activitydetail_id,$planname,$plancoursename,$planimg,$planendtime,$planmeettime,$planmeetplace,$planinclude,$planschedule,$plannotes,$plancancelpolicy,$planstartdate,$planpageurl,$planareaid";


			$stmt->bind_param("isiiissssssssssssi",$buying_id,$buyingserialnum,$b2bflg,$activitymain_id,$activitydetail_id,$planname,$plancoursename,$planimg,$planendtime,$planmeettime,$planmeetplace,$planinclude,$planschedule,$plannotes,$plancancelpolicy,$planstartdate,$planpageurl,$planareaid);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 	
       	
       	       	
       function buyingmaillog($sendto,$ccto,$title,$status){

			$sql="INSERT buyingmaillog (sendto,ccto,title,status) VALUES(?,?,?,?)";
			$stmt =$this->link->prepare($sql);

			$tmp="$sendto,$ccto,$title,$status";

			$stmt->bind_param("ssss",$sendto,$ccto,$title,$status);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 	
       	
       function addBuyingusageb2c($insertid,$buser_id,$isdelegate,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$copnb2ccost,$pointcal_calid,$pointcalval,$pointcalcost){

			$sql="INSERT buyingusageb2c (buser_id,isdelegate,buy_id,copnpoint_id,copnb2cmid,copnb2cnum,moneycal_calid,copnb2cprice,copnb2ccost,pointcal_calid,pointcalval,pointcalcost) VALUES(?,?,?,?,?,?,?,?,?,?,?,?)";
			$tmp="$buser_id,$isdelegate,$insertid,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$copnb2ccost,$pointcal_calid,$pointcalval,$pointcalcost";

			
			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("iiiiiiiiiiii", $buser_id,$isdelegate,$insertid,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$copnb2ccost,$pointcal_calid,$pointcalval,$pointcalcost);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 		

       				
       function addBuyingusageb2b($insertid,$buser_id,$isdelegate,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$copnb2ccost,$pointcal_calid,$pointcalval){

			$sql="INSERT buyingusageb2b (buser_id,isdelegate,buy_id,copnpoint_id,copnb2cmid,copnb2cnum,moneycal_calid,copnb2cprice,copnb2ccost,pointcal_calid,pointcalval,pointcalcost) VALUES(?,?,?,?,?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="$buser_id,$isdelegate,$insertid,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$pointcal_calid,$pointcalval";
			
			$stmt->bind_param("iiiiiiiiiiii", $buser_id,$isdelegate,$insertid,$copnpoint_id,$copnb2cmid,$copnb2cnum,$moneycal_calid,$copnb2cprice,$copnb2ccost,$pointcal_calid,$pointcalval,$pointcalcost);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 		
	
		
       function addReservefree(
       		$rsvlang,
       		$rsvstartdate,
       		$rsvperiod,
       		$rsvbuyid,
       		$rsvserialnum, 
       		$rsvcompanyid,
       		$rsvcompanycd,
       		$rsvcompanyname,
       		$rsvplay_id,
       		$rsvplaycd,
       		$rsvplayname,
	    	$rsvplayname_en,
	    	$rsvplayname_cn,
	    	$rsvplayname_tw,
	    	$rsvplayname_kr,       		
       		$rsvareafather_id,
       		$rsvareafathername,
	    	$rsvareafathername_en,
	    	$rsvareafathername_cn,
	    	$rsvareafathername_tw,
	    	$rsvareafathername_kr,       		
       		$rsvarea_id,
       		$rsvareaname,
	    	$rsvareaname_en,
	    	$rsvareaname_cn,
	    	$rsvareaname_tw,
	    	$rsvareaname_kr,       		
       		$sectionname1,
       		$sectionname2,
       		$sectionname3,
       		$sectionname4,
       		$sectionname5,
       		$sectionname6,
       		$rsvb2bflg        	
       	){
		$sql="INSERT reservefree (
			
			rsvlang,
			rsvstartdate,
			rsvperiod,
			rsvbuyid,
			rsvserialnum,
			rsvcompanyid,
			rsvcompanycd,
			rsvcompanyname,
			rsvplay_id,
			rsvplaycd,
			rsvplayname,
			rsvplayname_en,
			rsvplayname_cn,
			rsvplayname_tw,
			rsvplayname_kr,
			rsvareafather_id,
			rsvareafathername,
	    	rsvareafathername_en,
	    	rsvareafathername_cn,
	    	rsvareafathername_tw,
	    	rsvareafathername_kr,  			
			rsvarea_id,
			rsvareaname,
			rsvareaname_en,
			rsvareaname_cn,
			rsvareaname_tw,
			rsvareaname_kr,
			sectionname1,
			sectionname2,
			sectionname3,
			sectionname4,
			sectionname5,
			sectionname6,
			rsvb2bflg
			) VALUES(TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="

				$rsvlang,
				$rsvstartdate,
				$rsvperiod,
				$rsvbuyid,
				$rsvserialnum,
				$rsvcompanyid,
				$rsvcompanycd,
				$rsvcompanyname,
				$rsvplay_id,
				$rsvplaycd,
				$rsvplayname,
				$rsvareafather_id,
				$rsvareafathername,
				$rsvareafathername_en,
				$rsvareafathername_cn,
				$rsvareafathername_tw,
				$rsvareafathername_kr,
				$rsvarea_id,
				$rsvareaname,
				$rsvareaname_en,
				$rsvareaname_cn,
				$rsvareaname_tw,
				$rsvareaname_kr,
				$sectionname1,
				$sectionname2,
				$sectionname3,
				$sectionname4,
				$sectionname5,
				$sectionname6,
				$rsvb2bflg		       
			";

			$stmt->bind_param("ssiisississssssisssssisssssiiiiiii", $rsvlang,$rsvstartdate, $rsvperiod, $rsvbuyid,$rsvserialnum,$rsvcompanyid,$rsvcompanycd, $rsvcompanyname,$rsvplay_id,$rsvplaycd,$rsvplayname,$rsvplayname_en,$rsvplayname_cn,$rsvplayname_tw,$rsvplayname_kr,$rsvareafather_id,$rsvareafathername,$rsvareafathername_en, $rsvareafathername_cn, $rsvareafathername_tw, $rsvareafathername_kr, $rsvarea_id, $rsvareaname,$rsvareaname_en,$rsvareaname_cn,$rsvareaname_tw,$rsvareaname_kr,$sectionname1,$sectionname2,$sectionname3,$sectionname4,$sectionname5,$sectionname6,$rsvb2bflg);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 		
       function setconfimrsv($rsvid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update reserve set rsviscanceled = 0 where rsvid  = ?";
       		
       		$tmp="$rsvid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$rsvid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function setAgentsDissign_idbyAgentid($agentid,$dissign_id){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update agents set dissign_id = ?  where agentid  = ?";
       		
       		$tmp="$agentid,$dissign_id";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$dissign_id,$agentid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
                     
       function updateReservefreeRsvcd($rsvcd,$rsvid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update reservefree set rsvcd = ? where rsvid  = ?";
       		
       		$tmp="$rsvcd,$rsvid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('si',$rsvcd,$rsvid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updateBuyingFinalpointval($finalpointval,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set finalpointval = finalpointval-? where buyid  = ?";
       		
       		$tmp="$finalpointval,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('si',$finalpointval,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
              
       function updateBuyingb2bFinalpointval($finalpointval,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set finalpointval = finalpointval-? where buyid  = ?";
       		
       		$tmp="$finalpointval,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('si',$finalpointval,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
                       
       function updateBuyingCanceldayCancelfee($buyid,$cancelfee){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set cancelday = ?,cancelfee= ?  where buyid  = ?";
       		
       		$tmp="$sellerupdatedate,$cancelfee,$buyid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ssi',$sellerupdatedate,$cancelfee,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updateBuyingb2bCanceldayCancelfee($buyid,$cancelfee){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set cancelday = ?,cancelfee= ?  where buyid  = ?";
       		
       		$tmp="$sellerupdatedate,$cancelfee,$buyid";



			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ssi',$sellerupdatedate,$cancelfee,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
              
       function updateBuyingIsused($buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set isused = 1 where buyid  = ?";
       		
       		$tmp="$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   

       function updateBuyingb2bIsused($buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set isused = 1 where buyid  = ?";
       		
       		$tmp="$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
              
       function updateBuyinguserIsused($buserid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyinguser set isused = 1 where buserid  = ?";
       		
       		$tmp="$buserid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$buserid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
		
       function addReservefreedelegate(
       				$rsvfree_id,
					$buyserserialnum,
					$buy_id,
					$ticketid,
					$rsvdelegatefirstname,
					$rsvdelegatelastname,
					$rsvdelegatesex,
					$rsvdelegateage,
					$rsvdelegatetel,
					$rsvdelegatemail,
					$rsvlivearea_id,
					$rsvlivearea_name,
					$buykpcalid,
					$buykpf_key,
					$buykpcoupon_id,
					$buykpcalname,
					$buykpcalyear,
					$buykpcalmonth,
					$buykpcalval,
					$buykpcalcost,
					$buykpcalsex,
					$playid,
					$playtype_jp,
					$playtype_en,
					$playtype_cn,
					$playtype_tw,
					$playtype_kr,
					$usecalid,
					$usef_key,
					$usecoupon_id,
					$usecalname,
					$usecalmonth,
					$usecalval,
					$usecalcost,
					$usecalsex,
					$isb2b
        ){
		$sql="INSERT reservefreedelegate (
			rsvfree_id,
			buyserserialnum,
			buy_id,
			ticketid,
			rsvdelegatefirstname,
			rsvdelegatelastname,
			rsvdelegatesex,
			rsvdelegateage,
			rsvdelegatetel,
			rsvdelegatemail,
			rsvlivearea_id,
			rsvlivearea_name,
			buykpcalid,
			buykpf_key,
			buykpcoupon_id,
			buykpcalname,
			buykpcalyear,
			buykpcalmonth,
			buykpcalval,
			buykpcalcost,
			buykpcalsex,
			playid,
			playtype_jp,
			playtype_en,
			playtype_cn,
			playtype_tw,
			playtype_kr,
			usecalid,
			usef_key,
			usecoupon_id,
			usecalname,
			usecalmonth,
			usecalval,
			usecalcost,
			usecalsex,
			b2bflg
					
			) VALUES(TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?)
			
			)";
			$tmp="
					$rsvfree_id,
					$buyserserialnum,
					$buy_id,
					$ticketid,
					$rsvdelegatefirstname,
					$rsvdelegatelastname,
					$rsvdelegatesex,
					$rsvdelegateage,
					$rsvdelegatetel,
					$rsvdelegatemail,
					$rsvlivearea_id,
					$rsvlivearea_name,
					$buykpcalid,
					$buykpf_key,
					$buykpcoupon_id,
					$buykpcalname,
					$buykpcalyear,
					$buykpcalmonth,
					$buykpcalval,
					$buykpcalcost,
					$buykpcalsex,
					$playid,
					$playtype_jp,
					$playtype_en,
					$playtype_cn,
					$playtype_tw,
					$playtype_kr,
					$usecalid,
					$usef_key,
					$usecoupon_id,
					$usecalname,
					$usecalmonth,
					$usecalval,
					$usecalcost,
					$usecalsex,
					$isb2b
			";			
			

			
			$stmt =$this->link->prepare($sql);


			$stmt->bind_param("isiissiissisiiisssiiiisssssiiisiiiii", 
					$rsvfree_id,
					$buyserserialnum,
					$buy_id,
					$ticketid,
					$rsvdelegatefirstname,
					$rsvdelegatelastname,
					$rsvdelegatesex,
					$rsvdelegateage,
					$rsvdelegatetel,
					$rsvdelegatemail,
					$rsvlivearea_id,
					$rsvlivearea_name,
					$buykpcalid,
					$buykpf_key,
					$buykpcoupon_id,
					$buykpcalname,
					$buykpcalyear,
					$buykpcalmonth,
					$buykpcalval,
					$buykpcalcost,
					$buykpcalsex,
					$playid,
					$playtype_jp,
					$playtype_en,
					$playtype_cn,
					$playtype_tw,
					$playtype_kr,
					$usecalid,
					$usef_key,
					$usecoupon_id,
					$usecalname,
					$usecalmonth,
					$usecalval,
					$usecalcost,
					$usecalsex,
					$isb2b
			
			
			);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 		
       
       
       
       
       function addReservefreefollowers(
       		$rsvfree_id,
			$buyserserialnum,		
			$buy_id,					
			$buser_id,
			$ticketid,
			$rsvfollowerfirstname,	
			$rsvfollowerlastname,	
			$rsvfollowersex,			
			$rsvfollowerage,			
			$copnpoint_id,			
			$copntypename_jp,		
			$copntypename_en,		
			$copntypename_cn,		
			$copntypename_tw,		
			$copntypename_kr,		
			$buykpcalid,				
			$buykpf_key,				
			$buykpcoupon_id,			
			$buykpcalname,			
			$buykpcalyear,			
			$buykpcalmonth,			
			$buykpcalval,			
			$buykpcalcost,			
			$buykpcalsex,			
			$playid,					
			$playtype_jp,			
			$playtype_en,			
			$playtype_cn,			
			$playtype_tw,			
			$playtype_kr,			
			$usecalid,				
			$usef_key,				
			$usecoupon_id,			
			$usecalname,				
			$usecalmonth,			
			$usecalval,				
			$usecalcost,				
			$usecalsex,
			$isb2b		
		
        ){
		$sql="INSERT reservefreefollowers (
				rsvfree_id,
				buyserserialnum,		
				buy_id,					
				buser_id,
				ticketid,
				rsvfollowerfirstname,	
				rsvfollowerlastname,	
				rsvfollowersex,			
				rsvfollowerage,			
				copnpoint_id,			
				copntypename_jp,		
				copntypename_en,		
				copntypename_cn,		
				copntypename_tw,		
				copntypename_kr,		
				buykpcalid,				
				buykpf_key,				
				buykpcoupon_id,			
				buykpcalname,			
				buykpcalyear,			
				buykpcalmonth,			
				buykpcalval,			
				buykpcalcost,			
				buykpcalsex,			
				playid,					
				playtype_jp,			
				playtype_en,			
				playtype_cn,			
				playtype_tw,			
				playtype_kr,			
				usecalid,				
				usef_key,				
				usecoupon_id,			
				usecalname,				
				usecalmonth,			
				usecalval,				
				usecalcost,				
				usecalsex,
				b2bflg		
			
			
					
			) VALUES(
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?)
			
			)";
			
			
			$tmp="
				$rsvfree_id,
				$buyserserialnum,		
				$buy_id,			
				$buser_id,	
				$ticketid,		
				$rsvfollowerfirstname,	
				$rsvfollowerlastname,	
				$rsvfollowersex,			
				$rsvfollowerage,			
				$copnpoint_id,			
				$copntypename_jp,		
				$copntypename_en,		
				$copntypename_cn,		
				$copntypename_tw,		
				$copntypename_kr,		
				$buykpcalid,				
				$buykpf_key,				
				$buykpcoupon_id,			
				$buykpcalname,			
				$buykpcalyear,			
				$buykpcalmonth,			
				$buykpcalval,			
				$buykpcalcost,			
				$buykpcalsex,			
				$playid,					
				$playtype_jp,			
				$playtype_en,			
				$playtype_cn,			
				$playtype_tw,			
				$playtype_kr,			
				$usecalid,				
				$usef_key,				
				$usecoupon_id,			
				$usecalname,				
				$usecalmonth,			
				$usecalval,				
				$usecalcost,				
				$usecalsex,
				$isb2b	
			";
			
	
			$stmt =$this->link->prepare($sql);

			$stmt->bind_param("isiiissiiisssssiiisssiiiisssssiiisiiiii", 
				$rsvfree_id,
				$buyserserialnum,		
				$buy_id,			
				$buser_id,	
				$ticketid,		
				$rsvfollowerfirstname,	
				$rsvfollowerlastname,	
				$rsvfollowersex,			
				$rsvfollowerage,			
				$copnpoint_id,			
				$copntypename_jp,		
				$copntypename_en,		
				$copntypename_cn,		
				$copntypename_tw,		
				$copntypename_kr,		
				$buykpcalid,				
				$buykpf_key,				
				$buykpcoupon_id,			
				$buykpcalname,			
				$buykpcalyear,			
				$buykpcalmonth,			
				$buykpcalval,			
				$buykpcalcost,			
				$buykpcalsex,			
				$playid,					
				$playtype_jp,			
				$playtype_en,			
				$playtype_cn,			
				$playtype_tw,			
				$playtype_kr,			
				$usecalid,				
				$usef_key,				
				$usecoupon_id,			
				$usecalname,				
				$usecalmonth,			
				$usecalval,				
				$usecalcost,				
				$usecalsex,
				$isb2b	
			
			
			);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 		
       
       	  
       function getBuyingusageb2bByBuy_id($buy_id){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from buyingusageb2b as b left join copnb2cmoney as c on b.copnb2cmid=c.copnb2cmid where b.buy_id  = ?";
       		$tmp="$buy_id";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$buy_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['usageid']			=$row['usageid'];
			    $rtn[$i]['buy_id']			=$row['buy_id'];
			    $rtn[$i]['copnb2cmid']		=$row['copnb2cmid'];
			    $rtn[$i]['copnb2cnum']		=$row['copnb2cnum'];    
			    $rtn[$i]['copnb2cprice']	=$row['copnb2cprice'];
			    $rtn[$i]['pointcal_calid']	=$row['pointcal_calid'];
			    $rtn[$i]['pointcalval']		=$row['pointcalval'];
			    $rtn[$i]['usagedelflg']		=$row['usagedelflg'];
			    $rtn[$i]['usagecreatetime']	=$row['usagecreatetime'];
			    
			    
			    $rtn[$i]['copnb2cmname_jp']	=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']	=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_cn']	=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']	=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']	=$row['copnb2cmname_kr'];

			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']		=$row['copncreate'];


			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }       
       	  
       function getBuyingusageb2cByBuy_id($buy_id){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from buyingusageb2c as b left join copnb2cmoney as c on b.copnb2cmid=c.copnb2cmid where b.buy_id  = ?";
       		$tmp="$buy_id";


			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$buy_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['usageid']			=$row['usageid'];
			    $rtn[$i]['buy_id']			=$row['buy_id'];
			    $rtn[$i]['copnb2cmid']		=$row['copnb2cmid'];
			    $rtn[$i]['copnb2cnum']		=$row['copnb2cnum'];    
			    $rtn[$i]['copnb2cprice']	=$row['copnb2cprice'];
			    $rtn[$i]['pointcal_calid']	=$row['pointcal_calid'];
			    $rtn[$i]['pointcalval']		=$row['pointcalval'];
			    $rtn[$i]['usagedelflg']		=$row['usagedelflg'];
			    $rtn[$i]['usagecreatetime']	=$row['usagecreatetime'];
			    
			    
			    $rtn[$i]['copnb2cmname_jp']	=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']	=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_cn']	=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']	=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']	=$row['copnb2cmname_kr'];

			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['copnpoint_id']	=$row['copnpoint_id'];
			    $rtn[$i]['copncreate']		=$row['copncreate'];


			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }

       function getBuyappendPTs($coupon_id,$b2bflg){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from buyappend  where coupon_id= ? and b2bflg = ?";
       		
       		$tmp="$coupon_id,$b2bflg";

			$stmt =$this->link->prepare($sql);
			
			if($stmt){
				$stmt->bind_param('ii',$coupon_id,$b2bflg);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['bypndid']				=$row['bypndid'];
			    $rtn[$i]['serialnum']				=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];    
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['finalmoney']			=$row['finalmoney'];
			    $rtn[$i]['finalpointval']		=$row['finalpointval'];
			    $rtn[$i]['b2bflg']				=$row['b2bflg'];
			    
			    $rtn[$i]['createtime']		=$row['createtime'];
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }       
             

       function getBuyinguserb2bCopnpointPointcalByBuy_id($buy_id){
       
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from buyinguser as b left join copnpoint as c on b.copnpoint_id=c.copnpointid where b.buy_id=?";
       		$sql = "select * from buyinguserb2b as b left join copnpoint as c on b.copnpoint_id=c.copnpointid left join b2cmoneycal as m on b.money_id=m.calid where b.buy_id=?";
       		$tmp="$buy_id";


			$stmt =$this->link->prepare($sql);
			
			if($stmt){
				$stmt->bind_param('i',$buy_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buserid']				=$row['buserid'];
			    $rtn[$i]['buy_id']				=$row['buy_id'];
			    $rtn[$i]['buserfirstname']		=$row['buserfirstname'];
			    $rtn[$i]['buserlastname']		=$row['buserlastname'];    
			    $rtn[$i]['busersex']			=$row['busersex'];
			    $rtn[$i]['buserage']			=$row['buserage'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['isused']				=$row['isused'];
			    
			    $rtn[$i]['busercreatetime']		=$row['busercreatetime'];
			    $rtn[$i]['usagecreatetime']		=$row['usagecreatetime'];
			    
			    $rtn[$i]['money_id']		=$row['money_id'];
			    $rtn[$i]['point_id']		=$row['point_id'];
			    
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];

			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']		=$row['calval'];

			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }       
       
       
       
       function getBuyinguserCopnpointPointcalByBuy_id($buy_id){
       
			$sellerupdatedate=date('Y-m-d');
       		//$sql = "select * from buyinguser as b left join copnpoint as c on b.copnpoint_id=c.copnpointid where b.buy_id=?";
       		$sql = "select * from buyinguser as b left join copnpoint as c on b.copnpoint_id=c.copnpointid left join b2cmoneycal as m on b.money_id=m.calid where b.buy_id=?";
       		$tmp="$buy_id";

			$stmt =$this->link->prepare($sql);
			
			if($stmt){
				$stmt->bind_param('i',$buy_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buserid']				=$row['buserid'];
			    $rtn[$i]['buy_id']				=$row['buy_id'];
			    $rtn[$i]['buserfirstname']		=$row['buserfirstname'];
			    $rtn[$i]['buserlastname']		=$row['buserlastname'];    
			    $rtn[$i]['busersex']			=$row['busersex'];
			    $rtn[$i]['buserage']			=$row['buserage'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['isused']				=$row['isused'];
			    
			    $rtn[$i]['busercreatetime']		=$row['busercreatetime'];
			    $rtn[$i]['usagecreatetime']		=$row['usagecreatetime'];
			    
			    $rtn[$i]['money_id']		=$row['money_id'];
			    $rtn[$i]['point_id']		=$row['point_id'];
			    
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];

			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']		=$row['calval'];

			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }

       
       function getBuyinguserCopnpointPointcalByBuy_idb2b($buy_id){
       
			$sellerupdatedate=date('Y-m-d');

       		$sql = "select * from buyinguserb2b as b left join copnpoint as c on b.copnpoint_id=c.copnpointid left join b2bmoneycal as m on b.money_id=m.calid where b.buy_id=?";
       		$tmp="$buy_id";

			$stmt =$this->link->prepare($sql);

			
			if($stmt){
				$stmt->bind_param('i',$buy_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['buserid']				=$row['buserid'];
			    $rtn[$i]['buy_id']				=$row['buy_id'];
			    $rtn[$i]['buserfirstname']		=$row['buserfirstname'];
			    $rtn[$i]['buserlastname']		=$row['buserlastname'];    
			    $rtn[$i]['busersex']			=$row['busersex'];
			    $rtn[$i]['buserage']			=$row['buserage'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['isused']				=$row['isused'];
			    
			    $rtn[$i]['busercreatetime']		=$row['busercreatetime'];
			    $rtn[$i]['usagecreatetime']		=$row['usagecreatetime'];
			    
			    $rtn[$i]['money_id']		=$row['money_id'];
			    $rtn[$i]['point_id']		=$row['point_id'];
			    
			    $rtn[$i]['copnpointid']			=$row['copnpointid'];
			    $rtn[$i]['copntypename_jp']		=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']		=$row['copntypename_en'];
			    $rtn[$i]['copntypename_us']		=$row['copntypename_us'];
			    $rtn[$i]['copntypename_cn']		=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']		=$row['copntypename_tw'];

			    $rtn[$i]['copntypename_kr']		=$row['copntypename_kr'];
			    
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']		=$row['calval'];

			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }
             
       function getBuyappendByCoupon_id($coupon_id){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from buyappend  where coupon_id  = ?";
       		$tmp="$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['bypndid']			=$row['bypndid'];
			    $rtn[$i]['serialnum']		=$row['serialnum'];
			    $rtn[$i]['accessid']		=$row['accessid'];
			    $rtn[$i]['accesspass']		=$row['accesspass'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['finalmoney']		=$row['finalmoney'];
			    $rtn[$i]['finalpointval']	=$row['finalpointval'];
			    $rtn[$i]['createtime']		=$row['createtime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       }
       
       
                     
       function reservefreefollowersisused($buser_id,$ticketid,$rsvb2bflg){
       
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select rf.*,r.* from reservefreefollowers as rf left join  reservefree as r on r.rsvid=rf.rsvfree_id   where rf.buser_id  = ? and rf.ticketid = ? and r.rsvb2bflg=? ";
       		$tmp="$buser_id,$ticketid,$rsvb2bflg";



			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iii',$buser_id,$ticketid,$rsvb2bflg);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['resvffollowerid ']			=$row['resvffollowerid '];
			    $rtn[$i]['rsvfree_id']					=$row['rsvfree_id'];
			    $rtn[$i]['buyserserialnum']				=$row['buyserserialnum'];
			    $rtn[$i]['buy_id']						=$row['buy_id'];
			    $rtn[$i]['buser_id']					=$row['buser_id'];
			    $rtn[$i]['rsvfollowerfirstname']		=$row['rsvfollowerfirstname'];
			    $rtn[$i]['rsvfollowerlastname']			=$row['rsvfollowerlastname'];
			    $rtn[$i]['rsvfollowersex']				=$row['rsvfollowersex'];
			    $rtn[$i]['rsvfollowerage']				=$row['rsvfollowerage'];
			    $rtn[$i]['copnpoint_id']				=$row['copnpoint_id'];
			    $rtn[$i]['copntypename_jp']				=$row['copntypename_jp'];
			    $rtn[$i]['copntypename_en']				=$row['copntypename_en'];
			    $rtn[$i]['copntypename_cn']				=$row['copntypename_cn'];
			    $rtn[$i]['copntypename_tw']				=$row['copntypename_tw'];
			    $rtn[$i]['copntypename_kr']				=$row['copntypename_kr'];
			    $rtn[$i]['buykpcalid']					=$row['buykpcalid'];
			    $rtn[$i]['buykpf_key']					=$row['buykpf_key'];
			    $rtn[$i]['buykpcoupon_id']				=$row['buykpcoupon_id'];
			    $rtn[$i]['buykpcalname']				=$row['buykpcalname'];
			    $rtn[$i]['buykpcalyear']				=$row['buykpcalyear'];
			    $rtn[$i]['buykpcalmonth']				=$row['buykpcalmonth'];
			    $rtn[$i]['buykpcalval']					=$row['buykpcalval'];
			    $rtn[$i]['buykpcalcost']				=$row['buykpcalcost'];
			    $rtn[$i]['buykpcalsex']					=$row['buykpcalsex'];
			    $rtn[$i]['playid']						=$row['playid'];
			    $rtn[$i]['playtype_jp']					=$row['playtype_jp'];
			    $rtn[$i]['playtype_en']					=$row['playtype_en'];
			    $rtn[$i]['playtype_cn']					=$row['playtype_cn'];
			    $rtn[$i]['playtype_tw']					=$row['playtype_tw'];
			    $rtn[$i]['playtype_kr']					=$row['playtype_kr'];
			    $rtn[$i]['usecalid']					=$row['usecalid'];
			    $rtn[$i]['usef_key']					=$row['usef_key'];
			    $rtn[$i]['usecoupon_id']				=$row['usecoupon_id'];
			    $rtn[$i]['usecalname']					=$row['usecalname'];
			    $rtn[$i]['usecalmonth']					=$row['usecalmonth'];
			    $rtn[$i]['usecalval']					=$row['usecalval'];
			    $rtn[$i]['usecalcost']					=$row['usecalcost'];
			    $rtn[$i]['usecalsex']					=$row['usecalsex'];
			    $rtn[$i]['createtime']					=$row['createtime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       }
       
       
       function addBuying($affiliatecd,$urllang,$coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail){

			$sql="INSERT buying (
				affiliatecd,
				urllang,
				coupon_id,
				copnpoint_id,
				urlareaid,
				area_id,
				caldate,
				period,
				endcaldate,
				usagetypecnt,
				money_id,
				finalmoney,
				finalmoneylog,
				point_id,
				finalpointval,
				finalpointvallog,
				delegatefist,
				delegatelast,
				delegatesex,
				delegateage,
				delegatetel,
				delegatebirthday,
				delegatemail
				) VALUES(
				TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?)
				)";
			$tmp="$affiliatecd,$urllang, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail";
			

			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ssiiiisisiiiiiiissiisss",$affiliatecd,$urllang, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
       
       function addBuyingb2b($frmsellerid,$frmcompanyid,$urllang,$coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail){
       		
       		//echo "delegatemail  ---- > ".$delegatemail ."|--tel-->"	.$delegatetel;		exit;
			$sql="INSERT buyingb2b (
				frmsellerid,
				frmcompanyid,
				urllang,
				coupon_id,
				copnpoint_id,
				urlareaid,
				area_id,
				caldate,
				period,
				endcaldate,
				usagetypecnt,
				money_id,
				finalmoney,
				finalmoneylog,
				point_id,
				finalpointval,
				finalpointvallog,
				delegatefist,
				delegatelast,
				delegatesex,
				delegateage,
				delegatetel,
				delegatebirthday,
				delegatemail
				) VALUES(
				?,?,TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?)
				)";
			$tmp="$frmsellerid,$frmcompanyid,$urllang, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail";

			$stmt =$this->link->prepare($sql);

			$stmt->bind_param("iisiiiisisiiiiiiissiisss",$frmsellerid,$frmcompanyid,$urllang, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$endcaldate,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail);
			
	


			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
			       		
       		
       }
       
       function addBuyingb2b_deleteme($frmsellerid,$frmcompanyid,$coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail){
	

			$sql="INSERT buyingb2b (
				frmsellerid,
				frmcompanyid,
				coupon_id,
				copnpoint_id,
				urlareaid,
				area_id,
				caldate,
				period,
				usagetypecnt,
				money_id,
				finalmoney,
				finalmoneylog,
				point_id,
				finalpointval,
				finalpointvallog,
				delegatefist,
				delegatelast,
				delegatesex,
				delegateage,
				delegatetel,
				delegatebirthday,
				delegatemail
				) VALUES(
				?,?,TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?),TRIM(?)
				)";
			$tmp="$frmsellerid,$frmcompanyid, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail";

			$stmt =$this->link->prepare($sql);

			$stmt->bind_param("iiiiiisiiiiiiiissiisss",$frmsellerid,$frmcompanyid, $coupon_id,$copnpoint_id,$urlareaid,$area_id,$caldate,$period,$usagetypecnt,$finalmoney_id,$finalmoney,$finalmoneylog,$finalpoint_id,$finalpointval,$finalpointvallog,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatebirthday,$delegatemail);
			
	


			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
       function buyappend($coupon_id,$finalmoney,$finalpointval,$b2bflg){

			$sql="INSERT buyappend (
				coupon_id,
				finalmoney,
				finalpointval,
				b2bflg
				) VALUES(
				TRIM(?),TRIM(?),TRIM(?),TRIM(?)
				)";
			$tmp="$coupon_id,$finalmoney,$finalpointval,$b2bflg";
			


			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("iiii", $coupon_id,$finalmoney,$finalpointval,$b2bflg);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       	
       	
              
       function updateBuyappend($serialnum,$accessid,$accesspass,$bypndid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyappend set serialnum = ?,accessid = TRIM(?), accesspass=TRIM(?) where bypndid  = ?";
       		
       		$tmp="$serialnum,$accessid,$accesspass,$bypndid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('sssi',$serialnum,$accessid,$accesspass,$bypndid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function updateBuying_FinalmoneyByBuyid($finalmoney,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set finalmoney =finalmoney+ ? where buyid  = ?";
       		
       		$tmp="$finalmoney,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$finalmoney,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  
              
       function updateBuying_FinalpointvalByBuyid($appendpoint,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set finalpointval =finalpointval+ ? where buyid  = ?";
       		
       		$tmp="$appendpoint,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$appendpoint,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
		       		
       function addBuyinguser($buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id){

			$sql="INSERT buyinguser (buy_id,buserfirstname,buserlastname,busersex,buserage,copnpoint_id,money_id,point_id) VALUES(?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="$buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id";

			$stmt->bind_param("issiiiii", $buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 	

       function addBuyinguserb2b($buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id){

			$sql="INSERT buyinguserb2b (buy_id,buserfirstname,buserlastname,busersex,buserage,copnpoint_id,money_id,point_id) VALUES(?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="$buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id";

			$stmt->bind_param("issiiiii", $buy_id,$buserfirstname,$buserlastname,$busersex,$buserage,$copnpoint_id,$money_id,$point_id);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 
       function updateBuyingb2b($serialnum,$accessid,$accesspass,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set serialnum = ?,accessid = TRIM(?), accesspass=TRIM(?) where buyid  = ?";
       		
       		$tmp="$serialnum,$accessid,$accesspass,$buyid";


			$stmt =$this->link->prepare($sql);
	

		
			if($stmt){
				$stmt->bind_param('sssi',$serialnum,$accessid,$accesspass,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }    
       function updateBuyingb2bMobileflg($ismobile,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set ismobile = ? where buyid  = ?";
       		
       		$tmp="$ismobile,$buyid";


			$stmt =$this->link->prepare($sql);
	

		
			if($stmt){
				$stmt->bind_param('si',$ismobile,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function updateBuyingMobileflg($ismobile,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set ismobile = ? where buyid  = ?";
       		
       		$tmp="$ismobile,$buyid";


			$stmt =$this->link->prepare($sql);
	

		
			if($stmt){
				$stmt->bind_param('si',$ismobile,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }                                    
       function updateBuying($serialnum,$accessid,$accesspass,$buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set serialnum = ?,accessid = TRIM(?), accesspass=TRIM(?) where buyid  = ?";
       		
       		$tmp="$serialnum,$accessid,$accesspass,$buyid";


			$stmt =$this->link->prepare($sql);
	

		
			if($stmt){
				$stmt->bind_param('sssi',$serialnum,$accessid,$accesspass,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function cancelBuying($buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set cancelflg = 1 where buyid  = ?";
       		
       		$tmp="$buyid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }         

       function cancelBuyingb2b($buyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set cancelflg = 1 where buyid  = ?";
       		
       		$tmp="$buyid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
       
       function getPointcals($f_key,$coupon_id,$calmonth){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from pointcal  where f_key  = ? and coupon_id = ? and calmonth = ?";
       		$tmp="$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('iis',$f_key,$coupon_id,$calmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['calid ']			=$row['calid'];
			    $rtn[$i]['f_key']			=$row['f_key'];
			    $rtn[$i]['coupon_id']		=$row['coupon_id'];
			    $rtn[$i]['calname']			=$row['calname'];    
			    $rtn[$i]['calmonth']		=$row['calmonth'];
			    $rtn[$i]['calval']			=$row['calval'];
			    $rtn[$i]['calcost']			=$row['calcost'];
			    $rtn[$i]['calsex']			=$row['calsex'];
			    $rtn[$i]['calcreatedate']	=$row['calcreatedate'];


			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }
       
       function addPointcal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex){

			$sql="INSERT pointcal (f_key,coupon_id,calmonth,calval,calcost,calsex) VALUES(?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("iisiis", $f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex);
			$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex";
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   

       function setPointcal($f_key,$calval,$calcost,$calsex,$coupon_id,$calmonth){

       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update pointcal set  calval= ?,calcost= ?,calsex = ? where  coupon_id = ? and calmonth = ? and f_key= ?";
       		
       		$tmp="$calval,$calcost,$calsex,$coupon_id,$calmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisisi',$calval,$calcost,$calsex,$coupon_id,$calmonth,$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   

       function addStockcal($activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop){

			$sql="INSERT stockcal (activitydetail_id,stockcalmonth,stockcalval,stockisstop) VALUES(?,?,?,?)";
			$tmp="$activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop";
			
	
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("isii", $activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
       function setStockcal($calval,$activitydetail_id,$calmonth){


       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update stockcal set  stockcalval= ? where  activitydetail_id = ? and stockcalmonth = ?";
       		
       		$tmp="$calval,$activitydetail_id,$calmonth";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iis',$calval,$activitydetail_id,$calmonth);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function editStopStockcal($activitydetail_id,$stockcalmonth,$stockisstop){

	       		
	       		$sql = "update stockcal set stockisstop = ?  where activitydetail_id   = ? and stockcalmonth = ?";
	       		
	       		$tmp="$stockisstop,$activitydetail_id,$stockcalmonth";
		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('iis',$stockisstop,$activitydetail_id,$stockcalmonth);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
       }   
       function addPlanstockcal($activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop){

			$sql="INSERT planstockcal (activitydetail_id,stockcalmonth,stockcalval,stockisstop) VALUES(?,?,?,?)";
			$tmp="$activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop";
			
	
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("isii", $activitydetail_id,$stockcalmonth,$stockcalval,$stockisstop);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }  
       
       function setPlanstockcal($batchstock,$batchcoupon_id,$stockcalmonth){

       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update planstockcal set stockcalval = ? where  activitydetail_id = ? and stockcalmonth = ?";
       		
       		$tmp="$batchstock,$batchcoupon_id,$stockcalmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iis',$batchstock,$batchcoupon_id,$stockcalmonth);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  
       function editPlanstockcal($activitydetail_id,$stockcalmonth,$stockisstop){

			$sql="update planstockcal set stockisstop =  TRIM(?) where activitydetail_id  = ? and   stockcalmonth= ? ";
			$tmp="$stockisstop, $activitydetail_id,$stockcalmonth";
	
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("iis",$stockisstop, $activitydetail_id,$stockcalmonth);
			
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  
       
       
       
       function addActivitystockcal($activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex){

			$sql="INSERT activitystockcal (activitypoint_id,atstockcalmonth,atstockcalcost,atstockcalval,atstockcalsex) VALUES(?,?,?,?,?)";
			$tmp="$activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex";

			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("isiis", $activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
       function setActivitystockcal($batchmoney,$batchpoint,$batchsex,$id,$stockcalmonth){

       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update activitystockcal set  atstockcalval= ?,atstockcalcost= ?,atstockcalsex = ? where  activitypoint_id = ? and atstockcalmonth = ? ";
       		
       		$tmp="$batchmoney,$batchpoint,$batchsex,$id,$stockcalmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisis',$batchmoney,$batchpoint,$batchsex,$id,$stockcalmonth);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
		function deletePointcal($calid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from pointcal  where calid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       
		function deleteStockcal($stockcalid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from stockcal  where stockcalid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$stockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
       
       
		function deletePlanstockcal($stockcalid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from planstockcal  where stockcalid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$stockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
              
		function deleteActivitystockcal($atstockcalid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from activitystockcal  where atstockcalid  = ?";
       		$tmp="$atstockcalid";


  		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$atstockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        						
		function deletePlaymoneycal($calid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from playmoneycal  where calid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       

       function addB2cmoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex){

			$sql="INSERT b2cmoneycal (f_key,coupon_id,calmonth,calval,calcost,calsex) VALUES(?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex";

			$stmt->bind_param("iisiis", $f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   

       function setB2cmoneycal($f_key,$calval,$calcost,$calsex,$coupon_id,$calmonth){

       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update b2cmoneycal set  calval= ?,calcost= ?,calsex = ? where  coupon_id = ? and calmonth = ? and f_key = ?";
       		
       		$tmp="$calval,$calcost,$calsex,$coupon_id,$calmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisisi',$calval,$calcost,$calsex,$coupon_id,$calmonth,$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function addPlaymoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex){

			$sql="INSERT playmoneycal (f_key,coupon_id,calmonth,calval,calcost,calsex) VALUES(?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex";

			$stmt->bind_param("iisiis", $f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   


       function setPlaymoneycal($f_key,$calval,$calcost,$calsex,$coupon_id,$calmonth){


       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update playmoneycal set  calval= ?,calcost= ?,calsex = ? where  coupon_id = ? and calmonth = ? and f_key = ?";
       		
       		$tmp="$calval,$calcost,$calsex,$coupon_id,$calmonth,$f_key";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisisi',$calval,$calcost,$calsex,$coupon_id,$calmonth,$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   

       function addB2bmoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex){

			$sql="INSERT b2bmoneycal (f_key,coupon_id,calmonth,calval,calcost,calsex) VALUES(?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			
			$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex";

			$stmt->bind_param("iisiis", $f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex);
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
       
       function setB2bmoneycal($f_key,$calval,$calcost,$calsex,$coupon_id,$calmonth){

       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update b2bmoneycal set  calval= ?,calcost= ?,calsex = ? where  coupon_id = ? and calmonth = ? and f_key = ?";
       		
       		$tmp="$calval,$calcost,$calsex,$coupon_id,$calmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisisi',$calval,$calcost,$calsex,$coupon_id,$calmonth,$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
              
		function deleteB2cmoney($calid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from b2cmoneycal  where calid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
		function deleteB2bmoney($calid){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from b2bmoneycal  where calid  = ?";
       		$tmp="$calid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       function updateB2cmoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update b2cmoneycal set f_key = ? ,coupon_id = ? ,calmonth = ?, calval= ?,calcost= ?,calsex = ? where calid  = ?";
       		
       		$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisiisi',$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function updateReserveOkByRsvid($rsvid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update reserve set rsviscanceled = 0 where rsvid  = ?";
       		
       		$tmp="$rsvid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$rsvid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function updateReserveByRsvid($rsvid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update reserve set rsviscanceled = 1 where rsvid  = ?";
       		
       		$tmp="$rsvid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('i',$rsvid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updateBuyingFinalpointvalBybuyid($buyid,$pointval){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set finalpointval = finalpointval+? where buyid  = ?";
       		
       		$tmp="$pointval,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$pointval,$buyid);
			}
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   

       function updateBuyingb2bFinalpointvalBybuyid($buyid,$pointval){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set finalpointval = finalpointval+? where buyid  = ?";
       		
       		$tmp="$pointval,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$pointval,$buyid);
			}
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   


              
       function updateBuyingFinalmoneyvalBybuyid($finalmoney,$buyid){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set finalmoney = finalmoney-? where buyid  = ?";
       		
       		$tmp="$finalmoney,$buyid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$finalmoney,$buyid);
			}
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       function updateBuyingb2bFinalmoneyvalBybuyid($finalmoney,$buyid){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set finalmoney = finalmoney-? where buyid  = ?";
       		
       		$tmp="$finalmoney,$buyid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$finalmoney,$buyid);
			}
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       

       function updateBuyingb2bAllFields($buyid,$mdacode,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalmoneyday,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set 
       			mdacode			= ? , 
       			seller_id 		= ? , 
       			serialnum 		= ? , 
       			urlareaid 		= ? , 
       			area_id			= ? , 
       			caldate			= ? , 
       			period			= ? , 
       			finalmoney		= ? , 
       			finalmoneyday	= ? , 
       			finalpointval	= ? , 
       			delegatefist	= ? , 
       			delegatelast	= ? , 
       			delegatesex		= ? , 
       			delegateage		= ? , 
       			delegatetel		= ? , 
       			delegatemail	= ? , 
       			cancelflg		= ? , 
       			cancelday		= ? , 
       			cancelfee		= ? ,
       			memo			= ? 
       			
       			where buyid  = ?
       		
       		";
			if($cancelflg=="")
			{
	       		$sql = "update buyingb2b set 
	       			mdacode			= ? , 
	       			seller_id 		= ? , 
	       			serialnum 		= ? , 
	       			urlareaid 		= ? , 
	       			area_id			= ? , 
	       			caldate			= ? , 
	       			period			= ? , 
	       			finalmoney		= ? , 
	       			finalmoneyday	= ? , 
	       			finalpointval	= ? , 
	       			delegatefist	= ? , 
	       			delegatelast	= ? , 
	       			delegatesex		= ? , 
	       			delegateage		= ? , 
	       			delegatetel		= ? , 
	       			delegatemail	= ? , 
	       			cancelday		= ? , 
	       			cancelfee		= ? ,
       				memo			= ? 
	       			where buyid  = ?
	       		
	       		";
			}
			$finalmoneyday=$finalmoneyday==""?NULL:$finalmoneyday;
       		$caldate=$caldate==""?NULL:$caldate;
       		$cancelday=$cancelday==""?NULL:$cancelday;
       		
       		$tmp="$mdacode,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalmoneyday,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo,$buyid";


			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				
				if($cancelflg==""){
					$stmt->bind_param('sisiisiisissiisssssi',$mdacode,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalmoneyday,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelday,$cancelfee,$memo,$buyid);
				}else{
					$stmt->bind_param('sisiisiisissiississsi',$mdacode,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalmoneyday,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo,$buyid);			
				}	
				
			}
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       
              

       function updateBuyingAllFields($buyid,$mdacode,$affiliatecd,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo){
       
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set 
       			mdacode			= ? , 
       			affiliatecd		= ? , 
       			seller_id 		= ? , 
       			serialnum 		= ? , 
       			urlareaid 		= ? , 
       			area_id			= ? , 
       			caldate			= ? , 
       			period			= ? , 
       			finalmoney		= ? , 
       			
       			finalpointval	= ? , 
       			delegatefist	= ? , 
       			delegatelast	= ? , 
       			delegatesex		= ? , 
       			delegateage		= ? , 
       			delegatetel		= ? , 
       			delegatemail	= ? , 
       			cancelflg		= ? , 
       			cancelday		= ? , 
       			cancelfee		= ? ,
       			memo			= ?
       			where buyid  = ?
       		
       		";
       		
       		if($cancelflg==""){
	       		$sql = "update buying set 
	       			mdacode			= ? , 
	       			affiliatecd		= ? , 
	       			seller_id 		= ? , 
	       			serialnum 		= ? , 
	       			urlareaid 		= ? , 
	       			area_id			= ? , 
	       			caldate			= ? , 
	       			period			= ? , 
	       			finalmoney		= ? , 
	       			
	       			finalpointval	= ? , 
	       			delegatefist	= ? , 
	       			delegatelast	= ? , 
	       			delegatesex		= ? , 
	       			delegateage		= ? , 
	       			delegatetel		= ? , 
	       			delegatemail	= ? , 

	       			cancelday		= ? , 
	       			cancelfee		= ? , 
	       			memo			= ?
	       			
	       			where buyid  = ?
	       		
	       		";
       		}
			
			$finalmoneyday=$finalmoneyday==""?NULL:$finalmoneyday;
       		$caldate=$caldate==""?NULL:$caldate;
       		$cancelday=$cancelday==""?NULL:$cancelday;
       		
       		$tmp="$mdacode,$affiliatecd,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo,$buyid";
      		

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				if($cancelflg==""){


					$stmt->bind_param('ssisiisiiissiisssssi',$mdacode,$affiliatecd,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelday,$cancelfee,$memo,$buyid);

			
				}else{
				


					$stmt->bind_param('ssisiisiiissiississsi',$mdacode,$affiliatecd,$seller_id,$serialnum,$urlareaid,$area_id,$caldate,$period,$finalmoney,$finalpointval,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$cancelflg,$cancelday,$cancelfee,$memo,$buyid);
			
				}
				
			}
			
			
		
			
			
			$done = $stmt->execute();
		
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       
              
              
       function updateStockcalByActivitydetail_idStockcalmonth($activitydetail_id,$stockcalmonth,$stockvalval){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update stockcal set stockcalval = stockcalval+? where activitydetail_id  = ? and stockcalmonth = ?";
       		
       		$tmp="$stockvalval,$activitydetail_id,$stockcalmonth";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iis',$stockvalval,$activitydetail_id,$stockcalmonth);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updateStockcalByStockcalid($stockcalid,$stockcalmonth,$stockvalval,$stockisstop){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update stockcal set stockcalval = ?, stockcalmonth = ?, stockisstop = ? where stockcalid  = ? ";
       		
       		$tmp="$stockvalval,$stockcalmonth,$stockisstop,$stockcalid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('isii',$stockvalval,$stockcalmonth,$stockisstop,$stockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updatePlanstockcalByStockcalid($stockcalid,$stockcalmonth,$stockvalval,$stockisstop){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update planstockcal set stockcalval = ?, stockcalmonth = ?,stockisstop = ? where stockcalid  = ? ";
       		
       		$tmp="$stockvalval,$stockcalmonth,$stockisstop,$stockcalid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('isii',$stockvalval,$stockcalmonth,$stockisstop,$stockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updateCouponsArea_id($area_id,$couponid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update coupons set area_id = ? where couponid  = ?";
       		
       		$tmp="$area_id,$couponid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('ii',$area_id,$couponid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function updatePlaymoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update playmoneycal set f_key = ? ,coupon_id = ? ,calmonth = ?, calval= ?,calcost= ?,calsex = ? where calid  = ?";
       		
       		$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisiisi',$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
        
       function updateB2bmoneycal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update b2bmoneycal set f_key = ? ,coupon_id = ? ,calmonth = ?, calval= ?,calcost= ?,calsex = ? where calid  = ?";
       		
       		$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisiisi',$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }                        
       function updatePointcal($f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update pointcal set f_key = ? ,coupon_id = ? ,calmonth = ?, calval= ?,calcost= ?,calsex = ? where calid  = ?";
       		
       		$tmp="$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('iisiisi',$f_key,$coupon_id,$calmonth,$calval,$calcost,$calsex,$calid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }                
       
       function updateActivitystockcal($activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex,$atstockcalid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update activitystockcal set activitypoint_id = ? ,atstockcalmonth = ? ,atstockcalcost = ?, atstockcalval= ?,atstockcalsex= ? where atstockcalid  = ?";
       		
       		$tmp="$activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex,$atstockcalid";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param('isiisi',$activitypoint_id,$atstockcalmonth,$atstockcalcost,$atstockcalval,$atstockcalsex,$atstockcalid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }                
       
       function addCopnpoint($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$coupon_id){
			$sql="INSERT copnpoint (copntypename_jp,copntypename_en,copntypename_us,copntypename_cn,copntypename_tw,copntypename_kr,coupon_id) VALUES(?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ssssssi", $copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$coupon_id);
	
			$tmp="$copntypename";
			
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   

       function addActivitypoint($activitypointname_jp,$activitypointname_en,$activitypointname_us,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$activitydetail_id){
			$sql="INSERT activitypoint (activitypointname_jp,activitypointname_en,activitypointname_us,activitypointname_cn,activitypointname_tw,activitypointname_kr,activitydetail_id) VALUES(?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param("ssssssi", $activitypointname_jp,$activitypointname_en,$activitypointname_us,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$activitydetail_id);
	
			$tmp="$copntypename";
			
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
                              
       function updateCopnpoint($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpointid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update copnpoint set copntypename_jp = ? ,copntypename_en = ? ,copntypename_us = ? ,copntypename_cn = ? ,copntypename_tw = ? ,copntypename_kr = ?  where copnpointid  = ?";
       		
       		$tmp="$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpointid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssssssi',$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpointid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }     
       
                              
       function updateActivitypoint($activitypointname_jp,$activitypointname_en,$activitypointname_us,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$activitydetail_id){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update activitypoint set activitypointname_jp = ? ,activitypointname_en = ?  ,activitypointname_us = ? ,activitypointname_cn = ? ,activitypointname_tw = ? ,activitypointname_kr = ?  where activitypointid   = ?";
       		
       		$tmp="$activitypointname_jp,$activitypointname_en,$activitypointname_us,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$activitydetail_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssssssi',$activitypointname_jp,$activitypointname_en,$activitypointname_us,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$activitydetail_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
            
       function addCopnb2cmoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id){

			$sql="INSERT copnb2cmoney (copnb2cmname_jp,copnb2cmname_en,copnb2cmname_us,copnb2cmname_cn,copnb2cmname_tw,copnb2cmname_kr,copnpoint_id,coupon_id) VALUES(?,?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			$tmp="$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id";
				
			$stmt->bind_param("ssssssii",$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id);
		
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   

       function updateCopnb2cmoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$copnb2cmid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update copnb2cmoney set copnb2cmname_jp = ?, copnb2cmname_en = ?,copnb2cmname_us = ?, copnb2cmname_cn = ?, copnb2cmname_tw = ?, copnb2cmname_kr = ?, copnpoint_id = ? where copnb2cmid  = ?";
       		
       		$tmp="$copntypename_jp,$copntypename_en,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$copnb2cmid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssssssii',$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$copnb2cmid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       

       function addPlaymoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$play_id){
			$sql="INSERT playmoney (playmoneytype_jp,playmoneytype_en,playmoneytype_us,playmoneytype_cn,playmoneytype_tw,playmoneytype_kr,play_id) VALUES(?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			
			$tmp="$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$play_id";
		
			
			$stmt->bind_param("ssssssi", $copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$play_id);
			
			
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }         
       function updatePlaymoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$playmoneyid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update playmoney set playmoneytype_jp = ?, playmoneytype_en = ?,  playmoneytype_us = ?, playmoneytype_cn = ?, playmoneytype_tw = ?, playmoneytype_kr = ?  where playmoneyid  = ?";
       		
       		$tmp="$playmoneytype,$playmoneyid";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssssssi',$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$playmoneyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function addCopnb2bmoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id){
			$sql="INSERT copnb2bmoney (copnb2bmname_jp,copnb2bmname_en,copnb2bmname_us,copnb2bmname_cn,copnb2bmname_tw,copnb2bmname_kr,copnpoint_id,coupon_id) VALUES(?,?,?,?,?,?,?,?)";
			
			$tmp="$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id";

			
			$stmt =$this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->bind_param("ssssssii",$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$coupon_id);
			
			
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
		   
			       return mysqli_insert_id($this->link);
			   }else{
		   
			       return -1;
			}
       }   

              

       function updateCopnb2bmoney($copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$copnb2bmid){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update copnb2bmoney set copnb2bmname_jp = ?, copnb2bmname_en = ?, copnb2bmname_us = ?, copnb2bmname_cn = ?, copnb2bmname_tw = ?, copnb2bmname_kr = ?, copnpoint_id = ? where copnb2bmid  = ?";
       		
       		$tmp="$copntypename_jp,$copntypename_en,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssssssii',$copntypename_jp,$copntypename_en,$copntypename_us,$copntypename_cn,$copntypename_tw,$copntypename_kr,$copnpoint_id,$copnb2bmid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
           
           
       function updateActivitydetail4picByActivitydetailid(
       
			$activitydetailid,
			$activitydetailimg1,
			$activitydetailimg2,
			$activitydetailimg3,
			$activitydetailimg4,     
			$activitydetailimgcp1_jp,
			$activitydetailimgcp1_en,
			$activitydetailimgcp1_cn,
			$activitydetailimgcp1_tw,
			$activitydetailimgcp1_kr,
			$activitydetailimgcp2_jp,
			$activitydetailimgcp2_en,
			$activitydetailimgcp2_cn,
			$activitydetailimgcp2_tw,
			$activitydetailimgcp2_kr,
			$activitydetailimgcp3_jp,
			$activitydetailimgcp3_en,
			$activitydetailimgcp3_cn,
			$activitydetailimgcp3_tw,
			$activitydetailimgcp3_kr,
			$activitydetailimgcp4_jp,
			$activitydetailimgcp4_en,
			$activitydetailimgcp4_cn,
			$activitydetailimgcp4_tw,
			$activitydetailimgcp4_kr 
       
       ){
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update activitydetail set 

				activitydetailimg1				=TRIM(?),		
				activitydetailimg2	       		=TRIM(?),		
				activitydetailimg3	       		=TRIM(?),			
				activitydetailimg4	       		=TRIM(?),		
				activitydetailimgcp1_jp       	=TRIM(?),	
				activitydetailimgcp1_en       	=TRIM(?),	
				activitydetailimgcp1_cn       	=TRIM(?),	
				activitydetailimgcp1_tw       	=TRIM(?),	
				activitydetailimgcp1_kr       	=TRIM(?),	
				activitydetailimgcp2_jp       	=TRIM(?),	
				activitydetailimgcp2_en       	=TRIM(?),	
				activitydetailimgcp2_cn       	=TRIM(?),	
				activitydetailimgcp2_tw       	=TRIM(?),	
				activitydetailimgcp2_kr       	=TRIM(?),	
				activitydetailimgcp3_jp       	=TRIM(?),	
				activitydetailimgcp3_en       	=TRIM(?),	
				activitydetailimgcp3_cn       	=TRIM(?),	
				activitydetailimgcp3_tw       	=TRIM(?),	
				activitydetailimgcp3_kr       	=TRIM(?),	
				activitydetailimgcp4_jp       	=TRIM(?),	
				activitydetailimgcp4_en       	=TRIM(?),	
				activitydetailimgcp4_cn       	=TRIM(?),	
				activitydetailimgcp4_tw       	=TRIM(?),	
				activitydetailimgcp4_kr       	=TRIM(?)
       		
       			where activitydetailid  		= ?";
       		
       		$tmp="
				$activitydetailimg1,
				$activitydetailimg2,
				$activitydetailimg3,
				$activitydetailimg4,     
				$activitydetailimgcp1_jp,
				$activitydetailimgcp1_en,
				$activitydetailimgcp1_cn,
				$activitydetailimgcp1_tw,
				$activitydetailimgcp1_kr,
				$activitydetailimgcp2_jp,
				$activitydetailimgcp2_en,
				$activitydetailimgcp2_cn,
				$activitydetailimgcp2_tw,
				$activitydetailimgcp2_kr,
				$activitydetailimgcp3_jp,
				$activitydetailimgcp3_en,
				$activitydetailimgcp3_cn,
				$activitydetailimgcp3_tw,
				$activitydetailimgcp3_kr,
				$activitydetailimgcp4_jp,
				$activitydetailimgcp4_en,
				$activitydetailimgcp4_cn,
				$activitydetailimgcp4_tw,
				$activitydetailimgcp4_kr,
				$activitydetailid				
       		
       		";

			$stmt =$this->link->prepare($sql);
		
			if($stmt){
				$stmt->bind_param(
					'ssssssssssssssssssssssssi',
					$activitydetailimg1,
					$activitydetailimg2,
					$activitydetailimg3,
					$activitydetailimg4,     
					$activitydetailimgcp1_jp,
					$activitydetailimgcp1_en,
					$activitydetailimgcp1_cn,
					$activitydetailimgcp1_tw,
					$activitydetailimgcp1_kr,
					$activitydetailimgcp2_jp,
					$activitydetailimgcp2_en,
					$activitydetailimgcp2_cn,
					$activitydetailimgcp2_tw,
					$activitydetailimgcp2_kr,
					$activitydetailimgcp3_jp,
					$activitydetailimgcp3_en,
					$activitydetailimgcp3_cn,
					$activitydetailimgcp3_tw,
					$activitydetailimgcp3_kr,
					$activitydetailimgcp4_jp,
					$activitydetailimgcp4_en,
					$activitydetailimgcp4_cn,
					$activitydetailimgcp4_tw,
					$activitydetailimgcp4_kr,
					$activitydetailid
				
				);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
           
           
           
       function deletePlaymoney($playmoneyid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from playmoney  where playmoneyid  = ?";
       		$tmp="$playmoneyid";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$playmoneyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
       function deletePlaymoneycalsByf_key($f_key){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from playmoneycal  where f_key  = ?";
       		$tmp="$f_key";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  
                                  
       function deleteCopnpoint($copnpointid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from copnpoint  where copnpointid  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$copnpointid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function deleteActivitypoint($activitypointid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from activitypoint  where activitypointid  = ?";
       		$tmp="$activitypointid";
      		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitypointid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       function deletePointcalByf_key($f_key){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from pointcal  where f_key  = ?";
       		$tmp="$f_key";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
       
       function deleteActivitystockcalByf_key($activitypoint_id){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from activitystockcal  where activitypoint_id  = ?";
       		$tmp="$activitypoint_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitypoint_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }    
              
       function deleteCopnb2cmoney($copnb2cmid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from copnb2cmoney  where copnb2cmid  = ?";
       		$tmp="$copnb2cmid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$copnb2cmid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }        
       
       function deleteCopnb2cmoneysByF_key($f_key){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from b2cmoneycal  where f_key  = ?";
       		$tmp="$f_key";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }           
       
       
       function deleteCopnb2bmoney($copnb2bmid){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from copnb2bmoney  where copnb2bmid  = ?";
       		$tmp="$copnb2cmid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$copnb2bmid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }   
       
       function deleteCopnb2bmoneysByF_key($f_key){
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from b2bmoneycal  where f_key  = ?";
       		$tmp="$f_key";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$f_key);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  

                     
       function addCancel(
       $coupon_id,
       $cancelfrom,
       $cancelto,
       $cancelfromtitle_jp,
       $cancelfromtitle_en,
       $cancelfromtitle_cn,
       $cancelfromtitle_tw,
       $cancelfromtitle_kr,
       $canceltotitle_jp,
       $canceltotitle_en,
       $canceltotitle_cn,
       $canceltotitle_tw,
       $canceltotitle_kr,
       $cancelmoney,
       $cancelpercent
       ){
			$sql="INSERT cancel (
			coupon_id,
			cancelfrom,
			cancelto,
			cancelfromtitle_jp,
			cancelfromtitle_en,
			cancelfromtitle_cn,
			cancelfromtitle_tw,
			cancelfromtitle_kr,
			canceltotitle_jp,
			canceltotitle_en,
			canceltotitle_cn,
			canceltotitle_tw,
			canceltotitle_kr,
			cancelmoney,
			cancelpercent
			) VALUES(
			?,?,?,?,?,?,?,?,?,?,?,?,?,?,?
			)";
			$stmt =$this->link->prepare($sql);

			$tmp="
			$coupon_id,
			$cancelfrom,
			$cancelto,
			$cancelfromtitle_jp,
			$cancelfromtitle_en,
			$cancelfromtitle_cn,
			$cancelfromtitle_tw,
			$cancelfromtitle_kr,
			$canceltotitle_jp,
			$canceltotitle_en,
			$canceltotitle_cn,
			$canceltotitle_tw,
			$canceltotitle_kr,
			$cancelmoney,
			$cancelpercent
			";
			
		
			$stmt->bind_param("issssssssssssss", 
			$coupon_id,
			$cancelfrom,
			$cancelto,
			$cancelfromtitle_jp,
			$cancelfromtitle_en,
			$cancelfromtitle_cn,
			$cancelfromtitle_tw,
			$cancelfromtitle_kr,
			$canceltotitle_jp,
			$canceltotitle_en,
			$canceltotitle_cn,
			$canceltotitle_tw,
			$canceltotitle_kr,
			$cancelmoney,
			$cancelpercent
			);

					
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }   
       
                     
       function addActivitycancell(
	       $activitydetail_id,
	       $cancelfrom,
	       $cancelto,
	       $cancelfromtitle_jp,
	       $cancelfromtitle_en,
	       $cancelfromtitle_cn,
	       $cancelfromtitle_tw,
	       $cancelfromtitle_kr,
	       $canceltotitle_jp,
	       $canceltotitle_en,
	       $canceltotitle_cn,
	       $canceltotitle_tw,
	       $canceltotitle_kr,
	       $cancelmoney,
	       $cancelpercent
       ){
       		if($activitydetail_id>0){
       			
				$sql="INSERT activitycancel (
				activitydetail_id,
				cancelfrom,
				cancelto,
				cancelfromtitle_jp,
				cancelfromtitle_en,
				cancelfromtitle_cn,
				cancelfromtitle_tw,
				cancelfromtitle_kr,
				canceltotitle_jp,
				canceltotitle_en,
				canceltotitle_cn,
				canceltotitle_tw,
				canceltotitle_kr,
				cancelmoney,
				cancelpercent
				) VALUES(
				?,?,?,?,?,?,?,?,?,?,?,?,?,?,?
				)";
				$stmt =$this->link->prepare($sql);

				$tmp="
				$activitydetail_id,
				$cancelfrom,
				$cancelto,
				$cancelfromtitle_jp,
				$cancelfromtitle_en,
				$cancelfromtitle_cn,
				$cancelfromtitle_tw,
				$cancelfromtitle_kr,
				$canceltotitle_jp,
				$canceltotitle_en,
				$canceltotitle_cn,
				$canceltotitle_tw,
				$canceltotitle_kr,
				$cancelmoney,
				$cancelpercent
				";
				


				$stmt->bind_param("issssssssssssss", 
				$activitydetail_id,
				$cancelfrom,
				$cancelto,
				$cancelfromtitle_jp,
				$cancelfromtitle_en,
				$cancelfromtitle_cn,
				$cancelfromtitle_tw,
				$cancelfromtitle_kr,
				$canceltotitle_jp,
				$canceltotitle_en,
				$canceltotitle_cn,
				$canceltotitle_tw,
				$canceltotitle_kr,
				$cancelmoney,
				$cancelpercent
				);
					
				$stmt->execute();
				if($stmt->affected_rows > 0){ //
				       return mysqli_insert_id($this->link);
				   }else{
				       return -1;
				}
       			
       		}
       		return 0;//この値は無視する意味

       }   
       
              
		function deleteCancelByCoupon_id($coupon_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from cancel  where coupon_id  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
		function deleteActivitycancelByCoupon_id($activitydetail_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from activitycancel  where activitydetail_id  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }                     
       function addAgents($coupon_id,$company_id){
			$sql="INSERT INTO agents (coupon_id,company_id) VALUES(?,?)";
			$tmp="$coupon_id,$company_id";
	
			
			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ii", $coupon_id,$company_id);
			
	
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }    
       
		function deleteAgentByCoupon_id($coupon_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from agents  where coupon_id  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
       function addFacility($coupon_id,$play_id){
			$sql="INSERT INTO facility (coupon_id,play_id) VALUES(?,?)";
			$tmp="$coupon_id,$play_id";
		

			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ii", $coupon_id,$play_id);
			$tmp="$coupon_id,$company_id";
					
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }        

       function addMenus($coupon_id,$activitymain_id){
			$sql="INSERT INTO menus (coupon_id,activitymain_id) VALUES(?,?)";
			$tmp="$coupon_id,$play_id";
		

			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ii", $coupon_id,$activitymain_id);
			$tmp="$coupon_id,$activitymain_id";
					
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }        
       
              
		function deleteFacilityByCoupon_id($coupon_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from facility  where coupon_id  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }    
       
		function deleteMenusByCoupon_id($coupon_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from menus  where coupon_id  = ?";
       		$tmp="$coupon_id";
       		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       }  
                 
		function upgrade($id,$item_name){

	       		$sellerupdatedate=date('Y-m-d');
	       		$sql = "update coupons set item_name = ? where id  = ?";
	       		
	       		$tmp="$item_name,$id";
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('si',$item_name,$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}

		
		}	
		

       function insertCoupons(
			$couponcd,
			$area_id,
			$couponname_jp,
			$couponname_en,
			$couponname_cn,
			$couponname_tw,
			$couponname_kr,
			$couponstart,
			$couponend,
			$couponinterval,
			$couponclosedupd,
			$couponclosedupt,			
			$couponheldcompany_jp,
			$couponheldcompany_en,
			$couponheldcompany_cn,
			$couponheldcompany_tw,
			$couponheldcompany_kr,
			$couponpic,
			$couponcomment_jp,
			$couponcomment_en,
			$couponcomment_cn,
			$couponcomment_tw,
			$couponcomment_kr,
			$coupontype,
			$dissign_id,
			$jplangflg,
			$enlangflg,
			$cnlangflg,
			$twlangflg,
			$krlangflg,				
			$couponcreater
       ){
       		
       		$sql="INSERT INTO coupons (
       			couponcd,
       			area_id,
       			couponname_jp,
       			couponname_en,
       			couponname_cn,
       			couponname_tw,
       			couponname_kr,
       			couponstart,
       			couponend,
       			couponinterval,
				couponclosedupd,
				couponclosedupt,       			
       			couponheldcompany_jp,
       			couponheldcompany_en,
       			couponheldcompany_cn,
       			couponheldcompany_tw,
       			couponheldcompany_kr,
       			couponpic,
       			couponcomment_jp,
       			couponcomment_en,
       			couponcomment_cn,
       			couponcomment_tw,
       			couponcomment_kr,
       			coupontype,
       			dissign_id,
				jplangflg,
				enlangflg,
				cnlangflg,
				twlangflg,
				krlangflg,	
       			couponcreater
       			)
       		    VALUES(?,?,?,?,?,?,?,TRIM(?),TRIM(?),?,TRIM(?),TRIM(?),?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
       		
       		$tmp="
				$couponcd,
				$area_id,
				$couponname_jp,
				$couponname_en,
				$couponname_cn,
				$couponname_tw,
				$couponname_kr,
				$couponstart,
				$couponend,
				$couponinterval,
				$couponclosedupd,
				$couponclosedupt,				
				$couponheldcompany_jp,
				$couponheldcompany_en,
				$couponheldcompany_cn,
				$couponheldcompany_tw,
				$couponheldcompany_kr,
				$couponpic,
				$couponcomment_jp,
				$couponcomment_en,
				$couponcomment_cn,
				$couponcomment_tw,
				$couponcomment_kr,
				$coupontype,
				$dissign_id,
				$jplangflg,
				$enlangflg,
				$cnlangflg,
				$twlangflg,
				$krlangflg,						
				$couponcreater
       		";

       		
			$stmt =$this->link->prepare($sql);
			$stmt->bind_param(
				"sisssssssisssssssssssssiiiiiiii",
				$couponcd,
				$area_id,
				$couponname_jp,
				$couponname_en,
				$couponname_cn,
				$couponname_tw,
				$couponname_kr,
				$couponstart,
				$couponend,
				$couponinterval,
				$couponclosedupd,
				$couponclosedupt,
				$couponheldcompany_jp,
				$couponheldcompany_en,
				$couponheldcompany_cn,
				$couponheldcompany_tw,
				$couponheldcompany_kr,
				$couponpic,
				$couponcomment_jp,
				$couponcomment_en,
				$couponcomment_cn,
				$couponcomment_tw,
				$couponcomment_kr,
				$coupontype,
				$dissign_id,
				$jplangflg,
				$enlangflg,
				$cnlangflg,
				$twlangflg,
				$krlangflg,		
				$couponcreater
			);

			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			}else{
			       return -1;
			}
			
       } 




       function insertActivitydetail(
       		$userid,
			$activitydetailseqcd,
			$activitymain_id,
			$activitydetailcrscd,
			$activitydetailcrs_jp,
			$activitydetailcrs_en,
			$activitydetailcrs_cn,
			$activitydetailcrs_tw,
			$activitydetailcrs_kr,
			$activitydetailfrom,
			$activitydetailto,
			$activitydetailperiod,
			$activitydetailschdtal_jp,
			$activitydetailschdtal_en,
			$activitydetailschdtal_cn,
			$activitydetailschdtal_tw,
			$activitydetailschdtal_kr,
			$activitydetailinstrct_jp,
			$activitydetailinstrct_en,
			$activitydetailinstrct_cn,
			$activitydetailinstrct_tw,
			$activitydetailinstrct_kr,
			$activitydetailfarcont_jp,
			$activitydetailfarcont_en,
			$activitydetailfarcont_cn,
			$activitydetailfarcont_tw,
			$activitydetailfarcont_kr,				
			$activitydetailmetplc_jp,
			$activitydetailmetplc_en,
			$activitydetailmetplc_cn,
			$activitydetailmetplc_tw,
			$activitydetailmetplc_kr,
			$activitydetaillat,
			$activitydetaillon,
			$activitydetailmettime,
			$activitydetailmettime_en,
			$activitydetailmettime_cn,
			$activitydetailmettime_tw,
			$activitydetailmettime_kr,
			$activitydetailmininum,
			$activitydetailminpar,
			$activitydetailmaxpar,
			$activitydetailtejmaid,
			$activitydetailtejmait,
			$activitydetailsttjmid,
			$activitydetailsttjmit,
			$activitydetailmov_jp,
			$activitydetailmov_en,
			$activitydetailmov_cn,
			$activitydetailmov_tw,
			$activitydetailmov_kr,
			$activitydetailmovcmt_jp,
			$activitydetailmovcmt_en,
			$activitydetailmovcmt_cn,
			$activitydetailmovcmt_tw,
			$activitydetailmovcmt_kr,
			$question_jp,
			$question_en,
			$question_cn,
			$question_tw,
			$question_kr,			
			$activitydetailmovurl,
			$activitydetailreqtime,
			$activitydetailstartage,
			$activitydetailendage
       ){
       		
       		$sql="INSERT INTO activitydetail (
					activitydetailseqcd,
					activitymain_id,
					activitydetailcrscd,
					activitydetailcrs_jp,
					activitydetailcrs_en,
					activitydetailcrs_cn,
					activitydetailcrs_tw,
					activitydetailcrs_kr,
					activitydetailfrom,
					activitydetailto,
					activitydetailperiod,
					activitydetailschdtal_jp,
					activitydetailschdtal_en,
					activitydetailschdtal_cn,
					activitydetailschdtal_tw,
					activitydetailschdtal_kr,					
					activitydetailinstrct_jp,
					activitydetailinstrct_en,
					activitydetailinstrct_cn,
					activitydetailinstrct_tw,
					activitydetailinstrct_kr,
					activitydetailfarcont_jp,
					activitydetailfarcont_en,
					activitydetailfarcont_cn,
					activitydetailfarcont_tw,
					activitydetailfarcont_kr,
					activitydetailmetplc_jp,
					activitydetailmetplc_en,
					activitydetailmetplc_cn,
					activitydetailmetplc_tw,
					activitydetailmetplc_kr,
					activitydetaillat,
					activitydetaillon,
					activitydetailmettime,
					activitydetailmettime_en,
					activitydetailmettime_cn,
					activitydetailmettime_tw,
					activitydetailmettime_kr,
					activitydetailmininum,
					activitydetailminpar,
					activitydetailmaxpar,
					activitydetailtejmaid,
					activitydetailtejmait,
					activitydetailsttjmid,
					activitydetailsttjmit,
					activitydetailmov_jp,
					activitydetailmov_en,
					activitydetailmov_cn,
					activitydetailmov_tw,
					activitydetailmov_kr,
					activitydetailmovcmt_jp,
					activitydetailmovcmt_en,
					activitydetailmovcmt_cn,
					activitydetailmovcmt_tw,
					activitydetailmovcmt_kr,
					question_jp,
					question_en,
					question_cn,
					question_tw,
					question_kr,					
					activitydetailmovurl,
					activitydetailreqtime,
					activitydetailstartage,
					activitydetailendage																				

       			)
       		    VALUES(
       		    TRIM(?),
       		    ?,
       		    TRIM(?),
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
       		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,

 		    ?,
 		    ?,
 		    ?,
 		    ?,

 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ?,
 		    ? 		           		           		           		           		    
       		    
)";
       		
       		$tmp="
				$activitydetailseqcd,
				$activitymain_id,
				$activitydetailcrscd,
				$activitydetailcrs_jp,
				$activitydetailcrs_en,
				$activitydetailcrs_cn,
				$activitydetailcrs_tw,
				$activitydetailcrs_kr,
				$activitydetailfrom,
				$activitydetailto,
				$activitydetailperiod,
				$activitydetailschdtal_jp,
				$activitydetailschdtal_en,
				$activitydetailschdtal_cn,
				$activitydetailschdtal_tw,
				$activitydetailschdtal_kr,
				$activitydetailinstrct_jp,
				$activitydetailinstrct_en,
				$activitydetailinstrct_cn,
				$activitydetailinstrct_tw,
				$activitydetailinstrct_kr,
				$activitydetailfarcont_jp,
				$activitydetailfarcont_en,
				$activitydetailfarcont_cn,
				$activitydetailfarcont_tw,
				$activitydetailfarcont_kr,
				$activitydetailmetplc_jp,
				$activitydetailmetplc_en,
				$activitydetailmetplc_cn,
				$activitydetailmetplc_tw,
				$activitydetailmetplc_kr,
				$activitydetaillat,
				$activitydetaillon,
				$activitydetailmettime,
				
				$activitydetailmininum,
				$activitydetailminpar,
				$activitydetailmaxpar,
				$activitydetailtejmaid,
				$activitydetailtejmait,
				$activitydetailsttjmid,
				$activitydetailsttjmit,
				$activitydetailmov_jp,
				$activitydetailmov_en,
				$activitydetailmov_cn,
				$activitydetailmov_tw,
				$activitydetailmov_kr,
				$activitydetailmovcmt_jp,
				$activitydetailmovcmt_en,
				$activitydetailmovcmt_cn,
				$activitydetailmovcmt_tw,
				$activitydetailmovcmt_kr,
			$question_jp,
			$question_en,
			$question_cn,
			$question_tw,
			$question_kr,					
				$activitydetailmovurl,
				$activitydetailreqtime,
				$activitydetailstartage,
				$activitydetailendage			
       		";


       		
			$stmt =$this->link->prepare($sql);
		
			$stmt->bind_param(
				"sissssssssisssssssssssssssssssssssssssissssssssssssssssssssssiii",
				$activitydetailseqcd,
				$activitymain_id,
				$activitydetailcrscd,
				$activitydetailcrs_jp,
				$activitydetailcrs_en,
				$activitydetailcrs_cn,
				$activitydetailcrs_tw,
				$activitydetailcrs_kr,
				$activitydetailfrom,
				$activitydetailto,
				$activitydetailperiod,
				$activitydetailschdtal_jp,
				$activitydetailschdtal_en,
				$activitydetailschdtal_cn,
				$activitydetailschdtal_tw,
				$activitydetailschdtal_kr,
				$activitydetailinstrct_jp,
				$activitydetailinstrct_en,
				$activitydetailinstrct_cn,
				$activitydetailinstrct_tw,
				$activitydetailinstrct_kr,
				$activitydetailfarcont_jp,
				$activitydetailfarcont_en,
				$activitydetailfarcont_cn,
				$activitydetailfarcont_tw,
				$activitydetailfarcont_kr,
				$activitydetailmetplc_jp,
				$activitydetailmetplc_en,
				$activitydetailmetplc_cn,
				$activitydetailmetplc_tw,
				$activitydetailmetplc_kr,
				$activitydetaillat,
				$activitydetaillon,
				$activitydetailmettime,
				$activitydetailmettime_en,
				$activitydetailmettime_cn,
				$activitydetailmettime_tw,
				$activitydetailmettime_kr,
				$activitydetailmininum,
				$activitydetailminpar,
				$activitydetailmaxpar,
				$activitydetailtejmaid,
				$activitydetailtejmait,
				$activitydetailsttjmid,
				$activitydetailsttjmit,
				$activitydetailmov_jp,
				$activitydetailmov_en,
				$activitydetailmov_cn,
				$activitydetailmov_tw,
				$activitydetailmov_kr,
				$activitydetailmovcmt_jp,
				$activitydetailmovcmt_en,
				$activitydetailmovcmt_cn,
				$activitydetailmovcmt_tw,
				$activitydetailmovcmt_kr,
			$question_jp,
			$question_en,
			$question_cn,
			$question_tw,
			$question_kr,					
				$activitydetailmovurl,
				$activitydetailreqtime,
				$activitydetailstartage,
				$activitydetailendage
			);


			$stmt->execute();



			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			}else{

				print_r($stmt);		
			    return -1;
			}
			
       } 
       

		function updateActivitydetail(
		
       		$userid,
       		$activitydetailid,
			$activitydetailseqcd,
			$activitymain_id,
			$activitydetailcrscd,
			$activitydetailcrs_jp,
			$activitydetailcrs_en,
			$activitydetailcrs_cn,
			$activitydetailcrs_tw,
			$activitydetailcrs_kr,
			$activitydetailfrom,
			$activitydetailto,
			$activitydetailperiod,
			$activitydetailschdtal_jp,
			$activitydetailschdtal_en,
			$activitydetailschdtal_cn,
			$activitydetailschdtal_tw,
			$activitydetailschdtal_kr,
			$activitydetailinstrct_jp,
			$activitydetailinstrct_en,
			$activitydetailinstrct_cn,
			$activitydetailinstrct_tw,
			$activitydetailinstrct_kr,
			$activitydetailfarcont_jp,
			$activitydetailfarcont_en,
			$activitydetailfarcont_cn,
			$activitydetailfarcont_tw,
			$activitydetailfarcont_kr,				
			$activitydetailmetplc_jp,
			$activitydetailmetplc_en,
			$activitydetailmetplc_cn,
			$activitydetailmetplc_tw,
			$activitydetailmetplc_kr,
			$activitydetaillat,
			$activitydetaillon,
			$activitydetailmettime,
			$activitydetailmettime_en,
			$activitydetailmettime_cn,
			$activitydetailmettime_tw,
			$activitydetailmettime_kr,
			$activitydetailmininum,
			$activitydetailminpar,
			$activitydetailmaxpar,
			$activitydetailtejmaid,
			$activitydetailtejmait,
			$activitydetailsttjmid,
			$activitydetailsttjmit,
			$activitydetailmov_jp,
			$activitydetailmov_en,
			$activitydetailmov_cn,
			$activitydetailmov_tw,
			$activitydetailmov_kr,
			$activitydetailmovcmt_jp,
			$activitydetailmovcmt_en,
			$activitydetailmovcmt_cn,
			$activitydetailmovcmt_tw,
			$activitydetailmovcmt_kr,
			
			$question_jp,
			$question_en,
			$question_cn,
			$question_tw,
			$question_kr,
			
			$activitydetailmovurl,
			$activitydetailreqtime,
			$activitydetailstartage,
			$activitydetailendage
		
		){


	       		$couponupdate=date('Y-m-d');
	       		
	       		$sql = "update activitydetail set 
						activitydetailseqcd			=TRIM(?),
						activitymain_id				=TRIM(?),
						activitydetailcrscd			=TRIM(?),
						activitydetailcrs_jp		=TRIM(?),
						activitydetailcrs_en		=TRIM(?),
						activitydetailcrs_cn		=TRIM(?),
						activitydetailcrs_tw		=TRIM(?),
						activitydetailcrs_kr		=TRIM(?),
						activitydetailfrom			=TRIM(?),
						activitydetailto			=TRIM(?),
						activitydetailperiod		=TRIM(?),
						activitydetailschdtal_jp	=TRIM(?),
						activitydetailschdtal_en	=TRIM(?),
						activitydetailschdtal_cn	=TRIM(?),
						activitydetailschdtal_tw	=TRIM(?),
						activitydetailschdtal_kr	=TRIM(?),
						activitydetailinstrct_jp	=TRIM(?),
						activitydetailinstrct_en	=TRIM(?),
						activitydetailinstrct_cn	=TRIM(?),
						activitydetailinstrct_tw	=TRIM(?),
						activitydetailinstrct_kr	=TRIM(?),
						activitydetailfarcont_jp	=TRIM(?),
						activitydetailfarcont_en	=TRIM(?),
						activitydetailfarcont_cn	=TRIM(?),
						activitydetailfarcont_tw	=TRIM(?),
						activitydetailfarcont_kr	=TRIM(?),
						activitydetailmetplc_jp		=TRIM(?),
						activitydetailmetplc_en		=TRIM(?),
						activitydetailmetplc_cn		=TRIM(?),
						activitydetailmetplc_tw		=TRIM(?),
						activitydetailmetplc_kr		=TRIM(?),
						activitydetaillat			=TRIM(?),
						activitydetaillon			=TRIM(?),
						activitydetailmettime		=TRIM(?),
						activitydetailmettime_en		=TRIM(?),
						activitydetailmettime_cn		=TRIM(?),
						activitydetailmettime_tw		=TRIM(?),
						activitydetailmettime_kr		=TRIM(?),
						
						activitydetailmininum		=TRIM(?),
						activitydetailminpar		=TRIM(?),
						activitydetailmaxpar		=TRIM(?),
						activitydetailtejmaid		=TRIM(?),
						activitydetailtejmait		=TRIM(?),
						activitydetailsttjmid		=TRIM(?),
						activitydetailsttjmit		=TRIM(?),
						activitydetailmov_jp		=TRIM(?),
						activitydetailmov_en		=TRIM(?),
						activitydetailmov_cn		=TRIM(?),
						activitydetailmov_tw		=TRIM(?),
						activitydetailmov_kr		=TRIM(?),
						activitydetailmovcmt_jp		=TRIM(?),
						activitydetailmovcmt_en		=TRIM(?),
						activitydetailmovcmt_cn		=TRIM(?),
						activitydetailmovcmt_tw		=TRIM(?),
						activitydetailmovcmt_kr		=TRIM(?),
						
						question_jp					=TRIM(?),
						question_en					=TRIM(?),
						question_cn					=TRIM(?),
						question_tw					=TRIM(?),
						question_kr					=TRIM(?),
						
						activitydetailmovurl		=TRIM(?),
						activitydetailreqtime 		=TRIM(?),
						activitydetailstartage 		=TRIM(?),
						activitydetailendage 		=TRIM(?)
						
		       		where 
		       			activitydetailid  =?
	       		
	       		";
	       		$tmp="
					$activitydetailseqcd,
					$activitymain_id,
					$activitydetailcrscd,
					$activitydetailcrs_jp,
					$activitydetailcrs_en,
					$activitydetailcrs_cn,
					$activitydetailcrs_tw,
					$activitydetailcrs_kr,
					$activitydetailfrom,
					$activitydetailto,
					$activitydetailperiod,
					$activitydetailschdtal_jp,
					$activitydetailschdtal_en,
					$activitydetailschdtal_cn,
					$activitydetailschdtal_tw,
					$activitydetailschdtal_kr,
					$activitydetailinstrct_jp,
					$activitydetailinstrct_en,
					$activitydetailinstrct_cn,
					$activitydetailinstrct_tw,
					$activitydetailinstrct_kr,
					$activitydetailfarcont_jp,
					$activitydetailfarcont_en,
					$activitydetailfarcont_cn,
					$activitydetailfarcont_tw,
					$activitydetailfarcont_kr,				
					$activitydetailmetplc_jp,
					$activitydetailmetplc_en,
					$activitydetailmetplc_cn,
					$activitydetailmetplc_tw,
					$activitydetailmetplc_kr,
					$activitydetaillat,
					$activitydetaillon,
					$activitydetailmettime,
					$activitydetailmininum,
					$activitydetailminpar,
					$activitydetailmaxpar,
					$activitydetailtejmaid,
					$activitydetailtejmait,
					$activitydetailsttjmid,
					$activitydetailsttjmit,
					$activitydetailmov_jp,
					$activitydetailmov_en,
					$activitydetailmov_cn,
					$activitydetailmov_tw,
					$activitydetailmov_kr,
					$activitydetailmovcmt_jp,
					$activitydetailmovcmt_en,
					$activitydetailmovcmt_cn,
					$activitydetailmovcmt_tw,
					$activitydetailmovcmt_kr,
					$question_jp,
					$question_en,
					$question_cn,
					$question_tw,
					$question_kr,
					$activitydetailmovurl,
					$activitydetailreqtime,
					$activitydetailstartage,
					$activitydetailendage,					
					$activitydetailid
	       		";


				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param(
						'sissssssssisssssssssssssssssssssssssssissssssssssssssssssssssiiii',
						TRIM($activitydetailseqcd),
						$activitymain_id,
						TRIM($activitydetailcrscd),
						TRIM($activitydetailcrs_jp),
						TRIM($activitydetailcrs_en),
						TRIM($activitydetailcrs_cn),
						TRIM($activitydetailcrs_tw),
						TRIM($activitydetailcrs_kr),
						TRIM($activitydetailfrom),
						TRIM($activitydetailto),
						$activitydetailperiod,
						TRIM($activitydetailschdtal_jp),
						TRIM($activitydetailschdtal_en),
						TRIM($activitydetailschdtal_cn),
						TRIM($activitydetailschdtal_tw),
						TRIM($activitydetailschdtal_kr),
						TRIM($activitydetailinstrct_jp),
						TRIM($activitydetailinstrct_en),
						TRIM($activitydetailinstrct_cn),
						TRIM($activitydetailinstrct_tw),
						TRIM($activitydetailinstrct_kr),
						TRIM($activitydetailfarcont_jp),
						TRIM($activitydetailfarcont_en),
						TRIM($activitydetailfarcont_cn),
						TRIM($activitydetailfarcont_tw),
						TRIM($activitydetailfarcont_kr),				
						TRIM($activitydetailmetplc_jp),
						TRIM($activitydetailmetplc_en),
						TRIM($activitydetailmetplc_cn),
						TRIM($activitydetailmetplc_tw),
						TRIM($activitydetailmetplc_kr),
						TRIM($activitydetaillat),
						TRIM($activitydetaillon),
						TRIM($activitydetailmettime),
						TRIM($activitydetailmettime_en),
						TRIM($activitydetailmettime_cn),
						TRIM($activitydetailmettime_tw),
						TRIM($activitydetailmettime_kr),
						TRIM($activitydetailmininum),
						TRIM($activitydetailminpar),
						TRIM($activitydetailmaxpar),
						TRIM($activitydetailtejmaid),
						TRIM($activitydetailtejmait),
						TRIM($activitydetailsttjmid),
						TRIM($activitydetailsttjmit),
						TRIM($activitydetailmov_jp),
						TRIM($activitydetailmov_en),
						TRIM($activitydetailmov_cn),
						TRIM($activitydetailmov_tw),
						TRIM($activitydetailmov_kr),
						TRIM($activitydetailmovcmt_jp),
						TRIM($activitydetailmovcmt_en),
						TRIM($activitydetailmovcmt_cn),
						TRIM($activitydetailmovcmt_tw),
						TRIM($activitydetailmovcmt_kr),
						$question_jp,
						$question_en,
						$question_cn,
						$question_tw,
						$question_kr,
						TRIM($activitydetailmovurl),
						$activitydetailreqtime,
						TRIM($activitydetailstartage),
						TRIM($activitydetailendage),
						$activitydetailid
					);
				}
		
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}

		}
		       
		function updateCouponUp(
			$couponcd,
			$couponname_jp,
			$couponname_en,
			$couponname_cn,
			$couponname_tw,
			$couponname_kr,
			$couponstart,
			$couponend,
			$couponinterval,
			$couponclosedupd,
			$couponclosedupt,
			
			$couponheldcompany_jp,
			$couponheldcompany_en,
			$couponheldcompany_cn,
			$couponheldcompany_tw,
			$couponheldcompany_kr,
			$couponpic,
			$couponcomment_jp,
			$couponcomment_en,
			$couponcomment_cn,
			$couponcomment_tw,
			$couponcomment_kr,
			$coupontype,
			$dissign_id,
			$jplangflg,
			$enlangflg,
			$cnlangflg,
			$twlangflg,
			$krlangflg,
			
			$couponupdater,
			$couponid
		){

				$couponstart=	trim($couponstart);
				$couponend	=	trim($couponend);

	       		$couponupdate=date('Y-m-d');
	       		
	       		$sql = "update coupons set 
		       		couponcd =?,
		       		couponname_jp =?,
		       		couponname_en =?,
		       		couponname_cn =?,
		       		couponname_tw =?,
		       		couponname_kr =?,
		       		couponstart=TRIM(?),  
		       		couponend=TRIM(?),  
		       		couponinterval=?, 
		       		couponclosedupd=TRIM(?),   
		       		couponclosedupt=TRIM(?),   
		       		
		       		couponheldcompany_jp=?,
		       		couponheldcompany_en=?,
		       		couponheldcompany_cn=?,
		       		couponheldcompany_tw=?,
		       		couponheldcompany_kr=?,
		       		couponpic=TRIM(?),  
		       		couponcomment_jp=?,  
		       		couponcomment_en=?,  
		       		couponcomment_cn=?,  
		       		couponcomment_tw=?,  
		       		couponcomment_kr=?,  
		       		coupontype=?,
		       		dissign_id=?,
					jplangflg=?,
					enlangflg=?,
					cnlangflg=?,
					twlangflg=?,
					krlangflg=?,
		       		couponupdater=?,  
		       		couponupdate=TRIM(?) 
		       		 where 
		       		couponid  =?
	       		
	       		";
	       		$tmp="
					$couponcd,
					$couponname_jp,
					$couponname_en,
					$couponname_cn,
					$couponname_tw,
					$couponname_kr,
					$couponstart,
					$couponend,
					$couponinterval,
					$couponclosedupd,
					$couponclosedupt,					
					$couponheldcompany_jp,
					$couponheldcompany_en,
					$couponheldcompany_cn,
					$couponheldcompany_tw,
					$couponheldcompany_kr,
					$couponpic,
					$couponcomment_jp,
					$couponcomment_en,
					$couponcomment_cn,
					$couponcomment_tw,
					$couponcomment_kr,
					$coupontype,
					$dissign_id,
					$jplangflg,
					$enlangflg,
					$cnlangflg,
					$twlangflg,
					$krlangflg,
					$couponupdater,
					$couponupdate,
					$couponid
	       		";

				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param(
					'ssssssssisssssssssssssiiiiiiiisi',
					$couponcd,
					$couponname_jp,
					$couponname_en,
					$couponname_cn,
					$couponname_tw,
					$couponname_kr,
					$couponstart,
					$couponend,
					$couponinterval,
					$couponclosedupd,
					$couponclosedupt,							
					$couponheldcompany_jp,
					$couponheldcompany_en,
					$couponheldcompany_cn,
					$couponheldcompany_tw,
					$couponheldcompany_kr,
					$couponpic,
					$couponcomment_jp,
					$couponcomment_en,
					$couponcomment_cn,
					$couponcomment_tw,
					$couponcomment_kr,
					$coupontype,
					$dissign_id,
					$jplangflg,
					$enlangflg,
					$cnlangflg,
					$twlangflg,
					$krlangflg,
					$couponupdater,
					$couponupdate,
					$couponid
					);
				}

				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}

		}
		

		function updateCoupon(
			$couponid,
			$couponcd,
			$couponname,
			$couponadultpoint,
			$ouponchildpoint,
			$couponstart,
			$couponend,
			$couponinterval,
			$couponheldcompany,
			$couponpic,
			$couponadultb2cprice,
			$couponchildb2cprice,
			$couponadultb2bprice,
			$couponchildb2bprice,
			$couponcomment,
			$couponupdater
		
		){

				$couponstart=	trim($couponstart);
				$couponend	=	trim($couponend);
				

				
	       		$couponupdate=date('Y-m-d');
	       		
	       		$sql = "update coupons set 
		       		couponcd =?,
		       		couponname =?,
		       		couponadultpoint=?,
		       		ouponchildpoint=?,  
		       		couponstart=TRIM(?),  
		       		couponend=TRIM(?),  
		       		couponinterval=?, 
		       		couponheldcompany=?, 
		       		couponpic=?,  
		       		couponadultb2cprice=?,  
		       		couponchildb2cprice=?,  
		       		couponadultb2bprice=?,  
		       		couponchildb2bprice=?,  
		       		couponcomment=?,  
		       		couponupdater=?,  
		       		couponupdate=TRIM(?) 
		       		where 
		       		couponid  =?
	       		
	       		";
	       		$tmp="
			       		$couponcd,
			       		$couponname,
			       		$couponadultpoint,
			       		$ouponchildpoint,  
			       		$couponstart,  
			       		$couponend,  
			       		$couponinterval,
			       		$couponheldcompany,  
			       		$couponpic,  
			       		$couponadultb2cprice,  
			       		$couponchildb2cprice,  
			       		$couponadultb2bprice,  
			       		$couponchildb2bprice,  
			       		$couponcomment,  
			       		$couponupdater,  
			       		$couponupdate,
						$couponid 
	       		";

				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param(
					'ssiississiiiisisi',
					$couponcd,
					$couponname,
					$couponadultpoint,
					$ouponchildpoint,
					$couponstart,
					$couponend,
					$couponinterval,
					$couponheldcompany,
					$couponpic,
					$couponadultb2cprice,
					$couponchildb2cprice,
					$couponadultb2bprice,
					$couponchildb2bprice,
					$couponcomment,
					$couponupdater,
					$couponupdate,
					$couponid
					);
				}
		
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}

		}
		function delCoupon($deleter,$id){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update coupons set coupondeleter = ?  where couponid   = ?";
	       		
	       		$tmp="$deleter,$id";
				$stmt =$this->link->prepare($sql);
				if($stmt){
					
				
					$stmt->bind_param('ii',$deleter,$id);

					$done = $stmt->execute();
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}
       } 
		function delActivitymain($deleter,$activitymainid ){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update activitymain set activitymaindeleterid = ?  where activitymainid    = ?";
	       		
	       		$tmp="$deleter,$activitymainid";
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					
				
					$stmt->bind_param('ii',$deleter,$activitymainid);

					$done = $stmt->execute();
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}
       }        
		function deleteCoupon($id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "delete from coupons  where couponid  = ?";
       		$tmp="$id";
       		
			$stmt =$this->link->prepare($sql);

	

			if($stmt){
				$stmt->bind_param('i',$id);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				echo $stmt->error;
				return -1;
			}
       } 
		function getCancelByCoupon_id($coupon_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from cancel  where coupon_id  = ?";
       		$tmp="$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$coupon_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['cancelid']			=$row['cancelid'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    $rtn[$i]['cancelfrom']			=$row['cancelfrom'];
			    $rtn[$i]['cancelto']			=$row['cancelto'];    
			    $rtn[$i]['cancelfromtitle_jp']			=$row['cancelfromtitle_jp'];
			    $rtn[$i]['cancelfromtitle_en']			=$row['cancelfromtitle_en'];
			    $rtn[$i]['cancelfromtitle_cn']			=$row['cancelfromtitle_cn'];
			    $rtn[$i]['cancelfromtitle_tw']			=$row['cancelfromtitle_tw'];
			    $rtn[$i]['cancelfromtitle_kr']			=$row['cancelfromtitle_kr'];
			    
			    $rtn[$i]['canceltotitle_jp']			=$row['canceltotitle_jp'];
			    $rtn[$i]['canceltotitle_en']			=$row['canceltotitle_en'];
			    $rtn[$i]['canceltotitle_cn']			=$row['canceltotitle_cn'];
			    $rtn[$i]['canceltotitle_tw']			=$row['canceltotitle_tw'];
			    $rtn[$i]['canceltotitle_kr']			=$row['canceltotitle_kr'];

			    $rtn[$i]['cancelmoney']			=$row['cancelmoney'];
			    $rtn[$i]['cancelpercent']		=$row['cancelpercent'];
			    $rtn[$i]['cancelcreatedate']	=$row['cancelcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }   
   
       
		function getPlanstockcalls($activitydetail_id,$stockcalmonth){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from planstockcal  where activitydetail_id  = ? and stockcalmonth = ?";
       		$tmp="$activitydetail_id,$stockcalmonth";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];    
			     $rtn[$i]['stockisstop']				=$row['stockisstop'];
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }          
		function getStockcal($activitydetail_id,$stockcalmonth){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from stockcal  where activitydetail_id  = ? and stockcalmonth = ?";
       		$tmp="$activitydetail_id,$stockcalmonth";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('is',$activitydetail_id,$stockcalmonth);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['stockcalid']			=$row['stockcalid'];
			    $rtn[$i]['activitydetail_id']	=$row['activitydetail_id'];
			    $rtn[$i]['stockcalmonth']		=$row['stockcalmonth'];
			    $rtn[$i]['stockcalval']			=$row['stockcalval'];    
			    $rtn[$i]['stockisstop']				=$row['stockisstop'];
			    $rtn[$i]['stockcalcreatetime']	=$row['stockcalcreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }   
          
		function getActivitycancelByActivitydetail_id($activitydetail_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from activitycancel  where activitydetail_id  = ?";
       		$tmp="$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['cancelid']			=$row['cancelid'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    $rtn[$i]['cancelfrom']			=$row['cancelfrom'];
			    $rtn[$i]['cancelto']			=$row['cancelto'];    
			    $rtn[$i]['cancelfromtitle_jp']			=$row['cancelfromtitle_jp'];
			    $rtn[$i]['cancelfromtitle_en']			=$row['cancelfromtitle_en'];
			    $rtn[$i]['cancelfromtitle_cn']			=$row['cancelfromtitle_cn'];
			    $rtn[$i]['cancelfromtitle_tw']			=$row['cancelfromtitle_tw'];
			    $rtn[$i]['cancelfromtitle_kr']			=$row['cancelfromtitle_kr'];
			    
			    $rtn[$i]['canceltotitle_jp']			=$row['canceltotitle_jp'];
			    $rtn[$i]['canceltotitle_en']			=$row['canceltotitle_en'];
			    $rtn[$i]['canceltotitle_cn']			=$row['canceltotitle_cn'];
			    $rtn[$i]['canceltotitle_tw']			=$row['canceltotitle_tw'];
			    $rtn[$i]['canceltotitle_kr']			=$row['canceltotitle_kr'];

			    $rtn[$i]['cancelmoney']			=$row['cancelmoney'];
			    $rtn[$i]['cancelpercent']		=$row['cancelpercent'];
			    $rtn[$i]['cancelcreatedate']	=$row['cancelcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }        
   
		function getActivitycancelByCoupon_id($activitydetail_id){
        
			$sellerupdatedate=date('Y-m-d');
       		$sql = "select * from activitycancel  where activitydetail_id  = ? and activitydetail_id>0";
       		$tmp="$coupon_id";

			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$activitydetail_id);
			}
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['cancelid']			=$row['cancelid'];
			    $rtn[$i]['activitydetail_id']			=$row['activitydetail_id'];
			    $rtn[$i]['cancelfrom']			=$row['cancelfrom'];
			    $rtn[$i]['cancelto']			=$row['cancelto'];    
			    $rtn[$i]['cancelfromtitle_jp']			=$row['cancelfromtitle_jp'];
			    $rtn[$i]['cancelfromtitle_en']			=$row['cancelfromtitle_en'];
			    $rtn[$i]['cancelfromtitle_cn']			=$row['cancelfromtitle_cn'];
			    $rtn[$i]['cancelfromtitle_tw']			=$row['cancelfromtitle_tw'];
			    $rtn[$i]['cancelfromtitle_kr']			=$row['cancelfromtitle_kr'];
			    
			    $rtn[$i]['canceltotitle_jp']			=$row['canceltotitle_jp'];
			    $rtn[$i]['canceltotitle_en']			=$row['canceltotitle_en'];
			    $rtn[$i]['canceltotitle_cn']			=$row['canceltotitle_cn'];
			    $rtn[$i]['canceltotitle_tw']			=$row['canceltotitle_tw'];
			    $rtn[$i]['canceltotitle_kr']			=$row['canceltotitle_kr'];

			    $rtn[$i]['cancelmoney']			=$row['cancelmoney'];
			    $rtn[$i]['cancelpercent']		=$row['cancelpercent'];
			    $rtn[$i]['cancelcreatedate']	=$row['cancelcreatedate'];

			    
				$i++;
			}
		  $stmt->free_result();

		  return $rtn;
       }        
   
      
       function getCopnb2cmoneyByCoupon_id($coupon_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnb2cmoney where coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnb2cmid']			=$row['copnb2cmid'];
			    $rtn[$i]['copnb2cmname_jp']		=$row['copnb2cmname_jp'];
			    $rtn[$i]['copnb2cmname_en']		=$row['copnb2cmname_en'];
			    $rtn[$i]['copnb2cmname_us']		=$row['copnb2cmname_us'];
			    $rtn[$i]['copnb2cmname_cn']		=$row['copnb2cmname_cn'];
			    $rtn[$i]['copnb2cmname_tw']		=$row['copnb2cmname_tw'];
			    $rtn[$i]['copnb2cmname_kr']		=$row['copnb2cmname_kr'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

			
       }  

       function getCopnb2bmoneyByCoupon_id($coupon_id){
    
       		$updatedate=date('Y-m-d');

			$sql = "select * from copnb2bmoney where coupon_id = ? ";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $coupon_id);
			$stmt->execute();
			
	
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['copnb2bmid']			=$row['copnb2bmid'];
			    $rtn[$i]['copnb2bmname_jp']		=$row['copnb2bmname_jp'];
			    $rtn[$i]['copnb2bmname_en']		=$row['copnb2bmname_en'];
			    $rtn[$i]['copnb2bmname_us']		=$row['copnb2bmname_us'];
			    $rtn[$i]['copnb2bmname_cn']		=$row['copnb2bmname_cn'];
			    $rtn[$i]['copnb2bmname_tw']		=$row['copnb2bmname_tw'];
			    $rtn[$i]['copnb2bmname_kr']		=$row['copnb2bmname_kr'];
			    $rtn[$i]['copnpoint_id']		=$row['copnpoint_id'];
			    $rtn[$i]['coupon_id']			=$row['coupon_id'];
			    
				$i++;
			}
		  $stmt->free_result();
		 
		  return $rtn;

			
       }  


       //admin
		function adminlogin($companymailorid,$companypass){
        	
        	$ismail=$this->is_email($companymailorid);
      	
        	if($ismail){
				$sql = "select * from company where companymail= TRIM(?) and  companypass= TRIM(?) and companyloginid ='' ";
		       
        	}else{
        	
				$sql = "select * from company where companyloginid= TRIM(?) and  companypass= TRIM(?)  ";
		       

        	}
        	
       		$tmp="$companymailorid,$companypass";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ss", $companymailorid,$companypass);
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];
			    $rtn[$i]['companyloginid']		=$row['companyloginid'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    
			    $rtn[$i]['companyareaid']		=$row['companyareaid'];

			    $rtn[$i]['sellerusername']		=$row['sellerusername'];
			    $rtn[$i]['companypass']			=$row['companypass'];
			    $rtn[$i]['isadmin']				=$row['isadmin'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       } 
		function userlogin($sellerusername,$sellerpassword){
        
			$sql = "select * from Sellers as s left join company as c on s.company_id= c.companyid where sellerusername= ? and  sellerpassword=? ";

	       
       		$tmp="$sellerusername,$sellerpassword";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ss", $sellerusername,$sellerpassword);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['company_id']			=$row['company_id'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['sellerusername']		=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']		=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']		=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']		=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']		=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];
			    
			    $rtn[$i]['companyname_jp']	=$row['companyname_jp'];			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       } 
        
       function getdissign ($start_from, $num_rec_per_page){

       		$updatedate=date('Y-m-d');
			$sql = "select * from dissign where dissigndeleter=0 limit ?,?";
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['dissignid']			=$row['dissignid'];
			    $rtn[$i]['dissignname']			=$row['dissignname'];
			    $rtn[$i]['dissignfolder']		=$row['dissignfolder'];
			    $rtn[$i]['dissigncreatetime']	=$row['dissigncreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
			
       }  
       
       function searchDissign($searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select * from dissign where dissignname LIKE CONCAT('%',?,'%')  limit ?,?";
			$tmp="$searchkey,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);



			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['dissignid']			=$row['dissignid'];
			    $rtn[$i]['dissignname']			=$row['dissignname'];
			    $rtn[$i]['dissignfolder']		=$row['dissignfolder'];
			    $rtn[$i]['dissigncreatetime']	=$row['dissigncreatetime'];
    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }  
       function getActivitytype ($start_from, $num_rec_per_page){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype   where activitydeleter=0 limit ?,?";
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];
			    
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
			
       }  
       
       
       function getActivitytypeByactivitytypeid ($activitytypeid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype   where activitytypeid=?";
			$tmp="$activitytypeid";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$activitytypeid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];
			    
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
			
       }     
       //Ｂ２Ｂユーザ情報       
       function getSellers($start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where s.isadmin=0 limit ?,?";
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany']		=$row['sellercompany'];
			    $rtn[$i]['sellerusername']		=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']		=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']		=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']		=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']		=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        
       function getMySellers($company_id,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where s.isadmin=0 and s.company_id = ? limit ?,?";
			$tmp="$company_id,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$company_id,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany']		=$row['sellercompany'];
			    $rtn[$i]['sellerusername']		=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']		=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']		=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']		=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']		=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}


		  $stmt->free_result();


		  return $rtn;

			
       }        
       
       function searchSellers($searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where CONCAT_WS(`sellercode`,`sellerusername`,`sellerpassword`,`companycd`,`companyname_jp`) LIKE CONCAT('%',?,'%') and  s.isadmin=0 limit ?,?";
			$tmp="$searchkey,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany']	=$row['sellercompany'];
			    $rtn[$i]['sellerusername']	=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']	=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']	=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']	=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']	=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }    
       function searchMySellers($company_id,$searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where CONCAT_WS(`sellercode`,`sellerusername`,`sellerpassword`,`companycd`,`companyname`) LIKE CONCAT('%',?,'%') and s.company_id= ? and  s.isadmin=0 limit ?,?";
			$tmp="$company_id,$searchkey,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("isii",$company_id,$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany_jp']	=$row['sellercompany_jp'];
			    $rtn[$i]['sellerusername']	=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']	=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']	=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']	=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']	=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }    
       function searchActivitytype($searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype where activityname_jp LIKE CONCAT('%',?,'%') and  activitydeleter=0 limit ?,?";
			$tmp="$searchkey,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);



			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];	    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }              
       function getAllSellers(){

       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where s.isadmin=0";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany']	=$row['sellercompany'];
			    $rtn[$i]['sellerusername']	=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']	=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']	=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']	=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']	=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname']			=$row['companyname'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }   
       
       function getAllActivitytype(){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype  where activitydeleter=0";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];

			    
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']	=$row['activitycreatetime'];
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        
       
       
       function getAllDissign(){

       		$updatedate=date('Y-m-d');
			$sql = "select * from dissign  where dissigndeleter=0";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['dissignid']			=$row['dissignid'];
			    $rtn[$i]['dissignname']			=$row['dissignname'];
			    $rtn[$i]['dissignfolder']		=$row['dissignfolder'];
			    $rtn[$i]['dissigndeleter']		=$row['dissigndeleter'];
			    $rtn[$i]['dissigncreatetime']	=$row['dissigncreatetime'];

				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }            
         
       function searchAllSellers($searchkey){

       		$updatedate=date('Y-m-d');
			$sql = "select s.*,c.* from Sellers as s left join company as c on s.company_id=c.companyid where CONCAT_WS(`sellercode`,`sellerusername`,`companycd`,`companyname_jp`) LIKE CONCAT('%',?,'%') and  s.isadmin=0 ";
			$stmt = $this->link->prepare($sql);
			$tmp="$searchkey";

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("s",$searchkey);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['sellercompany']	=$row['sellercompany'];
			    $rtn[$i]['sellerusername']	=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']	=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']	=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']	=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']	=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];

			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname']			=$row['companyname'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companyagtflg']		=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }   
       
       function searchAllActivitytype($searchkey){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype  where activityname_jp LIKE CONCAT('%',?,'%') and  activitydeleter=0 ";

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("s",$searchkey);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }   
       function getDissigneBydissignid($dissignid){
       
			$sql = "select * from dissign  where dissignid= ? and dissigndeleter = 0";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $dissignid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['dissignid']			=$row['dissignid'];
			    $rtn[$i]['dissignname']			=$row['dissignname'];
			    $rtn[$i]['dissignfolder']		=$row['dissignfolder'];
			    $rtn[$i]['dissigncreatetime']	=$row['dissigncreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }          
              
       function activitytypeByActivitytypeid($activitytypeid){
       
			$sql = "select * from activitytype  where activitytypeid= ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $activitytypeid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['activitytypeid']			=$row['activitytypeid'];
			    $rtn[$i]['activityname_jp']			=$row['activityname_jp'];
			    $rtn[$i]['activityname_en']			=$row['activityname_en'];
			    $rtn[$i]['activityname_cn']			=$row['activityname_cn'];
			    $rtn[$i]['activityname_tw']			=$row['activityname_tw'];
			    $rtn[$i]['activityname_kr']			=$row['activityname_kr'];
			    
			    $rtn[$i]['activitytype']			=$row['activitytype'];
			    $rtn[$i]['activitydeleter']			=$row['activitydeleter'];
			    $rtn[$i]['activitytypeindex']		=$row['activitytypeindex'];
			    $rtn[$i]['activitycreatetime']		=$row['activitycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }                        
       function addReservepointtype($rsv_id,$activitypointid,$activitypointname_en,$activitypointname_us,$activitypointname_jp,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$rptypemembernum,$rptypeunitprice,$rptypeunitmoney,$rptypepeoplenum,$atstockcal_id,$planorcourse,$isb2b){


			$sql="INSERT INTO reservepointtype (rsv_id,activitypointid,activitypointname_en,activitypointname_us,activitypointname_jp,activitypointname_cn,activitypointname_tw,activitypointname_kr,rptypemembernum,rptypeunitprice,rptypeunitmoney,rptypepeoplenum,atstockcal_id,planorcourse,b2bflg) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			$tmp=" $rsv_id,$activitypointid,$activitypointname_en,$activitypointname_jp,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$rptypemembernum,$rptypeunitprice,$rptypeunitmoney,$rptypepeoplenum,$atstockcal_id,$planorcourse,$isb2b";

			$stmt =$this->link->prepare($sql);
			$stmt->bind_param("iissssssiiiiiii", $rsv_id,$activitypointid,$activitypointname_en,$activitypointname_us,$activitypointname_jp,$activitypointname_cn,$activitypointname_tw,$activitypointname_kr,$rptypemembernum,$rptypeunitprice,$rptypeunitmoney,$rptypepeoplenum,$atstockcal_id,$planorcourse,$isb2b);
				
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }  
       
       function setReserveRsvcd($rsvcd,$rsvid){
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsvcd = ? where rsvid    = ?";
	       		
	       		$tmp="$rsvcd,$rsvid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('si',$rsvcd,$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }
       
       
       function setReserveLangAreaid($rsvid,$rsvlang,$urlareaid){
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsvlang = ? ,urlareaid = ? where rsvid    = ?";
	       		
	       		$tmp="$rsvlang,$urlareaid,$rsvid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('sii',$rsvlang,$urlareaid,$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }
       function setReserveRsvstatusatcancel($rsvstatusatcancel,$rsvid){
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsvstatusatcancel = ? where rsvid    = ?";
	       		
	       		$tmp="$rsvstatusatcancel,$rsvid";

				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$rsvstatusatcancel,$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }              
       function setReserveRsvuseprimoney($rsvuseprimoney,$rsvid){
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsvuseprimoney = ? where rsvid    = ?";
	       		
	       		$tmp="$rsvuseprimoney,$rsvid";

				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$rsvuseprimoney,$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }
       
       function isCanceledReserve($rsvid){
       
			$sql = "select * from reserve  where rsvid= ?  and rsviscanceledday is not null ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $rsvid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']			=$row['rsvid'];
			    $rtn[$i]['rsvcd']			=$row['rsvcd'];
			    $rtn[$i]['agt_id']			=$row['agt_id'];
			    $rtn[$i]['rsvlang']			=$row['rsvlang'];
			    $rtn[$i]['urlareaid']			=$row['urlareaid'];
			    $rtn[$i]['urllang']			=$row['urllang'];
			    
			    $rtn[$i]['rsvstartdate']			=$row['rsvstartdate'];
			    $rtn[$i]['rsvbuyid']			=$row['rsvbuyid'];
			    $rtn[$i]['rsvserialnum']		=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']		=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']		=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']		=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']		=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']		=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']		=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']		=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']		=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']		=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']		=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']		=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']		=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']		=$row['rsvdelegatetel'];
			    $rtn[$i]['sectionname1']		=$row['sectionname1'];
			    $rtn[$i]['sectionname2']		=$row['sectionname2'];
			    $rtn[$i]['sectionname3']		=$row['sectionname3'];
			    $rtn[$i]['sectionname4']		=$row['sectionname4'];
			    $rtn[$i]['sectionname5']		=$row['sectionname5'];
			    $rtn[$i]['sectionname6']		=$row['sectionname6'];
			    $rtn[$i]['rsvbabynum']		=$row['rsvbabynum'];
			    $rtn[$i]['rsvusedstock']		=$row['rsvusedstock'];
			    $rtn[$i]['rsvperiod']		=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']		=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']		=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']		=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']		=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvusedpointval']		=$row['rsvusedpointval'];
			    $rtn[$i]['rsvuseprimoney']		=$row['rsvuseprimoney'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']		=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainmod']		=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainify']		=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']		=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']		=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']		=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']		=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']		=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']		=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']		=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']		=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']		=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']		=$row['rsviscanceled'];
			    $rtn[$i]['rsviscanceledday']		=$row['rsviscanceledday'];
			    $rtn[$i]['rsvfee']		=$row['rsvfee'];
			    $rtn[$i]['rsvpointfee']		=$row['rsvpointfee'];

			    
			    
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       }
       function setReserveRsviscancelDayFee($rsvid,$fee){
	       		$updatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsviscanceledday = ?, rsvfee = ? where rsvid    = ?";
	       		
	       		$tmp="$rsvid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('sis',$updatedate,$fee,$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }
              
       function setReserveRsviscanceled($rsvid){
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update reserve set rsviscanceled = 2 where rsvid    = ?";
	       		
	       		$tmp="$rsvid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('i',$rsvid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }
             
       	//
		function setReservestockcalids($rsvid,$stockcal_id,$isb2b){
        
	       	$sellerupdatedate=date('Y-m-d');

			$sql="INSERT INTO reservestockcalids (rsvi_d,stockcal_id,isb2b) VALUES(?,?,?)";
			$tmp="$rsvid,$stockcal_id";


			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("iii",$rsvid,$stockcal_id,$isb2b);
				
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }     

		function getReservestockcalidsByRsvi_d($rsvi_d,$isb2b){
        
	       	$sellerupdatedate=date('Y-m-d');
       
			$sql = "select * from reservestockcalids  where rsvi_d= ? and isb2b = ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ii", $rsvi_d,$isb2b);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rscid']			=$row['rscid'];
			    $rtn[$i]['rsvi_d']			=$row['rsvi_d'];
			    $rtn[$i]['stockcal_id']		=$row['stockcal_id'];
			    $rtn[$i]['isb2b']			=$row['isb2b'];
			    
			    $rtn[$i]['rsccreatetime']	=$row['rsccreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
       } 
       
       
		function setStockcalStockcalval($stockcalval,$stockcalid ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update stockcal set stockcalval = stockcalval-?  where stockcalid    = ?";
	       		
	       		$tmp="$stockcalval,$stockcalid";

				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$stockcalval,$stockcalid );

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }  
		function setPlanstockcalStockcalValBack($stockcalval,$stockcalid ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update planstockcal set stockcalval = stockcalval+?  where stockcalid    = ?";
	       		
	       		$tmp="$stockcalval,$stockcalid";
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$stockcalval,$stockcalid );

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }    
		function setPlanstockcalStockcalVal($stockcalval,$stockcalid ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update planstockcal set stockcalval = stockcalval-?  where stockcalid    = ?";
	       		
	       		$tmp="$stockcalval,$stockcalid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$stockcalval,$stockcalid );

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }                
		function setStockcalStockcalValBack($stockcalval,$stockcalid ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update stockcal set stockcalval = stockcalval+?  where stockcalid    = ?";
	       		
	       		$tmp="$stockcalval,$stockcalid";

	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$stockcalval,$stockcalid );

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }         
		function setBuyingFinalpointval($buyid,$finalpointval ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update buying set finalpointval = finalpointval-?  where buyid    = ?";
	       		
	       		$tmp="$finalpointval,$buyid";
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$finalpointval,$buyid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }  
		function setBuyingb2bFinalpointval($buyid,$finalpointval ){

      
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update buyingb2b set finalpointval = finalpointval-?  where buyid    = ?";
	       		
	       		$tmp="$finalpointval,$buyid";
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				
					$stmt->bind_param('ii',$finalpointval,$buyid);

					$done = $stmt->execute();

				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }  
		function setBuyingB2BMdacodeSellercd($mdacode,$seller_id, $buyid){


	       		$sellerupdatedate=date('Y-m-d');

	       		$sql = "update buyingb2b set mdacode = ? , seller_id=? where buyid    = ?";
	       		$tmp="$mdacode,$seller_id,$buyid";
	 		       		
	       		if($seller_id==0){
	       			$sql = "update buying set mdacode = ?  where buyid    = ?";
	       			$tmp="$mdacode,$buyid";
	       			
	       		}
	       		
      		
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				

					
					if($seller_id==0){
						$stmt->bind_param('si',$mdacode,$buyid);
				
					}else{
						$stmt->bind_param('sii',$mdacode,$seller_id,$buyid);
					}
					$done = $stmt->execute();
				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }     

		function setBuyingMdacodeSellercd($mdacode,$seller_id, $buyid){

	       		$sellerupdatedate=date('Y-m-d');

	       		$sql = "update buying set mdacode = ? , seller_id=? where buyid    = ?";
	       		$tmp="$mdacode,$seller_id,$buyid";
	 		       		
	       		if($seller_id==0){
	       			$sql = "update buying set mdacode = ?  where buyid    = ?";
	       			$tmp="$mdacode,$buyid";
	       			
	       		}
	       		
      		
	       		
				$stmt =$this->link->prepare($sql);
				if($stmt){
				

					
					if($seller_id==0){
						$stmt->bind_param('si',$mdacode,$buyid);
				
					}else{
						$stmt->bind_param('sii',$mdacode,$seller_id,$buyid);
					}
					$done = $stmt->execute();
				
					if($done){

						return 1;
					}else{

						echo $stmt->error;
						return -1;
					}
				}else{

					return -1;
				}
       }          
                         
       function addSeller($sellercode,$company_id,$sellerusername,$sellerpassword){

			$sql="INSERT INTO Sellers (sellercode,company_id,sellerusername,sellerpassword) VALUES(?,?,?,?)";
			$tmp="$sellercode,$company_id,$sellerusername,$sellerpassword";

			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("siss", $sellercode,$company_id,$sellerusername,$sellerpassword);
				
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }  	
              
       function addReserve(
       				$stockpk,
					$rsvlang,
					$rsvstartdate			,
					$rsvbuyid				,
					$rsvserialnum			,
					$rsvcouponid			,
					$rsvcouponcd			,
					$rsvcouponname			,
					$rsvcouponname_en		,
					$rsvcouponname_cn		,
					$rsvcouponname_tw		,
					$rsvcouponname_kr		,
					$rsvcompanyid			,
					$rsvcompanycd			,
					$rsvactivitymainid		,
					$rsvactivitymainplncd	,
					$rsvactivitymainpln		,
					$rsvactivitymainpln_en	,
					$rsvactivitymainpln_cn	,
					$rsvactivitymainpln_tw	,
					$rsvactivitymainpln_kr	,
					$rsvactivitydetailid	,
					$rsvactivitydetailseqcd	,
					$rsvactivitydetailcrscd	,
					$rsvactivitydetailcrs	,
					$rsvactivitydetailcrs_en	,
					$rsvactivitydetailcrs_cn	,
					$rsvactivitydetailcrs_tw	,
					$rsvactivitydetailcrs_kr	,
					$rsvdelegatefist		,
					$rsvdelegatelast		,
					$rsvdelegatesex			,
					$rsvdelegateage			,
					$rsvdelegatetel			,
					$sectionname1,
					$sectionname2,
					$sectionname3,
					$sectionname4,
					$sectionname5,
					$sectionname6,
					$rsvbabynum				,
					$rsvusedstock			,
					$rsvperiod				,
					$rsvlivearea_id			,
					$rsvactivitytypecnt		,
					$rsvfinalmoney			,
					$rsvfinalpointval		,
					$rsvusedpointval		,
					$rsvcouponheldcompany	,
					$rsvactivitymainkbn		,
					$rsvactivitymainmod		,
					$rsvactivitymainify		,
					$rsvactivitytype_id		,
					$rsvarea_fid			,
					$rsvarea_id				,
					$rsvactivitymainlangflg_jp,
					$rsvactivitymainlangflg_en,
					$rsvactivitymainlangflg_cn,
					$rsvactivitymainlangflg_tw,
					$rsvactivitymainlangflg_kr,
					$replyquestion,
					$rsvb2bflg
       
       ){

			if($stockpk<0){
				$rsviscanceled=2;
			}else{
				$rsviscanceled=0;
			}

			$sql="INSERT INTO reserve (
					rsvlang,
					rsvstartdate,
					rsvbuyid,
					rsvserialnum,
					rsvcouponid,
					rsvcouponcd,
					rsvcouponname,
					rsvcouponname_en,
					rsvcouponname_cn,
					rsvcouponname_tw,
					rsvcouponname_kr,
					rsvcompanyid,
					rsvcompanycd,
					rsvactivitymainid,
					rsvactivitymainplncd,
					rsvactivitymainpln,
					rsvactivitymainpln_en,
					rsvactivitymainpln_cn,
					rsvactivitymainpln_tw,
					rsvactivitymainpln_kr,
					rsvactivitydetailid,
					rsvactivitydetailseqcd,
					rsvactivitydetailcrscd,
					rsvactivitydetailcrs,
					rsvactivitydetailcrs_en,
					rsvactivitydetailcrs_cn,
					rsvactivitydetailcrs_tw,
					rsvactivitydetailcrs_kr,
					rsvdelegatefist,
					rsvdelegatelast,
					rsvdelegatesex,
					rsvdelegateage,
					rsvdelegatetel,
					sectionname1,
					sectionname2,
					sectionname3,
					sectionname4,
					sectionname5,
					sectionname6,
					rsvbabynum,
					rsvusedstock,
					rsvperiod,
					rsvlivearea_id,
					rsvactivitytypecnt,
					rsvfinalmoney,
					rsvfinalpointval,
					rsvusedpointval,
					rsvcouponheldcompany,
					rsvactivitymainkbn,
					rsvactivitymainmod,
					rsvactivitymainify,
					rsvactivitytype_id,
					rsvarea_fid,
					rsvarea_id,
					rsvactivitymainlangflg_jp,
					rsvactivitymainlangflg_en,
					rsvactivitymainlangflg_cn,
					rsvactivitymainlangflg_tw,
					rsvactivitymainlangflg_kr,					
					replyquestion,
					rsviscanceled,
					rsvb2bflg

			) VALUES(
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,				
				?,
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,																
				?,
				?
						
			)";
			$tmp="
					$rsvlang,
					$rsvstartdate,
					$rsvbuyid,
					$rsvserialnum,
					$rsvcouponid,
					$rsvcouponcd,
					$rsvcouponname,
					$rsvcouponname_en		,
					$rsvcouponname_cn		,
					$rsvcouponname_tw		,
					$rsvcouponname_kr		,					
					$rsvcompanyid,
					$rsvcompanycd,
					$rsvactivitymainid,
					$rsvactivitymainplncd,
					$rsvactivitymainpln,
					$rsvactivitymainpln_en	,
					$rsvactivitymainpln_cn	,
					$rsvactivitymainpln_tw	,
					$rsvactivitymainpln_kr	,
					$rsvactivitydetailid,
					$rsvactivitydetailseqcd,
					$rsvactivitydetailcrscd,
					$rsvactivitydetailcrs,
					$rsvactivitydetailcrs_en	,
					$rsvactivitydetailcrs_cn	,
					$rsvactivitydetailcrs_tw	,
					$rsvactivitydetailcrs_kr	,					
					$rsvdelegatefist,
					$rsvdelegatelast,
					$rsvdelegatesex,
					$rsvdelegateage,
					$rsvdelegatetel,
					$sectionname1,
					$sectionname2,
					$sectionname3,
					$sectionname4,
					$sectionname5,
					$sectionname6,					
					$rsvbabynum,
					$rsvusedstock,
					$rsvperiod,
					$rsvlivearea_id,
					$rsvactivitytypecnt,
					$rsvfinalmoney,
					$rsvfinalpointval,
					$rsvusedpointval,
					$rsvcouponheldcompany,
					$rsvactivitymainkbn,
					$rsvactivitymainmod,
					$rsvactivitymainify,
					$rsvactivitytype_id,
					$rsvarea_fid,
					$rsvarea_id,
					$rsvactivitymainlangflg_jp,
					$rsvactivitymainlangflg_en,
					$rsvactivitymainlangflg_cn,
					$rsvactivitymainlangflg_tw,
					$rsvactivitymainlangflg_kr,							
					$replyquestion,
					$rsviscanceled,
					$rsvb2bflg
			";

			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ssisissssssisissssssisssssssssiisiiiiiiiiiiiiiisiiiiiiiiiiisii",
					$rsvlang,
					$rsvstartdate,
					$rsvbuyid,
					$rsvserialnum,
					$rsvcouponid,
					$rsvcouponcd,
					$rsvcouponname,
					$rsvcouponname_en		,
					$rsvcouponname_cn		,
					$rsvcouponname_tw		,
					$rsvcouponname_kr		,					
					$rsvcompanyid,
					$rsvcompanycd,
					$rsvactivitymainid,
					$rsvactivitymainplncd,
					$rsvactivitymainpln,
					$rsvactivitymainpln_en	,
					$rsvactivitymainpln_cn	,
					$rsvactivitymainpln_tw	,
					$rsvactivitymainpln_kr	,
					$rsvactivitydetailid,
					$rsvactivitydetailseqcd,
					$rsvactivitydetailcrscd,
					$rsvactivitydetailcrs,
					$rsvactivitydetailcrs_en	,
					$rsvactivitydetailcrs_cn	,
					$rsvactivitydetailcrs_tw	,
					$rsvactivitydetailcrs_kr	,					
					$rsvdelegatefist,
					$rsvdelegatelast,
					$rsvdelegatesex,
					$rsvdelegateage,
					$rsvdelegatetel,
					$sectionname1,
					$sectionname2,
					$sectionname3,
					$sectionname4,
					$sectionname5,
					$sectionname6,					
					$rsvbabynum,
					$rsvusedstock,
					$rsvperiod,
					$rsvlivearea_id,
					$rsvactivitytypecnt,
					$rsvfinalmoney,
					$rsvfinalpointval,
					$rsvusedpointval,
					$rsvcouponheldcompany,
					$rsvactivitymainkbn,
					$rsvactivitymainmod,
					$rsvactivitymainify,
					$rsvactivitytype_id,
					$rsvarea_fid,
					$rsvarea_id,
					$rsvactivitymainlangflg_jp,
					$rsvactivitymainlangflg_en,
					$rsvactivitymainlangflg_cn,
					$rsvactivitymainlangflg_tw,
					$rsvactivitymainlangflg_kr,							
					$replyquestion,
					$rsviscanceled,
					$rsvb2bflg
			 );
				
			
				
			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       } 
       function addActivitytype($admin_id,$activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex){
			$sql="INSERT INTO activitytype (activityname_jp,activityname_en,activityname_cn,activityname_tw,activityname_kr,activitytype,activitytypeindex) VALUES(?,?,?,?,?,?,?)";
			$stmt =$this->link->prepare($sql);
			$tmp="$activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex";

			
			$stmt->bind_param("sssssii", $activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex);

			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }  

       function addDissign($dissignname,$dissignfolder){
			$sql="INSERT INTO dissign (dissignname,dissignfolder) VALUES(?,?)";
			$stmt =$this->link->prepare($sql);
			$tmp="$dissignname,$dissignfolder";

			
			$stmt->bind_param("ss", $dissignname,$dissignfolder);

			$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			   }else{
			       return -1;
			}
       }  
           
                         
       function getSeller($sellerid){
       
			$sql = "select * from Sellers  where sellerid= ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $sellerid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['sellerid']			=$row['sellerid'];
			    $rtn[$i]['sellercode']			=$row['sellercode'];
			    $rtn[$i]['admin_id']			=$row['admin_id'];
			    $rtn[$i]['company_id']			=$row['company_id'];
			    
			    $rtn[$i]['sellercompany']	=$row['sellercompany'];
			    $rtn[$i]['sellerusername']	=$row['sellerusername'];
			    $rtn[$i]['sellerpassword']	=$row['sellerpassword'];
			    $rtn[$i]['sellerinvalid']	=$row['sellerinvalid'];
			    $rtn[$i]['sellerdeleteflg']	=$row['sellerdeleteflg'];
			    $rtn[$i]['admindeleteflg']	=$row['admindeleteflg'];
			    $rtn[$i]['sellerupdatedate']	=$row['sellerupdatedate'];
			    $rtn[$i]['sellercreatetime']	=$row['sellercreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }
       function getReservepointtype($rsv_id){
       
			$sql = "select * from reservepointtype  where rsv_id= ? and rptypemembernum >0";
			$tmp="$rsv_id";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $rsv_id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rptypeid']					=$row['rptypeid'];
			    $rtn[$i]['rsv_id']						=$row['rsv_id'];
			    $rtn[$i]['activitypointid']				=$row['activitypointid'];
			    $rtn[$i]['activitypointname_en']		=$row['activitypointname_en'];
			    $rtn[$i]['activitypointname_us']		=$row['activitypointname_us'];
			    $rtn[$i]['activitypointname_jp']		=$row['activitypointname_jp'];
			    $rtn[$i]['activitypointname_cn']		=$row['activitypointname_cn'];
			    $rtn[$i]['activitypointname_tw']		=$row['activitypointname_tw'];
			    $rtn[$i]['activitypointname_kr']		=$row['activitypointname_kr'];
			    $rtn[$i]['rptypemembernum']				=$row['rptypemembernum'];
			    $rtn[$i]['rptypeunitprice']				=$row['rptypeunitprice'];
			    $rtn[$i]['rptypepeoplenum']				=$row['rptypepeoplenum'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }   
       
       function getCancelReserves($rsvbuyid){
       
			$sql = "select * from reserve  where rsvbuyid= ? and rsviscanceled=1";
			$tmp="$rsvbuyid";



			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $rsvbuyid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']					=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }
           
       function getNoCancelReserves($rsvbuyid,$rsvb2bflg){
       
			$sql = "select * from reserve  where rsvbuyid= ? and rsviscanceled<>1 and rsvb2bflg= ?";
			$tmp="$rsvbuyid";



			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ii", $rsvbuyid,$rsvb2bflg);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']					=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }
       function getReserve($rsvbuyid){
       
			$sql = "select * from reserve  where rsvbuyid= ? ";
			$tmp="$rsvbuyid";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $rsvbuyid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']					=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }
       
       
       function getReserveActivitydetailByRsvbuyid($rsvbuyid,$isb2b){
       
			$sql = "select * from reserve as r left join activitydetail as a on r.rsvactivitydetailid= a.activitydetailid  where r.rsvbuyid= ? and rsvb2bflg = ?";
			$tmp="$rsvbuyid";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ii", $rsvbuyid,$isb2b);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln_jp']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitymainpln_en']			=$row['rsvactivitymainpln_en'];
			    $rtn[$i]['rsvactivitymainpln_cn']			=$row['rsvactivitymainpln_cn'];
			    $rtn[$i]['rsvactivitymainpln_tw']			=$row['rsvactivitymainpln_tw'];
			    $rtn[$i]['rsvactivitymainpln_kr']			=$row['rsvactivitymainpln_kr'];
			    
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs_jp']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvactivitydetailcrs_en']		=$row['rsvactivitydetailcrs_en'];
			    $rtn[$i]['rsvactivitydetailcrs_cn']		=$row['rsvactivitydetailcrs_cn'];
			    $rtn[$i]['rsvactivitydetailcrs_tw']		=$row['rsvactivitydetailcrs_tw'];
			    $rtn[$i]['rsvactivitydetailcrs_kr']		=$row['rsvactivitydetailcrs_kr'];
			    
			    
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];
			    
			    $rtn[$i]['rsvstatusatcancel']				=$row['rsvstatusatcancel'];
			    
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    	
			    $rtn[$i]['rsvbabynum']					=$row['rsvbabynum'];

			    	
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];
			    
			    
			    $rtn[$i]['activitydetailid']					=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']					=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']						=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']					=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']				=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']				=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']				=$row['activitydetailcrs_cn'];
			    $rtn[$i]['activitydetailcrs_tw']				=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']				=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']					=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']					=$row['activitydetailto'];
			    $rtn[$i]['activitystock']						=$row['activitystock'];
			    $rtn[$i]['activitydetailschdtal_jp']			=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']					=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']					=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']					=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']					=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']					=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']					=$row['activitydetailinstrct_en'];
			    $rtn[$i]['activitydetailinstrct_cn']					=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']					=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']					=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']					=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']					=$row['activitydetailfarcont_en'];
			    $rtn[$i]['activitydetailfarcont_cn']					=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']					=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']					=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']					=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']					=$row['activitydetailmetplc_en'];
			    $rtn[$i]['activitydetailmetplc_cn']					=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']					=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']					=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']					=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']					=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime_jp']					=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailmettime_en']					=$row['activitydetailmettime_en'];
			    $rtn[$i]['activitydetailmettime_cn']					=$row['activitydetailmettime_cn'];
			    $rtn[$i]['activitydetailmettime_tw']					=$row['activitydetailmettime_tw'];
			    $rtn[$i]['activitydetailmettime_kr']					=$row['activitydetailmettime_kr'];
			    
			    
			    $rtn[$i]['activitydetailminpar']					=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']					=$row['activitydetailmaxpar'];
			    $rtn[$i]['activitydetailtejmaid']					=$row['activitydetailtejmaid'];
			    $rtn[$i]['activitydetailtejmait']					=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']					=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']					=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']					=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']					=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']					=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']					=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']					=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']					=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']					=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']					=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']					=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['activitydetailimgcp2_jp']					=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']					=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']					=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']					=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']					=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']					=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']					=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']					=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']					=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']					=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']					=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']					=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']					=$row['activitydetailimgcp4_cn'];
			    
			    $rtn[$i]['activitydetailimgcp4_tw']					=$row['activitydetailimgcp4_tw'];			    
			    $rtn[$i]['activitydetailimgcp4_kr']					=$row['activitydetailimgcp4_kr'];			    
			    $rtn[$i]['activitydetailmov_jp']					=$row['activitydetailmov_jp'];			    
			    $rtn[$i]['activitydetailmov_en']					=$row['activitydetailmov_en'];			    
			    $rtn[$i]['activitydetailmov_cn']					=$row['activitydetailmov_cn'];			    
			    $rtn[$i]['activitydetailmov_tw']					=$row['activitydetailmov_tw'];			    
			    $rtn[$i]['activitydetailmov_kr']					=$row['activitydetailmov_kr'];			    
			    $rtn[$i]['activitydetailmovcmt_jp']					=$row['activitydetailmovcmt_jp'];			    
			    $rtn[$i]['activitydetailmovcmt_en']					=$row['activitydetailmovcmt_en'];			    
			    $rtn[$i]['activitydetailmovcmt_cn']					=$row['activitydetailmovcmt_cn'];			    
			    $rtn[$i]['activitydetailmovcmt_tw']					=$row['activitydetailmovcmt_tw'];			    
			    $rtn[$i]['activitydetailmovcmt_kr']					=$row['activitydetailmovcmt_kr'];			    
			    $rtn[$i]['activitydetailmovurl']					=$row['activitydetailmovurl'];			    
			    $rtn[$i]['activitydetailreqtime']					=$row['activitydetailreqtime'];			    
			    $rtn[$i]['activitydetailstartage']					=$row['activitydetailstartage'];			    
			    $rtn[$i]['activitydetailendage']					=$row['activitydetailendage'];			    
			    $rtn[$i]['activitydetaildeleter']					=$row['activitydetaildeleter'];			    
			    $rtn[$i]['activitydetailcreattime']					=$row['activitydetailcreattime'];			    

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }
              
       function getReserveByRsvid($rsvid){
       
			$sql = "select * from reserve  where rsvid= ? ";
			$tmp="$rsvid";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $rsvid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['rsvid']						=$row['rsvid'];
			    $rtn[$i]['rsvcd']						=$row['rsvcd'];
			    
			    $rtn[$i]['agt_id']						=$row['agt_id'];
			    $rtn[$i]['rsvlang']						=$row['rsvlang'];
			    $rtn[$i]['urlareaid']						=$row['urlareaid'];
			    
			    $rtn[$i]['rsvstartdate']				=$row['rsvstartdate'];
			    $rtn[$i]['rsvserialnum']				=$row['rsvserialnum'];
			    $rtn[$i]['rsvcouponid']					=$row['rsvcouponid'];
			    $rtn[$i]['rsvcouponcd']					=$row['rsvcouponcd'];
			    $rtn[$i]['rsvcouponname']				=$row['rsvcouponname'];
			    $rtn[$i]['rsvcompanyid']				=$row['rsvcompanyid'];
			    $rtn[$i]['rsvcompanycd']				=$row['rsvcompanycd'];
			    $rtn[$i]['rsvactivitymainid']			=$row['rsvactivitymainid'];
			    $rtn[$i]['rsvactivitymainplncd']		=$row['rsvactivitymainplncd'];
			    $rtn[$i]['rsvactivitymainpln_jp']			=$row['rsvactivitymainpln'];
			    $rtn[$i]['rsvactivitymainpln_en']			=$row['rsvactivitymainpln_en'];
			    $rtn[$i]['rsvactivitymainpln_cn']			=$row['rsvactivitymainpln_cn'];
			    $rtn[$i]['rsvactivitymainpln_tw']			=$row['rsvactivitymainpln_tw'];
			    $rtn[$i]['rsvactivitymainpln_kr']			=$row['rsvactivitymainpln_kr'];
			    
			    $rtn[$i]['rsvactivitydetailid']			=$row['rsvactivitydetailid'];
			    $rtn[$i]['rsvactivitydetailseqcd']		=$row['rsvactivitydetailseqcd'];
			    $rtn[$i]['rsvactivitydetailcrscd']		=$row['rsvactivitydetailcrscd'];
			    $rtn[$i]['rsvactivitydetailcrs_jp']		=$row['rsvactivitydetailcrs'];
			    $rtn[$i]['rsvactivitydetailcrs_en']		=$row['rsvactivitydetailcrs_en'];
			    $rtn[$i]['rsvactivitydetailcrs_cn']		=$row['rsvactivitydetailcrs_cn'];
			    $rtn[$i]['rsvactivitydetailcrs_tw']		=$row['rsvactivitydetailcrs_tw'];
			    $rtn[$i]['rsvactivitydetailcrs_kr']		=$row['rsvactivitydetailcrs_kr'];
			    
			    $rtn[$i]['rsvdelegatefist']				=$row['rsvdelegatefist'];
			    $rtn[$i]['rsvdelegatelast']				=$row['rsvdelegatelast'];
			    $rtn[$i]['rsvdelegatesex']				=$row['rsvdelegatesex'];
			    $rtn[$i]['rsvdelegateage']				=$row['rsvdelegateage'];
			    $rtn[$i]['rsvdelegatetel']				=$row['rsvdelegatetel'];

			    $rtn[$i]['sectionname1']				=$row['sectionname1'];
			    $rtn[$i]['sectionname2']				=$row['sectionname2'];
			    $rtn[$i]['sectionname3']				=$row['sectionname3'];
			    $rtn[$i]['sectionname4']				=$row['sectionname4'];
			    $rtn[$i]['sectionname5']				=$row['sectionname5'];
			    $rtn[$i]['sectionname6']				=$row['sectionname6'];

			    $rtn[$i]['rsvbuyid']					=$row['rsvbuyid'];

			    $rtn[$i]['rsvbabynum']					=$row['rsvbabynum'];
			    $rtn[$i]['rsvusedstock']				=$row['rsvusedstock'];
			    $rtn[$i]['rsvusedpointval']				=$row['rsvusedpointval'];
			    $rtn[$i]['rsvusedstock']				=$row['rsvusedstock'];			    
			    			    
			    $rtn[$i]['rsvperiod']					=$row['rsvperiod'];
			    

			    
			    
			    $rtn[$i]['rsvlivearea_id']				=$row['rsvlivearea_id'];
			    $rtn[$i]['rsvactivitytypecnt']			=$row['rsvactivitytypecnt'];
			    $rtn[$i]['rsvfinalmoney']				=$row['rsvfinalmoney'];
			    $rtn[$i]['rsvfinalpointval']			=$row['rsvfinalpointval'];
			    $rtn[$i]['rsvcouponheldcompany']		=$row['rsvcouponheldcompany'];
			    $rtn[$i]['rsvactivitymainmod']			=$row['rsvactivitymainmod'];
			    $rtn[$i]['rsvactivitymainkbn']			=$row['rsvactivitymainkbn'];
			    $rtn[$i]['rsvactivitymainify']			=$row['rsvactivitymainify'];
			    $rtn[$i]['rsvactivitytype_id']			=$row['rsvactivitytype_id'];
			    
			    $rtn[$i]['rsvarea_fid']					=$row['rsvarea_fid'];
			    $rtn[$i]['rsvarea_id']					=$row['rsvarea_id'];
			    $rtn[$i]['rsvactivitymainlangflg_jp']	=$row['rsvactivitymainlangflg_jp'];
			    $rtn[$i]['rsvactivitymainlangflg_en']	=$row['rsvactivitymainlangflg_en'];
			    $rtn[$i]['rsvactivitymainlangflg_cn']	=$row['rsvactivitymainlangflg_cn'];
			    $rtn[$i]['rsvactivitymainlangflg_tw']	=$row['rsvactivitymainlangflg_tw'];
			    $rtn[$i]['rsvactivitymainlangflg_kr']	=$row['rsvactivitymainlangflg_kr'];
			    $rtn[$i]['rsvisused']					=$row['rsvisused'];
			    $rtn[$i]['rsviscanceled']				=$row['rsviscanceled'];
			    $rtn[$i]['rsvcreatedatetime']			=$row['rsvcreatedatetime'];


			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;
		         
       }       
        function updateSellers($admin_id,$sellercode,$company_id,$sellerusername,$sellerpassword,$sellerid){
        
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update Sellers set 
       		admin_id =?,
       		sellercode = ?,
       		company_id = ?,
       		sellerusername = ?,
       		sellerpassword = ?,
       		sellerupdatedate = ? 
       		where sellerid  = ?";
       		
       		$tmp="$admin_id,$sellercode,$company_id,$sellerusername,$sellerpassword,$sellerupdatedate,$sellerid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('isssssi',$admin_id,$sellercode,$company_id,$sellerusername,$sellerpassword,$sellerupdatedate,$sellerid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				return -1;
			}
			
       }   
        function updateBuyingByBuyid($buyid,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval){
        
        	if($delegatefist==""){
        		echo "姓がない、更新できない";
        		exit;
        	}
        	if($delegatelast==""){
        		echo "名がない更新できない";
        		exit;
        	}
        	if($delegatesex==""){
        		echo "更新できない";
        		exit;
        	}
        	if($delegateage==""){
        		echo "更新できない";
        		exit;
        	}
        	if($delegatetel==""){
        		echo "更新できない";
        		exit;
        	}
        	if($delegatemail==""){
        		echo "更新できない";
        		exit;
        	}
        	if($caldate==""){
        		echo "更新できない";
        		exit;
        	}
        	if($period==0){
        		echo "ポイントを０にするのは開発者と連絡してから更新してください。";
        		exit;
        	}
        	if($finalmoney==0){
        		echo "更新できない";
        		exit;
        	}
        	if($finalpointval==0){
        		echo "ポイントを０にするのは開発者と連絡してから更新してください。";
        		exit;
        	}
        	
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buying set 
       		delegatefist =?,
       		delegatelast =?,
       		delegatesex =?,
       		delegateage =?,
       		delegatetel =?,
       		delegatemail = ?,
       		caldate = ?,  
       		period = ?,  
       		finalmoney = ? , 
       		finalpointval = ?  
       		 where buyid = ?";
       		
       		$tmp="$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval,$buyid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssiisssiiii',$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval,$buyid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				return -1;
			}
			
       }    
        function updateBuyingB2bByBuyid($buyid,$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval){
        
        	if($delegatefist==""){
        		echo "姓がない、更新できない";
        		exit;
        	}
        	if($delegatelast==""){
        		echo "名がない更新できない";
        		exit;
        	}
        	if($delegatesex==""){
        		echo "性別ない";
        		exit;
        	}
        	if($delegateage==""){
        		echo "年齢ない";
        		exit;
        	}
        	if($delegatetel==""){
        		echo "電話番号ない";
        		exit;
        	}
        	if($delegatemail==""){
        		echo "メールない";
        		exit;
        	}
        	if($caldate==""){
        		echo "利用開始日ない";
        		exit;
        	}
        	if($period==0){
        		echo "ポイントを０にするのは開発者と連絡してから更新してください。";
        		exit;
        	}

        	if($finalpointval==0){
        		echo "ポイントを０にするのは開発者と連絡してから更新してください。";
        		exit;
        	}
        	
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update buyingb2b set 
       		delegatefist =?,
       		delegatelast =?,
       		delegatesex =?,
       		delegateage =?,
       		delegatetel =?,
       		delegatemail = ?,
       		caldate = ?,  
       		period = ?,  
       		finalmoney = ? , 
       		finalpointval = ?  
       		 where buyid = ?";
       		
       		$tmp="$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval,$buyid";

    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
		
				$stmt->bind_param('ssiisssiiii',$delegatefist,$delegatelast,$delegatesex,$delegateage,$delegatetel,$delegatemail,$caldate,$period,$finalmoney,$finalpointval,$buyid);
			}
			
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				return -1;
			}
			
			
       }    
             
        function updateDissign($dissignid,$dissignname,$dissignfolder){
        
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update dissign set 
       		dissignname =?,
       		dissignfolder =?  
       		 where dissignid = ?";
       		
       		$tmp="$dissignname,$dissignfolder,$dissignid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('ssi',$dissignname,$dissignfolder,$dissignid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				return -1;
			}
			
       }    
       
       
       
        function updateActivitytype($adminid,$activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex,$activitytypeid){
        
       		$sellerupdatedate=date('Y-m-d');
       		$sql = "update activitytype set 
       		activityname_jp =?,
       		activityname_en =?,
       		activityname_cn =?,
       		activityname_tw =?,
       		activityname_kr =?,
       		
       		activitytype = ?,
       		activitytypeindex = ?  
       		 where activitytypeid = ?";
       		
       		$tmp="$activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex,$activitytypeid";
    		
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('sssssiii',$activityname_jp,$activityname_en,$activityname_cn,$activityname_tw,$activityname_kr,$activitytype,$activitytypeindex,$activitytypeid);
			}
			$done = $stmt->execute();
			if($done){
				return 1;
			}else{
				return -1;
			}
			
       }    
       
                   
       function deleteSeller($sellerid){
       
       
	      	 $sql = "delete from Sellers where sellerid = ?";
	       
	       
       		$tmp="$sellerid";

			
			
			$stmt =$this->link->prepare($sql);
			if($stmt){
				$stmt->bind_param('i',$sellerid);
				$stmt->execute();
				if($stmt->affected_rows>0){
					return 1;
				}else{
					print_r( mysqli_errno($stmt));
					return -1;
				}
			}
       
       }
 		//会社情報
       function addCompany(
			$companycd,
    		$companyname_jp,
    		$companyname_en,
    		$companyname_cn,
    		$companyname_tw,
    		$companyname_kr,
	        $companymail,
	        $companyloginid,
	        $companypass,
    		$companytel_jp,
    		$companytel_en,
    		$companytel_cn,
    		$companytel_tw,
    		$companytel_kr,
	        $companyzipcd,
    		$companyaddr1_jp,
    		$companyaddr2_jp,
    		$companyaddr1_en,
    		$companyaddr2_en,
    		$companyaddr1_cn,
    		$companyaddr2_cn,
    		$companyaddr1_tw,
    		$companyaddr2_tw,
    		$companyaddr1_kr,
    		$companyaddr2_kr,
	    	$agtcontact_jp,
	    	$agtcontact_en,
	    	$agtcontact_cn,
	    	$agtcontact_tw,
	    	$agtcontact_kr,
			$companyagtflg,
			$admin_id
       ){
			$sql="INSERT INTO company (
				companycd,
				companyname_jp,
				companyname_en,
				companyname_cn,
				companyname_tw,
				companyname_kr,
				companymail,
				companyloginid,
				companypass,
				companytel_jp,
				companytel_en,
				companytel_cn,
				companytel_tw,
				companytel_kr,
				companyzipcd,
				companyaddr1_jp,
				companyaddr2_jp,
				companyaddr1_en,
				companyaddr2_en,
				companyaddr1_cn,
				companyaddr2_cn,
				companyaddr1_tw,
				companyaddr2_tw,
				companyaddr1_kr,
				companyaddr2_kr,
				agtcontact_jp,
				agtcontact_en,
				agtcontact_cn,
				agtcontact_tw,
				agtcontact_kr,
				companyagtflg,
				companymakerid
			) VALUES(
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),
				TRIM(?),
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),			
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?),
				TRIM(?)
			)";
			$tmp="
				$companycd,
				$companyname_jp,
				$companyname_en,
				$companyname_cn,
				$companyname_tw,
				$companyname_kr,
				$companymail,
				$companyloginid,
				$companypass,
				$companytel_jp,
				$companytel_en,
				$companytel_cn,
				$companytel_tw,
				$companytel_kr,
				$companyzipcd,
				$companyaddr1_jp,
				$companyaddr2_jp,
				$companyaddr1_en,
				$companyaddr2_en,
				$companyaddr1_cn,
				$companyaddr2_cn,
				$companyaddr1_tw,
				$companyaddr2_tw,
				$companyaddr1_kr,
				$companyaddr2_kr,
				
		    	$agtcontact_jp,
		    	$agtcontact_en,
		    	$agtcontact_cn,
		    	$agtcontact_tw,
		    	$agtcontact_kr,

				$companyagtflg,
				$admin_id		
				
			";

			
			$stmt =$this->link->prepare($sql);
			
			$stmt->bind_param("ssssssssssssssssssssssssssssssii",
				$companycd,
				$companyname_jp,
				$companyname_en,
				$companyname_cn,
				$companyname_tw,
				$companyname_kr,
				$companymail,
				$companyloginid,
				$companypass,
				$companytel_jp,
				$companytel_en,
				$companytel_cn,
				$companytel_tw,
				$companytel_kr,
				$companyzipcd,
				$companyaddr1_jp,
				$companyaddr2_jp,
				$companyaddr1_en,
				$companyaddr2_en,
				$companyaddr1_cn,
				$companyaddr2_cn,
				$companyaddr1_tw,
				$companyaddr2_tw,
				$companyaddr1_kr,
				$companyaddr2_kr,
				
		    	$agtcontact_jp,
		    	$agtcontact_en,
		    	$agtcontact_cn,
		    	$agtcontact_tw,
		    	$agtcontact_kr,

				$companyagtflg,
				$admin_id												
			);


			$res=$stmt->execute();
			if($stmt->affected_rows > 0){ //
			       return mysqli_insert_id($this->link);
			      	
			   }else{


			       return -1;
			}
       } 
       function getCompany($id){
		
			$sql = "select * from company  where companyid= ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    $rtn[$i]['companyloginid']	=$row['companyloginid'];
			     $rtn[$i]['companymail']	=$row['companymail'];
			    $rtn[$i]['companypass']	=$row['companypass'];
			     $rtn[$i]['companyareaid']	=$row['companyareaid'];
			    
			    $rtn[$i]['companytel_jp']	=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']	=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']	=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']	=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']	=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']	=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']	=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']	=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']	=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']	=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']	=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']	=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']	=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']	=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']	=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']	=$row['companyaddr2_kr'];
			    
			    $rtn[$i]['agtcontact_jp']	=$row['agtcontact_jp'];
			    $rtn[$i]['agtcontact_en']	=$row['agtcontact_en'];
			    $rtn[$i]['agtcontact_cn']	=$row['agtcontact_cn'];
			    $rtn[$i]['agtcontact_tw']	=$row['agtcontact_tw'];
			    $rtn[$i]['agtcontact_kr']	=$row['agtcontact_kr'];

			    
			    $rtn[$i]['companyagtflg']	=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']	=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    
			    
				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }

       function getCompanyByCompanyloginid($loginid){
		
			$sql = "select * from company  where companyloginid= ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("s", $loginid);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    $rtn[$i]['companyloginid']	=$row['companyloginid'];
			     $rtn[$i]['companymail']	=$row['companymail'];
			    $rtn[$i]['companypass']	=$row['companypass'];
			     $rtn[$i]['companyareaid']	=$row['companyareaid'];
			    
			    $rtn[$i]['companytel_jp']	=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']	=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']	=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']	=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']	=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']	=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']	=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']	=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']	=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']	=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']	=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']	=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']	=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']	=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']	=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']	=$row['companyaddr2_kr'];
			    
			    $rtn[$i]['agtcontact_jp']	=$row['agtcontact_jp'];
			    $rtn[$i]['agtcontact_en']	=$row['agtcontact_en'];
			    $rtn[$i]['agtcontact_cn']	=$row['agtcontact_cn'];
			    $rtn[$i]['agtcontact_tw']	=$row['agtcontact_tw'];
			    $rtn[$i]['agtcontact_kr']	=$row['agtcontact_kr'];

			    
			    $rtn[$i]['companyagtflg']	=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']	=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    
			    
				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }
              
                     
       function getCompanyByCompanycd($cd){
		
			$sql = "select * from company  where companycd= ? ";
			$tmp="$sellercode";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("s", $cd);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    $rtn[$i]['companyloginid']	=$row['companyloginid'];
			     $rtn[$i]['companymail']	=$row['companymail'];
			    $rtn[$i]['companypass']	=$row['companypass'];
			     $rtn[$i]['companyareaid']	=$row['companyareaid'];
			    
			    $rtn[$i]['companytel_jp']	=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']	=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']	=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']	=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']	=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']	=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']	=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']	=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']	=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']	=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']	=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']	=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']	=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']	=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']	=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']	=$row['companyaddr2_kr'];
			    
			    $rtn[$i]['agtcontact_jp']	=$row['agtcontact_jp'];
			    $rtn[$i]['agtcontact_en']	=$row['agtcontact_en'];
			    $rtn[$i]['agtcontact_cn']	=$row['agtcontact_cn'];
			    $rtn[$i]['agtcontact_tw']	=$row['agtcontact_tw'];
			    $rtn[$i]['agtcontact_kr']	=$row['agtcontact_kr'];

			    
			    $rtn[$i]['companyagtflg']	=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']	=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    
			    
				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }
              
       
       function getMyCompany($areaid,$companyid,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid=ca.company_id where c.companydeleterid=0 and ca.area_id=? and c.companyid= ? limit ? , ?";
			
			$tmp="$companyid,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiii",$areaid,$companyid,$start_from, $num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']			=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']			=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']			=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']			=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    
			    
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

       }       
   
                 
       function getCompanys($areaid,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from company where companydeleterid=0 and companyareaid = ? limit ?,?";
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid=ca.company_id where c.companydeleterid=0 and ca.area_id=? limit ?,?";
			
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']			=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']			=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']			=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']			=$row['companyname_kr'];
			    
			    
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']			=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']			=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']			=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']			=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    
			    
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

       }              
       function searchCompanys($companyid,$searchkey,$areaid){

       		$updatedate=date('Y-m-d');
			//$sql = "select * from company where CONCAT_WS(`companycd`,`companyname_jp`,`companymail`,`companytel_jp`,`companyaddr1_jp`,`companyaddr2_jp`) LIKE CONCAT('%',?,'%') and  companydeleterid=0  and companyareaid= ? and companyid= ?";
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid= ca.company_id  where  CONCAT_WS(`companycd`,`companyname_jp`,`companymail`,`companytel_jp`,`companyaddr1_jp`,`companyaddr2_jp`) LIKE CONCAT('%',?,'%') and c.companydeleterid=0 and ca.area_id= ? and c.companyid= ?";
			
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$areaid,$companyid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']			=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  

		  return $rtn;

       }        
       function searchMyCompanys($companyid,$searchkey,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			$sql = "select * from company where CONCAT_WS(`companycd`,`companyname`,`companymail`,`companytel`,`companyaddr1`,`companyaddr2`) LIKE CONCAT('%',?,'%') and  companydeleterid=0 limit ?,?";
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname']			=$row['companyname'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel']			=$row['companytel'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];

			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

       }        
       function searchAllCompanys($searchkey,$areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid= ca.company_id  where  CONCAT_WS(`companycd`,`companyname_jp`,`companymail`,`companytel_jp`,`companyaddr1_jp`,`companyaddr2_jp`) LIKE CONCAT('%',?,'%') and c.companydeleterid=0 and ca.area_id= ? ";
			$stmt = $this->link->prepare($sql);
			$tmp="$searchkey,$areaid";

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("si",$searchkey,$areaid);		
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']			=$row['companytel_jp'];
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1']		=$row['companyaddr1'];
			    $rtn[$i]['companyaddr2']		=$row['companyaddr2'];
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  
	
		  return $rtn;

			
       } 
       
       
       function getAllCompanys($areaid){

       		$updatedate=date('Y-m-d');
			//$sql = "select * from company where companydeleterid=0 and companyareaid = ?";
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid=ca.company_id where c.companydeleterid=0 and ca.area_id=?";
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);		
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']		=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']		=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']		=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']		=$row['companyname_kr'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']		=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']		=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']		=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']		=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']		=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  
	
		  return $rtn;

			
       } 
               
       
       function getMyCompanys($areaid,$companyid){

       		$updatedate=date('Y-m-d');
			//$sql = "select * from company where companydeleterid=0 and companyareaid = ?";
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid=ca.company_id where c.companydeleterid=0 and ca.area_id=? and c.companyid= ? ";
			$tmp="ii";

			$stmt = $this->link->prepare($sql);


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$areaid,$companyid);		
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']		=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']		=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']		=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']		=$row['companyname_kr'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']		=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']		=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']		=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']		=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']		=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  
	
		  return $rtn;

			
       }                            
       function getAreaCompanys( $areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from company as c left join companyid_areaids as ca on c.companyid = ca.company_id where c.companydeleterid=0 and ca.area_id = ?";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['companyid']			=$row['companyid'];
			    $rtn[$i]['companycd']			=$row['companycd'];
			    $rtn[$i]['companyname_jp']		=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']		=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']		=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']		=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']		=$row['companyname_kr'];
			    $rtn[$i]['companymail']			=$row['companymail'];
			    $rtn[$i]['companytel_jp']		=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']		=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']		=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']		=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']		=$row['companytel_kr'];
			    
			    $rtn[$i]['companyzipcd']		=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']		=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']		=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']		=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']		=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']		=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']		=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']		=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']		=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']		=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']		=$row['companyaddr2_kr'];
			    
			    
			    $rtn[$i]['companymakerid']		=$row['companymakerid'];
			    $rtn[$i]['companyupdaterid']	=$row['companyupdaterid'];
			    
			    $rtn[$i]['companydeleterid']	=$row['companydeleterid'];
			    $rtn[$i]['companyupdatetime']	=$row['companyupdatetime'];
			    $rtn[$i]['companycreatetime']	=$row['companycreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
		  
	
		  return $rtn;

			
       } 
               
       function getAllActivitytypeTabi($activitytype){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitytype where activitydeleter=0 and activitytype=? order by activitytypeindex desc";
			
	
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			if($stmt){
					$stmt->bind_param('i',$activitytype);
					$stmt->execute();
					$result = $stmt->get_result();
					$num_of_rows = $result->num_rows;
					$i=0;
					while ($row = $result->fetch_assoc()) {
					
					    $rtn[$i]['activitytypeid']		=$row['activitytypeid'];
					    $rtn[$i]['activityname_jp']		=$row['activityname_jp'];
					    $rtn[$i]['activityname_en']		=$row['activityname_en'];
					    $rtn[$i]['activityname_cn']		=$row['activityname_cn'];
					    $rtn[$i]['activityname_tw']		=$row['activityname_tw'];
					    $rtn[$i]['activityname_kr']		=$row['activityname_kr'];
					    
					    $rtn[$i]['activitytype']		=$row['activitytype'];
					    $rtn[$i]['activitydeleter']		=$row['activitydeleter'];
					    $rtn[$i]['activitycreatetime']	=$row['activitycreatetime'];

					    
						$i++;
					}
				  $stmt->free_result();
					
			}
							


		  
	
		  return $rtn;

			
       }        
         function delcompanyinfo($id,$deleteby){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update company set companydeleterid = ?  where companyid   = ?";
	       		
	       		$tmp="$id,$deleteby";

		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('ii',$deleteby,$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	      }
        
         function delActivitytype($id,$deleteby){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update activitytype set activitydeleter = ?  where activitytypeid   = ?";
	       		
	       		$tmp="$id,$deleteby";

		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('ii',$deleteby,$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	      }
	      
        
         function delDissign($id,$deleteby){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update dissign set dissigndeleter = ?  where dissignid   = ?";
	       		
	       		$tmp="$deleteby,$id";

		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('ii',$deleteby,$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	      }
	      	      
         function updateCompanyInfo(
         	$companycd,
         	$companyname_jp,
         	$companyname_en,
         	$companyname_cn,
         	$companyname_tw,
         	$companyname_kr,
         	$companyloginid,
         	$companymail,
         	$companypass,
         	$companyareaid,
         	
         	$companytel_jp,
         	$companytel_en,
         	$companytel_cn,
         	$companytel_tw,
         	$companytel_kr,
         	
         	$companyzipcd,
         	$companyaddr1_jp,
         	$companyaddr2_jp,
         	$companyaddr1_en,
         	$companyaddr2_en,
         	$companyaddr1_cn,
         	$companyaddr2_cn,
         	$companyaddr1_tw,
         	$companyaddr2_tw,
         	$companyaddr1_kr,
         	$companyaddr2_kr,
         	
	    	$agtcontact_jp,
	    	$agtcontact_en,
	    	$agtcontact_cn,
	    	$agtcontact_tw,
	    	$agtcontact_kr,
         	
         	$companyupdaterid,
         	$companyagtflg,
         	$companyid
         	
         	){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update company set 
	       		companycd = ?,
	       		companyname_jp = ?,
	       		companyname_en = ?,
	       		companyname_cn = ?,
	       		companyname_tw = ?,
	       		companyname_kr = ?,
	       		companyloginid= ?,
	       		companymail= ?,
	       		companypass= ?,
	       		companyareaid= ?,
	       		companytel_jp= ? ,
	       		companytel_en= ? ,
	       		companytel_cn= ? ,
	       		companytel_tw= ? ,
	       		companytel_kr= ? ,
	       		
	       		companyzipcd= ? ,
	       		companyaddr1_jp= ? ,
	       		companyaddr2_jp= ? ,
	       		companyaddr1_en= ? ,
	       		companyaddr2_en= ? ,
	       		companyaddr1_cn= ? ,
	       		companyaddr2_cn= ? ,
	       		companyaddr1_tw= ? ,
	       		companyaddr2_tw= ? ,
	       		companyaddr1_kr= ? ,
	       		companyaddr2_kr= ? ,
	       		
	       		agtcontact_jp= ? ,
	       		agtcontact_en= ? ,
	       		agtcontact_cn= ? ,
	       		agtcontact_tw= ? ,
	       		agtcontact_kr= ? ,
	       		
	       		
	       		companyupdaterid= ? ,
	       		companyupdatetime= ? ,
	       		companyagtflg =?   
	       		where companyid  = ?";
	       		
	       		$tmp="
		         	$companycd,
		         	$companyname_jp,
		         	$companyname_en,
		         	$companyname_cn,
		         	$companyname_tw,
		         	$companyname_kr,
		         	
		         	$companymail,
		         	$companypass,
		         	$companytel_jp,
		         	$companytel_en,
		         	$companytel_cn,
		         	$companytel_tw,
		         	$companytel_kr,
		         	
		         	$companyzipcd,
		         	$companyaddr1_jp,
		         	$companyaddr2_jp,
		         	$companyaddr1_en,
		         	$companyaddr2_en,
		         	$companyaddr1_cn,
		         	$companyaddr2_cn,
		         	$companyaddr1_tw,
		         	$companyaddr2_tw,
		         	$companyaddr1_kr,
		         	$companyaddr2_kr,
		         	
			    	$agtcontact_jp,
			    	$agtcontact_en,
			    	$agtcontact_cn,
			    	$agtcontact_tw,
			    	$agtcontact_kr,
		         	
		         	
		         	
		         	
		         	$companyupdaterid,
		         	$companyagtflg,
		         	$companyid
	       		";

				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('sssssssssisssssssssssssssssssssisii',
					$companycd,
		         	$companyname_jp,
		         	$companyname_en,
		         	$companyname_cn,
		         	$companyname_tw,
		         	$companyname_kr,
		         	$companyloginid,
					$companymail,
					$companypass,
					$companyareaid,
		         	$companytel_jp,
		         	$companytel_en,
		         	$companytel_cn,
		         	$companytel_tw,
		         	$companytel_kr,
					$companyzipcd,
		         	$companyaddr1_jp,
		         	$companyaddr2_jp,
		         	$companyaddr1_en,
		         	$companyaddr2_en,
		         	$companyaddr1_cn,
		         	$companyaddr2_cn,
		         	$companyaddr1_tw,
		         	$companyaddr2_tw,
		         	$companyaddr1_kr,
		         	$companyaddr2_kr,
		         	
			    	$agtcontact_jp,
			    	$agtcontact_en,
			    	$agtcontact_cn,
			    	$agtcontact_tw,
			    	$agtcontact_kr,
		         	
					$companyupdaterid,
					$sellerupdatedate,
					$companyagtflg,
					$companyid
					
					);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	       } 
       function getAreasByAreaid($areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from areas where areaid =? ";
			$tmp="$areaid";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']				=$row['areaid'];
 				$rtn[$i]['areafatherid']		=$row['areafatherid'];			    
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];
			    
			    $rtn[$i]['areasort']			=$row['areasort'];
			    $rtn[$i]['areainvalid']			=$row['areainvalid'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       } 
       function getFAreas($contryflg){


       		$updatedate=date('Y-m-d');
			$sql = "select * from areas where countryflg is null and areainvalid=0 and  areafatherid=0 order by areasort asc";
			if($contryflg=="jp"){
				$sql = "select * from areas where countryflg= ? and areainvalid=0 and  areafatherid=0 order by areasort asc";
			}

						
			$tmp="$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			if($contryflg<>""){
				$stmt->bind_param("s",$contryflg);	
			}

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']				=$row['areaid'];
 				$rtn[$i]['areafatherid']		=$row['areafatherid'];			    
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];
			    
			    $rtn[$i]['areasort']			=$row['areasort'];
			    $rtn[$i]['areainvalid']			=$row['areainvalid'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       } 
       function getBigAreas($contryflg){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from areas where countryflg is null and areainvalid=0 and  areafatherid=0 order by areasort asc";
			
				$sql = "select * from areas where countryflg= ? and areainvalid=0 and  areafatherid=0 order by areasort asc";
			

						
			$tmp="$contryflg";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			if($contryflg<>""){
				$stmt->bind_param("s",$contryflg);	
			}
			

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']				=$row['areaid'];
 				$rtn[$i]['areafatherid']		=$row['areafatherid'];			    
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];
			    
			    $rtn[$i]['areasort']			=$row['areasort'];
			    $rtn[$i]['areainvalid']			=$row['areainvalid'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }        

       function getAreasByAreafatherid($areafatherid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from areas where areainvalid=0 and  areafatherid=? order by areasort asc";
			$tmp="$areafatherid";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areafatherid);	


			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['areaid']				=$row['areaid'];
			    $rtn[$i]['areafatherid']		=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];
			    
			    $rtn[$i]['areasort']			=$row['areasort'];
			    $rtn[$i]['areainvalid']			=$row['areainvalid'];
			    
				$i++;
			}
		  $stmt->free_result();
		  return $rtn;

			
       }  

	   //遊び放題マスタ
       function getPlaymastersNoadmin($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where p.playisopen=1 and  p.playdeteleter=0 and p.areafather_id= ? limit ?,?";
			$tmp="$areaid,$start_from, $num_rec_per_page";

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playname_en']						=$row['playname_en'];
			    $rtn[$i]['playname_cn']						=$row['playname_cn'];
			    $rtn[$i]['playname_tw']						=$row['playname_tw'];
			    $rtn[$i]['playname_kr']						=$row['playname_kr'];
			    
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']				=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']				=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']				=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']				=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']				=$row['playdescription_kr'];
			    
			    $rtn[$i]['playnotes_jp']						=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']						=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']						=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']						=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']						=$row['playnotes_kr'];
			    
			    $rtn[$i]['playplace_jp']						=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']						=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']						=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']						=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']						=$row['playplace_kr'];
			    
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']						=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']						=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']						=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']						=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']						=$row['playaccess_kr'];
			    
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

	   //遊び放題マスタ
       function getPlaymasters($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where p.playdeteleter=0 and p.areafather_id= ? limit ?,?";
			$tmp="$areaid,$start_from, $num_rec_per_page";

			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playname_en']						=$row['playname_en'];
			    $rtn[$i]['playname_cn']						=$row['playname_cn'];
			    $rtn[$i]['playname_tw']						=$row['playname_tw'];
			    $rtn[$i]['playname_kr']						=$row['playname_kr'];
			    
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']				=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']				=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']				=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']				=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']				=$row['playdescription_kr'];
			    
			    $rtn[$i]['playnotes_jp']						=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']						=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']						=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']						=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']						=$row['playnotes_kr'];
			    
			    $rtn[$i]['playplace_jp']						=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']						=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']						=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']						=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']						=$row['playplace_kr'];
			    
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']						=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']						=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']						=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']						=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']						=$row['playaccess_kr'];
			    
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

	   //遊び放題マスタ
       function getPlaymastersByCompanyid($start_from, $num_rec_per_page,$areaid,$companyid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where p.playdeteleter=0 and p.areafather_id= ? and p.playcompany_id= ? limit ?,?";
			$tmp="$areaid,$start_from, $num_rec_per_page";

			$stmt = $this->link->prepare($sql);


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiii",$areaid,$companyid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playname_en']						=$row['playname_en'];
			    $rtn[$i]['playname_cn']						=$row['playname_cn'];
			    $rtn[$i]['playname_tw']						=$row['playname_tw'];
			    $rtn[$i]['playname_kr']						=$row['playname_kr'];
			    
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']				=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']				=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']				=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']				=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']				=$row['playdescription_kr'];
			    
			    $rtn[$i]['playnotes_jp']						=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']						=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']						=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']						=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']						=$row['playnotes_kr'];
			    
			    $rtn[$i]['playplace_jp']						=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']						=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']						=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']						=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']						=$row['playplace_kr'];
			    
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']						=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']						=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']						=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']						=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']						=$row['playaccess_kr'];
			    
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

       
       function getActivitymains($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd  where a.activitymaindeleterid=0 and a.area_fid= ?  limit ?,?";
			$tmp="$areaid,$start_from, $num_rec_per_page";
		
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];

			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];

			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   


       
       function getActivitymainsNoadmin($start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd  where a.activitymainisopen=1 and  a.activitymaindeleterid=0 and a.area_fid= ?  limit ?,?";
			$tmp="$areaid,$start_from, $num_rec_per_page";
		
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iii",$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];

			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];

			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

       function getActivitymainsBycompany($start_from, $num_rec_per_page,$areaid,$companyid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd  where a.activitymaindeleterid=0 and a.area_fid= ? and c.companyid= ?   limit ?,?";
			$tmp="$areaid,$companyid,$start_from,$num_rec_per_page";

			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("iiii",$areaid,$companyid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];

			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];

			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   



       
       function searchPlaymastersNoadmin($searchkey,$start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where p.playisopen=1 and CONCAT_WS(`playcd`,`playname_jp`,`areaname_jp`) LIKE CONCAT('%',?,'%') and  p.playdeteleter=0 and p.areafather_id = ?  limit ?,?";
			$tmp="$searchkey,$areaid,$start_from, $num_rec_per_page";
			
		
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("siii",$searchkey,$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

       
       function searchPlaymasters($searchkey,$start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where  CONCAT_WS(`playcd`,`playname_jp`,`areaname_jp`) LIKE CONCAT('%',?,'%') and  p.playdeteleter=0 and p.areafather_id = ?  limit ?,?";
			$tmp="$searchkey,$areaid,$start_from, $num_rec_per_page";
			
		
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("siii",$searchkey,$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

       
       function searchPlaymastersByCompanyid($searchkey,$areaid,$companyid){


       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where  CONCAT_WS(`playcd`,`playname_jp`,`areaname_jp`) LIKE CONCAT('%',?,'%') and  p.playdeteleter=0 and p.areafather_id = ? and p.playcompany_id=?  ";
			$tmp="$searchkey,$areaid,$start_from, $num_rec_per_page";
			
		
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$areaid,$companyid);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areaname_jp']			=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']			=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']			=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']			=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']			=$row['areaname_kr'];

			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   

       
       function searchActivitymains($searchkey,$start_from, $num_rec_per_page,$areaid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd   where   CONCAT_WS(`activitymainseq`,`activitymaincmpcd`,`activitymainplncd`,`activitymainpln_jp`)  LIKE CONCAT('%',?,'%') and  a.activitymaindeleterid=0 and a.area_fid = ?  limit ?,?";
			$tmp="$searchkey,$areaid,$start_from, $num_rec_per_page";


			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("siii",$searchkey,$areaid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
			    
			    
			    
			    

			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];

			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];

			    
			    
			    
			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   
       

       function searchActivitymainsBycompany($searchkey,$start_from, $num_rec_per_page,$areaid,$companyid){


       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd   where   CONCAT_WS(`activitymainseq`,`activitymaincmpcd`,`activitymainplncd`,`activitymainpln_jp`)  LIKE CONCAT('%',?,'%')  and a.activitymaindeleterid=0 and a.area_fid = ? and a.activitymaincmpcd  = ?  limit ?,?";
			$tmp="$searchkey,$areaid,$companyid,$start_from, $num_rec_per_page";

	
		
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("siiii",$searchkey,$areaid,$companyid,$start_from,$num_rec_per_page);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
			    
			    
			    
			    

			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];

			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];

			    
			    
			    
			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   
       
              
       function searchActivitydetails($searchkey,$f_id,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from activitydetail   where   CONCAT_WS(`activitydetailcrscd`,`activitydetailcrs_jp`)  LIKE CONCAT('%',?,'%') and  p.activitydetaildeleter=0 and activitymain_id= ? limit ?,?";
			$sql = "select * from activitydetail   where   CONCAT_WS(`activitydetailcrscd`,`activitydetailcrs_jp`)  LIKE CONCAT('%',?,'%') and  activitydetaildeleter=0 and activitymain_id= ? ";
			$tmp="$searchkey,$f_id";
			


			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("si",$searchkey,$f_id);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']						=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']						=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']							=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']						=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']					=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']					=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']					=$row['activitydetailcrs_cn'];
			    
			    $rtn[$i]['activitydetailcrs_tw']					=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']					=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']						=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']						=$row['activitydetailto'];
			    $rtn[$i]['activitydetailschdtal_jp']				=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']				=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']				=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']				=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']				=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']				=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']				=$row['activitydetailinstrct_en'];
			    
			    $rtn[$i]['activitydetailinstrct_cn']				=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']				=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']				=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']				=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']				=$row['activitydetailfarcont_en'];
			    
			    $rtn[$i]['activitydetailfarcont_cn']				=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']				=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']				=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']					=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']					=$row['activitydetailmetplc_en'];
			    
			    $rtn[$i]['activitydetailmetplc_cn']					=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']					=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']					=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']						=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']						=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']					=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']					=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']					=$row['activitydetailmaxpar'];
			    
			    $rtn[$i]['activitydetailtejmaid']					=$row['activitydetailtejmaid'];
			    
			    $rtn[$i]['activitydetailtejmait']					=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']					=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']					=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']						=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']						=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']						=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']						=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']					=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']					=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']					=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']					=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']					=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['activitydetailimgcp2_jp']					=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']					=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']					=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']					=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']					=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']					=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']					=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']					=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']					=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']					=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']					=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']					=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']					=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']					=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']					=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']					=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']					=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']					=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']					=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']					=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']					=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']					=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']					=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']					=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']					=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']					=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetaildeleter']					=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']					=$row['activitydetailcreattime'];

			    
			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   
       
       function getActivitydetails($f_id,$start_from, $num_rec_per_page){


       		$updatedate=date('Y-m-d');
			//$sql = "select * from activitydetail   where   activitydetaildeleter=0 and activitymain_id= ? limit ?,?";
			$sql = "select * from activitydetail   where   activitydetaildeleter=0 and activitymain_id= ? ";
			$tmp="$f_id,$start_from, $num_rec_per_page";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$f_id);		
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']						=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']						=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']							=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']						=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']					=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']					=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']					=$row['activitydetailcrs_cn'];
			    
			    $rtn[$i]['activitydetailcrs_tw']					=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']					=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']						=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']						=$row['activitydetailto'];
			    $rtn[$i]['activitystock']						=$row['activitystock'];
			    
			    $rtn[$i]['activitydetailschdtal_jp']				=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']				=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']				=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']				=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']				=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']				=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']				=$row['activitydetailinstrct_en'];
			    
			    $rtn[$i]['activitydetailinstrct_cn']				=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']				=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']				=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']				=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']				=$row['activitydetailfarcont_en'];
			    
			    $rtn[$i]['activitydetailfarcont_cn']				=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']				=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']				=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']					=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']					=$row['activitydetailmetplc_en'];
			    
			    $rtn[$i]['activitydetailmetplc_cn']					=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']					=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']					=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']						=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']						=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime']					=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailminpar']					=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']					=$row['activitydetailmaxpar'];
			    
			    $rtn[$i]['activitydetailtejmaid']					=$row['activitydetailtejmaid'];
			    
			    $rtn[$i]['activitydetailtejmait']					=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']					=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']					=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']						=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']						=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']						=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']						=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']					=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']					=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']					=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']					=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']					=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['activitydetailimgcp2_jp']					=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']					=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']					=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']					=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']					=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']					=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']					=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']					=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']					=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']					=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']					=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']					=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']					=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']					=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']					=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']					=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']					=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']					=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']					=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']					=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']					=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']					=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']					=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']					=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']					=$row['activitydetailmovcmt_kr'];
			    $rtn[$i]['activitydetailmovurl']					=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']					=$row['activitydetailreqtime'];
			    $rtn[$i]['activitydetailstartage']					=$row['activitydetailstartage'];
			    $rtn[$i]['activitydetailendage']					=$row['activitydetailendage'];
			    
			    $rtn[$i]['activitydetaildeleter']					=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']					=$row['activitydetailcreattime'];

			    
			    
				$i++;
			}
		  $stmt->free_result();

		  	  
		  return $rtn;

			
       }   
       
       
       function getAllPlaymaster($areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from playmaster where playdeteleter=0 and areafather_id= ? ";
			$tmp="$areaid";
			
		
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }    
       
       function getAllPlaymasterNoadmin($areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from playmaster where playisopen=1 and playdeteleter=0 and areafather_id= ? ";
			$tmp="$areaid";
			
		
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }    
       
       function getAllPlaymasterByCompanyid($areaid,$companyid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from playmaster where playdeteleter=0 and areafather_id= ? and playcompany_id = ?";
			$tmp="$areaid";
			
		
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$areaid,$companyid);	
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }    

       function getAllActivitymainByActivitymainifyAreaid($activitymainify,$area_fid,$langflg){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain where activitymainisopen=1 and activitymaindeleterid=0  and activitymainlangflg_$langflg =1 and activitymainify = ? and area_fid = ?";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("ii",$activitymainify,$area_fid);	
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$tmp="$activitymainify,$area_fid";
			
	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];
			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }
       

       function getAllActivitymainByActivitymainify($activitymainify){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain where activitymaindeleterid=0  and activitymainify = ?";
			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i",$activitymainify);	
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];
			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }
       
       function getAllActivitymain($areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain where activitymaindeleterid=0 and area_fid= ? ";
			$tmp="$areaid";

			$stmt = $this->link->prepare($sql);
	
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }

       
       function getAllActivitymainNoadmin($areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain where activitymainisopen=1 and activitymaindeleterid=0 and area_fid= ? ";
			$tmp="$areaid";

			$stmt = $this->link->prepare($sql);
	
			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$areaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }
             
       function getAllActivitymainBycompany($areaid,$companyid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain as a left join company as c on c.companyid=a.activitymaincmpcd  where a.activitymaindeleterid=0 and a.area_fid= ? and c.companyid= ?  ";

			$stmt = $this->link->prepare($sql);
			$tmp="$areaid,$companyid";


			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("ii",$areaid,$companyid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }
              
       function searchAllPlaymaster($searchkey,$areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select p.*,a.* from playmaster as p left join areas as a on p.area_id= a.areaid  where  CONCAT_WS(`playcd`,`playname_jp`,`areaname_jp`) LIKE CONCAT('%',?,'%') and  playdeteleter=0 and p.areafather_id = ?  ";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("si",$searchkey,$areaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']						=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }   
       
       
       function searchAllActivitymain($searchkey,$areaid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain  where  CONCAT_WS(`activitymainseq`,`activitymaincmpcd`,`activitymainplncd`,`activitymainpln_jp`) LIKE CONCAT('%',?,'%') and  activitymaindeleterid=0 and area_fid = ?";

			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("si",$searchkey,$areaid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }          


       
       function searchAllActivitymainBycompany($searchkey,$areaid,$companyid){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitymain  where  CONCAT_WS(`activitymainseq`,`activitymaincmpcd`,`activitymainplncd`,`activitymainpln_jp`) LIKE CONCAT('%',?,'%') and  activitymaindeleterid=0 and area_fid = ? and activitymaincmpcd = ?";
			
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("sii",$searchkey,$areaid,$companyid);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }         
              
       function searchAllActivitydetail($searchkey,$f_id){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitydetail  where  CONCAT_WS(`activitydetailcrscd`,`activitydetailcrs_jp`) LIKE CONCAT('%',?,'%') and  activitydetaildeleter=0 and activitymain_id= ?";
			$stmt = $this->link->prepare($sql);

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("si",$searchkey,$f_id);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']=$row['activitydetailid '];

			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }      
       
       function getAllActivitydetail($f_id){

       		$updatedate=date('Y-m-d');
			$sql = "select * from activitydetail  where   activitydetaildeleter=0 and activitymain_id= ?";
			$stmt = $this->link->prepare($sql);
			$tmp="$f_id";

			if(!$stmt){
				echo "sql文が正しくない";
			}
			$stmt->bind_param("i",$f_id);	
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['activitydetailid']=$row['activitydetailid '];

			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       }    

       function getAllMenutype(){


       		$updatedate=date('Y-m-d');
			$sql = "select * from menutype";
			$stmt = $this->link->prepare($sql);
			
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['menuid']							=$row['menuid'];
			    $rtn[$i]['menucd']							=$row['menucd'];
			    $rtn[$i]['menuname_jp']						=$row['menuname_jp'];
			    $rtn[$i]['menuname_en']						=$row['menuname_en'];
			    $rtn[$i]['menuname_cn']						=$row['menuname_cn'];
			    $rtn[$i]['menuname_tw']						=$row['menuname_tw'];
			    $rtn[$i]['menuname_kr']						=$row['menuname_kr'];
			    
			    
			    
			    
			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       } 

                       
       function getAllPlaymasterByArea_id($areafather_id){


       		$updatedate=date('Y-m-d');
			$sql = "select a.*,b.* from playmaster as a left join areas as b on a.area_id=b.areaid where playdeteleter=0 and areafather_id = ?";
			$stmt = $this->link->prepare($sql);
		
			$stmt->bind_param("i",$areafather_id);	
			if(!$stmt){
				echo "sql文が正しくない";
			}
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;
			$i=0;
			while ($row = $result->fetch_assoc()) {
			
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playadultNormalprice']			=$row['playadultNormalprice'];
			    $rtn[$i]['playchildrenNormalprice']			=$row['playchildrenNormalprice'];
			    $rtn[$i]['playadultOriginalprice']			=$row['playadultOriginalprice'];
			    $rtn[$i]['playchildrenOriginalprice']		=$row['playchildrenOriginalprice'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription']					=$row['playdescription'];
			    $rtn[$i]['playnotes']						=$row['playnotes'];
			    $rtn[$i]['playplace']						=$row['playplace'];
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess']						=$row['playaccess'];
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    
			    $rtn[$i]['areafather_id']					=$row['areafather_id'];
			    
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];

			    $rtn[$i]['areafatherid']					=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];

			    
				$i++;
			}
		  $stmt->free_result();
 
		  return $rtn;

			
       } 
              	 		
	       function addPlaymaster(
					$playcd,
					$playminipoint,
					$playname_jp,
					$playname_en,
					$playname_cn,
					$playname_tw,
					$playname_kr,
					$playcompany_id,
					$playpic1,
					$playpic2,
					$playpic3,
					$playpic4,
					$playpic5,
					$playdescription_jp,
					$playdescription_en,
					$playdescription_cn,
					$playdescription_tw,
					$playdescription_kr,
					$playnotes_jp,
					$playnotes_en,
					$playnotes_cn,
					$playnotes_tw,
					$playnotes_kr,
					$playplace_jp,
					$playplace_en,
					$playplace_cn,
					$playplace_tw,
					$playplace_kr,
					$playlongitude,
					$playlatitude,
					$playcontact,
					$playaccess_jp,
					$playaccess_en,
					$playaccess_cn,
					$playaccess_tw,
					$playaccess_kr,
					$playclose,
					$playclose_en,
					$playclose_cn,
					$playclose_tw,
					$playclose_kr,
					
					$playopenstart,
					$playopenstart_en,
					$playopenstart_cn,
					$playopenstart_tw,
					$playopenstart_kr,
					
					$playopenend,
					$playopenend_en,
					$playopenend_cn,
					$playopenend_tw,
					$playopenend_kr,
					
					$playhpurl,
					$playutubeurl,
					$area_id,
					$areafather_id,
					$activitytype_id,
					$jplangflg,
					$enlangflg,
					$cnlangflg,
					$twlangflg,
					$krlangflg,		
					$playisopen,					
					$playcreater
		       ){


		 
		       		$sellerupdatedate=date('Y-m-d');
					$sql="INSERT INTO playmaster 
						(
						playcd,
						playminipoint,
						playname_jp,
						playname_en,
						playname_cn,
						playname_tw,
						playname_kr,
						playcompany_id,
						playpic1,
						playpic2,
						playpic3,
						playpic4,
						playpic5,
						playdescription_jp,
						playdescription_en,
						playdescription_cn,
						playdescription_tw,
						playdescription_kr,						
						playnotes_jp,
						playnotes_en,
						playnotes_cn,
						playnotes_tw,
						playnotes_kr,
						playplace_jp,
						playplace_en,
						playplace_cn,
						playplace_tw,
						playplace_kr,
						playlongitude,
						playlatitude,
						playcontact,
						playaccess_jp,
						playaccess_en,
						playaccess_cn,
						playaccess_tw,
						playaccess_kr,
						playclose,
						playclose_en,
						playclose_cn,
						playclose_tw,
						playclose_kr,
						playopenstart,
						playopenstart_en,
						playopenstart_cn,
						playopenstart_tw,
						playopenstart_kr,
						playopenend,
						playopenend_en,
						playopenend_cn,
						playopenend_tw,
						playopenend_kr,
						
						playhpurl,
						playutubeurl,
						area_id,
						areafather_id,
						activitytype_id,
						jplangflg,
						enlangflg,
						cnlangflg,
						twlangflg,
						krlangflg,	
						playisopen,
						playcreater
						
						) 
						VALUES
						(
						TRIM(?),?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,						
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?
						
						)";
					$stmt =$this->link->prepare($sql);
			
					$stmt->bind_param(
					"sssssssisssssssssssssssssssssssssssssssssssssssssssssiiiiiiiiii",
				       $playcd,
				       $playminipoint,
				       $playname_jp,
				       $playname_en,
				       $playname_cn,
				       $playname_tw,
				       $playname_kr,
				       $playcompany_id,
				       $playpic1,
				       $playpic2,
				       $playpic3,
				       $playpic4,
				       $playpic5,
				       $playdescription_jp,
				       $playdescription_en,
				       $playdescription_cn,
				       $playdescription_tw,
				       $playdescription_kr,
				       $playnotes_jp,
				       $playnotes_en,
				       $playnotes_cn,
				       $playnotes_tw,
				       $playnotes_kr,
				       $playplace_jp,
				       $playplace_en,
				       $playplace_cn,
				       $playplace_tw,
				       $playplace_kr,				       
				       $playlongitude,
				       $playlatitude,
				       $playcontact,
				       $playaccess_jp,
				       $playaccess_en,
				       $playaccess_cn,
				       $playaccess_tw,
				       $playaccess_kr,
				       $playclose,
				       $playclose_en,
				       $playclose_cn,
				       $playclose_tw,
				       $playclose_kr,
				       $playopenstart,
				       $playopenstart_en,
				       $playopenstart_cn,
				       $playopenstart_tw,
				       $playopenstart_kr,

				       $playopenend,
				       $playopenend_en,
				       $playopenend_cn,
				       $playopenend_tw,
				       $playopenend_kr,
				       
				       $playhpurl,
				       $playutubeurl,
				       $area_id,
						$areafather_id,
						$activitytype_id,
						$jplangflg,
						$enlangflg,
						$cnlangflg,
						$twlangflg,
						$krlangflg,
						$playisopen,
				       $playcreater
					);
						$tmp="
				       $playcd,
				       $playminipoint,
				       $playname_jp,
				       $playname_en,
				       $playname_cn,
				       $playname_tw,
				       $playname_kr,
				       $playcompany_id,
				       $playpic1,
				       $playpic2,
				       $playpic3,
				       $playpic4,
				       $playpic5,
				       $playdescription_jp,
				       $playdescription_en,
				       $playdescription_cn,
				       $playdescription_tw,
				       $playdescription_kr,
				       $playnotes_jp,
				       $playnotes_en,
				       $playnotes_cn,
				       $playnotes_tw,
				       $playnotes_kr,
				       $playplace_jp,
				       $playplace_en,
				       $playplace_cn,
				       $playplace_tw,
				       $playplace_kr,				       
				       $playlongitude,
				       $playlatitude,
				       $playcontact,
				       $playaccess_jp,
				       $playaccess_en,
				       $playaccess_cn,
				       $playaccess_tw,
				       $playaccess_kr,
				       $playclose,
				       $playopenstart,
				       $playopenend,
				       $playhpurl,
				       $playutubeurl,
				       $area_id,
						$areafather_id,
						$activitytype_id,
						$jplangflg,
						$enlangflg,
						$cnlangflg,
						$twlangflg,
						$krlangflg,	
						$playisopen,					
				       $playcreater
					";

					$stmt->execute();
					if($stmt->affected_rows > 0){ //
					       return mysqli_insert_id($this->link);
					   }else{
					       return -1;
					}
	       } 

	       function addActivitymain(
					$sellerid,				
					$activitymainseq,		
					$activitymaincmpcd,		
					$activitymainplncd,		
					$activitymainminpoint,
					$activitymainpln_jp,		
					$activitymainpln_en,		
					$activitymainpln_cn,		
					$activitymainpln_tw,		
					$activitymainpln_kr,		
					$activitymainkbn,		
					$activitymainunit_jp,	
					$activitymainunit_en,	
					$activitymainunit_cn,	
					$activitymainunit_tw,	
					$activitymainunit_kr,	
					$activitymainmod,		
					$activitymainnoshowbaby,
					$activitymaincmt_jp,		
					$activitymaincmt_en,		
					$activitymaincmt_cn,		
					$activitymaincmt_tw,		
					$activitymaincmt_kr,		
					$activitymainimg,		
					$activitymainimgcp_jp,	
					$activitymainimgcp_en,	
					$activitymainimgcp_cn,	
					$activitymainimgcp_tw,	
					$activitymainimgcp_kr,	
					$activitymainreqtime,	
					$activitymainify,		
					$activitytype_id,		
					$area_fid,				
					$area_id,				
					$activitymainlangflg_jp,
					$activitymainlangflg_en,	
					$activitymainlangflg_cn,	
					$activitymainlangflg_tw,	
					$activitymainlangflg_kr,
					$activitymainisopen	
					
		       ){
	 
		       		$sellerupdatedate=date('Y-m-d');
					$sql="INSERT INTO activitymain 
						(
							activitymainseq,		
							activitymaincmpcd,		
							activitymainplncd,		
							activitymainminpoint,
							activitymainpln_jp,		
							activitymainpln_en,		
							activitymainpln_cn,		
							activitymainpln_tw,		
							activitymainpln_kr,		
							activitymainkbn,		
							activitymainunit_jp,	
							activitymainunit_en,	
							activitymainunit_cn,	
							activitymainunit_tw,	
							activitymainunit_kr,	
							activitymainmod,		
							activitymainnoshowbaby,
							activitymaincmt_jp,		
							activitymaincmt_en,		
							activitymaincmt_cn,		
							activitymaincmt_tw,		
							activitymaincmt_kr,		
							activitymainimg,		
							activitymainimgcp_jp,	
							activitymainimgcp_en,	
							activitymainimgcp_cn,	
							activitymainimgcp_tw,	
							activitymainimgcp_kr,	
							activitymainreqtime,	
							activitymainify,		
							activitytype_id,		
							area_fid,				
							area_id,				
							activitymainlangflg_jp,
							activitymainlangflg_en,	
							activitymainlangflg_cn,	
							activitymainlangflg_tw,	
							activitymainlangflg_kr,
							activitymainisopen,	
							activitymaincreaterid
						
						) 
						VALUES
						(
						TRIM(?),?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,						
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?,?,
						?,?,?,?
						
						)";
						
						$tmp="
							$activitymainseq,		
							$activitymaincmpcd,		
							$activitymainplncd,	
							$activitymainminpoint,	
							$activitymainpln_jp,		
							$activitymainpln_en,		
							$activitymainpln_cn,		
							$activitymainpln_tw,		
							$activitymainpln_kr,		
							$activitymainkbn,	
							$activitymainnoshowbaby,	
							$activitymainunit_jp,	
							$activitymainunit_en,	
							$activitymainunit_cn,	
							$activitymainunit_tw,	
							$activitymainunit_kr,	
							$activitymainmod,		
							$activitymaincmt_jp,		
							$activitymaincmt_en,		
							$activitymaincmt_cn,		
							$activitymaincmt_tw,		
							$activitymaincmt_kr,		
							$activitymainimg,		
							$activitymainimgcp_jp,	
							$activitymainimgcp_en,	
							$activitymainimgcp_cn,	
							$activitymainimgcp_tw,	
							$activitymainimgcp_kr,	
							$activitymainreqtime,	
							$activitymainify,		
							$activitytype_id,		
							$area_fid,				
							$area_id,				
							$activitymainlangflg_jp,
							$activitymainlangflg_en,	
							$activitymainlangflg_cn,	
							$activitymainlangflg_tw,	
							$activitymainlangflg_kr,
							$activitymainisopen,	
							$sellerid
					";
					
				
					$stmt =$this->link->prepare($sql);
			
					$stmt->bind_param(
						"sissssssssssssssisssssssssssiiiiiiiiiiii",
						$activitymainseq,		
						$activitymaincmpcd,		
						$activitymainplncd,		
						$activitymainminpoint,
						$activitymainpln_jp,		
						$activitymainpln_en,		
						$activitymainpln_cn,		
						$activitymainpln_tw,		
						$activitymainpln_kr,		
						$activitymainkbn,		
						$activitymainunit_jp,	
						$activitymainunit_en,	
						$activitymainunit_cn,	
						$activitymainunit_tw,	
						$activitymainunit_kr,	
						$activitymainmod,		
						$activitymainnoshowbaby,
						$activitymaincmt_jp,		
						$activitymaincmt_en,		
						$activitymaincmt_cn,		
						$activitymaincmt_tw,		
						$activitymaincmt_kr,		
						$activitymainimg,		
						$activitymainimgcp_jp,	
						$activitymainimgcp_en,	
						$activitymainimgcp_cn,	
						$activitymainimgcp_tw,	
						$activitymainimgcp_kr,	
						$activitymainreqtime,	
						$activitymainify,		
						$activitytype_id,		
						$area_fid,				
						$area_id,				
						$activitymainlangflg_jp,
						$activitymainlangflg_en,	
						$activitymainlangflg_cn,	
						$activitymainlangflg_tw,	
						$activitymainlangflg_kr,
						$activitymainisopen,	
						$sellerid
					);

					$stmt->execute();
					if($stmt->affected_rows > 0){ //
					       return mysqli_insert_id($this->link);
					   }else{
					       return -1;
					}
	       } 
	              	       
       function getActivitymain($id){
		
			$sql = "select a.*,c.*,r.* from activitymain as a  left join company as c on a.activitymaincmpcd=c.companyid left join areas as r on a.area_id=r.areaid  where a.activitymaindeleterid=0 and a.activitymainid = ?";

			$tmp="$id";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];
			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymainnoshowbaby']					=$row['activitymainnoshowbaby'];
			    
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    $rtn[$i]['activitymainisopen']						=$row['activitymainisopen'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];


			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];

			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];
			    $rtn[$i]['companyagtflg']					=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']					=$row['companymakerid'];


			    $rtn[$i]['areaid']							=$row['areaid'];
			    $rtn[$i]['areafatherid']					=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']						=$row['areaname_jp'];
			    $rtn[$i]['areaname_en']						=$row['areaname_en'];
			    $rtn[$i]['areaname_cn']						=$row['areaname_cn'];
			    $rtn[$i]['areaname_tw']						=$row['areaname_tw'];
			    $rtn[$i]['areaname_kr']						=$row['areaname_kr'];
			    $rtn[$i]['areasort']						=$row['areasort'];
			    $rtn[$i]['areainvalid']						=$row['areainvalid'];
			    $rtn[$i]['countryflg']						=$row['countryflg'];




				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }	       
	       
       function getActivitymainByAreaid($id){
		
			$sql = "select c.*,r.*,a.* from activitymain as a  left join company as c on a.activitymaincmpcd=c.companyid  left join areas as r on r.areaid  =a.area_id  where a.activitymaindeleterid=0 and a.area_fid = ?";

			$tmp="$id";

			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			

			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['activitymainid']							=$row['activitymainid'];
			    $rtn[$i]['activitymainseq']							=$row['activitymainseq'];
			    $rtn[$i]['activitymaincmpcd']						=$row['activitymaincmpcd'];
			    $rtn[$i]['activitymainplncd']						=$row['activitymainplncd'];
			    $rtn[$i]['activitymainminpoint']					=$row['activitymainminpoint'];
			    
			    $rtn[$i]['activitymainpln_jp']						=$row['activitymainpln_jp'];
			    $rtn[$i]['activitymainpln_en']						=$row['activitymainpln_en'];
			    $rtn[$i]['activitymainpln_cn']						=$row['activitymainpln_cn'];
			    
			    $rtn[$i]['activitymainpln_tw']						=$row['activitymainpln_tw'];
			    $rtn[$i]['activitymainpln_kr']						=$row['activitymainpln_kr'];
			    $rtn[$i]['activitymainkbn']							=$row['activitymainkbn'];
			    $rtn[$i]['activitymainunit_jp']						=$row['activitymainunit_jp'];
			    $rtn[$i]['activitymainunit_en']						=$row['activitymainunit_en'];
			    $rtn[$i]['activitymainunit_cn']						=$row['activitymainunit_cn'];
			    $rtn[$i]['activitymainunit_tw']						=$row['activitymainunit_tw'];
			    $rtn[$i]['activitymainunit_kr']						=$row['activitymainunit_kr'];
			    $rtn[$i]['activitymainmod']							=$row['activitymainmod'];
			    $rtn[$i]['activitymainnoshowbaby']					=$row['activitymainnoshowbaby'];
			    
			    $rtn[$i]['activitymaincmt_jp']						=$row['activitymaincmt_jp'];
			    $rtn[$i]['activitymaincmt_en']						=$row['activitymaincmt_en'];
			    
			    $rtn[$i]['activitymaincmt_cn']						=$row['activitymaincmt_cn'];
			    $rtn[$i]['activitymaincmt_tw']						=$row['activitymaincmt_tw'];
			    $rtn[$i]['activitymaincmt_kr']						=$row['activitymaincmt_kr'];
			    $rtn[$i]['activitymainimg']							=$row['activitymainimg'];
			    $rtn[$i]['activitymainimgcp_jp']					=$row['activitymainimgcp_jp'];
			    
			    $rtn[$i]['activitymainimgcp_en']					=$row['activitymainimgcp_en'];
			    $rtn[$i]['activitymainimgcp_cn']					=$row['activitymainimgcp_cn'];
			    $rtn[$i]['activitymainimgcp_tw']					=$row['activitymainimgcp_tw'];
			    $rtn[$i]['activitymainimgcp_kr']					=$row['activitymainimgcp_kr'];
			    $rtn[$i]['activitymainreqtime']						=$row['activitymainreqtime'];
			    
			    $rtn[$i]['activitymainify']							=$row['activitymainify'];
			    $rtn[$i]['activitytype_id']							=$row['activitytype_id'];
			    $rtn[$i]['area_fid']								=$row['area_fid'];
			    $rtn[$i]['area_id']									=$row['area_id'];
			    $rtn[$i]['activitymainlangflg_jp']					=$row['activitymainlangflg_jp'];
			    $rtn[$i]['activitymainlangflg_en']					=$row['activitymainlangflg_en'];
			    $rtn[$i]['activitymainlangflg_cn']					=$row['activitymainlangflg_cn'];
			    $rtn[$i]['activitymainlangflg_tw']					=$row['activitymainlangflg_tw'];
			    $rtn[$i]['activitymainisopen']						=$row['activitymainisopen'];
			    
			    $rtn[$i]['activitymainlangflg_kr']					=$row['activitymainlangflg_kr'];


			    $rtn[$i]['companycd']					=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_cn']					=$row['companyname_cn'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];

			    $rtn[$i]['companymail']					=$row['companymail'];
			    $rtn[$i]['companypass']					=$row['companypass'];
			    $rtn[$i]['companytel_jp']					=$row['companytel_jp'];
			    $rtn[$i]['companytel_en']					=$row['companytel_en'];
			    $rtn[$i]['companytel_cn']					=$row['companytel_cn'];
			    $rtn[$i]['companytel_tw']					=$row['companytel_tw'];
			    $rtn[$i]['companytel_kr']					=$row['companytel_kr'];
			    $rtn[$i]['companyzipcd']					=$row['companyzipcd'];
			    $rtn[$i]['companyaddr1_jp']					=$row['companyaddr1_jp'];
			    $rtn[$i]['companyaddr2_jp']					=$row['companyaddr2_jp'];
			    $rtn[$i]['companyaddr1_en']					=$row['companyaddr1_en'];
			    $rtn[$i]['companyaddr2_en']					=$row['companyaddr2_en'];
			    $rtn[$i]['companyaddr1_cn']					=$row['companyaddr1_cn'];
			    $rtn[$i]['companyaddr2_cn']					=$row['companyaddr2_cn'];
			    $rtn[$i]['companyaddr1_tw']					=$row['companyaddr1_tw'];
			    $rtn[$i]['companyaddr2_tw']					=$row['companyaddr2_tw'];
			    $rtn[$i]['companyaddr1_kr']					=$row['companyaddr1_kr'];
			    $rtn[$i]['companyaddr2_kr']					=$row['companyaddr2_kr'];
			    $rtn[$i]['companyagtflg']					=$row['companyagtflg'];
			    $rtn[$i]['companymakerid']					=$row['companymakerid'];

			    $rtn[$i]['areafatherid']					=$row['areafatherid'];
			    $rtn[$i]['areaname_jp']					=$row['areaname_jp'];

				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }	       	              	       
       function getActivitydetail($id){
		
			$sql = "select * from activitydetail where activitydetaildeleter=0 and activitydetailid = ?";

			$tmp="$id";


			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['activitydetailid']						=$row['activitydetailid'];
			    $rtn[$i]['activitydetailseqcd']						=$row['activitydetailseqcd'];
			    $rtn[$i]['activitymain_id']							=$row['activitymain_id'];
			    $rtn[$i]['activitydetailcrscd']						=$row['activitydetailcrscd'];
			    $rtn[$i]['activitydetailcrs_jp']					=$row['activitydetailcrs_jp'];
			    $rtn[$i]['activitydetailcrs_en']					=$row['activitydetailcrs_en'];
			    $rtn[$i]['activitydetailcrs_cn']					=$row['activitydetailcrs_cn'];
			    
			    $rtn[$i]['activitydetailcrs_tw']					=$row['activitydetailcrs_tw'];
			    $rtn[$i]['activitydetailcrs_kr']					=$row['activitydetailcrs_kr'];
			    $rtn[$i]['activitydetailfrom']						=$row['activitydetailfrom'];
			    $rtn[$i]['activitydetailto']						=$row['activitydetailto'];
			    
			    $rtn[$i]['activitydetailperiod']					=$row['activitydetailperiod'];
			     
			    $rtn[$i]['activitystock']							=$row['activitystock'];
		   
			    
			    $rtn[$i]['activitydetailschdtal_jp']				=$row['activitydetailschdtal_jp'];
			    $rtn[$i]['activitydetailschdtal_en']				=$row['activitydetailschdtal_en'];
			    $rtn[$i]['activitydetailschdtal_cn']				=$row['activitydetailschdtal_cn'];
			    $rtn[$i]['activitydetailschdtal_tw']				=$row['activitydetailschdtal_tw'];
			    $rtn[$i]['activitydetailschdtal_kr']				=$row['activitydetailschdtal_kr'];
			    $rtn[$i]['activitydetailinstrct_jp']				=$row['activitydetailinstrct_jp'];
			    $rtn[$i]['activitydetailinstrct_en']				=$row['activitydetailinstrct_en'];
			    
			    $rtn[$i]['activitydetailinstrct_cn']				=$row['activitydetailinstrct_cn'];
			    $rtn[$i]['activitydetailinstrct_tw']				=$row['activitydetailinstrct_tw'];
			    $rtn[$i]['activitydetailinstrct_kr']				=$row['activitydetailinstrct_kr'];
			    $rtn[$i]['activitydetailfarcont_jp']				=$row['activitydetailfarcont_jp'];
			    $rtn[$i]['activitydetailfarcont_en']				=$row['activitydetailfarcont_en'];
			    
			    $rtn[$i]['activitydetailfarcont_cn']				=$row['activitydetailfarcont_cn'];
			    $rtn[$i]['activitydetailfarcont_tw']				=$row['activitydetailfarcont_tw'];
			    $rtn[$i]['activitydetailfarcont_kr']				=$row['activitydetailfarcont_kr'];
			    $rtn[$i]['activitydetailmetplc_jp']					=$row['activitydetailmetplc_jp'];
			    $rtn[$i]['activitydetailmetplc_en']					=$row['activitydetailmetplc_en'];
			    
			    $rtn[$i]['activitydetailmetplc_cn']					=$row['activitydetailmetplc_cn'];
			    $rtn[$i]['activitydetailmetplc_tw']					=$row['activitydetailmetplc_tw'];
			    $rtn[$i]['activitydetailmetplc_kr']					=$row['activitydetailmetplc_kr'];
			    $rtn[$i]['activitydetaillat']						=$row['activitydetaillat'];
			    $rtn[$i]['activitydetaillon']						=$row['activitydetaillon'];
			    $rtn[$i]['activitydetailmettime_jp']				=$row['activitydetailmettime'];
			    $rtn[$i]['activitydetailmettime_en']				=$row['activitydetailmettime_en'];
			    $rtn[$i]['activitydetailmettime_cn']				=$row['activitydetailmettime_cn'];
			    $rtn[$i]['activitydetailmettime_tw']				=$row['activitydetailmettime_tw'];
			    $rtn[$i]['activitydetailmettime_kr']				=$row['activitydetailmettime_kr'];
			    
			    
			     $rtn[$i]['activitydetailmininum']					=$row['activitydetailmininum'];
			    $rtn[$i]['activitydetailminpar']					=$row['activitydetailminpar'];
			    $rtn[$i]['activitydetailmaxpar']					=$row['activitydetailmaxpar'];
			    
			    $rtn[$i]['activitydetailtejmaid']					=$row['activitydetailtejmaid'];
			    
			    $rtn[$i]['activitydetailtejmait']					=$row['activitydetailtejmait'];
			    $rtn[$i]['activitydetailsttjmid']					=$row['activitydetailsttjmid'];
			    $rtn[$i]['activitydetailsttjmit']					=$row['activitydetailsttjmit'];
			    $rtn[$i]['activitydetailimg1']						=$row['activitydetailimg1'];
			    $rtn[$i]['activitydetailimg2']						=$row['activitydetailimg2'];
			    $rtn[$i]['activitydetailimg3']						=$row['activitydetailimg3'];
			    $rtn[$i]['activitydetailimg4']						=$row['activitydetailimg4'];
			    $rtn[$i]['activitydetailimgcp1_jp']					=$row['activitydetailimgcp1_jp'];
			    $rtn[$i]['activitydetailimgcp1_en']					=$row['activitydetailimgcp1_en'];
			    $rtn[$i]['activitydetailimgcp1_cn']					=$row['activitydetailimgcp1_cn'];
			    $rtn[$i]['activitydetailimgcp1_tw']					=$row['activitydetailimgcp1_tw'];
			    $rtn[$i]['activitydetailimgcp1_kr']					=$row['activitydetailimgcp1_kr'];
			    $rtn[$i]['activitydetailimgcp2_jp']					=$row['activitydetailimgcp2_jp'];
			    $rtn[$i]['activitydetailimgcp2_en']					=$row['activitydetailimgcp2_en'];
			    $rtn[$i]['activitydetailimgcp2_cn']					=$row['activitydetailimgcp2_cn'];
			    $rtn[$i]['activitydetailimgcp2_tw']					=$row['activitydetailimgcp2_tw'];
			    $rtn[$i]['activitydetailimgcp2_kr']					=$row['activitydetailimgcp2_kr'];
			    $rtn[$i]['activitydetailimgcp3_jp']					=$row['activitydetailimgcp3_jp'];
			    $rtn[$i]['activitydetailimgcp3_en']					=$row['activitydetailimgcp3_en'];
			    $rtn[$i]['activitydetailimgcp3_cn']					=$row['activitydetailimgcp3_cn'];
			    $rtn[$i]['activitydetailimgcp3_tw']					=$row['activitydetailimgcp3_tw'];
			    $rtn[$i]['activitydetailimgcp3_kr']					=$row['activitydetailimgcp3_kr'];
			    $rtn[$i]['activitydetailimgcp4_jp']					=$row['activitydetailimgcp4_jp'];
			    $rtn[$i]['activitydetailimgcp4_en']					=$row['activitydetailimgcp4_en'];
			    $rtn[$i]['activitydetailimgcp4_cn']					=$row['activitydetailimgcp4_cn'];
			    $rtn[$i]['activitydetailimgcp4_tw']					=$row['activitydetailimgcp4_tw'];
			    $rtn[$i]['activitydetailimgcp4_kr']					=$row['activitydetailimgcp4_kr'];
			    $rtn[$i]['activitydetailmov_jp']					=$row['activitydetailmov_jp'];
			    $rtn[$i]['activitydetailmov_en']					=$row['activitydetailmov_en'];
			    $rtn[$i]['activitydetailmov_cn']					=$row['activitydetailmov_cn'];
			    $rtn[$i]['activitydetailmov_tw']					=$row['activitydetailmov_tw'];
			    $rtn[$i]['activitydetailmov_kr']					=$row['activitydetailmov_kr'];
			    $rtn[$i]['activitydetailmovcmt_jp']					=$row['activitydetailmovcmt_jp'];
			    $rtn[$i]['activitydetailmovcmt_en']					=$row['activitydetailmovcmt_en'];
			    $rtn[$i]['activitydetailmovcmt_cn']					=$row['activitydetailmovcmt_cn'];
			    $rtn[$i]['activitydetailmovcmt_tw']					=$row['activitydetailmovcmt_tw'];
			    $rtn[$i]['activitydetailmovcmt_kr']					=$row['activitydetailmovcmt_kr'];
			    
			    $rtn[$i]['question_jp']								=$row['question_jp'];
			    $rtn[$i]['question_en']								=$row['question_en'];
			    $rtn[$i]['question_cn']								=$row['question_cn'];
			    $rtn[$i]['question_tw']								=$row['question_tw'];
			    $rtn[$i]['question_kr']								=$row['question_kr'];
			    
			    
			    $rtn[$i]['activitydetailmovurl']					=$row['activitydetailmovurl'];
			    $rtn[$i]['activitydetailreqtime']					=$row['activitydetailreqtime'];			    
			    $rtn[$i]['activitydetailstartage']					=$row['activitydetailstartage'];			    
			    $rtn[$i]['activitydetailendage']					=$row['activitydetailendage'];			    
			    
			    $rtn[$i]['activitydetaildeleter']					=$row['activitydetaildeleter'];
			    $rtn[$i]['activitydetailcreattime']					=$row['activitydetailcreattime'];


				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }	       
	              
       function getPlaymaster($id){
		
			$sql = "select * from playmaster as p left join company as c on c.companyid=p.playcompany_id where p.playdeteleter=0 and p.playid= ?";

			$tmp="$id";



			$stmt = $this->link->prepare($sql);
			$stmt->bind_param("i", $id);
			
			
			
			$stmt->execute();
			$result = $stmt->get_result();
			$num_of_rows = $result->num_rows;

			$i=0;
			while ($row = $result->fetch_assoc()) {
			    $rtn[$i]['playid']							=$row['playid'];
			    $rtn[$i]['playcd']							=$row['playcd'];
			    $rtn[$i]['playminipoint']					=$row['playminipoint'];
			    
			    $rtn[$i]['playname_jp']						=$row['playname_jp'];
			    $rtn[$i]['playname_en']						=$row['playname_en'];
			    $rtn[$i]['playname_cn']						=$row['playname_cn'];
			    $rtn[$i]['playname_tw']						=$row['playname_tw'];
			    $rtn[$i]['playname_kr']						=$row['playname_kr'];
			    
			    $rtn[$i]['playcompany_id']					=$row['playcompany_id'];
			    $rtn[$i]['playpic1']						=$row['playpic1'];
			    $rtn[$i]['playpic2']						=$row['playpic2'];
			    $rtn[$i]['playpic3']						=$row['playpic3'];
			    $rtn[$i]['playpic4']						=$row['playpic4'];
			    $rtn[$i]['playpic5']						=$row['playpic5'];
			    $rtn[$i]['playdescription_jp']				=$row['playdescription_jp'];
			    $rtn[$i]['playdescription_en']				=$row['playdescription_en'];
			    $rtn[$i]['playdescription_cn']				=$row['playdescription_cn'];
			    $rtn[$i]['playdescription_tw']				=$row['playdescription_tw'];
			    $rtn[$i]['playdescription_kr']				=$row['playdescription_kr'];
			    
			    $rtn[$i]['playnotes_jp']					=$row['playnotes_jp'];
			    $rtn[$i]['playnotes_en']					=$row['playnotes_en'];
			    $rtn[$i]['playnotes_cn']					=$row['playnotes_cn'];
			    $rtn[$i]['playnotes_tw']					=$row['playnotes_tw'];
			    $rtn[$i]['playnotes_kr']					=$row['playnotes_kr'];
			    
			    $rtn[$i]['playplace_jp']					=$row['playplace_jp'];
			    $rtn[$i]['playplace_en']					=$row['playplace_en'];
			    $rtn[$i]['playplace_cn']					=$row['playplace_cn'];
			    $rtn[$i]['playplace_tw']					=$row['playplace_tw'];
			    $rtn[$i]['playplace_kr']					=$row['playplace_kr'];
			    
			    $rtn[$i]['playlongitude']					=$row['playlongitude'];
			    $rtn[$i]['playlatitude']					=$row['playlatitude'];
			    $rtn[$i]['playcontact']						=$row['playcontact'];
			    $rtn[$i]['playaccess_jp']					=$row['playaccess_jp'];
			    $rtn[$i]['playaccess_en']					=$row['playaccess_en'];
			    $rtn[$i]['playaccess_cn']					=$row['playaccess_cn'];
			    $rtn[$i]['playaccess_tw']					=$row['playaccess_tw'];
			    $rtn[$i]['playaccess_kr']					=$row['playaccess_kr'];
			    
			    $rtn[$i]['playclose']						=$row['playclose'];
			    $rtn[$i]['playclose_en']						=$row['playclose_en'];
			    $rtn[$i]['playclose_cn']						=$row['playclose_cn'];
			    $rtn[$i]['playclose_tw']						=$row['playclose_tw'];
			    $rtn[$i]['playclose_kr']						=$row['playclose_kr'];
			    
			    
			    
			    
			    $rtn[$i]['playopenstart']					=$row['playopenstart'];
			    $rtn[$i]['playopenstart_en']					=$row['playopenstart_en'];
			    $rtn[$i]['playopenstart_cn']					=$row['playopenstart_cn'];
			    $rtn[$i]['playopenstart_tw']					=$row['playopenstart_tw'];
			    $rtn[$i]['playopenstart_kr']					=$row['playopenstart_kr'];

			    $rtn[$i]['playopenend']						=$row['playopenend'];
			    $rtn[$i]['playopenend_en']						=$row['playopenend_en'];
			    $rtn[$i]['playopenend_cn']						=$row['playopenend_cn'];
			    $rtn[$i]['playopenend_tw']						=$row['playopenend_tw'];
			    $rtn[$i]['playopenend_kr']						=$row['playopenend_kr'];
			    
			    
			    $rtn[$i]['playhpurl']						=$row['playhpurl'];
			    $rtn[$i]['playutubeurl']					=$row['playutubeurl'];
			    $rtn[$i]['area_id']							=$row['area_id'];
			    $rtn[$i]['areafather_id']					=$row['areafather_id'];
			    $rtn[$i]['activitytype_id']					=$row['activitytype_id'];
			   
			    $rtn[$i]['jplangflg']						=$row['jplangflg'];
			    $rtn[$i]['enlangflg']						=$row['enlangflg'];
			    $rtn[$i]['cnlangflg']						=$row['cnlangflg'];
			    $rtn[$i]['twlangflg']						=$row['twlangflg'];
			    $rtn[$i]['krlangflg']						=$row['krlangflg'];
			   
			    $rtn[$i]['playisopen']						=$row['playisopen'];
			    
			    $rtn[$i]['playdeteleter']					=$row['playdeteleter'];
			    $rtn[$i]['playupdater']						=$row['playupdater'];
			    $rtn[$i]['playupdatetime']					=$row['playupdatetime'];
			    $rtn[$i]['playcreater']						=$row['playcreater'];
			    
			    $rtn[$i]['playordercnt']					=$row['playordercnt'];
			    
			    
			    $rtn[$i]['playcreatetime']					=$row['playcreatetime'];
			    
			    $rtn[$i]['companyid']						=$row['companyid'];
			    $rtn[$i]['companycd']						=$row['companycd'];
			    $rtn[$i]['companyname_jp']					=$row['companyname_jp'];
			    $rtn[$i]['companyname_en']					=$row['companyname_en'];
			    $rtn[$i]['companyname_tw']					=$row['companyname_tw'];
			    $rtn[$i]['companyname_kr']					=$row['companyname_kr'];
			    $rtn[$i]['companymail']						=$row['companymail'];
			    $rtn[$i]['companyagtflg']					=$row['companyagtflg'];

			    
			    
			    
				$i++;
			}
		  $stmt->free_result();
  
		  return $rtn;
		         
       }	       
	   
	   

	       function updatePlaymaster(
				$playid,	
				$playcd,
				$playminipoint,
				$playname_jp,
				$playname_en,
				$playname_cn,
				$playname_tw,
				$playname_kr,
				$playcompany_id,
				$playpic1,
				$playpic2,
				$playpic3,
				$playpic4,
				$playpic5,
				$playdescription_jp,
				$playdescription_en,
				$playdescription_cn,
				$playdescription_tw,
				$playdescription_kr,
				$playnotes_jp,
				$playnotes_en,
				$playnotes_cn,
				$playnotes_tw,
				$playnotes_kr,
				$playplace_jp,
				$playplace_en,
				$playplace_cn,
				$playplace_tw,
				$playplace_kr,
				$playlongitude,
				$playlatitude,
				$playcontact,
				$playaccess_jp,
				$playaccess_en,
				$playaccess_cn,
				$playaccess_tw,
				$playaccess_kr,
				$playclose,
				$playclose_en,
				$playclose_cn,
				$playclose_tw,
				$playclose_kr,
				$playopenstart,
				$playopenstart_en,
				$playopenstart_cn,
				$playopenstart_tw,
				$playopenstart_kr,
				
				$playopenend,
				$playopenend_en,
				$playopenend_cn,
				$playopenend_tw,
				$playopenend_kr,
				
				$playhpurl,
				$playutubeurl,
				$areafather_id,
				$area_id,
				$activitytype_id,
				$jplangflg,
				$enlangflg,
				$cnlangflg,
				$twlangflg,
				$krlangflg,		
				$playisopen,							
				$playupdater
		       ){
		      // echo "qqqqqqqqqq-> $playid,$playcd,$playname_jp,$playcompany_id,$playadultNormalprice,$playchildrenNormalprice,$playadultOriginalprice,$playchildrenOriginalprice,$playpic1,$playpic2,$playpic3,$playpic4,$playpic5,$playdescription,$playnotes,$playplace,$playlongitude,$playlatitude,$playcontact,$playaccess,$playclose,$playopenstart,$playopenend,$playhpurl,$playutubeurl,$playarea,$playupdater<--";
		   
		       		$sellerupdatedate=date('Y-m-d');
					$sql="update playmaster 
						set
						playcd						= TRIM(?),
						playminipoint				= ?,
						playname_jp					= ?,
						playname_en					= ?,
						playname_cn					= ?,
						playname_tw					= ?,
						playname_kr					= ?,
						
						playcompany_id				= ?,
						playpic1					= ?,
						playpic2					= ?,
						playpic3					= ?,
						playpic4					= ?,
						playpic5					= ?,
						playdescription_jp			= ?,
						playdescription_en			= ?,
						playdescription_cn			= ?,
						playdescription_tw			= ?,
						playdescription_kr			= ?,
						
						playnotes_jp				= ?,
						playnotes_en				= ?,
						playnotes_cn				= ?,
						playnotes_tw				= ?,
						playnotes_kr				= ?,
						
						playplace_jp				= ?,
						playplace_en				= ?,
						playplace_cn				= ?,
						playplace_tw				= ?,
						playplace_kr				= ?,
						
						playlongitude				= ?,
						playlatitude				= ?,
						playcontact					= ?,
						playaccess_jp				= ?,
						playaccess_en				= ?,
						playaccess_cn				= ?,
						playaccess_tw				= ?,
						playaccess_kr				= ?,
						
						playclose					= ?,
						playclose_en				= ?,
						playclose_cn				= ?,
						playclose_tw				= ?,
						playclose_kr				= ?,
						
						playopenstart				= ?,
						playopenstart_en				= ?,
						playopenstart_cn				= ?,
						playopenstart_tw				= ?,
						playopenstart_kr				= ?,
						
						playopenend					= ?,
						playopenend_en					= ?,
						playopenend_cn					= ?,
						playopenend_tw					= ?,
						playopenend_kr					= ?,
						
						playhpurl					= ?,
						playutubeurl				= ?,
						area_id						= ?,
						areafather_id				= ?,
						activitytype_id				= ?,
						jplangflg				= ?,
						enlangflg				= ?,
						cnlangflg				= ?,
						twlangflg				= ?,
						krlangflg				= ?,	
						playisopen				=?,						
						playupdater					= ?,
						playupdatetime				= TRIM(?) 
						 where playid  				= ?
						";

						$tmp="
						$playcd,
						$playminipoint,
						$playname_jp,
						$playname_en,
						$playname_cn,
						$playname_tw,
						$playname_kr,
						$playcompany_id,
						$playpic1,
						$playpic2,
						$playpic3,
						$playpic4,
						$playpic5,
						$playdescription_jp,
						$playdescription_en,
						$playdescription_cn,
						$playdescription_tw,
						$playdescription_kr,
						$playnotes_jp,
						$playnotes_en,
						$playnotes_cn,
						$playnotes_tw,
						$playnotes_kr,
						$playplace_jp,
						$playplace_en,
						$playplace_cn,
						$playplace_tw,
						$playplace_kr,
						$playlongitude,
						$playlatitude,
						$playcontact,
						$playaccess_jp,
						$playaccess_en,
						$playaccess_cn,
						$playaccess_tw,
						$playaccess_kr,
						$playclose,
						$playclose_en,
						$playclose_cn,
						$playclose_tw,
						$playclose_kr,						
						$playopenstart,
						$playopenstart_en,
						$playopenstart_cn,
						$playopenstart_tw,
						$playopenstart_kr,
						$playopenend,
						$playopenend_en,
						$playopenend_cn,
						$playopenend_tw,
						$playopenend_kr,
						$playhpurl,
						$playutubeurl,
						$area_id,
						$areafather_id,
						$activitytype_id,
						$jplangflg,
						$enlangflg,
						$cnlangflg,
						$twlangflg,
						$krlangflg,				
						$playisopen,				
						$playupdater,
						$sellerupdatedate,
						$playid
					";


					$stmt =$this->link->prepare($sql);

				
					$stmt->bind_param(
						"sssssssisssssssssssssssssssssssssssssssssssssssssssssiiiiiiiiiisi",
						$playcd,
						$playminipoint,
						$playname_jp,
						$playname_en,
						$playname_cn,
						$playname_tw,
						$playname_kr,
						$playcompany_id,
						$playpic1,
						$playpic2,
						$playpic3,
						$playpic4,
						$playpic5,
						$playdescription_jp,
						$playdescription_en,
						$playdescription_cn,
						$playdescription_tw,
						$playdescription_kr,
						$playnotes_jp,
						$playnotes_en,
						$playnotes_cn,
						$playnotes_tw,
						$playnotes_kr,
						$playplace_jp,
						$playplace_en,
						$playplace_cn,
						$playplace_tw,
						$playplace_kr,
						$playlongitude,
						$playlatitude,
						$playcontact,
						$playaccess_jp,
						$playaccess_en,
						$playaccess_cn,
						$playaccess_tw,
						$playaccess_kr,
						$playclose,
						$playclose_en,
						$playclose_cn,
						$playclose_tw,
						$playclose_kr,						
						$playopenstart,
						$playopenstart_en,
						$playopenstart_cn,
						$playopenstart_tw,
						$playopenstart_kr,
						$playopenend,
						$playopenend_en,
						$playopenend_cn,
						$playopenend_tw,
						$playopenend_kr,
						$playhpurl,
						$playutubeurl,
						$area_id,
						$areafather_id,
						$activitytype_id,
						$jplangflg,
						$enlangflg,
						$cnlangflg,
						$twlangflg,
						$krlangflg,				
						$playisopen,				
						$playupdater,
						$sellerupdatedate,
						$playid
					);

					$done = $stmt->execute();
					if($done){
						return 1;
					}else{
						echo $stmt->error;
						return -1;
					}
	       } 



	       function updateActivitymain(
					$sellerid,			
					$activitymainid,	
					$activitymainseq,		
					$activitymaincmpcd,		
					$activitymainplncd,	
					$activitymainminpoint,	
					$activitymainpln_jp,		
					$activitymainpln_en,		
					$activitymainpln_cn,		
					$activitymainpln_tw,		
					$activitymainpln_kr,		
					$activitymainkbn,		
					$activitymainunit_jp,	
					$activitymainunit_en,	
					$activitymainunit_cn,	
					$activitymainunit_tw,	
					$activitymainunit_kr,	
					$activitymainmod,	
					$activitymainnoshowbaby,	
					$activitymaincmt_jp,		
					$activitymaincmt_en,		
					$activitymaincmt_cn,		
					$activitymaincmt_tw,		
					$activitymaincmt_kr,		
					$activitymainimg,		
					$activitymainimgcp_jp,	
					$activitymainimgcp_en,	
					$activitymainimgcp_cn,	
					$activitymainimgcp_tw,	
					$activitymainimgcp_kr,	
					$activitymainreqtime,	
					$activitymainify,		
					$activitytype_id,		
					$area_fid,				
					$area_id,				
					$activitymainlangflg_jp,
					$activitymainlangflg_en,	
					$activitymainlangflg_cn,	
					$activitymainlangflg_tw,	
					$activitymainlangflg_kr,
					$activitymainisopen	
		       ){
		      // echo "qqqqqqqqqq-> $playid,$playcd,$playname_jp,$playcompany_id,$playadultNormalprice,$playchildrenNormalprice,$playadultOriginalprice,$playchildrenOriginalprice,$playpic1,$playpic2,$playpic3,$playpic4,$playpic5,$playdescription,$playnotes,$playplace,$playlongitude,$playlatitude,$playcontact,$playaccess,$playclose,$playopenstart,$playopenend,$playhpurl,$playutubeurl,$playarea,$playupdater<--";

		       		$sellerupdatedate=date('Y-m-d');
					$sql="update activitymain 
						set
							activitymainseq				= ?,	
							activitymaincmpcd			= ?,			
							activitymainplncd			= ?,	
							activitymainminpoint		= ?,	
							activitymainpln_jp			= ?,			
							activitymainpln_en			= ?,			
							activitymainpln_cn			= ?,			
							activitymainpln_tw			= ?,			
							activitymainpln_kr			= ?,			
							activitymainkbn				= ?,				
							activitymainunit_jp			= ?,			
							activitymainunit_en			= ?,				
							activitymainunit_cn			= ?,				
							activitymainunit_tw			= ?,					
							activitymainunit_kr			= ?,				
							activitymainmod				= ?,	
							activitymainnoshowbaby		= ?,			
							activitymaincmt_jp			= ?,				
							activitymaincmt_en			= ?,				
							activitymaincmt_cn			= ?,				
							activitymaincmt_tw			= ?,				
							activitymaincmt_kr			= ?,				
							activitymainimg				= ?,				
							activitymainimgcp_jp		= ?,				
							activitymainimgcp_en		= ?,				
							activitymainimgcp_cn		= ?,				
							activitymainimgcp_tw		= ?,				
							activitymainimgcp_kr		= ?,				
							activitymainreqtime			= ?,				
							activitymainify				= ?,				
							activitytype_id				= ?,				
							area_fid					= ?,				
							area_id						= ?,				
							activitymainlangflg_jp		= ?,				
							activitymainlangflg_en		= ?,				
							activitymainlangflg_cn		= ?,				
							activitymainlangflg_tw		= ?,			
							activitymainlangflg_kr	    = ?,
							activitymainupdaterid	    = ?,
							activitymainisopen			= ?
							 where activitymainid		= ?
						";

					$tmp="
						$activitymainseq,		
						$activitymaincmpcd,		
						$activitymainplncd,		
						$activitymainminpoint,
						$activitymainpln_jp,		
						$activitymainpln_en,		
						$activitymainpln_cn,		
						$activitymainpln_tw,		
						$activitymainpln_kr,		
						$activitymainkbn,		
						$activitymainunit_jp,	
						$activitymainunit_en,	
						$activitymainunit_cn,	
						$activitymainunit_tw,	
						$activitymainunit_kr,	
						$activitymainmod,	
						$activitymainnoshowbaby,	
						$activitymaincmt_jp,		
						$activitymaincmt_en,		
						$activitymaincmt_cn,		
						$activitymaincmt_tw,		
						$activitymaincmt_kr,		
						$activitymainimg,		
						$activitymainimgcp_jp,	
						$activitymainimgcp_en,	
						$activitymainimgcp_cn,	
						$activitymainimgcp_tw,	
						$activitymainimgcp_kr,	
						$activitymainreqtime,	
						$activitymainify,		
						$activitytype_id,		
						$area_fid,				
						$area_id,				
						$activitymainlangflg_jp,
						$activitymainlangflg_en,	
						$activitymainlangflg_cn,	
						$activitymainlangflg_tw,	
						$activitymainlangflg_kr,
						$sellerid,
						$activitymainisopen,
						$activitymainid
					";

					$stmt =$this->link->prepare($sql);

				
					$stmt->bind_param(
						"sissssssssssssssisssssssssssiiiiiiiiiiiii",
		
						$activitymainseq,		
						$activitymaincmpcd,		
						$activitymainplncd,	
						$activitymainminpoint,	
						$activitymainpln_jp,		
						$activitymainpln_en,		
						$activitymainpln_cn,		
						$activitymainpln_tw,		
						$activitymainpln_kr,		
						$activitymainkbn,		
						$activitymainunit_jp,	
						$activitymainunit_en,	
						$activitymainunit_cn,	
						$activitymainunit_tw,	
						$activitymainunit_kr,	
						$activitymainmod,		
						$activitymainnoshowbaby,
						$activitymaincmt_jp,		
						$activitymaincmt_en,		
						$activitymaincmt_cn,		
						$activitymaincmt_tw,		
						$activitymaincmt_kr,		
						$activitymainimg,		
						$activitymainimgcp_jp,	
						$activitymainimgcp_en,	
						$activitymainimgcp_cn,	
						$activitymainimgcp_tw,	
						$activitymainimgcp_kr,	
						$activitymainreqtime,	
						$activitymainify,		
						$activitytype_id,		
						$area_fid,				
						$area_id,				
						$activitymainlangflg_jp,
						$activitymainlangflg_en,	
						$activitymainlangflg_cn,	
						$activitymainlangflg_tw,	
						$activitymainlangflg_kr,
						$sellerid,
						$activitymainisopen,
						$activitymainid
					);

					$done = $stmt->execute();
					if($done){
						return 1;
					}else{
						echo $stmt->error;
						return -1;
					}
	       } 
              
		function is_email($email){
			$has_at = strpos($email, "@");
			$has_dot = strpos($email, ".");
	
			if($has_at && $has_dot){
				return 1;
			}else{
				return 0;
			}
		}	       
	       
         function delPlaymaster($id,$deleteby){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update playmaster set playdeteleter = ?  where playid  = ?";
	       		
	       		$tmp="$id,$deleteby";

		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('ii',$deleteby,$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	       }

         function updatePlaymasterOrderCNT($id){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update playmaster set playordercnt = playordercnt+1  where playid  = ?";
		
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('i',$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	       }
	       
         function updateActivitymainOrderCNT($id){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update activitymain set activitymainordercnt = activitymainordercnt+1  where activitymainid  = ?";
				$tmp="$id";

				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('i',$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	       }
	       
         function updateActivitydetailOrderCNT($id){
        
	       		$sellerupdatedate=date('Y-m-d');
	       		
	       		$sql = "update activitydetail set activitydetailordercnt = activitydetailordercnt+1  where activitydetailid  = ?";
				$tmp="$id";

				
				$stmt =$this->link->prepare($sql);
				if($stmt){
					$stmt->bind_param('i',$id);
				}
				$done = $stmt->execute();
				if($done){
					return 1;
				}else{
					echo $stmt->error;
					return -1;
				}
	       }
	       	       	       	       
	                           		
}






